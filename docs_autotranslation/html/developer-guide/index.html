<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenDaylight Developer Guide &mdash; OpenDaylight Documentation Boron documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.3.6/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'Boron',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="OpenDaylight Documentation Boron documentation" href="../index.html" />
    <link rel="prev" title="OpenDaylight User Guide" href="../user-guide/index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/odl_small.png"></span>
          OpenDaylight Documentation</a>
        <span class="navbar-text navbar-version pull-left"><b>Boron</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-guide/index.html">OpenDaylight Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto-openstack/index.html">OpenDaylight and OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">OpenDaylight User Guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">OpenDaylight Developer Guide</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">OpenDaylight Developer Guide</a><ul>
<li><a class="reference internal" href="#getting-started-with-git-and-gerrit">Getting started with Git and Gerrit</a><ul>
<li><a class="reference internal" href="#overview-of-git-and-gerrit">Overview of Git and Gerrit</a></li>
<li><a class="reference internal" href="#setting-up-a-gerrit-account">Setting up a Gerrit account</a></li>
<li><a class="reference internal" href="#generating-ssh-keys-for-your-system">Generating SSH keys for your system</a></li>
<li><a class="reference internal" href="#registering-your-ssh-key-with-gerrit">Registering your SSH key with Gerrit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pulling-and-pushing-the-code-from-the-cli">Pulling and Pushing the Code from the CLI</a><ul>
<li><a class="reference internal" href="#pulling-code-via-git-cli">Pulling code via Git CLI</a></li>
<li><a class="reference internal" href="#setting-up-gerrit-change-id-commit-message-hook">Setting up Gerrit Change-id Commit Message Hook</a></li>
<li><a class="reference internal" href="#building-the-code">Building the code</a></li>
<li><a class="reference internal" href="#runing-opendaylight-from-local-build">Runing OpenDaylight from local build</a></li>
<li><a class="reference internal" href="#commit-the-code-using-git-cli">Commit the code using Git CLI</a></li>
<li><a class="reference internal" href="#pulling-the-code-changes-via-git-cli">Pulling the Code changes via Git CLI</a></li>
<li><a class="reference internal" href="#pushing-the-code-via-git-cli">Pushing the Code via Git CLI</a><ul>
<li><a class="reference internal" href="#viewing-your-changes-in-gerrit">Viewing your Changes in Gerrit</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#developing-apps-on-the-opendaylight-controller">Developing Apps on the OpenDaylight controller</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#pre-requisites">Pre requisites</a></li>
<li><a class="reference internal" href="#building-an-example-module">Building an example module</a></li>
<li><a class="reference internal" href="#defining-a-simple-hello-world-rpc">Defining a Simple Hello World RPC</a></li>
<li><a class="reference internal" href="#add-a-simple-helloworld-rpc-api">Add a simple HelloWorld RPC API</a></li>
<li><a class="reference internal" href="#implement-the-helloworld-rpc-api">Implement the HelloWorld RPC API</a></li>
<li><a class="reference internal" href="#execute-the-hello-project-for-the-first-time">Execute the <em>hello</em> project for the first time</a></li>
<li><a class="reference internal" href="#test-the-hello-world-rpc-via-rest">Test the <em>hello-world</em> RPC via REST</a><ul>
<li><a class="reference internal" href="#using-the-api-explorer-through-http">Using the API Explorer through HTTP</a></li>
<li><a class="reference internal" href="#using-a-browser-rest-client">Using a browser REST client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alto-developer-guide">ALTO Developer Guide</a><ul>
<li><a class="reference internal" href="#id2">Overview</a></li>
<li><a class="reference internal" href="#adding-alto-projects-as-dependencies">Adding ALTO Projects as Dependencies</a></li>
<li><a class="reference internal" href="#putting-fetching-data-from-alto">Putting/Fetching data from ALTO</a><ul>
<li><a class="reference internal" href="#using-restful-api">Using RESTful API</a></li>
<li><a class="reference internal" href="#using-ad-sal">Using AD-SAL</a></li>
<li><a class="reference internal" href="#using-md-sal">Using MD-SAL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#providing-customized-implementation">Providing Customized Implementation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#armoury">Armoury</a><ul>
<li><a class="reference internal" href="#id3">Overview</a></li>
<li><a class="reference internal" href="#armoury-architecture">Armoury Architecture</a></li>
<li><a class="reference internal" href="#key-apis-and-interfaces">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#armoury-catalog-api">Armoury Catalog API</a></li>
<li><a class="reference internal" href="#armoury-workload-manager-api">Armoury Workload Manager API</a></li>
<li><a class="reference internal" href="#armoury-driver-registry-api">Armoury Driver Registry API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-reference-documentation">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bgp-developer-guide">BGP Developer Guide</a><ul>
<li><a class="reference internal" href="#id4">Overview</a></li>
<li><a class="reference internal" href="#bgp-architecture">BGP Architecture</a></li>
<li><a class="reference internal" href="#id5">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#bgp-concepts">BGP concepts</a></li>
<li><a class="reference internal" href="#bgp-parser">BGP parser</a><ul>
<li><a class="reference internal" href="#registration">Registration</a></li>
<li><a class="reference internal" href="#serializing">Serializing</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#bgp-rib">BGP RIB</a><ul>
<li><a class="reference internal" href="#session-handling">Session handling</a></li>
<li><a class="reference internal" href="#synchronization">Synchronization</a></li>
<li><a class="reference internal" href="#rib-handling">RIB handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bgp-inet">BGP inet</a></li>
<li><a class="reference internal" href="#bgp-flowspec">BGP flowspec</a></li>
<li><a class="reference internal" href="#bgp-linkstate">BGP linkstate</a></li>
<li><a class="reference internal" href="#bgp-topology-provider">BGP topology provider</a></li>
<li><a class="reference internal" href="#id6">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#capwap-developer-guide">CAPWAP Developer Guide</a><ul>
<li><a class="reference internal" href="#id7">Overview</a></li>
<li><a class="reference internal" href="#capwap-architecture">CAPWAP Architecture</a></li>
<li><a class="reference internal" href="#capwap-apis-and-interfaces">CAPWAP APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#discovered-wtps">Discovered WTPs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller">Controller</a><ul>
<li><a class="reference internal" href="#id9">Overview</a></li>
<li><a class="reference internal" href="#md-sal-overview">MD-SAL Overview</a><ul>
<li><a class="reference internal" href="#basic-concepts">Basic concepts</a></li>
<li><a class="reference internal" href="#messaging-patterns">Messaging Patterns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#md-sal-data-transactions">MD-SAL Data Transactions</a><ul>
<li><a class="reference internal" href="#write-only-read-write-transaction">Write-Only &amp; Read-Write Transaction</a><ul>
<li><a class="reference internal" href="#modification-of-data-tree">Modification of Data Tree</a></li>
<li><a class="reference internal" href="#submitting-transaction">Submitting transaction</a></li>
<li><a class="reference internal" href="#transaction-local-state">Transaction local state</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transaction-isolation">Transaction isolation</a></li>
<li><a class="reference internal" href="#commit-failure-scenarios">Commit failure scenarios</a><ul>
<li><a class="reference internal" href="#example-conflict-of-two-transactions">Example conflict of two transactions</a></li>
<li><a class="reference internal" href="#example-asynchronous-retry-loop">Example asynchronous retry-loop</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concurrent-change-compatibility">Concurrent change compatibility</a></li>
</ul>
</li>
<li><a class="reference internal" href="#md-sal-rpc-routing">MD-SAL RPC routing</a><ul>
<li><a class="reference internal" href="#modeling-a-routed-rpc">Modeling a routed RPC</a><ul>
<li><a class="reference internal" href="#declaring-a-routing-context-type">Declaring a routing context type</a></li>
<li><a class="reference internal" href="#declaring-possible-context-instances">Declaring possible context instances</a></li>
<li><a class="reference internal" href="#declaring-a-routed-rpc">Declaring a routed RPC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-routed-rpcs">Using routed RPCs</a></li>
<li><a class="reference internal" href="#implementing-a-routed-rpc">Implementing a routed RPC</a><ul>
<li><a class="reference internal" href="#registering-implementations">Registering implementations</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#opendaylight-controller-md-sal-restconf">OpenDaylight Controller MD-SAL: RESTCONF</a><ul>
<li><a class="reference internal" href="#resconf-operations-overview">RESCONF operations overview</a></li>
<li><a class="reference internal" href="#mount-point">Mount point</a></li>
<li><a class="reference internal" href="#http-methods">HTTP methods</a><ul>
<li><a class="reference internal" href="#options-restconf">OPTIONS /restconf</a></li>
<li><a class="reference internal" href="#get-restconf-config-identifier">GET /restconf/config/&lt;identifier&gt;</a></li>
<li><a class="reference internal" href="#get-restconf-operational-identifier">GET /restconf/operational/&lt;identifier&gt;</a></li>
<li><a class="reference internal" href="#put-restconf-config-identifier">PUT /restconf/config/&lt;identifier&gt;</a></li>
<li><a class="reference internal" href="#post-restconf-config">POST /restconf/config</a></li>
<li><a class="reference internal" href="#post-restconf-config-identifier">POST /restconf/config/&lt;identifier&gt;</a></li>
<li><a class="reference internal" href="#post-restconf-operations-modulename-rpcname">POST /restconf/operations/&lt;moduleName&gt;:&lt;rpcName&gt;</a></li>
<li><a class="reference internal" href="#delete-restconf-config-identifier">DELETE /restconf/config/&lt;identifier&gt;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-restconf-works">How RESTCONF works</a></li>
<li><a class="reference internal" href="#get-in-action">GET in action</a></li>
<li><a class="reference internal" href="#put-in-action">PUT in action</a></li>
<li><a class="reference internal" href="#something-practical">Something practical</a></li>
</ul>
</li>
<li><a class="reference internal" href="#websocket-change-event-notification-subscription-tutorial">Websocket change event notification subscription tutorial</a><ul>
<li><a class="reference internal" href="#websocket-notifications-subscription-process">Websocket notifications subscription process</a><ul>
<li><a class="reference internal" href="#create-stream">Create stream</a></li>
<li><a class="reference internal" href="#subscribe-to-stream">Subscribe to stream</a></li>
<li><a class="reference internal" href="#receive-notifications">Receive notifications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-use-case">Example use case</a></li>
<li><a class="reference internal" href="#simple-javascript-client-implementation">Simple javascript client implementation</a><ul>
<li><a class="reference internal" href="#id10">Create stream</a></li>
<li><a class="reference internal" href="#id11">Subscribe to stream</a></li>
<li><a class="reference internal" href="#id12">Receive notifications</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#config-subsystem">Config Subsystem</a><ul>
<li><a class="reference internal" href="#id13">Overview</a></li>
<li><a class="reference internal" href="#validation">Validation</a></li>
<li><a class="reference internal" href="#dependency-resolver">Dependency resolver</a></li>
<li><a class="reference internal" href="#apis-and-spis">APIs and SPIs</a><ul>
<li><a class="reference internal" href="#spis">SPIs</a></li>
<li><a class="reference internal" href="#apis">APIs</a></li>
<li><a class="reference internal" href="#runtime-apis">Runtime APIs</a></li>
<li><a class="reference internal" href="#jmx-apis">JMX APIs</a></li>
<li><a class="reference internal" href="#use-case-scenarios">Use case scenarios</a></li>
<li><a class="reference internal" href="#default-module-instances">Default module instances</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#didm-developer-guide">DIDM Developer Guide</a><ul>
<li><a class="reference internal" href="#id14">Overview</a></li>
<li><a class="reference internal" href="#didm-architecture">DIDM Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dlux">DLUX</a><ul>
<li><a class="reference internal" href="#setup-and-run">Setup and Run</a><ul>
<li><a class="reference internal" href="#required-technology-stack">Required Technology Stack</a></li>
<li><a class="reference internal" href="#run-dlux">Run DLUX</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dlux-modules">DLUX Modules</a><ul>
<li><a class="reference internal" href="#module-structure">Module Structure</a></li>
<li><a class="reference internal" href="#create-new-module">Create New Module</a><ul>
<li><a class="reference internal" href="#define-the-module">Define the module</a></li>
<li><a class="reference internal" href="#set-the-register-function">Set the register function</a></li>
<li><a class="reference internal" href="#set-the-route">Set the route</a></li>
<li><a class="reference internal" href="#adding-element-to-the-navigation-menu">Adding element to the navigation menu</a></li>
<li><a class="reference internal" href="#link-the-angularjs-modules-controller-file">Link the AngularJS module’s controller file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-the-controller-factory-directive-etc">Create the controller, factory, directive, etc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-new-application-using-dlux-modularity">Add new application using DLUX modularity</a><ul>
<li><a class="reference internal" href="#add-a-new-osgi-blueprint-bundle">Add a new OSGi blueprint bundle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yang-utils">Yang Utils</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iotdm-developer-guide">IoTDM Developer Guide</a><ul>
<li><a class="reference internal" href="#id15">Overview</a></li>
<li><a class="reference internal" href="#onem2m-architecture">oneM2M Architecture</a></li>
<li><a class="reference internal" href="#id16">Key APIs and Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#l2switch-developer-guide">L2Switch Developer Guide</a><ul>
<li><a class="reference internal" href="#id17">Overview</a></li>
<li><a class="reference internal" href="#l2switch-architecture">L2Switch Architecture</a></li>
<li><a class="reference internal" href="#id18">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#packet-dispatcher">Packet Dispatcher</a><ul>
<li><a class="reference internal" href="#classes">Classes</a></li>
<li><a class="reference internal" href="#further-development">Further development</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loop-remover">Loop Remover</a><ul>
<li><a class="reference internal" href="#id19">Classes</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#id20">Further development</a></li>
<li><a class="reference internal" href="#validating-changes-to-loop-remover">Validating changes to Loop Remover</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arp-handler">Arp Handler</a><ul>
<li><a class="reference internal" href="#id21">Classes</a></li>
<li><a class="reference internal" href="#id22">Configuration</a></li>
<li><a class="reference internal" href="#id23">Further development</a></li>
</ul>
</li>
<li><a class="reference internal" href="#address-tracker">Address Tracker</a><ul>
<li><a class="reference internal" href="#id24">Classes</a></li>
<li><a class="reference internal" href="#id25">Configuration</a></li>
<li><a class="reference internal" href="#id26">Further development</a></li>
<li><a class="reference internal" href="#validating-changes-to-address-tracker">Validating changes to Address Tracker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developers-guide-for-host-tracker">Developer’s Guide for Host Tracker</a><ul>
<li><a class="reference internal" href="#validationg-changes-to-host-tracker">Validationg changes to Host Tracker</a></li>
</ul>
</li>
<li><a class="reference internal" href="#l2switch-main">L2Switch Main</a><ul>
<li><a class="reference internal" href="#id27">Classes</a></li>
<li><a class="reference internal" href="#id28">Configuration</a></li>
<li><a class="reference internal" href="#id29">Further development</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id30">API Reference Documentation</a></li>
<li><a class="reference internal" href="#checking-out-the-l2switch-project">Checking out the L2Switch project</a></li>
<li><a class="reference internal" href="#testing-your-changes-to-the-l2switch-project">Testing your changes to the L2Switch project</a><ul>
<li><a class="reference internal" href="#running-the-l2switch-project">Running the L2Switch project</a></li>
<li><a class="reference internal" href="#create-a-network-using-mininet">Create a network using mininet</a></li>
<li><a class="reference internal" href="#generating-network-traffic-using-mininet">Generating network traffic using mininet</a></li>
<li><a class="reference internal" href="#miscellaneous-mininet-commands">Miscellaneous mininet commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#lacp-developer-guide">LACP Developer Guide</a><ul>
<li><a class="reference internal" href="#lacp-overview">LACP Overview</a></li>
<li><a class="reference internal" href="#lacp-architecture">LACP Architecture</a><ul>
<li><a class="reference internal" href="#how-lag-programming-is-implemented">How LAG programming is implemented</a></li>
<li><a class="reference internal" href="#how-applications-can-program-openflow-flows-using-lacp-created-lag-groups">How applications can program OpenFlow flows using LACP-created LAG groups</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#messaging4transport-developer-guide">Messaging4Transport Developer Guide</a><ul>
<li><a class="reference internal" href="#id31">Overview</a></li>
<li><a class="reference internal" href="#messaging4transport-architecture">Messaging4Transport Architecture</a></li>
<li><a class="reference internal" href="#id32">Key APIs and Interfaces</a></li>
<li><a class="reference internal" href="#use-cases">Use Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#netconf-developer-guide">NETCONF Developer Guide</a><ul>
<li><a class="reference internal" href="#sample-app-overview">Sample app overview</a><ul>
<li><a class="reference internal" href="#ncmountprovider">NcmountProvider</a><ul>
<li><a class="reference internal" href="#retrieve-mountpointservice">Retrieve MountPointService</a></li>
<li><a class="reference internal" href="#listen-for-connection-state-changes">Listen for connection state changes</a></li>
<li><a class="reference internal" href="#reading-data-from-the-device">Reading data from the device</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#network-intent-composition-nic-developer-guide">Network Intent Composition (NIC) Developer Guide</a><ul>
<li><a class="reference internal" href="#id33">Overview</a></li>
<li><a class="reference internal" href="#odl-nic-core">odl-nic-core</a><ul>
<li><a class="reference internal" href="#post-put-configuration">POST / PUT (configuration)</a></li>
<li><a class="reference internal" href="#get-configuration-operational">GET (configuration / operational)</a></li>
<li><a class="reference internal" href="#delete-configuration">DELETE (configuration)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#odl-nic-cli">odl-nic-cli</a><ul>
<li><a class="reference internal" href="#intent-add">intent:add</a></li>
<li><a class="reference internal" href="#intent-update">intent:update</a></li>
<li><a class="reference internal" href="#intent-delete">intent:delete</a></li>
<li><a class="reference internal" href="#intent-list">intent:list</a></li>
<li><a class="reference internal" href="#intent-show">intent:show</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#network-modeling-nemo">NEtwork MOdeling (NEMO)</a><ul>
<li><a class="reference internal" href="#id34">Overview</a></li>
<li><a class="reference internal" href="#nemo-architecture">NEMO Architecture</a></li>
<li><a class="reference internal" href="#id35">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#nemo-intent-api">NEMO Intent API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id36">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#netide-developer-guide">NetIDE Developer Guide</a><ul>
<li><a class="reference internal" href="#id37">Overview</a></li>
<li><a class="reference internal" href="#netide-intermediate-protocol">NetIDE Intermediate Protocol</a><ul>
<li><a class="reference internal" href="#protocol-specification">Protocol specification</a></li>
<li><a class="reference internal" href="#module-announcement">Module announcement</a></li>
<li><a class="reference internal" href="#heartbeat">Heartbeat</a></li>
<li><a class="reference internal" href="#handshake">Handshake</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#neutron-northbound">Neutron Northbound</a><ul>
<li><a class="reference internal" href="#how-to-write-a-sb-neutron-consumer">How to Write a SB Neutron Consumer</a></li>
<li><a class="reference internal" href="#how-to-use-the-legacy-i-aware-interfaces">How to use the legacy I*Aware interfaces</a><ul>
<li><a class="reference internal" href="#the-semantics-of-the-can-methods">The semantics of the can*() methods</a></li>
<li><a class="reference internal" href="#the-semantics-of-the-neutron-methods">The semantics of the neutron*() methods</a></li>
<li><a class="reference internal" href="#how-to-register-your-consumer-with-the-neutron-service">How to register your consumer with the Neutron Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-use-the-neutron-yang-model">How to use the Neutron YANG model</a><ul>
<li><a class="reference internal" href="#the-semantics-of-the-tomd-methods">The semantics of the toMD() methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#odl-sdni-developer-guide">ODL-SDNi Developer Guide</a><ul>
<li><a class="reference internal" href="#id38">Overview</a></li>
<li><a class="reference internal" href="#odl-sdni-architecture">ODL-SDNi Architecture</a></li>
<li><a class="reference internal" href="#sdni-aggregator">SDNi Aggregator</a></li>
<li><a class="reference internal" href="#sdni-rest-api">SDNi REST API</a></li>
<li><a class="reference internal" href="#sdni-wrapper">SDNi Wrapper</a></li>
<li><a class="reference internal" href="#id39">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openflow-protocol-library-developer-guide">OpenFlow Protocol Library Developer Guide</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#features-overview">Features Overview</a></li>
<li><a class="reference internal" href="#odl-openflowjava-protocol-architecture">odl-openflowjava-protocol Architecture</a></li>
<li><a class="reference internal" href="#odl-openflowjava-stats-feature">odl-openflowjava-stats Feature</a></li>
<li><a class="reference internal" href="#id40">Key APIs and Interfaces</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#id41">Configuration</a></li>
<li><a class="reference internal" href="#architecture">Architecture</a><ul>
<li><a class="reference internal" href="#public-api-openflow-protocol-api">Public API <code class="docutils literal"><span class="pre">(openflow-protocol-api)</span></code></a></li>
<li><a class="reference internal" href="#tcp-channel-pipeline-openflow-protocol-impl">TCP Channel pipeline <code class="docutils literal"><span class="pre">(openflow-protocol-impl)</span></code></a></li>
<li><a class="reference internal" href="#udp-channel-pipeline-openflow-protocol-impl">UDP Channel pipeline (openflow-protocol-impl)</a></li>
<li><a class="reference internal" href="#spi-openflow-protocol-spi">SPI (openflow-protocol-spi)</a></li>
<li><a class="reference internal" href="#integration-test-openflow-protocol-it">Integration test (openflow-protocol-it)</a></li>
<li><a class="reference internal" href="#simple-client-simple-client">Simple client(simple-client)</a></li>
<li><a class="reference internal" href="#utility-util">Utility (util)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#librarys-lifecycle">Library’s lifecycle</a></li>
<li><a class="reference internal" href="#statistics-collection">Statistics collection</a><ul>
<li><a class="reference internal" href="#id42">Introduction</a></li>
<li><a class="reference internal" href="#karaf">Karaf</a></li>
<li><a class="reference internal" href="#jconsole">JConsole</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tls-support">TLS Support</a></li>
<li><a class="reference internal" href="#extensibility">Extensibility</a><ul>
<li><a class="reference internal" href="#id43">Introduction</a></li>
<li><a class="reference internal" href="#basic-principle">Basic Principle</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#detailed-walkthrough-deserialization-extensibility">Detailed walkthrough: Deserialization extensibility</a></li>
<li><a class="reference internal" href="#detailed-walkthrough-serialization-extensibility">Detailed walkthrough: Serialization extensibility</a></li>
<li><a class="reference internal" href="#internal-description">Internal description</a></li>
<li><a class="reference internal" href="#registration-keys">Registration keys</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#openflow-plugin-project-developer-guide">OpenFlow Plugin Project Developer Guide</a><ul>
<li><a class="reference internal" href="#event-sequences">Event Sequences</a><ul>
<li><a class="reference internal" href="#session-establishment">Session Establishment</a></li>
<li><a class="reference internal" href="#id44">Handshake</a><ul>
<li><a class="reference internal" href="#step-by-step-negotiation">STEP-BY-STEP negotiation:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-flow">Adding a Flow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#internal-message-statistics-api">Internal message statistics API</a><ul>
<li><a class="reference internal" href="#collect">Collect</a></li>
<li><a class="reference internal" href="#expose-statistics">Expose statistics</a><ul>
<li><a class="reference internal" href="#example-results">Example results</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#karaf-feature-tree">Karaf feature tree</a></li>
<li><a class="reference internal" href="#wiring-up-notifications">Wiring up notifications</a><ul>
<li><a class="reference internal" href="#id45">Introduction</a></li>
<li><a class="reference internal" href="#mechanics">Mechanics</a><ul>
<li><a class="reference internal" href="#create-a-translator-class">Create a Translator class</a></li>
<li><a class="reference internal" href="#register-your-translator-class">Register your Translator Class</a></li>
<li><a class="reference internal" href="#register-your-md-sal-message-for-notification-to-the-md-sal">Register your MD-SAL Message for Notification to the MD-SAL</a></li>
<li><a class="reference internal" href="#you-are-done">You are done</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#message-order-preservation">Message Order Preservation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opflex-agent-ovs-developer-guide">OpFlex agent-ovs Developer Guide</a><ul>
<li><a class="reference internal" href="#id46">Overview</a></li>
<li><a class="reference internal" href="#agent-ovs-architecture">agent-ovs Architecture</a></li>
<li><a class="reference internal" href="#id47">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opflex-genie-developer-guide">OpFlex genie Developer Guide</a><ul>
<li><a class="reference internal" href="#id48">Overview</a></li>
<li><a class="reference internal" href="#group-based-policy-model">Group-based Policy Model</a></li>
<li><a class="reference internal" href="#id49">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opflex-libopflex-developer-guide">OpFlex libopflex Developer Guide</a><ul>
<li><a class="reference internal" href="#id50">Overview</a><ul>
<li><a class="reference internal" href="#object-model">Object Model</a></li>
<li><a class="reference internal" href="#programming-by-side-effect">Programming by Side Effect</a></li>
<li><a class="reference internal" href="#threading-and-ownership">Threading and Ownership</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id51">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#basic-usage-and-initialization">Basic Usage and Initialization</a></li>
<li><a class="reference internal" href="#working-with-data-in-the-tree">Working with Data in the Tree</a><ul>
<li><a class="reference internal" href="#reading-from-the-tree">Reading from the Tree</a></li>
<li><a class="reference internal" href="#writing-to-the-tree">Writing to the Tree</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-notifications">Update Notifications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id52">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ovsdb-md-sal-southbound-plugin-developer-guide">OVSDB MD-SAL Southbound Plugin Developer Guide</a><ul>
<li><a class="reference internal" href="#id53">Overview</a></li>
<li><a class="reference internal" href="#ovsdb-md-sal-southbound-plugin-architecture-and-operation">OVSDB MD-SAL Southbound Plugin Architecture and Operation</a><ul>
<li><a class="reference internal" href="#connecting-to-an-ovsdb-node">Connecting to an OVSDB Node</a><ul>
<li><a class="reference internal" href="#active-ovsdb-node-manager-workflow">Active OVSDB Node Manager Workflow</a></li>
<li><a class="reference internal" href="#passive-ovsdb-node-manager-workflow">Passive OVSDB Node Manager Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ovsdb-node-id-in-the-southbound-operational-md-sal">OVSDB Node ID in the Southbound Operational MD-SAL</a></li>
<li><a class="reference internal" href="#ovsdb-changes-by-using-ovsdb-southbound-config-md-sal">OVSDB Changes by using OVSDB Southbound Config MD-SAL</a></li>
<li><a class="reference internal" href="#detecting-changes-in-ovsdb-coming-from-outside-opendaylight">Detecting changes in OVSDB coming from outside OpenDaylight</a></li>
<li><a class="reference internal" href="#ovsdb-model">OVSDB Model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples-of-ovsdb-southbound-md-sal-api">Examples of OVSDB Southbound MD-SAL API</a><ul>
<li><a class="reference internal" href="#connect-to-an-ovsdb-node">Connect to an OVSDB Node</a></li>
<li><a class="reference internal" href="#query-the-ovsdb-southbound-configuration-md-sal">Query the OVSDB Southbound Configuration MD-SAL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-documentation">Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ovsdb-openstack-developer-guide">OVSDB Openstack Developer Guide</a><ul>
<li><a class="reference internal" href="#id54">Overview</a></li>
<li><a class="reference internal" href="#ovsdb-openstack-architecture">OVSDB Openstack Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ovsdb-service-function-chaining-developer-guide">OVSDB Service Function Chaining Developer Guide</a><ul>
<li><a class="reference internal" href="#id55">Overview</a></li>
<li><a class="reference internal" href="#ovsdb-hardware-vtep-architecture">OVSDB Hardware VTEP Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ovsdb-hardware-vtep-developer-guide">OVSDB Hardware VTEP Developer Guide</a><ul>
<li><a class="reference internal" href="#id56">Overview</a></li>
<li><a class="reference internal" href="#id57">OVSDB Hardware VTEP Architecture</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pcep-developer-guide">PCEP Developer Guide</a><ul>
<li><a class="reference internal" href="#id58">Overview</a></li>
<li><a class="reference internal" href="#pcep-architecture">PCEP Architecture</a></li>
<li><a class="reference internal" href="#id59">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#pcep">PCEP</a><ul>
<li><a class="reference internal" href="#id60">Session handling</a></li>
<li><a class="reference internal" href="#parser">Parser</a></li>
<li><a class="reference internal" href="#id61">Registration</a></li>
<li><a class="reference internal" href="#parsing">Parsing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pcep-ietf-stateful">PCEP IETF stateful</a></li>
<li><a class="reference internal" href="#pcep-segment-routing-sr">PCEP segment routing (SR)</a></li>
<li><a class="reference internal" href="#pcep-topology">PCEP Topology</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id62">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#packetcable-developer-guide">PacketCable Developer Guide</a><ul>
<li><a class="reference internal" href="#pcmm-specification">PCMM Specification</a></li>
<li><a class="reference internal" href="#system-overview">System Overview</a></li>
<li><a class="reference internal" href="#packetcable-components">PacketCable Components</a><ul>
<li><a class="reference internal" href="#setting-logging-levels">Setting Logging Levels</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tools-for-testing">Tools for Testing</a><ul>
<li><a class="reference internal" href="#postman-rest-client-for-chrome">Postman REST client for Chrome</a></li>
<li><a class="reference internal" href="#view-rest-api">View Rest API</a></li>
<li><a class="reference internal" href="#yang-ide">Yang-IDE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-wireshark-to-trace-pcmm">Using Wireshark to Trace PCMM</a></li>
<li><a class="reference internal" href="#debugging-and-verifying-dqos-gate-flows-on-the-ccap-cmts">Debugging and Verifying DQoS Gate (Flows) on the CCAP/CMTS</a><ul>
<li><a class="reference internal" href="#cisco">Cisco</a></li>
<li><a class="reference internal" href="#find-the-cable-modem">Find the Cable Modem</a></li>
<li><a class="reference internal" href="#show-pcmm-plugin-connection">Show PCMM Plugin Connection</a></li>
<li><a class="reference internal" href="#show-cops-messages">Show COPS Messages</a></li>
<li><a class="reference internal" href="#use-cm-mac-address-to-list-service-flows">Use CM Mac Address to List Service Flows</a></li>
<li><a class="reference internal" href="#deleting-a-pcmm-gate-message-from-the-cmts">Deleting a PCMM Gate Message from the CMTS</a></li>
<li><a class="reference internal" href="#find-service-flows">Find service flows</a></li>
<li><a class="reference internal" href="#debug-and-display-pcmm-gate-messages">Debug and display PCMM Gate messages</a></li>
<li><a class="reference internal" href="#debug-cops-messages">Debug COPS messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-verification">Integration Verification</a><ul>
<li><a class="reference internal" href="#service-wrapper">service-wrapper</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#service-function-chaining">Service Function Chaining</a><ul>
<li><a class="reference internal" href="#opendaylight-service-function-chaining-sfc-overiew">OpenDaylight Service Function Chaining (SFC) Overiew</a></li>
<li><a class="reference internal" href="#sfc-classifier-control-and-date-plane-developer-guide">SFC Classifier Control and Date plane Developer guide</a><ul>
<li><a class="reference internal" href="#id63">Overview</a></li>
<li><a class="reference internal" href="#classifier-architecture">Classifier Architecture</a></li>
<li><a class="reference internal" href="#id64">Key APIs and Interfaces</a></li>
<li><a class="reference internal" href="#id65">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sfc-ovs-plugin">SFC-OVS Plugin</a><ul>
<li><a class="reference internal" href="#id66">Overview</a></li>
<li><a class="reference internal" href="#sfc-ovs-architecture">SFC-OVS Architecture</a></li>
<li><a class="reference internal" href="#id67">Key APIs and Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sfc-southbound-rest-plugin">SFC Southbound REST Plugin</a><ul>
<li><a class="reference internal" href="#id68">Overview</a></li>
<li><a class="reference internal" href="#southbound-rest-plugin-architecture">Southbound REST Plugin Architecture</a></li>
<li><a class="reference internal" href="#id69">Key APIs and Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-function-load-balancing-developer-guide">Service Function Load Balancing Developer Guide</a><ul>
<li><a class="reference internal" href="#id70">Overview</a></li>
<li><a class="reference internal" href="#load-balancing-architecture">Load Balancing Architecture</a></li>
<li><a class="reference internal" href="#id71">Key APIs and Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-function-scheduling-algorithms">Service Function Scheduling Algorithms</a><ul>
<li><a class="reference internal" href="#id72">Overview</a></li>
<li><a class="reference internal" href="#id73">Architecture</a></li>
<li><a class="reference internal" href="#id74">Key APIs and Interfaces</a></li>
<li><a class="reference internal" href="#id75">API Reference Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sxp-developer-guide">SXP Developer Guide</a><ul>
<li><a class="reference internal" href="#id76">Overview</a></li>
<li><a class="reference internal" href="#sxp-architecture">SXP Architecture</a></li>
<li><a class="reference internal" href="#id77">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#sxp-controller">sxp-controller</a></li>
<li><a class="reference internal" href="#sxp-api">sxp-api</a></li>
<li><a class="reference internal" href="#spx-core">spx-core</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id78">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tcpmd5-developer-guide">TCPMD5 Developer Guide</a><ul>
<li><a class="reference internal" href="#id79">Overview</a></li>
<li><a class="reference internal" href="#tcpmd5-architecture">TCPMD5 Architecture</a></li>
<li><a class="reference internal" href="#id80">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#tcpmd5-api">tcpmd5-api</a></li>
<li><a class="reference internal" href="#tcpmd5-jni">tcpmd5-jni</a></li>
<li><a class="reference internal" href="#tcpmd5-nio">tcpmd5-nio</a></li>
<li><a class="reference internal" href="#tcpmd5-netty">tcpmd5-netty</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#topology-processing-framework-developer-guide">Topology Processing Framework Developer Guide</a><ul>
<li><a class="reference internal" href="#id81">Overview</a></li>
<li><a class="reference internal" href="#topology-processing-framework-architecture">Topology Processing Framework Architecture</a></li>
<li><a class="reference internal" href="#aggregation-and-filtration">Aggregation and Filtration</a><ul>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#id82">Introduction</a></li>
<li><a class="reference internal" href="#aggregation">Aggregation</a><ul>
<li><a class="reference internal" href="#create-overlay-node">Create overlay node</a></li>
<li><a class="reference internal" href="#update-node">Update node</a></li>
<li><a class="reference internal" href="#remove-node">Remove node</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filtration">Filtration</a><ul>
<li><a class="reference internal" href="#nodeipfiltration">NodeIpFiltration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#wrapper-rpc-republishing-writing-mechanism">Wrapper, RPC republishing, writing mechanism</a><ul>
<li><a class="reference internal" href="#rpc-republishing">RPC republishing</a><ul>
<li><a class="reference internal" href="#rpc-call">RPC Call</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-mechanism">Writing mechanism</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classes-relationships">Classes relationships</a></li>
<li><a class="reference internal" href="#id83">Key APIs and Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ttp-model-developer-guide">TTP Model Developer Guide</a><ul>
<li><a class="reference internal" href="#id84">Overview</a></li>
<li><a class="reference internal" href="#ttp-model-architecture">TTP Model Architecture</a></li>
<li><a class="reference internal" href="#id85">Key APIs and Interfaces</a></li>
<li><a class="reference internal" href="#id86">API Reference Documentation</a><ul>
<li><a class="reference internal" href="#restconf">RESTCONF</a></li>
<li><a class="reference internal" href="#java-bindings">Java Bindings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-ttp-model-restconf-apis">Using the TTP Model RESTCONF APIs</a><ul>
<li><a class="reference internal" href="#setting-rest-http-headers">Setting REST HTTP Headers</a><ul>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#content-type-and-accept">Content-Type and Accept</a></li>
</ul>
</li>
<li><a class="reference internal" href="#content">Content</a></li>
<li><a class="reference internal" href="#making-a-rest-call">Making a REST Call</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ttp-cli-tools-developer-guide">TTP CLI Tools Developer Guide</a><ul>
<li><a class="reference internal" href="#id87">Overview</a></li>
<li><a class="reference internal" href="#ttp-cli-tools-architecture">TTP CLI Tools Architecture</a></li>
<li><a class="reference internal" href="#command-line-options">Command Line Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unified-secure-channel">Unified Secure Channel</a><ul>
<li><a class="reference internal" href="#id88">Overview</a></li>
<li><a class="reference internal" href="#usc-channel-architecture">USC Channel Architecture</a></li>
<li><a class="reference internal" href="#usc-channel-apis-and-interfaces">USC Channel APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#usc-channel-topology-api">USC Channel Topology API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id89">API Reference Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#virtual-tenant-network-vtn">Virtual Tenant Network (VTN)</a><ul>
<li><a class="reference internal" href="#opendaylight-virtual-tenant-network-vtn-overview">OpenDaylight Virtual Tenant Network (VTN) Overview</a><ul>
<li><a class="reference internal" href="#vtn-coordinator">VTN Coordinator</a><ul>
<li><a class="reference internal" href="#feature-overview">Feature Overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vtn-manager">VTN Manager</a><ul>
<li><a class="reference internal" href="#function-outline">Function Outline</a></li>
<li><a class="reference internal" href="#id92">Feature Overview</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage-examples">Usage Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yang-tools">YANG Tools</a><ul>
<li><a class="reference internal" href="#id93">Overview</a></li>
<li><a class="reference internal" href="#yang-java-binding-mapping-rules">YANG Java Binding: Mapping rules</a><ul>
<li><a class="reference internal" href="#general-conversion-rules">General conversion rules</a><ul>
<li><a class="reference internal" href="#package-names-of-yang-models">Package names of YANG models</a></li>
<li><a class="reference internal" href="#additional-packages">Additional Packages</a></li>
<li><a class="reference internal" href="#class-and-interface-names">Class and interface names</a></li>
<li><a class="reference internal" href="#getter-and-setter-names">Getter and setter names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statement-specific-mapping">Statement specific mapping</a><ul>
<li><a class="reference internal" href="#module-statement">module statement</a><ul>
<li><a class="reference internal" href="#data-interface">Data Interface</a></li>
<li><a class="reference internal" href="#service-interface">Service Interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#container-statement">container statement</a></li>
<li><a class="reference internal" href="#leaf-statement">Leaf statement</a></li>
<li><a class="reference internal" href="#leaf-list-statement">leaf-list statement</a></li>
<li><a class="reference internal" href="#list-statement">list statement</a></li>
<li><a class="reference internal" href="#choice-and-case-statements">choice and case statements</a></li>
<li><a class="reference internal" href="#grouping-and-uses-statements">grouping and uses statements</a></li>
<li><a class="reference internal" href="#rpc-input-and-output-statements">rpc, input and output statements</a></li>
<li><a class="reference internal" href="#notification-statement">notification statement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#augment-statement">augment statement</a></li>
<li><a class="reference internal" href="#yang-type-mapping">YANG Type mapping</a><ul>
<li><a class="reference internal" href="#typedef-statement">typedef statement</a><ul>
<li><a class="reference internal" href="#valid-arguments-type">Valid Arguments Type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enumeration-substatement-enum">Enumeration Substatement Enum</a></li>
<li><a class="reference internal" href="#bitss-substatement-bit">Bits’s Substatement Bit</a></li>
<li><a class="reference internal" href="#unions-substatement-type">Union’s Substatement Type</a></li>
<li><a class="reference internal" href="#string-mapping">String Mapping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#identity-statement">identity statement</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#yang-push-developer-guide">YANG-PUSH Developer Guide</a><ul>
<li><a class="reference internal" href="#id94">Overview</a><ul>
<li><a class="reference internal" href="#yang-push-capabilities-available">YANG-PUSH capabilities available</a></li>
<li><a class="reference internal" href="#future-yang-push-capabilities">Future YANG-PUSH capabilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yang-push-architecture">YANG-PUSH Architecture</a></li>
<li><a class="reference internal" href="#id95">Key APIs and Interfaces</a><ul>
<li><a class="reference internal" href="#yangpushdomprovider">YangpushDomProvider</a></li>
<li><a class="reference internal" href="#yangpushdomnotificationlistener">YangpushDOMNotificationListener</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id96">API Reference Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="../user-guide/index.html" title="Previous Chapter: OpenDaylight User Guide"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; OpenDaylight ...</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/developer-guide/index.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="opendaylight-developer-guide">
<h1>OpenDaylight Developer Guide<a class="headerlink" href="#opendaylight-developer-guide" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">OpenDaylight Community <a class="reference external" href="mailto:documentation&#37;&#52;&#48;opendaylight&#46;org">documentation<span>&#64;</span>opendaylight<span>&#46;</span>org</a></td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">2014-08-03</td>
</tr>
</tbody>
</table>
<div class="section" id="getting-started-with-git-and-gerrit">
<h2>Getting started with Git and Gerrit<a class="headerlink" href="#getting-started-with-git-and-gerrit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview-of-git-and-gerrit">
<h3>Overview of Git and Gerrit<a class="headerlink" href="#overview-of-git-and-gerrit" title="Permalink to this headline">¶</a></h3>
<p>Git is an opensource distributed version control system (dvcs) written
in the C language and originally developed by Linus Torvalds and others
to manage the Linux kernel. In Git, there is no central copy of the
repository. After you have cloned the repository, you have a functioning
copy of the source code with all the branches and tagged releases, in
your local repository.</p>
<p>Gerrit is an opensource web-based collaborative code review tool that
integrates with Git. It was developed at Google by Shawn Pearce. Gerrit
provides a framework for reviewing code commits before they are accepted
into the code base. Changes can be uploaded to Gerrit by any user.
However, the changes are not made a part of the project until a code
review is completed. Gerrit is also a good collaboration tool for
storing the conversations that occur around the code commits.</p>
<p>The OpenDaylight source code is hosted in a repository in Git.
Developers must use Gerrit to commit code to the OpenDaylight
repository.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>For more information on Git, see <a class="reference external" href="http://git-scm.com/">http://git-scm.com/</a>. For more
information on Gerrit, see <a class="reference external" href="https://code.google.com/p/gerrit/">https://code.google.com/p/gerrit/</a>.</p>
</div></blockquote>
</div>
<div class="section" id="setting-up-a-gerrit-account">
<h3>Setting up a Gerrit account<a class="headerlink" href="#setting-up-a-gerrit-account" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Using a Google Chrome or Mozilla Firefox browser, go to
<a class="reference external" href="https://git.opendaylight.org/gerrit">https://git.opendaylight.org/gerrit</a></li>
</ol>
<p>The main page shows existing Gerrit requests. These are patches that
have been pushed to the repository and not yet verified, reviewed, and
merged.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>If you already have an OpenDaylight account, you can click <strong>Sign
In</strong> in the top right corner of the page and follow the instructions
to enter the OpenDaylight page.</p>
</div></blockquote>
<div class="figure" id="id97">
<img alt="Signing in to OpenDaylight account" src="../_images/Sign_in.jpg" />
<p class="caption"><span class="caption-text">Signing in to OpenDaylight account</span></p>
</div>
<ol class="arabic simple">
<li>If you do not have an existing OpenDaylight account, click <strong>Account
signup/management</strong> on the top bar of the main Gerrit page.</li>
</ol>
<p>The <strong>WS02 Identity Server</strong> page is displayed.</p>
<div class="figure" id="id98">
<img alt="Gerrit Account signup/management link" src="../_images/Gerrit_setup.jpg" />
<p class="caption"><span class="caption-text">Gerrit Account signup/management link</span></p>
</div>
<ol class="arabic simple">
<li>In the <strong>WS02 Identity Server</strong> page, click <strong>Sign-up</strong> in the left
pane.</li>
</ol>
<p>There is also an option to authenticate your sign in with OpenID. This
option is not described in this document.</p>
<div class="figure" id="id99">
<img alt="Sign-up link for Gerrit account" src="../_images/sign-up.jpg" />
<p class="caption"><span class="caption-text">Sign-up link for Gerrit account</span></p>
</div>
<ol class="arabic simple">
<li>Click on the <strong>Sign-up with User Name/Password</strong> image on the right
pane to continue to the actual sign-up page.</li>
</ol>
<div class="figure" id="id100">
<img alt="Sign-up with User Name/Password Image" src="../_images/signup_image.jpg" />
<p class="caption"><span class="caption-text">Sign-up with User Name/Password Image</span></p>
</div>
<ol class="arabic simple">
<li>Fill out the details in the account creation form and then click
<strong>Submit</strong>.</li>
</ol>
<div class="figure" id="id101">
<img alt="Filling out the details" src="../_images/form_details.jpg" />
<p class="caption"><span class="caption-text">Filling out the details</span></p>
</div>
<p>You now have an OpenDaylight account that can be used with Gerrit to
pull the OpenDaylight code.</p>
</div>
<div class="section" id="generating-ssh-keys-for-your-system">
<h3>Generating SSH keys for your system<a class="headerlink" href="#generating-ssh-keys-for-your-system" title="Permalink to this headline">¶</a></h3>
<p>You must have SSH keys for your system to register with your Gerrit
account. The method for generating SSH keys is different for different
types of operating systems.</p>
<p>The key you register with Gerrit must be identical to the one you will
use later to pull or edit the code. For example, if you have a
development VM which has a different UID login and keygen than that of
your laptop, the SSH key you generate for the VM is different from the
laptop. If you register the SSH key generated on your VM with Gerrit and
do not reuse it on your laptop when using Git on the laptop, the pull
fails.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>For more information on SSH keys for Ubuntu, see
<a class="reference external" href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys">https://help.ubuntu.com/community/SSH/OpenSSH/Keys</a>. For generating
SSH keys for Windows, see
<a class="reference external" href="https://help.github.com/articles/generating-ssh-keys">https://help.github.com/articles/generating-ssh-keys</a>.</p>
</div></blockquote>
<p>For a system running Ubuntu operating system, follow the steps below:</p>
<ol class="arabic simple">
<li>Run the following command:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/.</span><span class="n">ssh</span>
<span class="n">chmod</span> <span class="mi">700</span> <span class="o">~/.</span><span class="n">ssh</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">t</span> <span class="n">rsa</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>You are prompted for a location to save the keys, and a passphrase
for the keys.</li>
</ol>
<p>This passphrase protects your private key while it is stored on the hard
drive. You must use the passphrase to use the keys every time you need
to login to a key-based system.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Generating</span> <span class="n">public</span><span class="o">/</span><span class="n">private</span> <span class="n">rsa</span> <span class="n">key</span> <span class="n">pair</span><span class="o">.</span>
<span class="n">Enter</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">b</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="p">(</span><span class="n">empty</span> <span class="k">for</span> <span class="n">no</span> <span class="n">passphrase</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">same</span> <span class="n">passphrase</span> <span class="n">again</span><span class="p">:</span>
<span class="n">Your</span> <span class="n">identification</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">b</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span>
<span class="n">Your</span> <span class="n">public</span> <span class="n">key</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">b</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span>
</pre></div>
</div>
<p>Your public key is now available as <strong>.ssh/id_rsa.pub</strong> in your home
folder.</p>
</div>
<div class="section" id="registering-your-ssh-key-with-gerrit">
<h3>Registering your SSH key with Gerrit<a class="headerlink" href="#registering-your-ssh-key-with-gerrit" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Using a Google Chrome or Mozilla Firefox browser, go to
<a class="reference external" href="https://git.opendaylight.org/gerrit">https://git.opendaylight.org/gerrit</a>.</li>
</ol>
<ol class="arabic simple">
<li>Click <strong>Sign In</strong> to access the OpenDaylight repository.</li>
</ol>
<div class="figure" id="id102">
<img alt="Signin in to OpenDaylight repository" src="../_images/Sign_in.jpg" />
<p class="caption"><span class="caption-text">Signin in to OpenDaylight repository</span></p>
</div>
<ol class="arabic simple">
<li>Click your name in the top right corner of the window and then click
<strong>Settings</strong>.</li>
</ol>
<p>The <strong>Settings</strong> page is displayed.</p>
<div class="figure" id="id103">
<img alt="Settings page for your Gerrit account" src="../_images/Gerrit_settings.jpg" />
<p class="caption"><span class="caption-text">Settings page for your Gerrit account</span></p>
</div>
<ol class="arabic simple">
<li>Click <strong>SSH Public Keys</strong> under <strong>Settings</strong>.</li>
<li>Click <strong>Add Key</strong>.</li>
<li>In the <strong>Add SSH Public Key</strong> text box, paste the contents of your
<strong>id_rsa.pub</strong> file and then click <strong>Add</strong>.</li>
</ol>
<div class="figure" id="id104">
<img alt="Adding your SSH key" src="../_images/SSH_keys.jpg" />
<p class="caption"><span class="caption-text">Adding your SSH key</span></p>
</div>
<p>To verify your SSH key is working correctly, try using an SSH client to
connect to Gerrit’s SSHD port.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ssh -p 29418 &lt;sshusername&gt;@git.opendaylight.org
Enter passphrase for key &#39;/home/cisco/.ssh/id_rsa&#39;:
****    Welcome to Gerrit Code Review    ****
Hi &lt;user&gt;, you have successfully connected over SSH.
Unfortunately, interactive shells are disabled.
To clone a hosted Git repository, use: git clone ssh://&lt;user&gt;@git.opendaylight.org:29418/REPOSITORY_NAME.git
Connection to git.opendaylight.org closed.
</pre></div>
</div>
<p>You can now proceed to either Pulling, Hacking, and Pushing the Code
from the CLI or Pulling, Hacking, and Pushing the Code from Eclipse
depending on your implementation.</p>
</div>
</div>
<div class="section" id="pulling-and-pushing-the-code-from-the-cli">
<h2>Pulling and Pushing the Code from the CLI<a class="headerlink" href="#pulling-and-pushing-the-code-from-the-cli" title="Permalink to this headline">¶</a></h2>
<p>OpenDayligh is a collection of projects, each with their own code
repository. This section provides a general guide for to pulling,
hacking, and pushing the code for each project. For project specific
detail, refer to the project’s section in this guide.</p>
<p>Code reviews are enabled through Gerrit. For setting up Gerrit see the
section on Getting started with Git and Gerrit.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>You will need to perform the Gerrit Setup before you can access git
via ssh as described below.</p>
</div></blockquote>
<div class="section" id="pulling-code-via-git-cli">
<h3>Pulling code via Git CLI<a class="headerlink" href="#pulling-code-via-git-cli" title="Permalink to this headline">¶</a></h3>
<p>Pull the code by cloning the project’s repository.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">ssh</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="p">:</span><span class="mi">29418</span><span class="o">/&lt;</span><span class="n">project_repo_name</span><span class="o">&gt;.</span><span class="n">git</span>
</pre></div>
</div>
<p>where &lt;username&gt; is your OpenDaylight username, and
&lt;project_repo_name&gt; is the name of the repository for project you are
trying to pull. Here is the current list of project repository names:</p>
<p>aaa, affinity, bgpcep, controller, defense4all, dlux, docs,
groupbasedpolicy, integration, l2switch, lispflowmapping, odlparent,
opendove, openflowjava, openflowplugin, opflex, ovsdb, packetcable,
reservation, sdninterfaceapp, sfc, snbi, snmp4sdn, toolkit, ttp, vtn,
yangtools.</p>
<p>For an anonymous git clone, you can use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">gerrit</span><span class="o">/</span><span class="n">p</span><span class="o">/&lt;</span><span class="n">project_repo_name</span><span class="o">&gt;.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-gerrit-change-id-commit-message-hook">
<h3>Setting up Gerrit Change-id Commit Message Hook<a class="headerlink" href="#setting-up-gerrit-change-id-commit-message-hook" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>This command inserts a unique Change-Id tag in the footer of a commit
message. This step is optional but highly recommended for tracking
changes.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">project_repo_name</span><span class="o">&gt;</span>
<span class="n">scp</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">P</span> <span class="mi">29418</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="p">:</span><span class="n">hooks</span><span class="o">/</span><span class="n">commit</span><span class="o">-</span><span class="n">msg</span> <span class="o">.</span><span class="n">git</span><span class="o">/</span><span class="n">hooks</span><span class="o">/</span>
<span class="n">chmod</span> <span class="mi">755</span> <span class="o">.</span><span class="n">git</span><span class="o">/</span><span class="n">hooks</span><span class="o">/</span><span class="n">commit</span><span class="o">-</span><span class="n">msg</span>
</pre></div>
</div>
<ul class="simple">
<li>Install and setup Git-review. Git-review is a great tool to simplify
the hassle of using several git commands to submit a patch for
review. Refer to <a class="reference external" href="http://www.mediawiki.org/wiki/Gerrit/git-review#Installation%7Chere">How to install and push codes with
git-review</a>
for instructions. After initializing git-review, both commit-msg hook
and a remote repo named gerrit will be created and a patch can be
submitted to Gerrit with a single &#8220;git review&#8221; command.</li>
<li>Now you can start making your code changes.</li>
</ul>
</div>
<div class="section" id="building-the-code">
<h3>Building the code<a class="headerlink" href="#building-the-code" title="Permalink to this headline">¶</a></h3>
<p>While you are in the &lt;project_repo_name&gt; directory, run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
<p>To run without unitests you can skip building those tests running the
following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span> <span class="o">-</span><span class="n">DskipTests</span>
<span class="o">/*</span> <span class="n">instead</span> <span class="n">of</span> <span class="s2">&quot;mvn clean install&quot;</span> <span class="o">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="runing-opendaylight-from-local-build">
<h3>Runing OpenDaylight from local build<a class="headerlink" href="#runing-opendaylight-from-local-build" title="Permalink to this headline">¶</a></h3>
<p>Change to the karaf distribution sub-directory, and run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">karaf</span>
</pre></div>
</div>
<p>At this point the OpenDaylight controller is running. You can now open a
web browser and point your browser at <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a></p>
<div class="figure" id="id105">
<img alt="OpenDaylight Main Page" src="../_images/800p_OpenDaylight_Login.jpg" />
<p class="caption"><span class="caption-text">OpenDaylight Main Page</span></p>
</div>
</div>
<div class="section" id="commit-the-code-using-git-cli">
<h3>Commit the code using Git CLI<a class="headerlink" href="#commit-the-code-using-git-cli" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>Note</strong></p>
<p>To be accepted, all code mustcome with a <a class="reference external" href="http://elinux.org/Developer_Certificate_Of_Origin">developer certificate of
origin</a> as
expressed by having a Signed-off-by. This means that you are
asserting that you have made the change and you understand that the
work was done as part of an open-source license.</p>
</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Developer</span><span class="s1">&#39;s Certificate of Origin 1.1</span>

        <span class="n">By</span> <span class="n">making</span> <span class="n">a</span> <span class="n">contribution</span> <span class="n">to</span> <span class="n">this</span> <span class="n">project</span><span class="p">,</span> <span class="n">I</span> <span class="n">certify</span> <span class="n">that</span><span class="p">:</span>

        <span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="n">The</span> <span class="n">contribution</span> <span class="n">was</span> <span class="n">created</span> <span class="ow">in</span> <span class="n">whole</span> <span class="ow">or</span> <span class="ow">in</span> <span class="n">part</span> <span class="n">by</span> <span class="n">me</span> <span class="ow">and</span> <span class="n">I</span>
            <span class="n">have</span> <span class="n">the</span> <span class="n">right</span> <span class="n">to</span> <span class="n">submit</span> <span class="n">it</span> <span class="n">under</span> <span class="n">the</span> <span class="nb">open</span> <span class="n">source</span> <span class="n">license</span>
            <span class="n">indicated</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">;</span> <span class="ow">or</span>

        <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="n">The</span> <span class="n">contribution</span> <span class="ow">is</span> <span class="n">based</span> <span class="n">upon</span> <span class="n">previous</span> <span class="n">work</span> <span class="n">that</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">best</span>
            <span class="n">of</span> <span class="n">my</span> <span class="n">knowledge</span><span class="p">,</span> <span class="ow">is</span> <span class="n">covered</span> <span class="n">under</span> <span class="n">an</span> <span class="n">appropriate</span> <span class="nb">open</span> <span class="n">source</span>
            <span class="n">license</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">have</span> <span class="n">the</span> <span class="n">right</span> <span class="n">under</span> <span class="n">that</span> <span class="n">license</span> <span class="n">to</span> <span class="n">submit</span> <span class="n">that</span>
            <span class="n">work</span> <span class="k">with</span> <span class="n">modifications</span><span class="p">,</span> <span class="n">whether</span> <span class="n">created</span> <span class="ow">in</span> <span class="n">whole</span> <span class="ow">or</span> <span class="ow">in</span> <span class="n">part</span>
            <span class="n">by</span> <span class="n">me</span><span class="p">,</span> <span class="n">under</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">open</span> <span class="n">source</span> <span class="n">license</span> <span class="p">(</span><span class="n">unless</span> <span class="n">I</span> <span class="n">am</span>
            <span class="n">permitted</span> <span class="n">to</span> <span class="n">submit</span> <span class="n">under</span> <span class="n">a</span> <span class="n">different</span> <span class="n">license</span><span class="p">),</span> <span class="k">as</span> <span class="n">indicated</span>
            <span class="ow">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">;</span> <span class="ow">or</span>

        <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">The</span> <span class="n">contribution</span> <span class="n">was</span> <span class="n">provided</span> <span class="n">directly</span> <span class="n">to</span> <span class="n">me</span> <span class="n">by</span> <span class="n">some</span> <span class="n">other</span>
            <span class="n">person</span> <span class="n">who</span> <span class="n">certified</span> <span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">have</span> <span class="ow">not</span> <span class="n">modified</span>
            <span class="n">it</span><span class="o">.</span>

        <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="n">I</span> <span class="n">understand</span> <span class="ow">and</span> <span class="n">agree</span> <span class="n">that</span> <span class="n">this</span> <span class="n">project</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">contribution</span>
            <span class="n">are</span> <span class="n">public</span> <span class="ow">and</span> <span class="n">that</span> <span class="n">a</span> <span class="n">record</span> <span class="n">of</span> <span class="n">the</span> <span class="n">contribution</span> <span class="p">(</span><span class="n">including</span> <span class="nb">all</span>
            <span class="n">personal</span> <span class="n">information</span> <span class="n">I</span> <span class="n">submit</span> <span class="k">with</span> <span class="n">it</span><span class="p">,</span> <span class="n">including</span> <span class="n">my</span> <span class="n">sign</span><span class="o">-</span><span class="n">off</span><span class="p">)</span> <span class="ow">is</span>
            <span class="n">maintained</span> <span class="n">indefinitely</span> <span class="ow">and</span> <span class="n">may</span> <span class="n">be</span> <span class="n">redistributed</span> <span class="n">consistent</span> <span class="k">with</span>
            <span class="n">this</span> <span class="n">project</span> <span class="ow">or</span> <span class="n">the</span> <span class="nb">open</span> <span class="n">source</span> <span class="n">license</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">involved</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Mechanically you do it this way</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">commit</span> <span class="o">--</span><span class="n">signoff</span>
</pre></div>
</div>
<p>You will be prompted for a commit message. If you are fixing a buzilla
bug you can add the associated bug number to your commit message and it
will get linked from Gerrit:</p>
<p><strong>For Example:.</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Fix</span> <span class="k">for</span> <span class="n">bug</span> <span class="mf">2.</span>

<span class="n">Signed</span><span class="o">-</span><span class="n">off</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">Ed</span> <span class="n">Warnicke</span> <span class="o">&lt;</span><span class="n">eaw</span><span class="nd">@cisco</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="c1"># Please enter the commit message for your changes. Lines starting</span>
<span class="c1"># with &#39;#&#39; will be ignored, and an empty message aborts the commit.</span>
<span class="c1"># On branch develop</span>
<span class="c1"># Changes to be committed:</span>
<span class="c1">#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span>
<span class="c1">#</span>
<span class="c1">#       modified:   README</span>
<span class="c1">#</span>
</pre></div>
</div>
</div>
<div class="section" id="pulling-the-code-changes-via-git-cli">
<h3>Pulling the Code changes via Git CLI<a class="headerlink" href="#pulling-the-code-changes-via-git-cli" title="Permalink to this headline">¶</a></h3>
<p>Pull the latest changes from the remote repository</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">update</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="n">origin</span><span class="o">/&lt;</span><span class="n">project_main_branch_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where &lt;project_main_branch_name&gt; is the the branch you want to commit
to. For most projects this is master branch. For some projects such as
lispflowmapping, a different branch name (develop in the case of
lispflowmapping) should be used.</p>
</div>
<div class="section" id="pushing-the-code-via-git-cli">
<h3>Pushing the Code via Git CLI<a class="headerlink" href="#pushing-the-code-via-git-cli" title="Permalink to this headline">¶</a></h3>
<p>Use git review to push your changes back to the remote repository using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">review</span>
</pre></div>
</div>
<p>You can set a topic for your patch by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">review</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">topic</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You will get a message pointing you to your gerrit request like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">==========================</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Resolving</span> <span class="n">deltas</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">Processing</span> <span class="n">changes</span><span class="p">:</span> <span class="n">new</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">refs</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">done</span>    <span class="o">+</span>
<span class="n">remote</span><span class="p">:</span> <span class="o">+</span>
<span class="n">remote</span><span class="p">:</span> <span class="n">New</span> <span class="n">Changes</span><span class="p">:</span> <span class="o">+</span>
<span class="n">remote</span><span class="p">:</span>   <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">gerrit</span><span class="o">/</span><span class="mi">64</span> <span class="o">+</span>
<span class="n">remote</span><span class="p">:</span> <span class="o">+</span>
<span class="o">==========================</span>
</pre></div>
</div>
<p>The Jenkins Controller User will verify your code and post the result on
the your gerrit request.</p>
<div class="section" id="viewing-your-changes-in-gerrit">
<h4>Viewing your Changes in Gerrit<a class="headerlink" href="#viewing-your-changes-in-gerrit" title="Permalink to this headline">¶</a></h4>
<p>Follow the link you got above to see your commit in Gerrit:</p>
<div class="figure" id="id106">
<img alt="Gerritt Code Review Sample" src="../_images/gerrit_code_review.jpg" />
<p class="caption"><span class="caption-text">Gerritt Code Review Sample</span></p>
</div>
<p>Note that the Jenkins Controller User has verified your code and at the
bottom is a link to the Jenkins build.</p>
<p>Once your code has been reviewed and submitted by a committer it will be
merged into the authoritative repo, which would look like this:</p>
<div class="figure" id="id107">
<img alt="Gerritt Code Merge Sample" src="../_images/gerrit_merged.jpg" />
<p class="caption"><span class="caption-text">Gerritt Code Merge Sample</span></p>
</div>
</div>
<div class="section" id="troubleshooting">
<h4>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><strong>What to do if your Firewall blocks port 29418</strong></li>
</ol>
<p>There have been reports that many corporate firewalls block port 29418.
If that’s the case, please follow the <a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Controller:Setting_up_HTTP_in_Gerrit">Setting up HTTP in
Gerrit</a>
instructions and use git URL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">your_username</span><span class="o">&gt;</span><span class="nd">@git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">gerrit</span><span class="o">/</span><span class="n">p</span><span class="o">/&lt;</span><span class="n">project_repo_name</span><span class="o">&gt;.</span><span class="n">git</span>
</pre></div>
</div>
<p>You will be prompted for the password you generated in <a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Controller:Setting_up_HTTP_in_Gerrit">Setting up HTTP
in
Gerrit</a>.</p>
<p>All other instructions on this page remain unchanged.</p>
<p>To download pre-built images with ODP bootstraps see the following
Github project:</p>
<p><a class="reference external" href="https://github.com/nerdalert/OpenDaylight-Lab">Pre-Built OpenDaylight VM
Images</a></p>
</div>
</div>
</div>
<div class="section" id="developing-apps-on-the-opendaylight-controller">
<h2>Developing Apps on the OpenDaylight controller<a class="headerlink" href="#developing-apps-on-the-opendaylight-controller" title="Permalink to this headline">¶</a></h2>
<p>This section provides information that is required to develop apps on
the OpenDaylight controller.</p>
<p>You can either develop apps within the controller using the model-driven
SAL (MD-SAL) archetype or develop external apps and use the RESTCONF to
communicate with the controller.</p>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>This section enables you to get started with app development within the
OpenDaylight controller. In this example, you perform the following
steps to develop an app.</p>
<ol class="arabic simple">
<li>Create a local repository for the code using a simple build process.</li>
<li>Start the OpenDaylight controller.</li>
<li>Test a simple remote procedure call (RPC) which you have created
based on the principle of <em>hello world</em>.</li>
</ol>
</div>
<div class="section" id="pre-requisites">
<h3>Pre requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h3>
<p>This example requires the following.</p>
<ul>
<li><p class="first">A development environment with following set up and working correctly
from the shell:</p>
<ul>
<li><p class="first">Maven 3.1.1 or later</p>
</li>
<li><p class="first">Java 7- or Java 8-compliant JDK</p>
</li>
<li><p class="first">An appropriate Maven settings.xml file. A simple way to get the
default OpenDaylight settings.xml file is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">n</span> <span class="o">~/.</span><span class="n">m2</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">xml</span><span class="p">{,</span><span class="o">.</span><span class="n">orig</span><span class="p">}</span> <span class="p">;</span> \<span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">/</span><span class="n">odlparent</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">lithium</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">xml</span> <span class="o">&gt;</span> <span class="o">~/.</span><span class="n">m2</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p><strong>Note</strong></p>
<p>If you are using Linux or Mac OS X as your development OS, your
local repository is ~/.m2/repository. For other platforms the local
repository location will vary.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="building-an-example-module">
<h3>Building an example module<a class="headerlink" href="#building-an-example-module" title="Permalink to this headline">¶</a></h3>
<p>To develop an app perform the following steps.</p>
<ol class="arabic">
<li><p class="first">Create an <em>Example</em> project using Maven and an archetype called the
<em>opendaylight-startup-archetype</em>. If you are downloading this project
for the first time, then it will take sometime to pull all the code
from the remote repository.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">archetype</span><span class="p">:</span><span class="n">generate</span> <span class="o">-</span><span class="n">DarchetypeGroupId</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">controller</span> <span class="o">-</span><span class="n">DarchetypeArtifactId</span><span class="o">=</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">startup</span><span class="o">-</span><span class="n">archetype</span> \
<span class="o">-</span><span class="n">DarchetypeRepository</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nexus</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">public</span><span class="o">/</span> \
<span class="o">-</span><span class="n">DarchetypeCatalog</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nexus</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">public</span><span class="o">/</span><span class="n">archetype</span><span class="o">-</span><span class="n">catalog</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the properties values as follows. Ensure that the groupid and
the artifactid is lower case.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>Define value for property &#39;groupId&#39;: : org.opendaylight.example
Define value for property &#39;artifactId&#39;: : example
Define value for property &#39;version&#39;:  1.0-SNAPSHOT: : 1.0.0-SNAPSHOT
Define value for property &#39;package&#39;:  org.opendaylight.example: :
Define value for property &#39;classPrefix&#39;:  ${artifactId.substring(0,1).toUpperCase()}${artifactId.substring(1)}
Define value for property &#39;copyright&#39;: : Copyright (c) 2015 Yoyodyne, Inc.
</pre></div>
</div>
</li>
<li><p class="first">Accept the default value of classPrefix that is,
<code class="docutils literal"><span class="pre">(${artifactId.substring(0,1).toUpperCase()}${artifactId.substring(1)})</span></code>.
The classPrefix creates a Java Class Prefix by capitalizing the first
character of the artifactId.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>In this scenario, the classPrefix used is &#8220;Example&#8221;. Create a
top-level directory for the archetype.</p>
</div></blockquote>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>${artifactId}/
example/
cd example/
api/
artifacts/
features/
impl/
karaf/
pom.xml
</pre></div>
</div>
</li>
<li><p class="first">Build the <em>example</em> project.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Depending on your development machine’s specification this might
take a little while. Ensure that you are in the project’s root
directory, example/, and then issue the build command, shown
below.</p>
</div></blockquote>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">Start the <em>example</em> project for the first time.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">karaf</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span>
<span class="n">ls</span>
<span class="o">./</span><span class="n">karaf</span>
</pre></div>
</div>
</li>
<li><p class="first">Wait for the karaf cli that appears as follows. Wait for OpenDaylight
to fully load all the components. This can take a minute or two after
the prompt appears. Check the CPU on your dev machine, specifically
the Java process to see when it calms down.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">opendaylight</span><span class="o">-</span><span class="n">user</span><span class="nd">@root</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify if the “example” module is built and search for the log entry
which includes the entry <em>ExampleProvider Session Initiated</em>.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">:</span><span class="n">display</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Example</span>
</pre></div>
</div>
</li>
<li><p class="first">Shutdown the OpenDaylight through the console by using the following
command.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">shutdown</span> <span class="o">-</span><span class="n">f</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="defining-a-simple-hello-world-rpc">
<h3>Defining a Simple Hello World RPC<a class="headerlink" href="#defining-a-simple-hello-world-rpc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Run the maven archetype <em>opendaylight-startup-archetype</em>, and
create the <em>hello</em> project.</div>
</div>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">archetype</span><span class="p">:</span><span class="n">generate</span> <span class="o">-</span><span class="n">DarchetypeGroupId</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">controller</span> <span class="o">-</span><span class="n">DarchetypeArtifactId</span><span class="o">=</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">startup</span><span class="o">-</span><span class="n">archetype</span> \
<span class="o">-</span><span class="n">DarchetypeRepository</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">nexus</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">snapshot</span><span class="o">/</span> \
<span class="o">-</span><span class="n">DarchetypeCatalog</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">nexus</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">repositories</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">snapshot</span><span class="o">/</span><span class="n">archetype</span><span class="o">-</span><span class="n">catalog</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the Properties values as follows.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>Define value for property &#39;groupId&#39;: : org.opendaylight.hello
Define value for property &#39;artifactId&#39;: : hello
Define value for property &#39;version&#39;:  1.0-SNAPSHOT: : 1.0.0-SNAPSHOT
Define value for property &#39;package&#39;:  org.opendaylight.hello: :
Define value for property &#39;classPrefix&#39;:  ${artifactId.substring(0,1).toUpperCase()}${artifactId.substring(1)}
Define value for property &#39;copyright&#39;: : Copyright(c) Yoyodyne, Inc.
</pre></div>
</div>
</li>
<li><p class="first">View the <em>hello</em> project.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">hello</span><span class="o">/</span>
<span class="n">ls</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">api</span>
<span class="n">artifacts</span>
<span class="n">features</span>
<span class="n">impl</span>
<span class="n">karaf</span>
<span class="n">pom</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</li>
<li><p class="first">Build <em>hello</em> project by using the following command.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that the project is functioning by executing karaf.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">karaf</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">./</span><span class="n">karaf</span>
</pre></div>
</div>
</li>
<li><div class="first line-block">
<div class="line">The karaf cli appears as follows.</div>
<div class="line">NOTE: Remember to wait for OpenDaylight to load completely. Verify
that the Java process CPU has stabilized.+</div>
</div>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">opendaylight</span><span class="o">-</span><span class="n">user</span><span class="nd">@root</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Verify that the <em>hello</em> module is loaded by checking the log.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">:</span><span class="n">display</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Hello</span>
</pre></div>
</div>
</li>
<li><p class="first">Shutdown karaf.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">shutdown</span> <span class="o">-</span><span class="n">f</span>
</pre></div>
</div>
</li>
<li><p class="first">Return to the top of the directory structure:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../../../../</span>
</pre></div>
</div>
</li>
<li><p class="first">View the entry point to understand where the log line came from. The
entry point is in the impl project:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">impl</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">impl</span><span class="o">/</span><span class="n">HelloProvider</span><span class="o">.</span><span class="n">java</span>
</pre></div>
</div>
</li>
<li><p class="first">Add any new things that you are doing in your implementation by
using the HelloProvider.onSessionInitiate method. Its analogous to
an Activator.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">onSessionInitiated</span><span class="p">(</span><span class="n">ProviderContext</span> <span class="n">session</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HelloProvider Session Initiated&quot;</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="add-a-simple-helloworld-rpc-api">
<h3>Add a simple HelloWorld RPC API<a class="headerlink" href="#add-a-simple-helloworld-rpc-api" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Navigate to the file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Edit</span>
<span class="n">api</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">yang</span><span class="o">/</span><span class="n">hello</span><span class="o">.</span><span class="n">yang</span>
</pre></div>
</div>
</li>
<li><p class="first">Edit this file as follows. In the following example, we are adding
the code in a YANG module to define the <em>hello-world</em> RPC:</p>
</li>
<li><p class="first">Return to the hello/api directory and build your API as follows.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../../../</span>
<span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="implement-the-helloworld-rpc-api">
<h3>Implement the HelloWorld RPC API<a class="headerlink" href="#implement-the-helloworld-rpc-api" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Define the HelloService, which is invoked through the <em>hello-world</em>
API.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">impl</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">org</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">/</span><span class="n">hello</span><span class="o">/</span><span class="n">impl</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a new file called HelloWorldImpl.java and add in the code
below.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">hello</span><span class="o">.</span><span class="n">impl</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.hello.rev150105.HelloService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.hello.rev150105.HelloWorldInput</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.hello.rev150105.HelloWorldOutput</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.hello.rev150105.HelloWorldOutputBuilder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.common.RpcResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.common.RpcResultBuilder</span><span class="p">;</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">HelloWorldImpl</span> <span class="n">implements</span> <span class="n">HelloService</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">RpcResult</span><span class="o">&lt;</span><span class="n">HelloWorldOutput</span><span class="o">&gt;&gt;</span> <span class="n">helloWorld</span><span class="p">(</span><span class="n">HelloWorldInput</span> <span class="nb">input</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">HelloWorldOutputBuilder</span> <span class="n">helloBuilder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HelloWorldOutputBuilder</span><span class="p">();</span>
        <span class="n">helloBuilder</span><span class="o">.</span><span class="n">setGreating</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nb">input</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">RpcResultBuilder</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">helloBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">())</span><span class="o">.</span><span class="n">buildFuture</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">The HelloProvider.java file is in the current directory. Register the
RPC that you created in the <em>hello.yang</em> file in the
HelloProvider.java file. You can either edit the HelloProvider.java
to match what is below or you can simple replace it with the code
below.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">Copyright</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Yoyodyne</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span> <span class="ow">and</span> <span class="n">others</span><span class="o">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="o">.</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">This</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">accompanying</span> <span class="n">materials</span> <span class="n">are</span> <span class="n">made</span> <span class="n">available</span> <span class="n">under</span> <span class="n">the</span>
 <span class="o">*</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Eclipse</span> <span class="n">Public</span> <span class="n">License</span> <span class="n">v1</span><span class="o">.</span><span class="mi">0</span> <span class="n">which</span> <span class="n">accompanies</span> <span class="n">this</span> <span class="n">distribution</span><span class="p">,</span>
 <span class="o">*</span> <span class="ow">and</span> <span class="ow">is</span> <span class="n">available</span> <span class="n">at</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">legal</span><span class="o">/</span><span class="n">epl</span><span class="o">-</span><span class="n">v10</span><span class="o">.</span><span class="n">html</span>
 <span class="o">*/</span>
<span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">hello</span><span class="o">.</span><span class="n">impl</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.controller.sal.binding.api.BindingAwareBroker.ProviderContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.controller.sal.binding.api.BindingAwareBroker.RpcRegistration</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.controller.sal.binding.api.BindingAwareProvider</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.opendaylight.params.xml.ns.yang.hello.rev150105.HelloService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">HelloProvider</span> <span class="n">implements</span> <span class="n">BindingAwareProvider</span><span class="p">,</span> <span class="n">AutoCloseable</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">HelloProvider</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
    <span class="n">private</span> <span class="n">RpcRegistration</span><span class="o">&lt;</span><span class="n">HelloService</span><span class="o">&gt;</span> <span class="n">helloService</span><span class="p">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">onSessionInitiated</span><span class="p">(</span><span class="n">ProviderContext</span> <span class="n">session</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HelloProvider Session Initiated&quot;</span><span class="p">);</span>
        <span class="n">helloService</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">addRpcImplementation</span><span class="p">(</span><span class="n">HelloService</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">new</span> <span class="n">HelloWorldImpl</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">close</span><span class="p">()</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;HelloProvider Closed&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">helloService</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">helloService</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Optionally, you can also build the Java classes which will register
the new RPC. This is useful to test the edits you have made to
HelloProvider.java and HelloWorldImpl.java.</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../../../../../../../</span>
<span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p class="first">Return to the top level directory</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span>
</pre></div>
</div>
</li>
<li><p class="first">Build the entire <em>hello</em> again, which will pickup the changes you
have made and build them into your project:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="execute-the-hello-project-for-the-first-time">
<h3>Execute the <em>hello</em> project for the first time<a class="headerlink" href="#execute-the-hello-project-for-the-first-time" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Run karaf</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">karaf</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">./</span><span class="n">karaf</span>
</pre></div>
</div>
</li>
<li><p class="first">Wait for the project to load completely. Then view the log to see the
loaded <em>Hello</em> Module:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">:</span><span class="n">display</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Hello</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="test-the-hello-world-rpc-via-rest">
<h3>Test the <em>hello-world</em> RPC via REST<a class="headerlink" href="#test-the-hello-world-rpc-via-rest" title="Permalink to this headline">¶</a></h3>
<p>There are a lot of ways to test your RPC. Following are some examples.</p>
<ol class="arabic simple">
<li>Using the API Explorer through HTTP</li>
<li>Using a browser REST client</li>
</ol>
<div class="section" id="using-the-api-explorer-through-http">
<h4>Using the API Explorer through HTTP<a class="headerlink" href="#using-the-api-explorer-through-http" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Navigate to <a class="reference external" href="http://localhost:8181/apidoc/explorer/index.html">apidoc
UI</a> with your
web browser.</div>
<div class="line">NOTE: In the URL mentioned above, Change <em>localhost</em> to the IP/Host
name to reflect your development machine’s network address.</div>
</div>
</li>
<li><p class="first">Select</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">hello</span><span class="p">(</span><span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Select</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">operations</span><span class="o">/</span><span class="n">hello</span><span class="p">:</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
</li>
<li><p class="first">Provide the required value.</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;hello:input&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Your Name&quot;</span><span class="p">}}</span>
</pre></div>
</div>
</li>
<li><p class="first">Click the button.</p>
</li>
<li><p class="first">Enter the username and password, by default the credentials are
admin/admin.</p>
</li>
<li><p class="first">In the response body you should see.</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;greating&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello Your Name&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="using-a-browser-rest-client">
<h4>Using a browser REST client<a class="headerlink" href="#using-a-browser-rest-client" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">For example, use the following information in the Firefox plugin
<em>RESTClient</em>
[<a class="reference external" href="https://github.com/chao/RESTClient}">https://github.com/chao/RESTClient}</a></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.43</span><span class="p">:</span><span class="mi">8181</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">operations</span><span class="o">/</span><span class="n">hello</span><span class="p">:</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<p>Header:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">application</span><span class="o">/</span><span class="n">json</span>
</pre></div>
</div>
<p>Body:</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Andrew&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Troubleshooting<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>If you get a response code 501 while attempting to POST
/operations/hello:hello-world, check the file: HelloProvider.java and
make sure the helloService member is being set. By not invoking
&#8220;session.addRpcImplementation()&#8221; the REST API will be unable to map
/operations/hello:hello-world url to HelloWorldImpl.</p>
</div>
</div>
<div class="section" id="alto-developer-guide">
<h2>ALTO Developer Guide<a class="headerlink" href="#alto-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Overview<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The topics of this guide are:</p>
<ol class="arabic simple">
<li>How to add alto projects as dependencies;</li>
<li>How to put/fetch data from ALTO;</li>
<li>How to use customized service implementations.</li>
</ol>
</div>
<div class="section" id="adding-alto-projects-as-dependencies">
<h3>Adding ALTO Projects as Dependencies<a class="headerlink" href="#adding-alto-projects-as-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Most ALTO packages can be added as dependencies in Maven projects by
putting the following code in the <em>pom.xml</em> file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;dependency&gt;
    &lt;groupId&gt;org.opendaylight.alto&lt;/groupId&gt;
    &lt;artifactId&gt;${THE_NAME_OF_THE_PACKAGE_YOU_NEED}&lt;/artifactId&gt;
    &lt;version&gt;${ALTO_VERSION}&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>
<p>The current stable version for ALTO is <code class="docutils literal"><span class="pre">0.1.0-Lithium</span></code>.</p>
</div>
<div class="section" id="putting-fetching-data-from-alto">
<h3>Putting/Fetching data from ALTO<a class="headerlink" href="#putting-fetching-data-from-alto" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-restful-api">
<h4>Using RESTful API<a class="headerlink" href="#using-restful-api" title="Permalink to this headline">¶</a></h4>
<p>There are two kinds of RESTful APIs for ALTO: the one provided by
<code class="docutils literal"><span class="pre">alto-northbound</span></code> which follows the formats defined in <a class="reference external" href="https://tools.ietf.org/html/rfc7285">RFC
7285</a>, and the one provided by
RESTCONF whose format is defined by the YANG model proposed in <a class="reference external" href="https://tools.ietf.org/html/draft-shi-alto-yang-model-03">this
draft</a>.</p>
<p>One way to get the URLs for the resources from <code class="docutils literal"><span class="pre">alto-northbound</span></code> is to
visit the IRD service first where there is a <code class="docutils literal"><span class="pre">uri</span></code> field for every
entry. However, the IRD service is not yet implemented so currently the
developers have to construct the URLs themselves. The base URL is
<code class="docutils literal"><span class="pre">/controller/nb/v2/alto</span></code> and below is a list of the specific paths
defined in <code class="docutils literal"><span class="pre">AltoNorthbound.java</span></code> in <code class="docutils literal"><span class="pre">alto-northbound</span></code> using Jersey
<code class="docutils literal"><span class="pre">&#64;Path</span></code> annotation:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">/ird/{rid}</span></code>: the path to access <em>IRD</em> services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/networkmap/{rid}[/{tag}]</span></code>: the path to access <em>Network Map</em>
services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/costmap/{rid}[/{tag}[/{mode}/{metric}]]</span></code>: the path to access
<em>Cost Map</em> services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/filtered/networkmap/{rid}[/{tag}]</span></code>: the path to access <em>Filtered
Network Map</em> services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/filtered/costmap/{rid}[/{tag}]</span></code>: the path to access <em>Filtered
Cost Map</em> services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/endpointprop/lookup/{rid}[/{tag}]</span></code>: the path to access <em>Endpoint
Property</em> services;</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">/endpointcost/lookup/{rid}[/{tag}]</span></code>: the path to access <em>Endpoint
Cost</em> services.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The segments in brackets are optional.</p>
</div></blockquote>
</li>
</ul>
<p>If you want to fetch the data using RESTCONF, it is highly recommended
to take a look at the <code class="docutils literal"><span class="pre">apidoc</span></code> page
(<a class="reference external" href="http://{controller_ip}:8181/apidoc/explorer/index.html">http://{controller_ip}:8181/apidoc/explorer/index.html</a>)
after installing the <code class="docutils literal"><span class="pre">alto-model</span></code> feature in karaf.</p>
<p>It is also worth pointing out that <code class="docutils literal"><span class="pre">alto-northbound</span></code> only supports
<code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code> operations so it is impossible to manipulate the
data through its RESTful APIs. To modify the data, use <code class="docutils literal"><span class="pre">PUT</span></code> and
<code class="docutils literal"><span class="pre">DELETE</span></code> methods with RESTCONF.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The current implementation uses the <code class="docutils literal"><span class="pre">configuration</span></code> data store and
that enables the developers to modify the data directly through
RESTCONF. In the future this approach might be disabled in the core
packages of ALTO but may still be available as an extension.</p>
</div></blockquote>
</div>
<div class="section" id="using-ad-sal">
<h4>Using AD-SAL<a class="headerlink" href="#using-ad-sal" title="Permalink to this headline">¶</a></h4>
<p>Five interfaces are defined in package <code class="docutils literal"><span class="pre">service-api-rfc7285</span></code>. Follow
the steps below to use them:</p>
<ol class="arabic simple">
<li>Determine the required service interface: <code class="docutils literal"><span class="pre">IRDService</span></code>,
<code class="docutils literal"><span class="pre">NetworkMapService</span></code>, <code class="docutils literal"><span class="pre">CostMapService</span></code>,
<code class="docutils literal"><span class="pre">EndpointPropertyService</span></code> or <code class="docutils literal"><span class="pre">EndpointCostService</span></code>;</li>
<li>Use the <code class="docutils literal"><span class="pre">ServiceHelper</span></code> to get the instance;</li>
<li>Call the corresponding methods with appropriate parameters.</li>
</ol>
</div>
<div class="section" id="using-md-sal">
<h4>Using MD-SAL<a class="headerlink" href="#using-md-sal" title="Permalink to this headline">¶</a></h4>
<p>You can also fetch data from the data store directly.</p>
<p>First you must get the access to the data store by registering your
module with a data broker.</p>
<p>Then an <code class="docutils literal"><span class="pre">InstanceIdentifier</span></code> must be created. Here is an example of
how to build an <code class="docutils literal"><span class="pre">InstanceIdentifier</span></code> for a <em>network map</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.opendaylight...alto...Resources</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight...alto...resources.NetworkMaps</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight...alto...resources.network.maps.NetworkMap</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight...alto...resources.network.maps.NetworkMapKey</span><span class="p">;</span>
<span class="o">...</span>
<span class="n">protected</span>
<span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">NetworkMap</span><span class="o">&gt;</span> <span class="n">getNetworkMapIID</span><span class="p">(</span><span class="n">String</span> <span class="n">resource_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ResourceId</span> <span class="n">rid</span> <span class="o">=</span> <span class="n">ResourceId</span><span class="o">.</span><span class="n">getDefaultInstance</span><span class="p">(</span><span class="n">resource_id</span><span class="p">);</span>
  <span class="n">NetworkMapKey</span> <span class="n">key</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NetworkMapKey</span><span class="p">(</span><span class="n">rid</span><span class="p">);</span>
  <span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">NetworkMap</span><span class="o">&gt;</span> <span class="n">iid</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
  <span class="n">iid</span> <span class="o">=</span> <span class="n">InstanceIdentifier</span><span class="o">.</span><span class="n">builder</span><span class="p">(</span><span class="n">Resources</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">NetworkMaps</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">NetworkMap</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                          <span class="o">.</span><span class="n">build</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">iid</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">...</span>
</pre></div>
</div>
<p>With the <code class="docutils literal"><span class="pre">InstanceIdentifier</span></code> you can use <code class="docutils literal"><span class="pre">ReadOnlyTransaction</span></code>,
<code class="docutils literal"><span class="pre">WriteTransaction</span></code> and <code class="docutils literal"><span class="pre">ReadWriteTransaction</span></code> to manipulate the data
accordingly. The <code class="docutils literal"><span class="pre">simple-impl</span></code> package, which provides some of the
AD-SAL APIs mentioned above, is using this method to get data from the
data store and then convert them into RFC7285-compatible objects.</p>
</div>
</div>
<div class="section" id="providing-customized-implementation">
<h3>Providing Customized Implementation<a class="headerlink" href="#providing-customized-implementation" title="Permalink to this headline">¶</a></h3>
<p>Currently it is very simple to provide a customized network map, the
only thing you have to do is to put the data into the data store. Cost
maps are more complex since there are no classes for the cost values by
default, you have to define it using <code class="docutils literal"><span class="pre">augment</span></code> in YANG. Here is an
example in <code class="docutils literal"><span class="pre">alto-hosttracker</span></code>.</p>
</div>
</div>
<div class="section" id="armoury">
<h2>Armoury<a class="headerlink" href="#armoury" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Overview<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>TBD: Overview of the Armoury feature, what logical functionality it
provides and why you might use it as a developer.</p>
</div>
<div class="section" id="armoury-architecture">
<h3>Armoury Architecture<a class="headerlink" href="#armoury-architecture" title="Permalink to this headline">¶</a></h3>
<p>TBD: Armoury components and how they work together. Also include
information about how the feature integrates with OpenDaylight and
architecture.</p>
</div>
<div class="section" id="key-apis-and-interfaces">
<h3>Key APIs and Interfaces<a class="headerlink" href="#key-apis-and-interfaces" title="Permalink to this headline">¶</a></h3>
<p>TBD: Document the key things a user would want to use.</p>
<div class="section" id="armoury-catalog-api">
<h4>Armoury Catalog API<a class="headerlink" href="#armoury-catalog-api" title="Permalink to this headline">¶</a></h4>
<p>TBD: A description of Armoury Catalog API.</p>
</div>
<div class="section" id="armoury-workload-manager-api">
<h4>Armoury Workload Manager API<a class="headerlink" href="#armoury-workload-manager-api" title="Permalink to this headline">¶</a></h4>
<p>TBD: A description of Armoury Workload Manager API.</p>
</div>
<div class="section" id="armoury-driver-registry-api">
<h4>Armoury Driver Registry API<a class="headerlink" href="#armoury-driver-registry-api" title="Permalink to this headline">¶</a></h4>
<p>TBD: A description of Armoury Driver Registry API.</p>
</div>
</div>
<div class="section" id="api-reference-documentation">
<h3>API Reference Documentation<a class="headerlink" href="#api-reference-documentation" title="Permalink to this headline">¶</a></h3>
<p>TBD: Provide links to JavaDoc, REST API documentation, etc.</p>
</div>
</div>
<div class="section" id="bgp-developer-guide">
<h2>BGP Developer Guide<a class="headerlink" href="#bgp-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Overview<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>This section provides an overview of <strong>feature odl-bgpcep-bgp-all</strong> .
This feature will install everything needed for BGP (Border Gateway
Protocol) from establishing the connection, storing the data in RIBs
(Route Information Base) and displaying data in network-topology
overview.</p>
</div>
<div class="section" id="bgp-architecture">
<h3>BGP Architecture<a class="headerlink" href="#bgp-architecture" title="Permalink to this headline">¶</a></h3>
<p>Each feature represents a module in the BGPCEP codebase. The following
diagram illustrates how the features are related.</p>
<div class="figure" id="id108">
<img alt="BGP Dependency Tree" src="../_images/bgp-dependency-tree.png" />
<p class="caption"><span class="caption-text">BGP Dependency Tree</span></p>
</div>
</div>
<div class="section" id="id5">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="bgp-concepts">
<h4>BGP concepts<a class="headerlink" href="#bgp-concepts" title="Permalink to this headline">¶</a></h4>
<p>This module contains the base BGP concepts contained in
<a class="reference external" href="http://tools.ietf.org/html/rfc4271">RFC4271</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc4760">RFC4760</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc4456">RFC4456</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc1997">RFC1997</a> and
<a class="reference external" href="http://tools.ietf.org/html/rfc4360">RFC4360</a>.</p>
<p>All the concepts are described in one yang model :
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/concepts/src/main/yang/bgp-types.yang;hb=refs/heads/stable/lithium">bgp-types.yang</a>
.</p>
<p>Outside generated classes, there is just one class
<em>`NextHopUtil &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/concepts/src/main/java/org/opendaylight/bgp/concepts/NextHopUtil.java;hb=refs/heads/stable/lithium&gt;`__</em>
that contains methods for serializing and parsing NextHop.</p>
</div>
<div class="section" id="bgp-parser">
<h4>BGP parser<a class="headerlink" href="#bgp-parser" title="Permalink to this headline">¶</a></h4>
<p>Base BGP parser includes messages and attributes from
<a class="reference external" href="http://tools.ietf.org/html/rfc4271">RFC4271</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc4760">RFC4760</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc1997">RFC1997</a> and
<a class="reference external" href="http://tools.ietf.org/html/rfc4360">RFC4360</a>.</p>
<p><em>API</em> module defines BGP messages in YANG.</p>
<p><em>IMPL</em> module contains actual parsers and serializers for BGP messages
and
<em>`Activator &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/parser-impl/src/main/java/org/opendaylight/protocol/bgp/parser/impl/BGPActivator.java;hb=refs/heads/stable/lithium&gt;`__</em>
class</p>
<p><em>SPI</em> module contains helper classes needed for registering parsers into
activators</p>
<div class="section" id="registration">
<h5>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h5>
<p>As mentioned before, all parsers and serializers need to be registered
into the <em>Extension provider</em>. This <em>Extension provider</em> is configured
in initial configuration of the parser-spi module (<em>31-bgp.xml</em>).</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:bgp:parser:spi&quot;</span><span class="o">&gt;</span><span class="n">prefix</span><span class="p">:</span><span class="n">bgp</span><span class="o">-</span><span class="n">extensions</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">extension</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">bgpspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:bgp:parser:spi&quot;</span><span class="o">&gt;</span><span class="n">bgpspi</span><span class="p">:</span><span class="n">extension</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">base</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">parser</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">extension</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">extension</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">bgpspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:bgp:parser:spi&quot;</span><span class="o">&gt;</span><span class="n">bgpspi</span><span class="p">:</span><span class="n">extension</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">bgp</span><span class="o">-</span><span class="n">linkstate</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">extension</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><em>base-bgp-parser</em> - will register parsers and serializers implemented
in the bgp-parser-impl module</li>
<li><em>bgp-linkstate</em> - will register parsers and serializers implemented
in the bgp-linkstate module</li>
</ul>
<p>The bgp-linkstate module is a good example of a BGP parser extension.</p>
<p>The configuration of bgp-parser-spi specifies one implementation of
<em>Extension provider</em> that will take care of registering mentioned parser
extensions:
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/parser-spi/src/main/java/org/opendaylight/protocol/bgp/parser/spi/pojo/SimpleBGPExtensionProviderContext.java;hb=refs/heads/stable/lithium">SimpleBGPExtensionProviderContext</a>.
All registries are implemented in package
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=tree;f=bgp/parser-spi/src/main/java/org/opendaylight/protocol/bgp/parser/spi;hb=refs/heads/stable/lithium">bgp-parser-spi</a>.</p>
</div>
<div class="section" id="serializing">
<h5>Serializing<a class="headerlink" href="#serializing" title="Permalink to this headline">¶</a></h5>
<p>The serializing of BGP elements is mostly done in the same way as in
PCEP, the only exception is the serialization of path attributes, that
is described here. Path attributes are different from any other BGP
element, as path attributes don’t implement one common interface, but
this interface contains getters for individual path attributes (this
structure is because update message can contain exactly one instance of
each path attribute). This means, that a given <em>PathAttributes</em> object,
you can only get to the specific type of the path attribute through
checking its presence. Therefore method <em>serialize()</em> in
<em>AttributeRegistry</em>, won’t look up the registered class, instead it will
go through the registrations and offer this object to the each
registered parser. This way the object will be passed also to
serializers unknown to module bgp-parser, for example to
LinkstateAttributeParser. RFC4271 recommends ordering path attributes,
hence the serializers are ordered in a list as they are registered in
the <em>Activator</em>. In other words, this is the only case, where
registration ordering matters.</p>
<div class="figure" id="id109">
<img alt="PathAttributesSerialization" src="../_images/PathAttributesSerialization.png" />
<p class="caption"><span class="caption-text">PathAttributesSerialization</span></p>
</div>
<p><em>serialize()</em> method in each Path Attribute parser contains check for
presence of its attribute in the PathAttributes object, which simply
returns, if the attribute is not there:</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">pathAttributes</span><span class="o">.</span><span class="n">getAtomicAggregate</span><span class="p">()</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">//</span><span class="k">continue</span> <span class="k">with</span> <span class="n">serialization</span> <span class="n">of</span> <span class="n">Atomic</span> <span class="n">Aggregate</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bgp-rib">
<h3>BGP RIB<a class="headerlink" href="#bgp-rib" title="Permalink to this headline">¶</a></h3>
<p>The BGP RIB module can be divided into two semantic parts: * BGP
listener and speaker session handling * RIB handling.</p>
<div class="section" id="session-handling">
<h4>Session handling<a class="headerlink" href="#session-handling" title="Permalink to this headline">¶</a></h4>
<p><em>31-bgp.xml</em> defines only bgp-dispatcher and the parser it should be
using (global-bgp-extensions).</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="n">prefix</span><span class="p">:</span><span class="n">bgp</span><span class="o">-</span><span class="n">dispatcher</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">dispatcher</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">bgp</span><span class="o">-</span><span class="n">extensions</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="n">bgpspi</span><span class="p">:</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">bgp</span><span class="o">-</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">bgp</span><span class="o">-</span><span class="n">extensions</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="n">netty</span><span class="p">:</span><span class="n">netty</span><span class="o">-</span><span class="n">threadgroup</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="n">netty</span><span class="p">:</span><span class="n">netty</span><span class="o">-</span><span class="n">threadgroup</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For user configuration of BGP, check User Guide.</p>
</div>
<div class="section" id="synchronization">
<h4>Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this headline">¶</a></h4>
<p>Synchronization is a phase, where upon connection, a BGP speaker sends
all available data about topology to its new client. After the whole
topology has been advertized, the synchronization is over. For the
listener, the synchronization is over when the RIB receives End-of-RIB
(EOR) messages. There is a special EOR message for each AFI (Address
Family Identifier).</p>
<ul class="simple">
<li>IPv4 EOR is an empty Update message</li>
<li>Ipv6 EOR is an Update message with empty MP_UNREACH attribute where
AFI and SAFI (Subsequent Address Family Identifier) are set to Ipv6.
OpenDaylight also supports EOR for IPv4 in this format</li>
<li>Linkstate EOR is an Update message with empty MP_UNREACH attribute
where AFI and SAFI are set to Linkstate</li>
</ul>
<p>For BGP connections, where both peers support graceful restart, the EORs
are sent by the BGP speaker and are redirected to RIB, where the
specific AFI/SAFI table is set to <em>true</em>. Without graceful restart, the
messages are generated by OpenDaylight itself and sent after second
keepalive for each AFI/SAFI. This is done in
<em>`BGPSynchronization &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/BGPSynchronization.java;hb=refs/heads/stable/lithium&gt;`__</em></p>
<p><strong>Peers</strong></p>
<p><em>`BGPPeer &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/BGPPeer.java;hb=refs/heads/stable/lithium&gt;`__</em>
has various meanings. If you configure BGP listener, <em>BGPPeer</em>
represents the BGP listener itself. If you are configuring BGP speaker,
you need to provide a list of peers, that are allowed to connect to this
speaker. Unknown peer represents, in this case, a peer that is allowed
to be refused. <em>BGPPeer</em> represents in this case peer, that is supposed
to connect to your speaker. <em>BGPPeer</em> is stored in
<em>`BGPPeerRegistry &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/StrictBGPPeerRegistry.java;hb=refs/heads/stable/lithium&gt;`__</em>.
This registry controls the number of sessions. Our strict implementation
limits sessions to one per peer.</p>
<p><em>`ApplicationPeer &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/ApplicationPeer.java;hb=refs/heads/stable/lithium&gt;`__</em>
is a special case of peer, that has it’s own RIB. This RIB is populated
from RESTCONF. The RIB is synchronized with default BGP RIB. Incoming
routes to the default RIB are treated in the same way as they were from
a BGP peer (speaker or listener) in the network.</p>
</div>
<div class="section" id="rib-handling">
<h4>RIB handling<a class="headerlink" href="#rib-handling" title="Permalink to this headline">¶</a></h4>
<p>RIB (Route Information Base) is defined as a concept in
<a class="reference external" href="http://tools.ietf.org/html/rfc4271#section-3.2">RFC4271</a>. RFC does
not define how it should be implemented. In our implementation, the
routes are stored in MD-SALs data-store. There are four supported routes
- <em>Ipv4Routes</em>, <em>Ipv6Routes</em>, <em>LinkstateRoutes</em> and <em>FlowspecRoutes</em>.</p>
<p>Each route type needs to provide a
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-spi/src/main/java/org/opendaylight/protocol/bgp/rib/spi/RIBSupport.java;hb=refs/heads/stable/lithium">RIBSupport.java</a>
implementation. <em>RIBSupport</em> tells RIB how to parse binding-aware data
(BGP Update message) to binding-independent (datastore format).</p>
<p>Following picture describes the data flow from BGP message that is sent
to <em>BGPPeer</em> to datastore and various types of RIB.</p>
<div class="figure" id="id110">
<img alt="RIB" src="../_images/RIB.png" />
<p class="caption"><span class="caption-text">RIB</span></p>
</div>
<p><strong>`AdjRibInWriter &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/AdjRibInWriter.java;hb=refs/heads/stable/lithium&gt;`__</strong>
- represents the first step in putting data to datastore. This writer is
notified whenever a peer receives an Update message. The message is
transformed into binding-independent format and pushed into datastore to
<em>adj-rib-in</em>. This RIB is associated with a peer.</p>
<p><strong>`EffectiveRibInWriter &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/EffectiveRibInWriter.java;hb=refs/heads/stable/lithium&gt;`__</strong>
- this writer is notified whenever <em>adj-rib-in</em> is updated. It applies
all configured import policies to the routes and stores them in
<em>effective-rib-in</em>. This RIB is also associated with a peer.</p>
<p><strong>`LocRibWriter &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/LocRibWriter.java;hb=refs/heads/stable/lithium&gt;`__</strong>
- this writer is notified whenever <strong>any</strong> <em>effective-rib-in</em> is updated
(in any peer). Performs best path selection filtering and stores the
routes in <em>loc-rib</em>. It also determines which routes need to be
advertised and fills in <em>adj-rib-out</em> that is per peer as well.</p>
<p><strong>`AdjRibOutListener &lt;https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/AdjRibOutListener.java;h=a14fd54a29ea613b381a36248f67491d968963b8;hb=refs/heads/stable/lithium&gt;`__</strong>
- listens for changes in <em>adj-rib-out</em>, transforms the routes into
BGPUpdate messages and sends them to its associated peer.</p>
</div>
</div>
<div class="section" id="bgp-inet">
<h3>BGP inet<a class="headerlink" href="#bgp-inet" title="Permalink to this headline">¶</a></h3>
<p>This module contains only one YANG model
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/inet/src/main/yang/bgp-inet.yang;hb=refs/heads/stable/lithium">bgp-inet.yang</a>
that summarizes the ipv4 and ipv6 extensions to RIB routes and BGP
messages.</p>
</div>
<div class="section" id="bgp-flowspec">
<h3>BGP flowspec<a class="headerlink" href="#bgp-flowspec" title="Permalink to this headline">¶</a></h3>
<p>BGP flowspec is a module that implements
<a class="reference external" href="http://tools.ietf.org/html/rfc5575">RFC5575</a>. The RFC defines an
extension to BGP in form of a new subsequent address family, NLRI and
extended communities. All of those are defined in the
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/flowspec/src/main/yang/bgp-flowspec.yang;hb=refs/heads/stable/lithium">bgp-flowspec.yang</a>
model. In addition to generated sources, the module contains parsers for
newly defined elements and RIBSupport for flowspec-routes. The route key
of flowspec routes is a string representing human-readable flowspec
request.</p>
</div>
<div class="section" id="bgp-linkstate">
<h3>BGP linkstate<a class="headerlink" href="#bgp-linkstate" title="Permalink to this headline">¶</a></h3>
<p>BGP linkstate is a module that implements
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-idr-ls-distribution-04">draft-ietf-idr-ls-distribution</a>
version 04. The draft defines an extension to BGP in form of a new
address family, subsequent address family, NLRI and path attribute. All
of those are defined in the
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/linkstate/src/main/yang/bgp-linkstate.yang;hb=refs/heads/stable/lithium">bgp-linkstate.yang</a>
model. In addition to generated sources, the module contains
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/linkstate/src/main/java/org/opendaylight/protocol/bgp/linkstate/attribute/LinkstateAttributeParser.java;hb=refs/heads/stable/lithium">LinkstateAttributeParser</a>,
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=bgp/linkstate/src/main/java/org/opendaylight/protocol/bgp/linkstate/nlri/LinkstateNlriParser.java;hb=refs/heads/stable/lithium">LinkstateNlriParser</a>,
activators for both, parser and RIB, and RIBSupport handler for
linkstate address family. As each route needs a key, in case of
linkstate, the route key is defined as a binary string, containing all
the nlri serialized to byte format.</p>
</div>
<div class="section" id="bgp-topology-provider">
<h3>BGP topology provider<a class="headerlink" href="#bgp-topology-provider" title="Permalink to this headline">¶</a></h3>
<p>BGP data besides RIB, is stored in network-topology view. The format of
how the data is displayed there conforms to
<a class="reference external" href="https://tools.ietf.org/html/draft-clemm-netmod-yang-network-topo-01">draft-clemm-netmod-yang-network-topo</a>.</p>
</div>
<div class="section" id="id6">
<h3>API Reference Documentation<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Javadocs are generated while creating mvn:site and they are located in
target/ directory in each module.</p>
</div>
</div>
<div class="section" id="capwap-developer-guide">
<h2>CAPWAP Developer Guide<a class="headerlink" href="#capwap-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Overview<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The Control And Provisioning of Wireless Access Points (CAPWAP) plugin
project aims to provide new southbound interface for controller to be
able to monitor and manage CAPWAP compliant wireless termination point
(WTP) network devices. The CAPWAP feature will provide REST based
northbound APIs.</p>
</div>
<div class="section" id="capwap-architecture">
<h3>CAPWAP Architecture<a class="headerlink" href="#capwap-architecture" title="Permalink to this headline">¶</a></h3>
<p>The CAPWAP feature is implemented as an MD-SAL based provider module,
which helps discover WTP devices and update their states in the MD-SAL
operational datastore.</p>
</div>
<div class="section" id="capwap-apis-and-interfaces">
<h3>CAPWAP APIs and Interfaces<a class="headerlink" href="#capwap-apis-and-interfaces" title="Permalink to this headline">¶</a></h3>
<p>This section describes the APIs for interacting with the CAPWAP plugin.</p>
<div class="section" id="discovered-wtps">
<h4>Discovered WTPs<a class="headerlink" href="#discovered-wtps" title="Permalink to this headline">¶</a></h4>
<p>The CAPWAP project maintains list of discovered CAPWAP WTPs that is
YANG-based in MD-SAL. These models are available via RESTCONF.</p>
<ul class="simple">
<li>Name: Discovered-WTPs</li>
<li>URL:
<a class="reference external" href="http://${ipaddress}:8181/restconf/operational/capwap-impl:capwap-ac-root/">http://${ipaddress}:8181/restconf/operational/capwap-impl:capwap-ac-root/</a></li>
<li>Description: Displays list of discovered WTPs and their basic
attributes</li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h3>API Reference Documentation<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Go to
<a class="reference external" href="http://${ipaddress}:8181/apidoc/explorer/index.html">http://${ipaddress}:8181/apidoc/explorer/index.html</a>,
sign in, and expand the capwap-impl panel. From there, users can execute
various API calls to test their CAPWAP deployment.</p>
</div>
</div>
<div class="section" id="controller">
<h2>Controller<a class="headerlink" href="#controller" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id9">
<h3>Overview<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>OpenDaylight Controller is Java-based, model-driven controller using
YANG as its modeling language for various aspects of the system and
applications and with its components serves as a base platform for other
OpenDaylight applications.</p>
<p>The OpenDaylight Controller relies on the following technologies:</p>
<ul class="simple">
<li><strong>OSGI</strong> - This framework is the back-end of OpenDaylight as it
allows dynamically loading of bundles and packages JAR files, and
binding bundles together for exchanging information.</li>
<li><strong>Karaf</strong> - Application container built on top of OSGI, which
simplifies operational aspects of packaging and installing
applications.</li>
<li><strong>YANG</strong> - a data modeling language used to model configuration and
state data manipulated by the applications, remote procedure calls,
and notifications.</li>
</ul>
<p>The OpenDaylight Controller provides following model-driven subsystems
as a foundation for Java applications:</p>
<ul class="simple">
<li><strong>`Config Subsystem &lt;#_config_subsystem&gt;`__</strong> - an activation,
dependency-injection and configuration framework, which allows
two-phase commits of configuration and dependency-injection, and
allows for run-time rewiring.</li>
<li><strong>`MD-SAL &lt;#_md_sal_overview&gt;`__</strong> - messaging and data storage
functionality for data, notifications and RPCs modeled by application
developers. MD-SAL uses YANG as the modeling for both interface and
data definitions, and provides a messaging and data-centric runtime
for such services based on YANG modeling.</li>
<li><strong>MD-SAL Clustering</strong> - enables cluster support for core MD-SAL
functionality and provides location-transparent accesss to
YANG-modeled data.</li>
</ul>
<p>The OpenDaylight Controller supports external access to applications and
data using following model-driven protocols:</p>
<ul class="simple">
<li><strong>NETCONF</strong> - XML-based RPC protocol, which provides abilities for
client to invoke YANG-modeled RPCs, receive notifications and to
read, modify and manipulate YANG modeled data.</li>
<li><strong>RESTCONF</strong> - HTTP-based protocol, which provides REST-like APIs to
manipulate YANG modeled data and invoke YANG modeled RPCs, using XML
or JSON as payload format.</li>
</ul>
</div>
<div class="section" id="md-sal-overview">
<h3>MD-SAL Overview<a class="headerlink" href="#md-sal-overview" title="Permalink to this headline">¶</a></h3>
<p>The Model-Driven Service Adaptation Layer (MD-SAL) is message-bus
inspired extensible middleware component that provides messaging and
data storage functionality based on data and interface models defined by
application developers (i.e. user-defined models).</p>
<p>The MD-SAL:</p>
<ul class="simple">
<li>Defines a <strong>common-layer, concepts, data model building blocks and
messaging patterns</strong> and provides infrastructure / framework for
applications and inter-application communication.</li>
<li>Provide common support for user-defined transport and payload
formats, including payload serialization and adaptation (e.g. binary,
XML or JSON).</li>
</ul>
<p>The MD-SAL uses <strong>YANG</strong> as the modeling language for both interface and
data definitions, and provides a messaging and data-centric runtime for
such services based on YANG modeling.</p>
<div class="line-block">
<div class="line">The MD-SAL provides two different API types (flavours):</div>
</div>
<ul>
<li><p class="first"><strong>MD-SAL Binding:</strong> MD-SAL APIs which extensively uses APIs and
classes generated from YANG models, which provides compile-time
safety.</p>
</li>
<li><p class="first"><strong>MD-SAL DOM:</strong> (Document Object Model) APIs which uses DOM-like
representation of data, which makes them more powerful, but provides
less compile-time safety.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Model-driven nature of the MD-SAL and <strong>DOM</strong>-based APIs allows for
behind-the-scene API and payload type mediation and transformation
to facilitate seamless communication between applications - this
enables for other components and applications to provide connectors
/ expose different set of APIs and derive most of its functionality
purely from models, which all existing code can benefit from without
modification. For example <strong>RESTCONF Connector</strong> is an application
built on top of MD-SAL and exposes YANG-modeled application APIs
transparently via HTTP and adds support for XML and JSON payload
type.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="basic-concepts">
<h4>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h4>
<p>Basic concepts are building blocks which are used by applications, and
from which MD-SAL uses to define messaging patterns and to provide
services and behavior based on developer-supplied YANG models.</p>
<dl class="docutils">
<dt>Data Tree</dt>
<dd><p class="first">All state-related data are modeled and represented as data tree,
with possibility to address any element / subtree</p>
<ul class="last simple">
<li><strong>Operational Data Tree</strong> - Reported state of the system,
published by the providers using MD-SAL. Represents a feedback
loop for applications to observe state of the network / system.</li>
<li><strong>Configuration Data Tree</strong> - Intended state of the system or
network, populated by consumers, which expresses their intention.</li>
</ul>
</dd>
<dt>Instance Identifier</dt>
<dd>Unique identifier of node / subtree in data tree, which provides
unambiguous information, how to reference and retrieve node /
subtree from conceptual data trees.</dd>
<dt>Notification</dt>
<dd>Asynchronous transient event which may be consumed by subscribers
and they may act upon it</dd>
<dt>RPC</dt>
<dd><p class="first">asynchronous request-reply message pair, when request is triggered
by consumer, send to the provider, which in future replies with
reply message.</p>
<blockquote class="last">
<div><p><strong>Note</strong></p>
<p>In MD-SAL terminology, the term <em>RPC</em> is used to define the
input and output for a procedure (function) that is to be
provided by a provider, and mediated by the MD-SAL, that means
it may not result in remote call.</p>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="messaging-patterns">
<h4>Messaging Patterns<a class="headerlink" href="#messaging-patterns" title="Permalink to this headline">¶</a></h4>
<p>MD-SAL provides several messaging patterns using broker derived from
basic concepts, which are intended to transfer YANG modeled data between
applications to provide data-centric integration between applications
instead of API-centric integration.</p>
<ul class="simple">
<li><strong>Unicast communication</strong><ul>
<li><strong>Remote Procedure Calls</strong> - unicast between consumer and
provider, where consumer sends <strong>request</strong> message to provider,
which asynchronously responds with <strong>reply</strong> message</li>
</ul>
</li>
<li><strong>Publish / Subscribe</strong><ul>
<li><strong>Notifications</strong> - multicast transient message which is published
by provider and is delivered to subscribers</li>
<li><strong>Data Change Events</strong> - multicast asynchronous event, which is
sent by data broker if there is change in conceptual data tree,
and is delivered to subscribers</li>
</ul>
</li>
<li><strong>Transactional access to Data Tree</strong><ul>
<li>Transactional <strong>reads</strong> from conceptual <strong>data tree</strong> - read-only
transactions with isolation from other running transactions.</li>
<li>Transactional <strong>modification</strong> to conceptual <strong>data tree</strong> - write
transactions with isolation from other running transactions.</li>
<li><strong>Transaction chaining</strong></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="md-sal-data-transactions">
<h3>MD-SAL Data Transactions<a class="headerlink" href="#md-sal-data-transactions" title="Permalink to this headline">¶</a></h3>
<p>MD-SAL <strong>Data Broker</strong> provides transactional access to conceptual
<strong>data trees</strong> representing configuration and operational state.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p><strong>Data tree</strong> usually represents state of the modeled data, usually
this is state of controller, applications and also external systems
(network devices).</p>
</div></blockquote>
<p><strong>Transactions</strong> provide <strong>`stable and isolated
view &lt;#_transaction_isolation&gt;`__</strong> from other currently running
transactions. The state of running transaction and underlying data tree
is not affected by other concurrently running transactions.</p>
<dl class="docutils">
<dt>Write-Only</dt>
<dd><p class="first">Transaction provides only modification capabilities, but does not
provide read capabilities. Write-only transaction is allocated using
<code class="docutils literal"><span class="pre">newWriteOnlyTransaction()</span></code>.</p>
<blockquote class="last">
<div><p><strong>Note</strong></p>
<p>This allows less state tracking for write-only transactions and
allows MD-SAL Clustering to optimize internal representation of
transaction in cluster.</p>
</div></blockquote>
</dd>
<dt>Read-Write</dt>
<dd>Transaction provides both read and write capabilities. It is
allocated using <code class="docutils literal"><span class="pre">newReadWriteTransaction()</span></code>.</dd>
<dt>Read-Only</dt>
<dd><p class="first">Transaction provides stable read-only view based on current data
tree. Read-only view is not affected by any subsequent write
transactions. Read-only transaction is allocated using
<code class="docutils literal"><span class="pre">newReadOnlyTransaction()</span></code>.</p>
<blockquote class="last">
<div><p><strong>Note</strong></p>
<p>If an application needs to observe changes itself in data tree,
it should use <strong>data tree listeners</strong> instead of read-only
transactions and polling data tree.</p>
</div></blockquote>
</dd>
</dl>
<p>Transactions may be allocated using the <strong>data broker</strong> itself or using
<strong>transaction chain</strong>. In the case of <strong>transaction chain</strong>, the new
allocated transaction is not based on current state of data tree, but
rather on state introduced by previous transaction from the same chain,
even if the commit for previous transaction has not yet occurred (but
transaction was submitted).</p>
<div class="section" id="write-only-read-write-transaction">
<h4>Write-Only &amp; Read-Write Transaction<a class="headerlink" href="#write-only-read-write-transaction" title="Permalink to this headline">¶</a></h4>
<p>Write-Only and Read-Write transactions provide modification capabilities
for the conceptual data trees.</p>
<ol class="arabic simple">
<li>application allocates new transactions using
<code class="docutils literal"><span class="pre">newWriteOnlyTransaction()</span></code> or <code class="docutils literal"><span class="pre">newReadWriteTransaction()</span></code>.</li>
<li>application <a class="reference external" href="#_modification_of_data_tree">modifies data tree</a>
using <code class="docutils literal"><span class="pre">put</span></code>, <code class="docutils literal"><span class="pre">merge</span></code> and/or <code class="docutils literal"><span class="pre">delete</span></code>.</li>
<li>application finishes transaction using
<code class="docutils literal"><span class="pre">`submit()</span></code> &lt;#_submitting_transaction&gt;`__, which seals transaction
and submits it to be processed.</li>
<li>application observes the result of the transaction commit using
either blocking or asynchronous calls.</li>
</ol>
<p>The <strong>initial state</strong> of the write transaction is a <strong>stable snapshot</strong>
of the current data tree state captured when transaction was created and
it’s state and underlying data tree are not affected by other
concurrently running transactions.</p>
<p>Write transactions are <strong>isolated</strong> from other concurrent write
transactions. All <strong>`writes are local &lt;#_transaction_local_state&gt;`__</strong>
to the transaction and represents only a <strong>proposal of state change</strong>
for data tree and <strong>are not visible</strong> to any other concurrently running
transactions (including read-only transactions).</p>
<p>The transaction <strong>`commit may fail &lt;#_commit_failure_scenarios&gt;`__</strong> due
to failing verification of data or concurrent transaction modifying and
affected data in an incompatible way.</p>
<div class="section" id="modification-of-data-tree">
<h5>Modification of Data Tree<a class="headerlink" href="#modification-of-data-tree" title="Permalink to this headline">¶</a></h5>
<p>Write-only and read-write transaction provides following methods to
modify data tree:</p>
<dl class="docutils">
<dt>put</dt>
<dd><div class="code java first highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">void</span> <span class="n">put</span><span class="p">(</span><span class="n">LogicalDatastoreType</span> <span class="n">store</span><span class="p">,</span> <span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">path</span><span class="p">,</span> <span class="n">T</span> <span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p class="last">Stores a piece of data at a specified path. This acts as an <strong>add /
replace</strong> operation, which is to say that whole subtree will be
replaced by the specified data.</p>
</dd>
<dt>merge</dt>
<dd><div class="code java first highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">void</span> <span class="n">merge</span><span class="p">(</span><span class="n">LogicalDatastoreType</span> <span class="n">store</span><span class="p">,</span> <span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">path</span><span class="p">,</span> <span class="n">T</span> <span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p class="last">Merges a piece of data with the existing data at a specified path.
Any <strong>pre-existing data</strong> which are not explicitly overwritten
<strong>will be preserved</strong>. This means that if you store a container, its
child subtrees will be merged.</p>
</dd>
<dt>delete</dt>
<dd><div class="code java first highlight-default"><div class="highlight"><pre><span></span>void delete(LogicalDatastoreType store, InstanceIdentifier&lt;?&gt; path);
</pre></div>
</div>
<p class="last">Removes a whole subtree from a specified path.</p>
</dd>
</dl>
</div>
<div class="section" id="submitting-transaction">
<h5>Submitting transaction<a class="headerlink" href="#submitting-transaction" title="Permalink to this headline">¶</a></h5>
<p>Transaction is submitted to be processed and committed using following
method:</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">CheckedFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="p">,</span><span class="n">TransactionCommitFailedException</span><span class="o">&gt;</span> <span class="n">submit</span><span class="p">();</span>
</pre></div>
</div>
<p>Applications publish the changes proposed in the transaction by calling
<code class="docutils literal"><span class="pre">submit()</span></code> on the transaction. This <strong>seals the transaction</strong>
(preventing any further writes using this transaction) and submits it to
be processed and applied to global conceptual data tree. The
<code class="docutils literal"><span class="pre">submit()</span></code> method does not block, but rather returns
<code class="docutils literal"><span class="pre">ListenableFuture</span></code>, which will complete successfully once processing
of transaction is finished and changes are applied to data tree. If
<strong>commit</strong> of data failed, the future will fail with
<code class="docutils literal"><span class="pre">TransactionFailedException</span></code>.</p>
<p>Application may listen on commit state asynchronously using
<code class="docutils literal"><span class="pre">ListenableFuture</span></code>.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">Futures</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span> <span class="n">writeTx</span><span class="o">.</span><span class="n">submit</span><span class="p">(),</span> <span class="n">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onSuccess</span><span class="p">(</span> <span class="n">Void</span> <span class="n">result</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Transaction committed successfully.&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">public</span> <span class="n">void</span> <span class="n">onFailure</span><span class="p">(</span> <span class="n">Throwable</span> <span class="n">t</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Commit failed.&quot;</span><span class="p">,</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></div>
</div>
<ul class="simple">
<li>Submits <code class="docutils literal"><span class="pre">writeTx</span></code> and registers application provided
<code class="docutils literal"><span class="pre">FutureCallback</span></code> on returned future.</li>
<li>Invoked when future completed successfully - transaction <code class="docutils literal"><span class="pre">writeTx</span></code>
was successfully committed to data tree.</li>
<li>Invoked when future failed - commit of transaction <code class="docutils literal"><span class="pre">writeTx</span></code>
failed. Supplied exception provides additional details and cause of
failure.</li>
</ul>
<p>If application need to block till commit is finished it may use
<code class="docutils literal"><span class="pre">checkedGet()</span></code> to wait till commit is finished.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
    <span class="n">writeTx</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span><span class="o">.</span><span class="n">checkedGet</span><span class="p">();</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">TransactionCommitFailedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Commit failed.&quot;</span><span class="p">,</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Submits <code class="docutils literal"><span class="pre">writeTx</span></code> and blocks till commit of <code class="docutils literal"><span class="pre">writeTx</span></code> is
finished. If commit fails <code class="docutils literal"><span class="pre">TransactionCommitFailedException</span></code> will
be thrown.</li>
<li>Catches <code class="docutils literal"><span class="pre">TransactionCommitFailedException</span></code> and logs it.</li>
</ul>
</div>
<div class="section" id="transaction-local-state">
<h5>Transaction local state<a class="headerlink" href="#transaction-local-state" title="Permalink to this headline">¶</a></h5>
<p>Read-Write transactions maintain transaction-local state, which renders
all modifications as if they happened, but this is only local to
transaction.</p>
<p>Reads from the transaction returns data as if the previous modifications
in transaction already happened.</p>
<p>Let assume initial state of data tree for <code class="docutils literal"><span class="pre">PATH</span></code> is <code class="docutils literal"><span class="pre">A</span></code>.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">ReadWriteTransaction</span> <span class="n">rwTx</span> <span class="o">=</span> <span class="n">broker</span><span class="o">.</span><span class="n">newReadWriteTransaction</span><span class="p">();</span>

<span class="n">rwRx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">rwRx</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">,</span><span class="n">B</span><span class="p">);</span>
<span class="n">rwRx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">rwRx</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">,</span><span class="n">C</span><span class="p">);</span>
<span class="n">rwRx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li>Allocates new <code class="docutils literal"><span class="pre">ReadWriteTransaction</span></code>.</li>
<li>Read from <code class="docutils literal"><span class="pre">rwTx</span></code> will return value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</li>
<li>Writes value <code class="docutils literal"><span class="pre">B</span></code> to <code class="docutils literal"><span class="pre">PATH</span></code> using <code class="docutils literal"><span class="pre">rwTx</span></code>.</li>
<li>Read will return value <code class="docutils literal"><span class="pre">B</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>, since previous write
occurred in same transaction.</li>
<li>Writes value <code class="docutils literal"><span class="pre">C</span></code> to <code class="docutils literal"><span class="pre">PATH</span></code> using <code class="docutils literal"><span class="pre">rwTx</span></code>.</li>
<li>Read will return value <code class="docutils literal"><span class="pre">C</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>, since previous write
occurred in same transaction.</li>
</ul>
</div>
</div>
<div class="section" id="transaction-isolation">
<h4>Transaction isolation<a class="headerlink" href="#transaction-isolation" title="Permalink to this headline">¶</a></h4>
<p>Running (not submitted) transactions are isolated from each other and
changes done in one transaction are not observable in other currently
running transaction.</p>
<p>Lets assume initial state of data tree for <code class="docutils literal"><span class="pre">PATH</span></code> is <code class="docutils literal"><span class="pre">A</span></code>.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">ReadOnlyTransaction</span> <span class="n">txRead</span> <span class="o">=</span> <span class="n">broker</span><span class="o">.</span><span class="n">newReadOnlyTransaction</span><span class="p">();</span>
<span class="n">ReadWriteTransaction</span> <span class="n">txWrite</span> <span class="o">=</span> <span class="n">broker</span><span class="o">.</span><span class="n">newReadWriteTransaction</span><span class="p">();</span>

<span class="n">txRead</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">txWrite</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">,</span><span class="n">B</span><span class="p">);</span>
<span class="n">txWrite</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">txWrite</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">txRead</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">txAfterCommit</span> <span class="o">=</span> <span class="n">broker</span><span class="o">.</span><span class="n">newReadOnlyTransaction</span><span class="p">();</span>
<span class="n">txAfterCommit</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">OPERATIONAL</span><span class="p">,</span><span class="n">PATH</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
</pre></div>
</div>
<ul>
<li><p class="first">Allocates read only transaction, which is based on data tree which
contains value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first">Allocates read write transaction, which is based on data tree which
contains value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first">Read from read-only transaction returns value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first">Data tree is updated using read-write transaction, <code class="docutils literal"><span class="pre">PATH</span></code> contains
<code class="docutils literal"><span class="pre">B</span></code>. Change is not public and only local to transaction.</p>
</li>
<li><p class="first">Read from read-write transaction returns value <code class="docutils literal"><span class="pre">B</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first">Submits changes in read-write transaction to be committed to data
tree. Once commit will finish, changes will be published and <code class="docutils literal"><span class="pre">PATH</span></code>
will be updated for value <code class="docutils literal"><span class="pre">B</span></code>. Previously allocated transactions
are not affected by this change.</p>
</li>
<li><p class="first">Read from previously allocated read-only transaction still returns
value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>, since it provides stable and isolated view.</p>
</li>
<li><p class="first">Allocates new read-only transaction, which is based on data tree,
which contains value <code class="docutils literal"><span class="pre">B</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.</p>
</li>
<li><p class="first">Read from new read-only transaction return value <code class="docutils literal"><span class="pre">B</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>
since read-write transaction was committed.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Examples contain blocking calls on future only to illustrate that
action happened after other asynchronous action. The use of the
blocking call <code class="docutils literal"><span class="pre">ListenableFuture#get()</span></code> is discouraged for most
use-cases and you should use
<code class="docutils literal"><span class="pre">Futures#addCallback(ListenableFuture,</span> <span class="pre">FutureCallback)</span></code> to listen
asynchronously for result.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="commit-failure-scenarios">
<h4>Commit failure scenarios<a class="headerlink" href="#commit-failure-scenarios" title="Permalink to this headline">¶</a></h4>
<p>A transaction commit may fail because of following reasons:</p>
<dl class="docutils">
<dt>Optimistic Lock Failure</dt>
<dd><p class="first">Another transaction finished earlier and <strong>modified the same node in
a non-compatible way</strong>. The commit (and the returned future) will
fail with an <code class="docutils literal"><span class="pre">OptimisticLockFailedException</span></code>.</p>
<p>It is the responsibility of the caller to create a new transaction
and submit the same modification again in order to update data tree.</p>
<blockquote class="last">
<div><p><strong>Warning</strong></p>
<p><code class="docutils literal"><span class="pre">OptimisticLockFailedException</span></code> usually exposes <strong>multiple
writers</strong> to the same data subtree, which may conflict on same
resources.</p>
<p>In most cases, retrying may result in a probability of success.</p>
<p>There are scenarios, albeit unusual, where any number of retries
will not succeed. Therefore it is strongly recommended to limit
the number of retries (2 or 3) to avoid an endless loop.</p>
</div></blockquote>
</dd>
<dt>Data Validation</dt>
<dd>The data change introduced by this transaction <strong>did not pass
validation</strong> by commit handlers or data was incorrectly structured.
The returned future will fail with a
<code class="docutils literal"><span class="pre">DataValidationFailedException</span></code>. User <strong>should not retry</strong> to
create new transaction with same data, since it probably will fail
again.</dd>
</dl>
<div class="section" id="example-conflict-of-two-transactions">
<h5>Example conflict of two transactions<a class="headerlink" href="#example-conflict-of-two-transactions" title="Permalink to this headline">¶</a></h5>
<p>This example illustrates two concurrent transactions, which derived from
same initial state of data tree and proposes conflicting modifications.</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span>WriteTransaction txA = broker.newWriteTransaction();
WriteTransaction txB = broker.newWriteTransaction();

txA.put(CONFIGURATION, PATH, A);
txB.put(CONFIGURATION, PATH, B);

CheckedFuture&lt;?,?&gt; futureA = txA.submit();
CheckedFuture&lt;?,?&gt; futureB = txB.submit();
</pre></div>
</div>
<ul class="simple">
<li>Updates <code class="docutils literal"><span class="pre">PATH</span></code> to value <code class="docutils literal"><span class="pre">A</span></code> using <code class="docutils literal"><span class="pre">txA</span></code></li>
<li>Updates <code class="docutils literal"><span class="pre">PATH</span></code> to value <code class="docutils literal"><span class="pre">B</span></code> using <code class="docutils literal"><span class="pre">txB</span></code></li>
<li>Seals &amp; submits <code class="docutils literal"><span class="pre">txA</span></code>. The commit will be processed asynchronously
and data tree will be updated to contain value <code class="docutils literal"><span class="pre">A</span></code> for <code class="docutils literal"><span class="pre">PATH</span></code>.
The returned ‘ListenableFuture’ will complete successfully once state
is applied to data tree.</li>
<li>Seals &amp; submits <code class="docutils literal"><span class="pre">txB</span></code>. Commit of <code class="docutils literal"><span class="pre">txB</span></code> will fail, because
previous transaction also modified path in a concurrent way. The
state introduced by <code class="docutils literal"><span class="pre">txB</span></code> will not be applied. The returned
<code class="docutils literal"><span class="pre">ListenableFuture</span></code> will fail with <code class="docutils literal"><span class="pre">OptimisticLockFailedException</span></code>
exception, which indicates that concurrent transaction prevented the
submitted transaction from being applied.</li>
</ul>
</div>
<div class="section" id="example-asynchronous-retry-loop">
<h5>Example asynchronous retry-loop<a class="headerlink" href="#example-asynchronous-retry-loop" title="Permalink to this headline">¶</a></h5>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">void</span> <span class="n">doWrite</span><span class="p">(</span> <span class="n">final</span> <span class="nb">int</span> <span class="n">tries</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">WriteTransaction</span> <span class="n">writeTx</span> <span class="o">=</span> <span class="n">dataBroker</span><span class="o">.</span><span class="n">newWriteOnlyTransaction</span><span class="p">();</span>

    <span class="n">MyDataObject</span> <span class="n">data</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
    <span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">MyDataObject</span><span class="o">&gt;</span> <span class="n">path</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
    <span class="n">writeTx</span><span class="o">.</span><span class="n">put</span><span class="p">(</span> <span class="n">LogicalDatastoreType</span><span class="o">.</span><span class="n">OPERATIONAL</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span> <span class="p">);</span>

    <span class="n">Futures</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span> <span class="n">writeTx</span><span class="o">.</span><span class="n">submit</span><span class="p">(),</span> <span class="n">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onSuccess</span><span class="p">(</span> <span class="n">Void</span> <span class="n">result</span> <span class="p">)</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">succeeded</span>
        <span class="p">}</span>

        <span class="n">public</span> <span class="n">void</span> <span class="n">onFailure</span><span class="p">(</span> <span class="n">Throwable</span> <span class="n">t</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">t</span> <span class="n">instanceof</span> <span class="n">OptimisticLockFailedException</span> <span class="o">&amp;&amp;</span> <span class="p">((</span> <span class="n">tries</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">doWrite</span><span class="p">(</span> <span class="n">tries</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
<span class="p">}</span>
<span class="o">...</span>
<span class="n">doWrite</span><span class="p">(</span> <span class="mi">2</span> <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="concurrent-change-compatibility">
<h4>Concurrent change compatibility<a class="headerlink" href="#concurrent-change-compatibility" title="Permalink to this headline">¶</a></h4>
<p>There are several sets of changes which could be considered incompatible
between two transactions which are derived from same initial state.
Rules for conflict detection applies recursively for each subtree level.</p>
<p>Following table shows state changes and failures between two concurrent
transactions, which are based on same initial state, <code class="docutils literal"><span class="pre">tx1</span></code> is
submitted before <code class="docutils literal"><span class="pre">tx2</span></code>.</p>
<p>INFO: Following tables stores numeric values and shows data using
<code class="docutils literal"><span class="pre">toString()</span></code> to simplify examples.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Initial state</th>
<th class="head">tx1</th>
<th class="head">tx2</th>
<th class="head">Observable Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Empty</td>
<td><code class="docutils literal"><span class="pre">put(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">put(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
value of <code class="docutils literal"><span class="pre">A</span></code> is
<code class="docutils literal"><span class="pre">1</span></code></td>
</tr>
<tr class="row-odd"><td>Empty</td>
<td><code class="docutils literal"><span class="pre">put(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">merge(A,2)</span></code></td>
<td>value of <code class="docutils literal"><span class="pre">A</span></code> is
<code class="docutils literal"><span class="pre">2</span></code></td>
</tr>
<tr class="row-even"><td>Empty</td>
<td><code class="docutils literal"><span class="pre">merge(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">put(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
value of <code class="docutils literal"><span class="pre">A</span></code> is
<code class="docutils literal"><span class="pre">1</span></code></td>
</tr>
<tr class="row-odd"><td>Empty</td>
<td><code class="docutils literal"><span class="pre">merge(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">merge(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">A</span></code> is <code class="docutils literal"><span class="pre">2</span></code></td>
</tr>
<tr class="row-even"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">put(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">put(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
<code class="docutils literal"><span class="pre">A</span></code> is <code class="docutils literal"><span class="pre">1</span></code></td>
</tr>
<tr class="row-odd"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">put(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">merge(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">A</span></code> is <code class="docutils literal"><span class="pre">2</span></code></td>
</tr>
<tr class="row-even"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">merge(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">put(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
value of <code class="docutils literal"><span class="pre">A</span></code> is
<code class="docutils literal"><span class="pre">1</span></code></td>
</tr>
<tr class="row-odd"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">merge(A,1)</span></code></td>
<td><code class="docutils literal"><span class="pre">merge(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">A</span></code> is <code class="docutils literal"><span class="pre">2</span></code></td>
</tr>
<tr class="row-even"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">delete(A)</span></code></td>
<td><code class="docutils literal"><span class="pre">put(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
<code class="docutils literal"><span class="pre">A</span></code> does not
exists</td>
</tr>
<tr class="row-odd"><td>A=0</td>
<td><code class="docutils literal"><span class="pre">delete(A)</span></code></td>
<td><code class="docutils literal"><span class="pre">merge(A,2)</span></code></td>
<td><code class="docutils literal"><span class="pre">A</span></code> is <code class="docutils literal"><span class="pre">2</span></code></td>
</tr>
</tbody>
</table>
<p>Table: Concurrent change resolution for leaves and leaf-list items</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Initial state</th>
<th class="head"><code class="docutils literal"><span class="pre">tx1</span></code></th>
<th class="head"><code class="docutils literal"><span class="pre">tx2</span></code></th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Empty</td>
<td>put(TOP,[])</td>
<td>put(TOP,[])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is TOP=[]</td>
</tr>
<tr class="row-odd"><td>Empty</td>
<td>put(TOP,[])</td>
<td>merge(TOP,[])</td>
<td>TOP=[]</td>
</tr>
<tr class="row-even"><td>Empty</td>
<td>put(TOP,[FOO=1])</td>
<td>put(TOP,[BAR=1])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is
TOP=[FOO=1]</td>
</tr>
<tr class="row-odd"><td>Empty</td>
<td>put(TOP,[FOO=1])</td>
<td>merge(TOP,[BAR=1])</td>
<td>TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>Empty</td>
<td>merge(TOP,[FOO=1])</td>
<td>put(TOP,[BAR=1])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is
TOP=[FOO=1]</td>
</tr>
<tr class="row-odd"><td>Empty</td>
<td>merge(TOP,[FOO=1])</td>
<td>merge(TOP,[BAR=1])</td>
<td>TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>put(TOP,[FOO=1])</td>
<td>put(TOP,[BAR=1])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is
TOP=[FOO=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>put(TOP,[FOO=1])</td>
<td>merge(TOP,[BAR=1])</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>merge(TOP,[FOO=1])</td>
<td>put(TOP,[BAR=1])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is
TOP=[FOO=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>merge(TOP,[FOO=1])</td>
<td>merge(TOP,[BAR=1])</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>delete(TOP)</td>
<td>put(TOP,[BAR=1])</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is empty
store</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>delete(TOP)</td>
<td>merge(TOP,[BAR=1])</td>
<td>state is
TOP=[BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>put(TOP/FOO,1)</td>
<td>put(TOP/BAR,1])</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>put(TOP/FOO,1)</td>
<td>merge(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>merge(TOP/FOO,1)</td>
<td>put(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>merge(TOP/FOO,1)</td>
<td>merge(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=1,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[]</td>
<td>delete(TOP)</td>
<td>put(TOP/BAR,1)</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is empty
store</td>
</tr>
<tr class="row-odd"><td>TOP=[]</td>
<td>delete(TOP)</td>
<td>merge(TOP/BAR,1]</td>
<td><code class="docutils literal"><span class="pre">tx2</span></code> will fail,
state is empty
store</td>
</tr>
<tr class="row-even"><td>TOP=[FOO=1]</td>
<td>put(TOP/FOO,2)</td>
<td>put(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=2,BAR=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[FOO=1]</td>
<td>put(TOP/FOO,2)</td>
<td>merge(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=2,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[FOO=1]</td>
<td>merge(TOP/FOO,2)</td>
<td>put(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=2,BAR=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[FOO=1]</td>
<td>merge(TOP/FOO,2)</td>
<td>merge(TOP/BAR,1)</td>
<td>state is
TOP=[FOO=2,BAR=1]</td>
</tr>
<tr class="row-even"><td>TOP=[FOO=1]</td>
<td>delete(TOP/FOO)</td>
<td>put(TOP/BAR,1)</td>
<td>state is
TOP=[BAR=1]</td>
</tr>
<tr class="row-odd"><td>TOP=[FOO=1]</td>
<td>delete(TOP/FOO)</td>
<td>merge(TOP/BAR,1]</td>
<td>state is
TOP=[BAR=1]</td>
</tr>
</tbody>
</table>
<p>Table: Concurrent change resolution for containers, lists, list items</p>
</div>
</div>
<div class="section" id="md-sal-rpc-routing">
<h3>MD-SAL RPC routing<a class="headerlink" href="#md-sal-rpc-routing" title="Permalink to this headline">¶</a></h3>
<p>The MD-SAL provides a way to deliver Remote Procedure Calls (RPCs) to a
particular implementation based on content in the input as it is modeled
in YANG. This part of the the RPC input is referred to as a <strong>context
reference</strong>.</p>
<p>The MD-SAL does not dictate the name of the leaf which is used for this
RPC routing, but provides necessary functionality for YANG model author
to define their <strong>context reference</strong> in their model of RPCs.</p>
<p>MD-SAL routing behavior is modeled using following terminology and its
application to YANG models:</p>
<dl class="docutils">
<dt>Context Type</dt>
<dd>Logical type of RPC routing. Context type is modeled as YANG
<code class="docutils literal"><span class="pre">identity</span></code> and is referenced in model to provide scoping
information.</dd>
<dt>Context Instance</dt>
<dd>Conceptual location in data tree, which represents context in which
RPC could be executed. Context instance usually represent logical
point to which RPC execution is attached.</dd>
<dt>Context Reference</dt>
<dd>Field of RPC input payload which contains Instance Identifier
referencing <strong>context instance</strong> in which the RPC should be
executed.</dd>
</dl>
<div class="section" id="modeling-a-routed-rpc">
<h4>Modeling a routed RPC<a class="headerlink" href="#modeling-a-routed-rpc" title="Permalink to this headline">¶</a></h4>
<p>In order to define routed RPCs, the YANG model author needs to declare
(or reuse) a <strong>context type</strong>, set of possible <strong>context instances</strong> and
finally RPCs which will contain <strong>context reference</strong> on which they will
be routed.</p>
<div class="section" id="declaring-a-routing-context-type">
<h5>Declaring a routing context type<a class="headerlink" href="#declaring-a-routing-context-type" title="Permalink to this headline">¶</a></h5>
<p>This declares an identity named <code class="docutils literal"><span class="pre">node-context</span></code>, which is used as
marker for node-based routing and is used in other places to reference
that routing type.</p>
</div>
<div class="section" id="declaring-possible-context-instances">
<h5>Declaring possible context instances<a class="headerlink" href="#declaring-possible-context-instances" title="Permalink to this headline">¶</a></h5>
<p>In order to define possible values of <strong>context instances</strong> for routed
RPCs, we need to model that set accordingly using <code class="docutils literal"><span class="pre">context-instance</span></code>
extension from the <code class="docutils literal"><span class="pre">yang-ext</span></code> model.</p>
<p>The statement <code class="docutils literal"><span class="pre">ext:context-instance</span> <span class="pre">&quot;node-context&quot;;</span></code> marks any element
of the <code class="docutils literal"><span class="pre">list</span> <span class="pre">node</span></code> as a possible valid <strong>context instance</strong> in
<code class="docutils literal"><span class="pre">node-context</span></code> based routing.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The existence of a <strong>context instance</strong> node in operational or
config data tree is not strongly tied to existence of RPC
implementation.</p>
<p>For most routed RPC models, there is relationship between the data
present in operational data tree and RPC implementation
availability, but this is not enforced by MD-SAL. This provides some
flexibility for YANG model writers to better specify their routing
model and requirements for implementations. Details when RPC
implementations are available should be documented in YANG model.</p>
<p>If user invokes RPC with a <strong>context instance</strong> that has no
registered implementation, the RPC invocation will fail with the
exception <code class="docutils literal"><span class="pre">DOMRpcImplementationNotAvailableException</span></code>.</p>
</div></blockquote>
</div>
<div class="section" id="declaring-a-routed-rpc">
<h5>Declaring a routed RPC<a class="headerlink" href="#declaring-a-routed-rpc" title="Permalink to this headline">¶</a></h5>
<p>To declare RPC to be routed based on <code class="docutils literal"><span class="pre">node-context</span></code> we need to add
leaf of <code class="docutils literal"><span class="pre">instance-identifier</span></code> type (or type derived from
<code class="docutils literal"><span class="pre">instance-identifier</span></code>) to the RPC and mark it as <strong>context
reference</strong>.</p>
<p>This is achieved using YANG extension <code class="docutils literal"><span class="pre">context-reference</span></code> from
<code class="docutils literal"><span class="pre">yang-ext</span></code> model on leaf, which will be used for RPC routing.</p>
<p>The statement <code class="docutils literal"><span class="pre">ext:context-reference</span> <span class="pre">&quot;node-context&quot;</span></code> marks
<code class="docutils literal"><span class="pre">leaf</span> <span class="pre">node</span></code> as <strong>context reference</strong> of type <code class="docutils literal"><span class="pre">node-context</span></code>. The
value of this leaf, will be used by the MD-SAL to select the particular
RPC implementation that registered itself as the implementation of the
RPC for particular <strong>context instance</strong>.</p>
</div>
</div>
<div class="section" id="using-routed-rpcs">
<h4>Using routed RPCs<a class="headerlink" href="#using-routed-rpcs" title="Permalink to this headline">¶</a></h4>
<p>From a user perspective (e.g. invoking RPCs) there is no difference
between routed and non-routed RPCs. Routing information is just an
additional leaf in RPC which must be populated.</p>
</div>
<div class="section" id="implementing-a-routed-rpc">
<h4>Implementing a routed RPC<a class="headerlink" href="#implementing-a-routed-rpc" title="Permalink to this headline">¶</a></h4>
<p>Implementation</p>
<div class="section" id="registering-implementations">
<h5>Registering implementations<a class="headerlink" href="#registering-implementations" title="Permalink to this headline">¶</a></h5>
<p>Implementations of a routed RPC (e.g., southbound plugins) will specify
an instance-identifier for the <strong>context reference</strong> (in this case a
node) for which they want to provide an implementation during
registration. Consumers, e.g., those calling the RPC are required to
specify that instance-identifier (in this case the identifier of a node)
when invoking RPC.</p>
<p>Simple code which showcases that for add-flow via Binding-Aware APIs
(<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=controller.git;a=blob;f=opendaylight/md-sal/sal-binding-it/src/test/java/org/opendaylight/controller/test/sal/binding/it/RoutedServiceTest.java;h=d49d6f0e25e271e43c8550feb5eef63d96301184;hb=HEAD">RoutedServiceTest.java</a>
):</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="mi">61</span>  <span class="nd">@Override</span>
<span class="mi">62</span>  <span class="n">public</span> <span class="n">void</span> <span class="n">onSessionInitiated</span><span class="p">(</span><span class="n">ProviderContext</span> <span class="n">session</span><span class="p">)</span> <span class="p">{</span>
<span class="mi">63</span>      <span class="n">assertNotNull</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="mi">64</span>      <span class="n">firstReg</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">addRoutedRpcImplementation</span><span class="p">(</span><span class="n">SalFlowService</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">salFlowService1</span><span class="p">);</span>
<span class="mi">65</span>  <span class="p">}</span>
</pre></div>
</div>
<p>Line 64: We are registering salFlowService1 as implementation of
SalFlowService RPC</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="mi">107</span>  <span class="n">NodeRef</span> <span class="n">nodeOne</span> <span class="o">=</span> <span class="n">createNodeRef</span><span class="p">(</span><span class="s2">&quot;foo:node:1&quot;</span><span class="p">);</span>
<span class="mi">109</span>  <span class="o">/**</span>
<span class="mi">110</span>   <span class="o">*</span> <span class="n">Provider</span> <span class="mi">1</span> <span class="n">registers</span> <span class="n">path</span> <span class="n">of</span> <span class="n">node</span> <span class="mi">1</span>
<span class="mi">111</span>   <span class="o">*/</span>
<span class="mi">112</span>  <span class="n">firstReg</span><span class="o">.</span><span class="n">registerPath</span><span class="p">(</span><span class="n">NodeContext</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">nodeOne</span><span class="p">);</span>
</pre></div>
</div>
<p>Line 107: We are creating NodeRef (encapsulation of InstanceIdentifier)
for &#8220;foo:node:1&#8221;.</p>
<p>Line 112: We register salFlowService1 as implementation for nodeOne.</p>
<p>The salFlowService1 will be executed only for RPCs which contains
Instance Identifier for foo:node:1.</p>
</div>
</div>
</div>
<div class="section" id="opendaylight-controller-md-sal-restconf">
<h3>OpenDaylight Controller MD-SAL: RESTCONF<a class="headerlink" href="#opendaylight-controller-md-sal-restconf" title="Permalink to this headline">¶</a></h3>
<div class="section" id="resconf-operations-overview">
<h4>RESCONF operations overview<a class="headerlink" href="#resconf-operations-overview" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">RESTCONF allows access to datastores in the controller.</div>
<div class="line">There are two datastores:</div>
</div>
<ul>
<li><p class="first">Config: Contains data inserted via controller</p>
</li>
<li><p class="first">Operational: Contains other data</p>
<blockquote>
<div><p><strong>Note</strong></p>
<div class="line-block">
<div class="line">Each request must start with the URI /restconf.</div>
<div class="line">RESTCONF listens on port 8080 for HTTP requests.</div>
</div>
</div></blockquote>
</li>
</ul>
<p>RESTCONF supports <strong>OPTIONS</strong>, <strong>GET</strong>, <strong>PUT</strong>, <strong>POST</strong>, and
<strong>DELETE</strong> operations. Request and response data can either be in the
XML or JSON format. XML structures according to yang are defined at:
<a class="reference external" href="http://tools.ietf.org/html/rfc6020">XML-YANG</a>. JSON structures are
defined at:
<a class="reference external" href="http://tools.ietf.org/html/draft-lhotka-netmod-yang-json-02">JSON-YANG</a>.
Data in the request must have a correctly set <strong>Content-Type</strong> field in
the http header with the allowed value of the media type. The media type
of the requested data has to be set in the <strong>Accept</strong> field. Get the
media types for each resource by calling the OPTIONS operation. Most of
the paths of the pathsRestconf endpoints use <a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Controller:MD-SAL:Concepts#Instance_Identifier">Instance
Identifier</a>.
<code class="docutils literal"><span class="pre">&lt;identifier&gt;</span></code> is used in the explanation of the operations.</p>
<div class="line-block">
<div class="line"><strong>&lt;identifier&gt;</strong></div>
</div>
<ul>
<li><p class="first">It must start with &lt;moduleName&gt;:&lt;nodeName&gt; where &lt;moduleName&gt; is a
name of the module and &lt;nodeName&gt; is the name of a node in the
module. It is sufficient to just use &lt;nodeName&gt; after
&lt;moduleName&gt;:&lt;nodeName&gt;. Each &lt;nodeName&gt; has to be separated by /.</p>
</li>
<li><p class="first">&lt;nodeName&gt; can represent a data node which is a list or container
yang built-in type. If the data node is a list, there must be defined
keys of the list behind the data node name for example,
&lt;nodeName&gt;/&lt;valueOfKey1&gt;/&lt;valueOfKey2&gt;.</p>
</li>
<li><div class="first line-block">
<div class="line">The format &lt;moduleName&gt;:&lt;nodeName&gt; has to be used in this case as
well:</div>
<div class="line">Module A has node A1. Module B augments node A1 by adding node X.
Module C augments node A1 by adding node X. For clarity, it has to
be known which node is X (for example: C:X). For more details about
encoding, see: <a class="reference external" href="http://tools.ietf.org/html/draft-bierman-netconf-restconf-02#section-5.3.1">RESTCONF 02 - Encoding YANG Instance Identifiers in
the Request
URI.</a></div>
</div>
</li>
</ul>
</div>
<div class="section" id="mount-point">
<h4>Mount point<a class="headerlink" href="#mount-point" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">A Node can be behind a mount point. In this case, the URI has to be in
format &lt;identifier&gt;/<strong>yang-ext:mount</strong>/&lt;identifier&gt;. The first
&lt;identifier&gt; is the path to a mount point and the second &lt;identifier&gt;
is the path to a node behind the mount point. A URI can end in a mount
point itself by using &lt;identifier&gt;/<strong>yang-ext:mount</strong>.</div>
<div class="line">More information on how to actually use mountpoints is available at:
<a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Controller:Config:Examples:Netconf">OpenDaylight
Controller:Config:Examples:Netconf</a>.</div>
</div>
</div>
<div class="section" id="http-methods">
<h4>HTTP methods<a class="headerlink" href="#http-methods" title="Permalink to this headline">¶</a></h4>
<div class="section" id="options-restconf">
<h5>OPTIONS /restconf<a class="headerlink" href="#options-restconf" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Returns the XML description of the resources with the required
request and response media types in Web Application Description
Language (WADL)</li>
</ul>
</div>
<div class="section" id="get-restconf-config-identifier">
<h5>GET /restconf/config/&lt;identifier&gt;<a class="headerlink" href="#get-restconf-config-identifier" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Returns a data node from the Config datastore.</li>
<li>&lt;identifier&gt; points to a data node which must be retrieved.</li>
</ul>
</div>
<div class="section" id="get-restconf-operational-identifier">
<h5>GET /restconf/operational/&lt;identifier&gt;<a class="headerlink" href="#get-restconf-operational-identifier" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Returns the value of the data node from the Operational datastore.</li>
<li>&lt;identifier&gt; points to a data node which must be retrieved.</li>
</ul>
</div>
<div class="section" id="put-restconf-config-identifier">
<h5>PUT /restconf/config/&lt;identifier&gt;<a class="headerlink" href="#put-restconf-config-identifier" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Updates or creates data in the Config datastore and returns the state
about success.</li>
<li>&lt;identifier&gt; points to a data node which must be stored.</li>
</ul>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>PUT http://&lt;controllerIP&gt;:8080/restconf/config/module1:foo/bar
Content-Type: applicaton/xml
&lt;bar&gt;
  …
&lt;/bar&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>Example with mount point:</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>PUT http://&lt;controllerIP&gt;:8080/restconf/config/module1:foo1/foo2/yang-ext:mount/module2:foo/bar
Content-Type: applicaton/xml
&lt;bar&gt;
  …
&lt;/bar&gt;
</pre></div>
</div>
</div>
<div class="section" id="post-restconf-config">
<h5>POST /restconf/config<a class="headerlink" href="#post-restconf-config" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Creates the data if it does not exist</li>
</ul>
<div class="line-block">
<div class="line">For example:</div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">URL</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span>
<span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">yang</span><span class="o">.</span><span class="n">data</span><span class="o">+</span><span class="n">json</span>
<span class="n">JSON</span> <span class="n">payload</span><span class="p">:</span>

   <span class="p">{</span>
     <span class="s2">&quot;toaster:toaster&quot;</span> <span class="p">:</span>
     <span class="p">{</span>
       <span class="s2">&quot;toaster:toasterManufacturer&quot;</span> <span class="p">:</span> <span class="s2">&quot;General Electric&quot;</span><span class="p">,</span>
       <span class="s2">&quot;toaster:toasterModelNumber&quot;</span> <span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">,</span>
       <span class="s2">&quot;toaster:toasterStatus&quot;</span> <span class="p">:</span> <span class="s2">&quot;up&quot;</span>
     <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="post-restconf-config-identifier">
<h5>POST /restconf/config/&lt;identifier&gt;<a class="headerlink" href="#post-restconf-config-identifier" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Creates the data if it does not exist in the Config datastore, and
returns the state about success.</li>
<li>&lt;identifier&gt; points to a data node where data must be stored.</li>
<li>The root element of data must have the namespace (data are in XML) or
module name (data are in JSON.)</li>
</ul>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>POST http://&lt;controllerIP&gt;:8080/restconf/config/module1:foo
Content-Type: applicaton/xml/
&lt;bar xmlns=“module1namespace”&gt;
  …
&lt;/bar&gt;
</pre></div>
</div>
<p><strong>Example with mount point:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://&lt;controllerIP&gt;:8080/restconf/config/module1:foo1/foo2/yang-ext:mount/module2:foo
Content-Type: applicaton/xml
&lt;bar xmlns=“module2namespace”&gt;
  …
&lt;/bar&gt;
</pre></div>
</div>
</div>
<div class="section" id="post-restconf-operations-modulename-rpcname">
<h5>POST /restconf/operations/&lt;moduleName&gt;:&lt;rpcName&gt;<a class="headerlink" href="#post-restconf-operations-modulename-rpcname" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Invokes RPC.</li>
<li>&lt;moduleName&gt;:&lt;rpcName&gt; - &lt;moduleName&gt; is the name of the module and
&lt;rpcName&gt; is the name of the RPC in this module.</li>
<li>The Root element of the data sent to RPC must have the name “input”.</li>
<li>The result can be the status code or the retrieved data having the
root element “output”.</li>
</ul>
<div class="line-block">
<div class="line"><strong>Example:</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>POST http://&lt;controllerIP&gt;:8080/restconf/operations/module1:fooRpc
Content-Type: applicaton/xml
Accept: applicaton/xml
&lt;input&gt;
  …
&lt;/input&gt;

The answer from the server could be:
&lt;output&gt;
  …
&lt;/output&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>An example using a JSON payload:</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">operations</span><span class="o">/</span><span class="n">toaster</span><span class="p">:</span><span class="n">make</span><span class="o">-</span><span class="n">toast</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">yang</span><span class="o">.</span><span class="n">data</span><span class="o">+</span><span class="n">json</span>
<span class="p">{</span>
  <span class="s2">&quot;input&quot;</span> <span class="p">:</span>
  <span class="p">{</span>
     <span class="s2">&quot;toaster:toasterDoneness&quot;</span> <span class="p">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
     <span class="s2">&quot;toaster:toasterToastType&quot;</span><span class="p">:</span><span class="s2">&quot;wheat-bread&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">**</span><span class="n">Note</span><span class="o">**</span>

<span class="n">Even</span> <span class="n">though</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">default</span> <span class="k">for</span> <span class="n">the</span> <span class="n">toasterToastType</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">the</span>
<span class="n">yang</span><span class="p">,</span> <span class="n">you</span> <span class="n">still</span> <span class="n">need</span> <span class="n">to</span> <span class="n">define</span> <span class="n">it</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-restconf-config-identifier">
<h5>DELETE /restconf/config/&lt;identifier&gt;<a class="headerlink" href="#delete-restconf-config-identifier" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Removes the data node in the Config datastore and returns the state
about success.</li>
<li>&lt;identifier&gt; points to a data node which must be removed.</li>
</ul>
<p>More information is available in the <a class="reference external" href="http://tools.ietf.org/html/draft-bierman-netconf-restconf-02">RESTCONF
RFC</a>.</p>
</div>
</div>
<div class="section" id="how-restconf-works">
<h4>How RESTCONF works<a class="headerlink" href="#how-restconf-works" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">RESTCONF uses these base classes:</div>
</div>
<dl class="docutils">
<dt>InstanceIdentifier</dt>
<dd>Represents the path in the data tree</dd>
<dt>ConsumerSession</dt>
<dd>Used for invoking RPCs</dd>
<dt>DataBrokerService</dt>
<dd>Offers manipulation with transactions and reading data from the
datastores</dd>
<dt>SchemaContext</dt>
<dd>Holds information about yang modules</dd>
<dt>MountService</dt>
<dd>Returns MountInstance based on the InstanceIdentifier pointing to a
mount point</dd>
<dt>MountInstace</dt>
<dd>Contains the SchemaContext behind the mount point</dd>
<dt>DataSchemaNode</dt>
<dd>Provides information about the schema node</dd>
<dt>SimpleNode</dt>
<dd>Possesses the same name as the schema node, and contains the value
representing the data node value</dd>
<dt>CompositeNode</dt>
<dd>Can contain CompositeNode-s and SimpleNode-s</dd>
</dl>
</div>
<div class="section" id="get-in-action">
<h4>GET in action<a class="headerlink" href="#get-in-action" title="Permalink to this headline">¶</a></h4>
<p>Figure 1 shows the GET operation with URI restconf/config/M:N where M is
the module name, and N is the node name.</p>
<div class="figure" id="id111">
<img alt="Get" src="../_images/Get.png" />
<p class="caption"><span class="caption-text">Get</span></p>
</div>
<ol class="arabic simple">
<li>The requested URI is translated into the InstanceIdentifier which
points to the data node. During this translation, the DataSchemaNode
that conforms to the data node is obtained. If the data node is
behind the mount point, the MountInstance is obtained as well.</li>
<li>RESTCONF asks for the value of the data node from DataBrokerService
based on InstanceIdentifier.</li>
<li>DataBrokerService returns CompositeNode as data.</li>
<li>StructuredDataToXmlProvider or StructuredDataToJsonProvider is called
based on the <strong>Accept</strong> field from the http request. These two
providers can transform CompositeNode regarding DataSchemaNode to an
XML or JSON document.</li>
<li>XML or JSON is returned as the answer on the request from the client.</li>
</ol>
</div>
<div class="section" id="put-in-action">
<h4>PUT in action<a class="headerlink" href="#put-in-action" title="Permalink to this headline">¶</a></h4>
<p>Figure 2 shows the PUT operation with the URI restconf/config/M:N where
M is the module name, and N is the node name. Data is sent in the
request either in the XML or JSON format.</p>
<div class="figure" id="id112">
<img alt="Put" src="../_images/Put.png" />
<p class="caption"><span class="caption-text">Put</span></p>
</div>
<ol class="arabic simple">
<li>Input data is sent to JsonToCompositeNodeProvider or
XmlToCompositeNodeProvider. The correct provider is selected based on
the Content-Type field from the http request. These two providers can
transform input data to CompositeNode. However, this CompositeNode
does not contain enough information for transactions.</li>
<li>The requested URI is translated into InstanceIdentifier which points
to the data node. DataSchemaNode conforming to the data node is
obtained during this translation. If the data node is behind the
mount point, the MountInstance is obtained as well.</li>
<li>CompositeNode can be normalized by adding additional information from
DataSchemaNode.</li>
<li>RESTCONF begins the transaction, and puts CompositeNode with
InstanceIdentifier into it. The response on the request from the
client is the status code which depends on the result from the
transaction.</li>
</ol>
</div>
<div class="section" id="something-practical">
<h4>Something practical<a class="headerlink" href="#something-practical" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Create a new flow on the switch openflow:1 in table 2.</li>
</ol>
<div class="line-block">
<div class="line"><strong>HTTP request</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Operation</span><span class="p">:</span> <span class="n">POST</span>
<span class="n">URI</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">table</span><span class="o">/</span><span class="mi">2</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">xml</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;flow
    xmlns=&quot;urn:opendaylight:flow:inventory&quot;&gt;
    &lt;strict&gt;false&lt;/strict&gt;
    &lt;instructions&gt;
        &lt;instruction&gt;
            &lt;order&gt;1&lt;/order&gt;
            &lt;apply-actions&gt;
                &lt;action&gt;
                  &lt;order&gt;1&lt;/order&gt;
                    &lt;flood-all-action/&gt;
                &lt;/action&gt;
            &lt;/apply-actions&gt;
        &lt;/instruction&gt;
    &lt;/instructions&gt;
    &lt;table_id&gt;2&lt;/table_id&gt;
    &lt;id&gt;111&lt;/id&gt;
    &lt;cookie_mask&gt;10&lt;/cookie_mask&gt;
    &lt;out_port&gt;10&lt;/out_port&gt;
    &lt;installHw&gt;false&lt;/installHw&gt;
    &lt;out_group&gt;2&lt;/out_group&gt;
    &lt;match&gt;
        &lt;ethernet-match&gt;
            &lt;ethernet-type&gt;
                &lt;type&gt;2048&lt;/type&gt;
            &lt;/ethernet-type&gt;
        &lt;/ethernet-match&gt;
        &lt;ipv4-destination&gt;10.0.0.1/24&lt;/ipv4-destination&gt;
    &lt;/match&gt;
    &lt;hard-timeout&gt;0&lt;/hard-timeout&gt;
    &lt;cookie&gt;10&lt;/cookie&gt;
    &lt;idle-timeout&gt;0&lt;/idle-timeout&gt;
    &lt;flow-name&gt;FooXf22&lt;/flow-name&gt;
    &lt;priority&gt;2&lt;/priority&gt;
    &lt;barrier&gt;false&lt;/barrier&gt;
&lt;/flow&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>HTTP response</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Status</span><span class="p">:</span> <span class="mi">204</span> <span class="n">No</span> <span class="n">Content</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Change <em>strict</em> to <em>true</em> in the previous flow.</li>
</ol>
<div class="line-block">
<div class="line"><strong>HTTP request</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Operation</span><span class="p">:</span> <span class="n">PUT</span>
<span class="n">URI</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">table</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">flow</span><span class="o">/</span><span class="mi">111</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">xml</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;flow
    xmlns=&quot;urn:opendaylight:flow:inventory&quot;&gt;
    &lt;strict&gt;true&lt;/strict&gt;
    &lt;instructions&gt;
        &lt;instruction&gt;
            &lt;order&gt;1&lt;/order&gt;
            &lt;apply-actions&gt;
                &lt;action&gt;
                  &lt;order&gt;1&lt;/order&gt;
                    &lt;flood-all-action/&gt;
                &lt;/action&gt;
            &lt;/apply-actions&gt;
        &lt;/instruction&gt;
    &lt;/instructions&gt;
    &lt;table_id&gt;2&lt;/table_id&gt;
    &lt;id&gt;111&lt;/id&gt;
    &lt;cookie_mask&gt;10&lt;/cookie_mask&gt;
    &lt;out_port&gt;10&lt;/out_port&gt;
    &lt;installHw&gt;false&lt;/installHw&gt;
    &lt;out_group&gt;2&lt;/out_group&gt;
    &lt;match&gt;
        &lt;ethernet-match&gt;
            &lt;ethernet-type&gt;
                &lt;type&gt;2048&lt;/type&gt;
            &lt;/ethernet-type&gt;
        &lt;/ethernet-match&gt;
        &lt;ipv4-destination&gt;10.0.0.1/24&lt;/ipv4-destination&gt;
    &lt;/match&gt;
    &lt;hard-timeout&gt;0&lt;/hard-timeout&gt;
    &lt;cookie&gt;10&lt;/cookie&gt;
    &lt;idle-timeout&gt;0&lt;/idle-timeout&gt;
    &lt;flow-name&gt;FooXf22&lt;/flow-name&gt;
    &lt;priority&gt;2&lt;/priority&gt;
    &lt;barrier&gt;false&lt;/barrier&gt;
&lt;/flow&gt;
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>HTTP response</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span> <span class="n">OK</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>Show flow: check that <em>strict</em> is <em>true</em>.</li>
</ol>
<div class="line-block">
<div class="line"><strong>HTTP request</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Operation</span><span class="p">:</span> <span class="n">GET</span>
<span class="n">URI</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">table</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">flow</span><span class="o">/</span><span class="mi">111</span>
<span class="n">Accept</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">xml</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>HTTP response</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span> <span class="n">OK</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;flow
    xmlns=&quot;urn:opendaylight:flow:inventory&quot;&gt;
    &lt;strict&gt;true&lt;/strict&gt;
    &lt;instructions&gt;
        &lt;instruction&gt;
            &lt;order&gt;1&lt;/order&gt;
            &lt;apply-actions&gt;
                &lt;action&gt;
                  &lt;order&gt;1&lt;/order&gt;
                    &lt;flood-all-action/&gt;
                &lt;/action&gt;
            &lt;/apply-actions&gt;
        &lt;/instruction&gt;
    &lt;/instructions&gt;
    &lt;table_id&gt;2&lt;/table_id&gt;
    &lt;id&gt;111&lt;/id&gt;
    &lt;cookie_mask&gt;10&lt;/cookie_mask&gt;
    &lt;out_port&gt;10&lt;/out_port&gt;
    &lt;installHw&gt;false&lt;/installHw&gt;
    &lt;out_group&gt;2&lt;/out_group&gt;
    &lt;match&gt;
        &lt;ethernet-match&gt;
            &lt;ethernet-type&gt;
                &lt;type&gt;2048&lt;/type&gt;
            &lt;/ethernet-type&gt;
        &lt;/ethernet-match&gt;
        &lt;ipv4-destination&gt;10.0.0.1/24&lt;/ipv4-destination&gt;
    &lt;/match&gt;
    &lt;hard-timeout&gt;0&lt;/hard-timeout&gt;
    &lt;cookie&gt;10&lt;/cookie&gt;
    &lt;idle-timeout&gt;0&lt;/idle-timeout&gt;
    &lt;flow-name&gt;FooXf22&lt;/flow-name&gt;
    &lt;priority&gt;2&lt;/priority&gt;
    &lt;barrier&gt;false&lt;/barrier&gt;
&lt;/flow&gt;
</pre></div>
</div>
<ol class="arabic simple">
<li>Delete the flow created.</li>
</ol>
<div class="line-block">
<div class="line"><strong>HTTP request</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Operation</span><span class="p">:</span> <span class="n">DELETE</span>
<span class="n">URI</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">table</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">flow</span><span class="o">/</span><span class="mi">111</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>HTTP response</strong></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Status</span><span class="p">:</span> <span class="mi">200</span> <span class="n">OK</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="websocket-change-event-notification-subscription-tutorial">
<h3>Websocket change event notification subscription tutorial<a class="headerlink" href="#websocket-change-event-notification-subscription-tutorial" title="Permalink to this headline">¶</a></h3>
<p>Subscribing to data change notifications makes it possible to obtain
notifications about data manipulation (insert, change, delete) which are
done on any specified <strong>path</strong> of any specified <strong>datastore</strong> with
specific <strong>scope</strong>. In following examples <em>{odlAddress}</em> is address of
server where ODL is running and <em>{odlPort}</em> is port on which
OpenDaylight is running.</p>
<div class="section" id="websocket-notifications-subscription-process">
<h4>Websocket notifications subscription process<a class="headerlink" href="#websocket-notifications-subscription-process" title="Permalink to this headline">¶</a></h4>
<p>In this section we will learn what steps need to be taken in order to
successfully subscribe to data change event notifications.</p>
<div class="section" id="create-stream">
<h5>Create stream<a class="headerlink" href="#create-stream" title="Permalink to this headline">¶</a></h5>
<p>In order to use event notifications you first need to call RPC that
creates notification stream that you can later listen to. You need to
provide three parameters to this RPC:</p>
<ul class="simple">
<li><strong>path</strong>: data store path that you plan to listen to. You can
register listener on containers, lists and leaves.</li>
<li><strong>datastore</strong>: data store type. <em>OPERATIONAL</em> or <em>CONFIGURATION</em>.</li>
<li><strong>scope</strong>: Represents scope of data change. Possible options are:<ul>
<li>BASE: only changes directly to the data tree node specified in the
path will be reported</li>
<li>ONE: changes to the node and to direct child nodes will be
reported</li>
<li>SUBTREE: changes anywhere in the subtree starting at the node will
be reported</li>
</ul>
</li>
</ul>
<p>The RPC to create the stream can be invoked via RESCONF like this:</p>
<ul>
<li><p class="first">URI:
<a class="reference external" href="http:/">http:/</a>/{odlAddress}:{odlPort}/restconf/operations/sal-remote:create-data-change-event-subscription</p>
</li>
<li><p class="first">HEADER: Content-Type=application/json</p>
</li>
<li><p class="first">OPERATION: POST</p>
</li>
<li><p class="first">DATA:</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/toaster:toaster/toaster:toasterStatus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sal-remote-augment:datastore&quot;</span><span class="p">:</span> <span class="s2">&quot;OPERATIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sal-remote-augment:scope&quot;</span><span class="p">:</span> <span class="s2">&quot;ONE&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<p>The response should look something like this:</p>
<div class="code json highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;stream-name&quot;</span><span class="p">:</span> <span class="s2">&quot;toaster:toaster/toaster:toasterStatus/datastore=CONFIGURATION/scope=SUBTREE&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>stream-name</strong> is important because you will need to use it when you
subscribe to the stream in the next step.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Internally, this will create a new listener for <em>stream-name</em> if it
did not already exist.</p>
</div></blockquote>
</div>
<div class="section" id="subscribe-to-stream">
<h5>Subscribe to stream<a class="headerlink" href="#subscribe-to-stream" title="Permalink to this headline">¶</a></h5>
<p>In order to subscribe to stream and obtain WebSocket location you need
to call <em>GET</em> on your stream path. The URI should generally be
<a class="reference external" href="http:/">http:/</a>/{odlAddress}:{odlPort}/restconf/streams/stream/{streamName},
where <em>{streamName}</em> is the <em>stream-name</em> parameter contained in
response from <em>create-data-change-event-subscription</em> RPC from the
previous step.</p>
<ul class="simple">
<li>URI:
<a class="reference external" href="http:/">http:/</a>/{odlAddress}:{odlPort}/restconf/streams/stream/toaster:toaster/datastore=CONFIGURATION/scope=SUBTREE</li>
<li>OPERATION: GET</li>
</ul>
<p>The expected response status is 200 OK and response body should be
empty. You will get your WebSocket location from <strong>Location</strong> header of
response. For example in our particular toaster example location header
would have this value:
<em>ws://{odlAddress}:8185/toaster:toaster/datastore=CONFIGURATION/scope=SUBTREE</em></p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>During this phase there is an internal check for to see if a
listener for the <em>stream-name</em> from the URI exists. If not, new a
new listener is registered with the DOM data broker.</p>
</div></blockquote>
</div>
<div class="section" id="receive-notifications">
<h5>Receive notifications<a class="headerlink" href="#receive-notifications" title="Permalink to this headline">¶</a></h5>
<p>You should now have a data change notification stream created and have
location of a WebSocket. You can use this WebSocket to listen to data
change notifications. To listen to notifications you can use a
JavaScript client or if you are using chrome browser you can use the
<a class="reference external" href="https://chrome.google.com/webstore/detail/simple-websocket-client/pfdhoblngboilpfeibdedpjgfnlcodoo">Simple WebSocket
Client</a>.</p>
<p>Also, for testing purposes, there is simple Java application named
WebSocketClient. The application is placed in the
<em>-sal-rest-connector-classes.class</em> project. It accepts a WebSocket URI
as and input parameter. After starting the utility (WebSocketClient
class directly in Eclipse/InteliJ Idea) received notifications should be
displayed in console.</p>
<p>Notifications are always in XML format and look like this:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span>&lt;notification xmlns=&quot;urn:ietf:params:xml:ns:netconf:notification:1.0&quot;&gt;
    &lt;eventTime&gt;2014-09-11T09:58:23+02:00&lt;/eventTime&gt;
    &lt;data-changed-notification xmlns=&quot;urn:opendaylight:params:xml:ns:yang:controller:md:sal:remote&quot;&gt;
        &lt;data-change-event&gt;
            &lt;path xmlns:meae=&quot;http://netconfcentral.org/ns/toaster&quot;&gt;/meae:toaster&lt;/path&gt;
            &lt;operation&gt;updated&lt;/operation&gt;
            &lt;data&gt;
               &lt;!-- updated data --&gt;
            &lt;/data&gt;
        &lt;/data-change-event&gt;
    &lt;/data-changed-notification&gt;
&lt;/notification&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-use-case">
<h4>Example use case<a class="headerlink" href="#example-use-case" title="Permalink to this headline">¶</a></h4>
<p>The typical use case is listening to data change events to update web
page data in real-time. In this tutorial we will be using toaster as the
base.</p>
<p>When you call <em>make-toast</em> RPC, it sets <em>toasterStatus</em> to &#8220;down&#8221; to
reflect that the toaster is busy making toast. When it finishes,
<em>toasterStatus</em> is set to &#8220;up&#8221; again. We will listen to this toaster
status changes in data store and will reflect it on our web page in
real-time thanks to WebSocket data change notification.</p>
</div>
<div class="section" id="simple-javascript-client-implementation">
<h4>Simple javascript client implementation<a class="headerlink" href="#simple-javascript-client-implementation" title="Permalink to this headline">¶</a></h4>
<p>We will create simple JavaScript web application that will listen
updates on <em>toasterStatus</em> leaf and update some element of our web page
according to new toaster status state.</p>
<div class="section" id="id10">
<h5>Create stream<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h5>
<p>First you need to create stream that you are planing to subscribe to.
This can be achieved by invoking &#8220;create-data-change-event-subscription&#8221;
RPC on RESTCONF via AJAX request. You need to provide data store
<strong>path</strong> that you plan to listen on, <strong>data store type</strong> and <strong>scope</strong>.
If the request is successful you can extract the <strong>stream-name</strong> from
the response and use that to subscribe to the newly created stream. The
<em>{username}</em> and <em>{password}</em> fields represent your credentials that you
use to connect to OpenDaylight via RESTCONF:</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The default user name and password are &#8220;admin&#8221;.</p>
</div></blockquote>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span>function createStream() {
    $.ajax(
        {
            url: &#39;http://{odlAddress}:{odlPort}/restconf/operations/sal-remote:create-data-change-event-subscription&#39;,
            type: &#39;POST&#39;,
            headers: {
              &#39;Authorization&#39;: &#39;Basic &#39; + btoa(&#39;{username}:{password}&#39;),
              &#39;Content-Type&#39;: &#39;application/json&#39;
            },
            data: JSON.stringify(
                {
                    &#39;input&#39;: {
                        &#39;path&#39;: &#39;/toaster:toaster/toaster:toasterStatus&#39;,
                        &#39;sal-remote-augment:datastore&#39;: &#39;OPERATIONAL&#39;,
                        &#39;sal-remote-augment:scope&#39;: &#39;ONE&#39;
                    }
                }
            )
        }).done(function (data) {
            // this function will be called when ajax call is executed successfully
            subscribeToStream(data.output[&#39;stream-name&#39;]);
        }).fail(function (data) {
            // this function will be called when ajax call fails
            console.log(&quot;Create stream call unsuccessful&quot;);
        })
}
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h5>Subscribe to stream<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h5>
<p>The Next step is to subscribe to the stream. To subscribe to the stream
you need to call <em>GET</em> on
<em>http://{odlAddress}:{odlPort}/restconf/streams/stream/{stream-name}</em>.
If the call is successful, you get WebSocket address for this stream in
<strong>Location</strong> parameter inside response header. You can get response
header by calling <em>getResponseHeader(*Location</em>)* on HttpRequest
object inside <em>done()</em> function call:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span>function subscribeToStream(streamName) {
    $.ajax(
        {
            url: &#39;http://{odlAddress}:{odlPort}/restconf/streams/stream/&#39; + streamName;
            type: &#39;GET&#39;,
            headers: {
              &#39;Authorization&#39;: &#39;Basic &#39; + btoa(&#39;{username}:{password}&#39;),
            }
        }
    ).done(function (data, textStatus, httpReq) {
        // we need function that has http request object parameter in order to access response headers.
        listenToNotifications(httpReq.getResponseHeader(&#39;Location&#39;));
    }).fail(function (data) {
        console.log(&quot;Subscribe to stream call unsuccessful&quot;);
    });
}
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h5>Receive notifications<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<p>Once you got WebSocket server location you can now connect to it and
start receiving data change events. You need to define functions that
will handle events on WebSocket. In order to process incoming events
from OpenDaylight you need to provide a function that will handle
<em>onmessage</em> events. The function must have one parameter that represents
the received event object. The event data will be stored in
<em>event.data</em>. The data will be in an XML format that you can then easily
parse using jQuery.</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span>function listenToNotifications(socketLocation) {
    try {
        var notificatinSocket = new WebSocket(socketLocation);

        notificatinSocket.onmessage = function (event) {
            // we process our received event here
            console.log(&#39;Received toaster data change event.&#39;);
            $($.parseXML(event.data)).find(&#39;data-change-event&#39;).each(
                function (index) {
                    var operation = $(this).find(&#39;operation&#39;).text();
                    if (operation == &#39;updated&#39;) {
                        // toaster status was updated so we call function that gets the value of toasterStatus leaf
                        updateToasterStatus();
                        return false;
                    }
                }
            );
        }
        notificatinSocket.onerror = function (error) {
            console.log(&quot;Socket error: &quot; + error);
        }
        notificatinSocket.onopen = function (event) {
            console.log(&quot;Socket connection opened.&quot;);
        }
        notificatinSocket.onclose = function (event) {
            console.log(&quot;Socket connection closed.&quot;);
        }
        // if there is a problem on socket creation we get exception (i.e. when socket address is incorrect)
    } catch(e) {
        alert(&quot;Error when creating WebSocket&quot; + e );
    }
}
</pre></div>
</div>
<p>The <em>updateToasterStatus()</em> function represents function that calls
<em>GET</em> on the path that was modified and sets toaster status in some web
page element according to received data. After the WebSocket connection
has been established you can test events by calling make-toast RPC via
RESTCONF.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>for more information about WebSockets in JavaScript visit <a class="reference external" href="https://developer.mozilla.org/en-US/docs/WebSockets/Writing_WebSocket_client_applications">Writing
WebSocket client
applications</a></p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="config-subsystem">
<h3>Config Subsystem<a class="headerlink" href="#config-subsystem" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id13">
<h4>Overview<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>The Controller configuration operation has three stages:</p>
<ul class="simple">
<li>First, a Proposed configuration is created. Its target is to replace
the old configuration.</li>
<li>Second, the Proposed configuration is validated, and then committed.
If it passes validation successfully, the Proposed configuration
state will be changed to Validated.</li>
<li>Finally, a Validated configuration can be Committed, and the affected
modules can be reconfigured.</li>
</ul>
<p>In fact, each configuration operation is wrapped in a transaction. Once
a transaction is created, it can be configured, that is to say, a user
can abort the transaction during this stage. After the transaction
configuration is done, it is committed to the validation stage. In this
stage, the validation procedures are invoked. If one or more validations
fail, the transaction can be reconfigured. Upon success, the second
phase commit is invoked. If this commit is successful, the transaction
enters the last stage, committed. After that, the desired modules are
reconfigured. If the second phase commit fails, it means that the
transaction is unhealthy - basically, a new configuration instance
creation failed, and the application can be in an inconsistent state.</p>
<div class="figure" id="id113">
<img alt="Configuration states" src="../_images/configuration.jpg" />
<p class="caption"><span class="caption-text">Configuration states</span></p>
</div>
<div class="figure" id="id114">
<img alt="Transaction states" src="../_images/Transaction.jpg" />
<p class="caption"><span class="caption-text">Transaction states</span></p>
</div>
</div>
<div class="section" id="validation">
<h4>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h4>
<p>To secure the consistency and safety of the new configuration and to
avoid conflicts, the configuration validation process is necessary.
Usually, validation checks the input parameters of a new configuration,
and mostly verifies module-specific relationships. The validation
procedure results in a decision on whether the proposed configuration is
healthy.</p>
</div>
<div class="section" id="dependency-resolver">
<h4>Dependency resolver<a class="headerlink" href="#dependency-resolver" title="Permalink to this headline">¶</a></h4>
<p>Since there can be dependencies between modules, a change in a module
configuration can affect the state of other modules. Therefore, we need
to verify whether dependencies on other modules can be resolved. The
Dependency Resolver acts in a manner similar to dependency injectors.
Basically, a dependency tree is built.</p>
</div>
<div class="section" id="apis-and-spis">
<h4>APIs and SPIs<a class="headerlink" href="#apis-and-spis" title="Permalink to this headline">¶</a></h4>
<p>This section describes configuration system APIs and SPIs.</p>
<div class="section" id="spis">
<h5>SPIs<a class="headerlink" href="#spis" title="Permalink to this headline">¶</a></h5>
<p><strong>Module</strong> org.opendaylight.controller.config.spi. Module is the common
interface for all modules: every module must implement it. The module is
designated to hold configuration attributes, validate them, and create
instances of service based on the attributes. This instance must
implement the AutoCloseable interface, owing to resources clean up. If
the module was created from an already running instance, it contains an
old instance of the module. A module can implement multiple services. If
the module depends on other modules, setters need to be annotated with
&#64;RequireInterface.</p>
<p><strong>Module creation</strong></p>
<ol class="arabic simple">
<li>The module needs to be configured, set with all required attributes.</li>
<li>The module is then moved to the commit stage for validation. If the
validation fails, the module attributes can be reconfigured.
Otherwise, a new instance is either created, or an old instance is
reconfigured. A module instance is identified by ModuleIdentifier,
consisting of the factory name and instance name.</li>
</ol>
<div class="line-block">
<div class="line"><strong>ModuleFactory</strong> org.opendaylight.controller.config.spi. The
ModuleFactory interface must be implemented by each module factory.</div>
<div class="line">A module factory can create a new module instance in two ways:</div>
</div>
<ul>
<li><p class="first">From an existing module instance</p>
</li>
<li><div class="first line-block">
<div class="line">An entirely new instance</div>
<div class="line">ModuleFactory can also return default modules, useful for
populating registry with already existing configurations. A module
factory implementation must have a globally unique name.</div>
</div>
</li>
</ul>
</div>
<div class="section" id="apis">
<h5>APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ConfigRegistry</td>
<td>Represents functionality provided by
a configuration transaction (create,
destroy module, validate, or abort
transaction).</td>
</tr>
<tr class="row-even"><td>ConfigTransactionController</td>
<td>Represents functionality for
manipulating with configuration
transactions (begin, commit config).</td>
</tr>
<tr class="row-odd"><td>RuntimeBeanRegistratorAwareConfiBean</td>
<td>The module implementing this
interface will receive
RuntimeBeanRegistrator before
getInstance is invoked.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="runtime-apis">
<h5>Runtime APIs<a class="headerlink" href="#runtime-apis" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>RuntimeBean</td>
<td>Common interface for all runtime
beans</td>
</tr>
<tr class="row-even"><td>RootRuntimeBeanRegistrator</td>
<td>Represents functionality for root
runtime bean registration, which
subsequently allows hierarchical
registrations</td>
</tr>
<tr class="row-odd"><td>HierarchicalRuntimeBeanRegistration</td>
<td>Represents functionality for runtime
bean registration and
unreregistration from hierarchy</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="jmx-apis">
<h5>JMX APIs<a class="headerlink" href="#jmx-apis" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">JMX API is purposed as a transition between the Client API and the JMX
platform.</div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ConfigTransactionControllerMXBean</td>
<td>Extends ConfigTransactionController,
executed by Jolokia clients on
configuration transaction.</td>
</tr>
<tr class="row-even"><td>ConfigRegistryMXBean</td>
<td>Represents entry point of
configuration management for
MXBeans.</td>
</tr>
<tr class="row-odd"><td>Object names</td>
<td>Object Name is the pattern used in
JMX to locate JMX beans. It consists
of domain and key properties (at
least one key-value pair). Domain is
defined as
&#8220;org.opendaylight.controller&#8221;. The
only mandatory property is &#8220;type&#8221;.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-case-scenarios">
<h5>Use case scenarios<a class="headerlink" href="#use-case-scenarios" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">A few samples of successful and unsuccessful transaction scenarios
follow:</div>
</div>
<p><strong>Successful commit scenario</strong></p>
<ol class="arabic simple">
<li>The user creates a transaction calling creteTransaction() method on
ConfigRegistry.</li>
<li>ConfigRegisty creates a transaction controller, and registers the
transaction as a new bean.</li>
<li>Runtime configurations are copied to the transaction. The user can
create modules and set their attributes.</li>
<li>The configuration transaction is to be committed.</li>
<li>The validation process is performed.</li>
<li>After successful validation, the second phase commit begins.</li>
<li>Modules proposed to be destroyed are destroyed, and their service
instances are closed.</li>
<li>Runtime beans are set to registrator.</li>
<li>The transaction controller invokes the method getInstance on each
module.</li>
<li>The transaction is committed, and resources are either closed or
released.</li>
</ol>
<div class="line-block">
<div class="line"><strong>Validation failure scenario</strong></div>
<div class="line">The transaction is the same as the previous case until the validation
process.</div>
</div>
<ol class="arabic simple">
<li>If validation fails, (that is to day, illegal input attributes values
or dependency resolver failure), the validationException is thrown
and exposed to the user.</li>
<li>The user can decide to reconfigure the transaction and commit again,
or abort the current transaction.</li>
<li>On aborted transactions, TransactionController and JMXRegistrator are
properly closed.</li>
<li>Unregistration event is sent to ConfigRegistry.</li>
</ol>
</div>
<div class="section" id="default-module-instances">
<h5>Default module instances<a class="headerlink" href="#default-module-instances" title="Permalink to this headline">¶</a></h5>
<p>The configuration subsystem provides a way for modules to create default
instances. A default instance is an instance of a module, that is
created at the module bundle start-up (module becomes visible for
configuration subsystem, for example, its bundle is activated in the
OSGi environment). By default, no default instances are produced.</p>
<p>The default instance does not differ from instances created later in the
module life-cycle. The only difference is that the configuration for the
default instance cannot be provided by the configuration subsystem. The
module has to acquire the configuration for these instances on its own.
It can be acquired from, for example, environment variables. After the
creation of a default instance, it acts as a regular instance and fully
participates in the configuration subsystem (It can be reconfigured or
deleted in following transactions.).</p>
</div>
</div>
</div>
</div>
<div class="section" id="didm-developer-guide">
<h2>DIDM Developer Guide<a class="headerlink" href="#didm-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id14">
<h3>Overview<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>The Device Identification and Driver Management (DIDM) project addresses
the need to provide device-specific functionality. Device-specific
functionality is code that performs a feature, and the code is
knowledgeable of the capability and limitations of the device. For
example, configuring VLANs and adjusting FlowMods are features, and
there may be different implementations for different device types.
Device-specific functionality is implemented as Device Drivers. Device
Drivers need to be associated with the devices they can be used with. To
determine this association requires the ability to identify the device
type.</p>
</div>
<div class="section" id="didm-architecture">
<h3>DIDM Architecture<a class="headerlink" href="#didm-architecture" title="Permalink to this headline">¶</a></h3>
<p>The DIDM project creates the infrastructure to support the following
functions:</p>
<ul class="simple">
<li><strong>Discovery</strong> - Determination that a device exists in the controller
management domain and connectivity to the device can be established.
For devices that support the OpenFlow protocol, the existing
discovery mechanism in OpenDaylight suffices. Devices that do not
support OpenFlow will be discovered through manual means such as the
operator entering device information via GUI or REST API.</li>
<li><strong>Identification</strong> – Determination of the device type.</li>
<li><strong>Driver Registration</strong> – Registration of Device Drivers as routed
RPCs.</li>
<li><strong>Synchronization</strong> – Collection of device information, device
configuration, and link (connection) information.</li>
<li><strong>Data Models for Common Features</strong> – Data models will be defined to
perform common features such as VLAN configuration. For example,
applications can configure a VLAN by writing the VLAN data to the
data store as specified by the common data model.</li>
<li><strong>RPCs for Common Features</strong> – Configuring VLANs and adjusting
FlowMods are example of features. RPCs will be defined that specify
the APIs for these features. Drivers implement features for specific
devices and support the APIs defined by the RPCs. There may be
different Driver implementations for different device types.</li>
</ul>
</div>
</div>
<div class="section" id="dlux">
<h2>DLUX<a class="headerlink" href="#dlux" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup-and-run">
<h3>Setup and Run<a class="headerlink" href="#setup-and-run" title="Permalink to this headline">¶</a></h3>
<div class="section" id="required-technology-stack">
<h4>Required Technology Stack<a class="headerlink" href="#required-technology-stack" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>AngularJS (JavaScript client-side framework, <a class="reference external" href="http://www.angularjs.org">http://www.angularjs.org</a>
)</li>
</ul>
</div>
<div class="section" id="run-dlux">
<h4>Run DLUX<a class="headerlink" href="#run-dlux" title="Permalink to this headline">¶</a></h4>
<p>To turn on the DLUX UI, install DLUX core feature via running following
command on the Karaf console -</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">:</span><span class="n">install</span> <span class="n">odl</span><span class="o">-</span><span class="n">dlux</span><span class="o">-</span><span class="n">core</span>
</pre></div>
</div>
<p>The above command will install odl-restconf and DLUX topology
application internally, along with core DLUX components. Once this
feature is successfully installed, access the UI at
<a class="reference external" href="http://localhost:8181/index.html">http://localhost:8181/index.html</a>. The default credentials for login are
admin/admin.</p>
<p>All the applications in DLUX are Karaf features. A user can install
other dlux applications such as node and yang-ui from Karaf console
using commands such as -</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ feature:install odl-dlux-node

$ feature:install odl-dlux-yangui
</pre></div>
</div>
</div>
</div>
<div class="section" id="dlux-modules">
<h3>DLUX Modules<a class="headerlink" href="#dlux-modules" title="Permalink to this headline">¶</a></h3>
<p>DLUX modules are the individual features such as nodes and topology.
Each module has a defined structure and you can find all existing
modules at
<a class="reference external" href="https://github.com/opendaylight/dlux/tree/stable/lithium/modules">https://github.com/opendaylight/dlux/tree/stable/lithium/modules</a>.</p>
<div class="section" id="module-structure">
<h4>Module Structure<a class="headerlink" href="#module-structure" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>module_folder<ul>
<li>&lt;module_name&gt;.module.js</li>
<li>&lt;module_name&gt;.controller.js</li>
<li>&lt;module_name&gt;.services.js</li>
<li>&lt;module_name&gt;.directives.js</li>
<li>&lt;module_name&gt;.filter.js</li>
<li>index.tpl.html</li>
<li>&lt;a_stylesheet&gt;.css</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="create-new-module">
<h4>Create New Module<a class="headerlink" href="#create-new-module" title="Permalink to this headline">¶</a></h4>
<div class="section" id="define-the-module">
<h5>Define the module<a class="headerlink" href="#define-the-module" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li>Create an empty maven project and create your module folder under
src/main/resources.</li>
<li>Create an empty file with pattern &lt;module_name&gt;.module.js.</li>
<li>Next, you need to surround the angular module with a define function.
This allows RequireJs to see our module.js files. The first argument
is an array which contains all the module’s dependencies. The second
argument is a callback function, whose body contain the AngularJS
code base. The function parameters correspond with the order of
dependencies. Each dependency is injected into a parameter, if it is
provided.</li>
<li>Finally, you will return the angular module to be able to inject it
as a parameter in others modules.</li>
</ol>
<p>For each new module, you must have at least these two dependencies :</p>
<ul class="simple">
<li>angularAMD : It’s a wrapper around AngularJS to provide an AMD
(Asynchronous Module Definition) support, which is used by RequireJs.
For more information see the <a class="reference external" href="https://github.com/amdjs/amdjs-api/blob/master/AMD.md">AMD
documentation</a>.</li>
<li>app/core/core.services : This one is mandatory, if you want to add
content in the navigation menu, the left bar or the top bar.</li>
</ul>
<p>The following are not mandatory, but very often used.</p>
<ul class="simple">
<li>angular-ui-router : A library to provide URL routing.</li>
<li>routingConfig : To set the level access to a page.</li>
</ul>
<p>Your module.js file might look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">define</span><span class="p">([</span><span class="s1">&#39;angularAMD&#39;</span><span class="p">,</span><span class="s1">&#39;app/routingConfig&#39;</span><span class="p">,</span> <span class="s1">&#39;angular-ui-router&#39;</span><span class="p">,</span><span class="s1">&#39;app/core/core.services&#39;</span><span class="p">],</span> <span class="n">function</span><span class="p">(</span><span class="n">ng</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">var</span> <span class="n">module</span> <span class="o">=</span> <span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;app.a_module&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ui.router.state&#39;</span><span class="p">,</span> <span class="s1">&#39;app.core&#39;</span><span class="p">]);</span>
   <span class="o">//</span> <span class="n">module</span> <span class="n">configuration</span>
   <span class="n">module</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="p">[</span><span class="o">...</span><span class="p">]</span>
   <span class="p">});</span>
  <span class="k">return</span> <span class="n">module</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="set-the-register-function">
<h5>Set the register function<a class="headerlink" href="#set-the-register-function" title="Permalink to this headline">¶</a></h5>
<p>AngularJS allows lazy registration of a module’s components such as
controller, factory etc. Once you will install your application, DLUX
will load your module javascript, but not your angular component during
bootstrap phase. You have to register your angular components to make
sure they are available at the runtime.</p>
<p>Here is how to register your module’s component for lazy initialization
-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module.config(function($compileProvider, $controllerProvider, $provide) {
   module.register = {
     controller : $controllerProvider.register,
     directive : $compileProvider.directive,
     factory : $provide.factory,
     service : $provide.service
   };
});
</pre></div>
</div>
</div>
<div class="section" id="set-the-route">
<h5>Set the route<a class="headerlink" href="#set-the-route" title="Permalink to this headline">¶</a></h5>
<p>The next step is to set up the route for your module. This part is also
done in the configuration method of the module. We have to add
<strong>$stateProvider</strong> as a parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>module.config(function($stateProvider) {
   var access = routingConfig.accessLevels;
   $stateProvider.state(&#39;main.module&#39;, {
     url: &#39;module&#39;,
     views : {
       &#39;content&#39; : {
         templateUrl: &#39;src/app/module/module.tpl.html&#39;,
         controller: &#39;ModuleCtrl&#39;
       }
     }
   });
});
</pre></div>
</div>
</div>
<div class="section" id="adding-element-to-the-navigation-menu">
<h5>Adding element to the navigation menu<a class="headerlink" href="#adding-element-to-the-navigation-menu" title="Permalink to this headline">¶</a></h5>
<p>To be able to add item to the navigation menu, the module requires the
<strong>NavHelperProvider</strong> parameter in the configuration method.
<strong>addToMenu</strong> method in <strong>NavMenuHelper</strong> helper allows an item addition
to the menu.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">module</span> <span class="o">=</span> <span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;app.a_module&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;app.core&#39;</span><span class="p">]);</span>
<span class="n">module</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">NavMenuHelper</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NavMenuHelper</span><span class="o">.</span><span class="n">addToMenu</span><span class="p">(</span><span class="s1">&#39;myFirstModule&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s2">&quot;link&quot;</span> <span class="p">:</span> <span class="s2">&quot;#/module/index&quot;</span><span class="p">,</span>
        <span class="s2">&quot;active&quot;</span> <span class="p">:</span> <span class="s2">&quot;module&quot;</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;My First Module&quot;</span><span class="p">,</span>
        <span class="s2">&quot;icon&quot;</span> <span class="p">:</span> <span class="s2">&quot;icon-sitemap&quot;</span><span class="p">,</span>
        <span class="s2">&quot;page&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="s2">&quot;My First Module&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span> <span class="p">:</span> <span class="s2">&quot;My first module&quot;</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The first parameter is an ID that refers to the level of your menu and
the second is a object. For now, The ID parameter supports two levels of
depth. If your ID looks like <em>rootNode.childNode</em>, the helper will look
for a node named <em>rootNode</em> and it will append the <em>childNode</em> to it. If
the root node doesn’t exist, it will create it.</p>
</div>
<div class="section" id="link-the-angularjs-modules-controller-file">
<h5>Link the AngularJS module’s controller file<a class="headerlink" href="#link-the-angularjs-modules-controller-file" title="Permalink to this headline">¶</a></h5>
<p>To include the module’s controller file, you can use the
NavHelperProvider. It contains a method that will load the given file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
   <span class="n">NavHelperProvider</span><span class="o">.</span><span class="n">addControllerUrl</span><span class="p">(</span><span class="s1">&#39;&lt;path_to_module_folder&gt;/&lt;module_name&gt;.controller&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This completes your module.js file.</p>
</div>
</div>
<div class="section" id="create-the-controller-factory-directive-etc">
<h4>Create the controller, factory, directive, etc<a class="headerlink" href="#create-the-controller-factory-directive-etc" title="Permalink to this headline">¶</a></h4>
<p>Creating the controller and other components is similar to the module.</p>
<ul class="simple">
<li>First, add the define method.</li>
<li>Second, add the relative path to the module definition.</li>
<li>Last, create your methods as you usually do it with AngularJS.</li>
</ul>
<p>For example -</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>define([&#39;&lt;relative_path_to_module&gt;/&lt;module_name&gt;.module&#39;], function(module) {
   module.register.controller(&#39;ModuleCtrl&#39;, function($rootScope, $scope) {
   });
});
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-new-application-using-dlux-modularity">
<h3>Add new application using DLUX modularity<a class="headerlink" href="#add-new-application-using-dlux-modularity" title="Permalink to this headline">¶</a></h3>
<p>DLUX works as a Karaf based UI platform, where you can create a new
Karaf feature of your UI component and install that UI applications in
DLUX using blueprint. This page will help you to create and load a new
application for DLUX. You don’t have to add new module in DLUX
repository.</p>
<div class="section" id="add-a-new-osgi-blueprint-bundle">
<h4>Add a new OSGi blueprint bundle<a class="headerlink" href="#add-a-new-osgi-blueprint-bundle" title="Permalink to this headline">¶</a></h4>
<p>The OSGi Blueprint Container specification allows us to use dependency
injection in our OSGi environment. Each DLUX application module
registers itself via blueprint configuration. Each application will have
its own blueprint.xml to place its configuration.</p>
<ol class="arabic simple">
<li>Create a maven project to place blueprint configuration. For
reference, take a look at topology bundle, present at
<a class="reference external" href="https://github.com/opendaylight/dlux/tree/stable/lithium/bundles/topology">https://github.com/opendaylight/dlux/tree/stable/lithium/bundles/topology</a>.
All the existing DLUX modules&#8217; configurations are available under
bundles directory of DLUX code.</li>
<li>In pom.xml, you have to add a maven plugin to unpack your module code
under generated-resources of this project. For reference, you can
check pom.xml of dlux/bundles/topology at
<a class="reference external" href="https://github.com/opendaylight/dlux/tree/stable/lithium/bundles/topology">https://github.com/opendaylight/dlux/tree/stable/lithium/bundles/topology</a>.
Your bundle will eventually get deployed in Karaf as feature, so your
bundle should contain all your module code. If you want to combine
module and bundle project, that should not be an issue either.</li>
<li>Create a blueprint.xml configuration file under
src/main/resources/OSGI-INF/blueprint. Below is the content of the
blueprint.xml taken from topology bundles’s blueprint.xml. Any new
application should create a blueprint.xml in following format -</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">blueprint</span> <span class="n">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">reference</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;httpService&quot;</span> <span class="n">availability</span><span class="o">=</span><span class="s2">&quot;mandatory&quot;</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;eager&quot;</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;org.osgi.service.http.HttpService&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">reference</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;loader&quot;</span> <span class="n">availability</span><span class="o">=</span><span class="s2">&quot;mandatory&quot;</span> <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;eager&quot;</span> <span class="n">interface</span><span class="o">=</span><span class="s2">&quot;org.opendaylight.dlux.loader.DluxModuleLoader&quot;</span><span class="o">/&gt;</span>

    <span class="o">&lt;</span><span class="n">bean</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;bundle&quot;</span> <span class="n">init</span><span class="o">-</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;initialize&quot;</span> <span class="n">destroy</span><span class="o">-</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;clean&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;org.opendaylight.dlux.loader.DluxModule&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;httpService&quot;</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&quot;httpService&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;loader&quot;</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&quot;loader&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;moduleName&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;topology &quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;url&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;/src/app/topology&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;directory&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;/topology&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;requireJs&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;app/topology/topology.module&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;angularJs&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;app.topology&quot;</span><span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nb">property</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cssDependencies&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nb">list</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">yui</span><span class="o">.</span><span class="n">yahooapis</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mf">3.18</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">cssreset</span><span class="o">/</span><span class="n">cssreset</span><span class="o">-</span><span class="nb">min</span><span class="o">.</span><span class="n">css</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
              <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">src</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">-</span><span class="n">custom</span><span class="o">.</span><span class="n">css</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
          <span class="o">&lt;/</span><span class="nb">list</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="nb">property</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">blueprint</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In above configuration, there are two references with id httpService and
loader. These two beans will already be initialized by dlux-core, so any
new application can use them. Without these two bean references, a new
application will not be able to register.</p>
<p>Next is the initialization of your application bean, which will be an
instance of class org.opendaylight.dlux.loader.DluxModule. There are 5
properties that you should provide in this bean besides the references
of httpService and loader. Lets talk about those bean properties in
little more detail.</p>
<p><strong>moduleName</strong> : Name of your module. This name should be unique in
DLUX.</p>
<p><strong>url</strong>: This is the url via which RequireJS in DLUX will try to load
your module JS/HTML files. Also, this is the url that browser will use
to load the static HTML, JS or CSS files. RequireJS in DLUX has a base
path of <strong>src</strong>, so all the url should start with /src so RequireJS and
the browser can correctly find the files.</p>
<p><strong>directory</strong>: In your bundle’s pom.xml, you unpack your module code.
This is the directory where your actual static files will reside. The
above mentioned url is registered with httpService, so when browser
makes a call to that url, it will be redirected to the directory
mentioned here. In the above example, all the topology files are present
under /topology directory and the browser/RequireJS can access those
files with uri /src/app/topology.</p>
<p><strong>requireJS</strong>: This is the path to your RequireJS module. If you notice
closely, you will see the initial path of RequireJS app/topology in the
above example matches with the last part of url. This path will be be
used by RequireJS. As mentioned above, we have kept <strong>src</strong> as base path
in RequireJS, that is the exact reason that url start with /src.</p>
<p><strong>angularJS</strong>: name of your AngularJS module.</p>
<p><strong>cssDependencies</strong>: If the application has any external/internal css
dependencies, then those can be added here. If you create your own css
files, just point to those css files here. Use the url path that you
mentioned above, so the browser can find your css file.</p>
<p>OSGi understands blueprint.xml, once you will deploy your bundle in
karaf (or you can create a new feature for your application), karaf will
read your blueprint.xml and it will try to register your application
with dlux. Once successful, if you refresh your dlux UI, you will see
your application in left hand navigation bar of dlux.</p>
</div>
</div>
<div class="section" id="yang-utils">
<h3>Yang Utils<a class="headerlink" href="#yang-utils" title="Permalink to this headline">¶</a></h3>
<p>Yang Utils are used by UI to perform all CRUD operations. All of these
utilities are present in yangutils.services.js file. It has following
AngularJS factories -</p>
<ul class="simple">
<li><strong>arrayUtils</strong> – defines functions for working with arrays.</li>
<li><strong>pathUtils</strong> – defines functions for working with xpath (paths to
APIs and subAPIs). It divides xpath string to array of elements, so
this array can be later used for search functions.</li>
<li><strong>syncFact</strong> – provides synchronization between requests to and from
OpenDaylight when it’s needed.</li>
<li><strong>custFunct</strong> – it is linked with
apiConnector.createCustomFunctionalityApis in yangui controller in
yangui.controller.js. That function makes it possible to create some
custom function called by the click on button in index.tpl.html. All
custom functions are stored in array and linked to specific subAPI.
When particular subAPI is expanded and clicked, its inputs (linked
root node with its child nodes) are displayed in the bottom part of
the page and its buttons with custom functionality are displayed
also.</li>
<li><strong>reqBuilder</strong> – Builds object in JSON format from input fields of
the UI page. <strong>Show Preview</strong> button on Yang UI use this builder.
This request is sent to OpenDaylight when button PUT or POST is
clicked.</li>
<li><strong>yinParser</strong> – factory for reading .xml files of yang models and
creating object hierarchy. Every statement from yang is represented
by a node.</li>
<li><strong>nodeWrapper</strong> – adds functions to objects in tree hierarchy created
with yinParser. These functions provide functionality for every type
of node.</li>
<li><strong>apiConnector</strong> – the main functionality is filling the main
structures and linking them. Structure of APIs and subAPIs which is
two level array - first level is filled by main APIs, second level is
filled by others sub APIs. Second main structure is array of root
nodes, which are objects including root node and its children nodes.
Linking these two structures is creating links between every subAPI
(second level of APIs array) and its root node, which must be
displayed like inputs when subAPI is expanded.</li>
<li><strong>yangUtils</strong> – some top level functions which are used by yangui
controller for creating the main structures.</li>
</ul>
</div>
</div>
<div class="section" id="iotdm-developer-guide">
<h2>IoTDM Developer Guide<a class="headerlink" href="#iotdm-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id15">
<h3>Overview<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>The Internet of Things Data Management (IoTDM) on OpenDaylight project
is about developing a data-centric middleware that will act as a oneM2M
compliant IoT Data Broker and enable authorized applications to retrieve
IoT data uploaded by any device. The OpenDaylight platform is used to
implement the oneM2M data store which models a hierarchical containment
tree, where each node in the tree represents an oneM2M resource.
Typically, IoT devices and applications interact with the resource tree
over standard protocols such as CoAP, MQTT, and HTTP. Initially, the
oneM2M resource tree is used by applications to retrieve data. Possible
applications are inventory or device management systems or big data
analytic systems designed to make sense of the collected data. But, at
some point, applications will need to configure the devices. Features
and tools will have to be provided to enable configuration of the
devices based on applications responding to user input, network
conditions, or some set of programmable rules or policies possibly
triggered by the receipt of data collected from the devices. The
OpenDaylight platform, with its rich unique cross-section of SDN
capabilities, NFV, and now IoT device and application management, can be
bundled with a targeted set of features and deployed anywhere in the
network to give the network service provider ultimate control. Depending
on the use case, the OpenDaylight IoT platform can be configured with
only IoT data collection capabilities where it is deployed near the IoT
devices and its footprint needs to be small, or it can be configured to
run as a highly scaled up and out distributed cluster with IoT, SDN and
NFV functions enabled and deployed in a high traffic data center.</p>
</div>
<div class="section" id="onem2m-architecture">
<h3>oneM2M Architecture<a class="headerlink" href="#onem2m-architecture" title="Permalink to this headline">¶</a></h3>
<p>The architecture provides a framework that enables the support of the
oneM2M resource containment tree. The onem2m-core implements the MDSAL
RPCs defined in the onem2m-api YANG files. These RPCs enable oneM2M
resources to be created, read, updated, and deleted (CRUD), and also
enables the management of subscriptions. When resources are CRUDed, the
onem2m-notifier issues oneM2M notification events to interested
subscribers. TS0001: oneM2M Functional Architecture and TS0004: oneM2M
Service Layer Protocol are great reference documents to learn details of
oneM2M resource types, message flow, formats, and CRUD/N semantics. Both
of these specifications can be found at
<a class="reference external" href="http://onem2m.org/technical/published-documents">http://onem2m.org/technical/published-documents</a></p>
<p>The oneM2M resource tree is modeled in YANG and essentially is a
meta-model for the tree. The oneM2M wire protocols allow the resource
tree to be constructed via HTTP or CoAP messages that populate nodes in
the tree with resource specific attributes. Each oneM2M resource type
has semantic behaviour associated with it. For example: a container
resource has attributes which control quotas on how many and how big the
collection of data or content instance objects that can exist below it
in the tree. Depending on the resource type, the oneM2M core software
implements and enforces the resource type specific rules to ensure a
well-behaved resource tree.</p>
<p>The resource tree can be simultaneously accessed by many concurrent
applications wishing to manage or access the tree, and also many devices
can be reporting in new data or sensor readings into their appropriate
place in the tree.</p>
</div>
<div class="section" id="id16">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>The API’s to access the oneM2M datastore are well documented in TS0004
(referred above) found on onem2m.org</p>
<p>RESTCONF is available too but generally HTTP and CoAP are used to access
the oneM2M data tree.</p>
</div>
</div>
<div class="section" id="l2switch-developer-guide">
<h2>L2Switch Developer Guide<a class="headerlink" href="#l2switch-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id17">
<h3>Overview<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>The L2Switch project provides Layer2 switch functionality.</p>
</div>
<div class="section" id="l2switch-architecture">
<h3>L2Switch Architecture<a class="headerlink" href="#l2switch-architecture" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Packet Handler<ul>
<li>Decodes the packets coming to the controller and dispatches them
appropriately</li>
</ul>
</li>
<li>Loop Remover<ul>
<li>Removes loops in the network</li>
</ul>
</li>
<li>Arp Handler<ul>
<li>Handles the decoded ARP packets</li>
</ul>
</li>
<li>Address Tracker<ul>
<li>Learns the Addresses (MAC and IP) of entities in the network</li>
</ul>
</li>
<li>Host Tracker<ul>
<li>Tracks the locations of hosts in the network</li>
</ul>
</li>
<li>L2Switch Main<ul>
<li>Installs flows on each switch based on network traffic</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id18">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Packet Handler</li>
<li>Loop Remover</li>
<li>Arp Handler</li>
<li>Address Tracker</li>
<li>Host Tracker</li>
<li>L2Switch Main</li>
</ul>
<div class="section" id="packet-dispatcher">
<h4>Packet Dispatcher<a class="headerlink" href="#packet-dispatcher" title="Permalink to this headline">¶</a></h4>
<div class="section" id="classes">
<h5>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>AbstractPacketDecoder<ul>
<li>Defines the methods that all decoders must implement</li>
</ul>
</li>
<li>EthernetDecoder<ul>
<li>The base decoder which decodes the packet into an Ethernet packet</li>
</ul>
</li>
<li>ArpDecoder, Ipv4Decoder, Ipv6Decoder<ul>
<li>Decodes Ethernet packets into the either an ARP or IPv4 or IPv6
packet</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="further-development">
<h5>Further development<a class="headerlink" href="#further-development" title="Permalink to this headline">¶</a></h5>
<p>There is a need for more decoders. A developer can write</p>
<ul class="simple">
<li>A decoder for another EtherType, i.e. LLDP.</li>
<li>A higher layer decoder for the body of the IPv4 packet or IPv6
packet, i.e. TCP and UDP.</li>
</ul>
<p>How to write a new decoder</p>
<ul class="simple">
<li>extends AbstractDecoder&lt;A, B&gt;<ul>
<li>A refers to the notification that the new decoder consumes</li>
<li>B refers to the notification that the new decoder produces</li>
</ul>
</li>
<li>implements xPacketListener<ul>
<li>The new decoder must specify which notification it is listening to</li>
</ul>
</li>
<li>canDecode method<ul>
<li>This method should examine the consumed notification to see
whether the new decoder can decode the contents of the packet</li>
</ul>
</li>
<li>decode method<ul>
<li>This method does the actual decoding of the packet</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="loop-remover">
<h4>Loop Remover<a class="headerlink" href="#loop-remover" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id19">
<h5>Classes<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><strong>LoopRemoverModule</strong><ul>
<li>Reads config subsystem value for <em>is-install-lldp-flow</em><ul>
<li>If <em>is-install-lldp-flow</em> is true, then an
<strong>InitialFlowWriter</strong> is created</li>
</ul>
</li>
<li>Creates and initializes the other LoopRemover classes</li>
</ul>
</li>
<li><strong>InitialFlowWriter</strong><ul>
<li>Only created when <em>is-install-lldp-flow</em> is true</li>
<li>Installs a flow, which forwards all LLDP packets to the
controller, on each switch</li>
</ul>
</li>
<li><strong>TopologyLinkDataChangeHandler</strong><ul>
<li>Listens to data change events on the Topology tree</li>
<li>When these changes occur, it waits <em>graph-refresh-delay</em> seconds
and then tells <strong>NetworkGraphImpl</strong> to update</li>
<li>Writes an STP (Spanning Tree Protocol) status of &#8220;forwarding&#8221; or
&#8220;discarding&#8221; to each link in the Topology data tree<ul>
<li>Forwarding links can forward packets.</li>
<li>Discarding links cannot forward packets.</li>
</ul>
</li>
</ul>
</li>
<li><strong>NetworkGraphImpl</strong><ul>
<li>Creates a loop-free graph of the network</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configuration">
<h5>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>graph-refresh-delay<ul>
<li>Used in TopologyLinkDataChangeHandler</li>
<li>A higher value has the advantage of doing less graph updates, at
the potential cost of losing some packets because the graph didn’t
update immediately.</li>
<li>A lower value has the advantage of handling network topology
changes quicker, at the cost of doing more computation.</li>
</ul>
</li>
<li>is-install-lldp-flow<ul>
<li>Used in LoopRemoverModule</li>
<li>&#8220;true&#8221; means a flow that sends all LLDP packets to the controller
will be installed on each switch</li>
<li>&#8220;false&#8221; means this flow will not be installed</li>
</ul>
</li>
<li>lldp-flow-table-id<ul>
<li>The LLDP flow will be installed on the specified flow table of
each switch</li>
</ul>
</li>
<li>lldp-flow-priority<ul>
<li>The LLDP flow will be installed with the specified priority</li>
</ul>
</li>
<li>lldp-flow-idle-timeout<ul>
<li>The LLDP flow will timeout (removed from the switch) if the flow
doesn’t forward a packet for <em>x</em> seconds</li>
</ul>
</li>
<li>lldp-flow-hard-timeout<ul>
<li>The LLDP flow will timeout (removed from the switch) after <em>x</em>
seconds, regardless of how many packets it is forwarding</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id20">
<h5>Further development<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<p>No suggestions at the moment.</p>
</div>
<div class="section" id="validating-changes-to-loop-remover">
<h5>Validating changes to Loop Remover<a class="headerlink" href="#validating-changes-to-loop-remover" title="Permalink to this headline">¶</a></h5>
<p>STP Status information is added to the Inventory data tree.</p>
<ul class="simple">
<li>A status of &#8220;forwarding&#8221; means the link is active and packets are
flowing on it.</li>
<li>A status of &#8220;discarding&#8221; means the link is inactive and packets are
not sent over it.</li>
</ul>
<p>The STP status of a link can be checked through a browser or a REST
Client.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.194</span><span class="o">.</span><span class="mf">126.91</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">operational</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="n">connector</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
<p>The STP status should still be there after changes are made.</p>
</div>
</div>
<div class="section" id="arp-handler">
<h4>Arp Handler<a class="headerlink" href="#arp-handler" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id21">
<h5>Classes<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><strong>ArpHandlerModule</strong><ul>
<li>Reads config subsystem value for <em>is-proactive-flood-mode</em><ul>
<li>If <em>is-proactive-flood-mode</em> is true, then a
ProactiveFloodFlowWriter is created</li>
<li>If <em>is-proactive-flood-mode</em> is false, then an
InitialFlowWriter is created</li>
</ul>
</li>
</ul>
</li>
<li><strong>ProactiveFloodFlowWriter</strong><ul>
<li>Only created when <em>is-proactive-flood-mode</em> is true</li>
<li>Installs a flood flow on each switch. With this flood flow, a
packet that doesn’t match any other flows will be
flooded/broadcast from that switch.</li>
</ul>
</li>
<li><strong>InitialFlowWriter</strong><ul>
<li>Only created when <em>is-proactive-flood-mode</em> is false</li>
<li>Installs a flow, which sends all ARP packets to the controller, on
each switch</li>
</ul>
</li>
<li><strong>ArpPacketHandler</strong><ul>
<li>Only created when <em>is-proactive-flood-mode</em> is false</li>
<li>Handles and processes the controller’s incoming ARP packets</li>
<li>Uses <strong>PacketDispatcher</strong> to send the ARP packet back into the
network</li>
</ul>
</li>
<li><strong>PacketDispatcher</strong><ul>
<li>Only created when <em>is-proactive-flood-mode</em> is false</li>
<li>Sends packets out to the network</li>
<li>Uses <strong>InventoryReader</strong> to determine which node-connector to a
send a packet on</li>
</ul>
</li>
<li><strong>InventoryReader</strong><ul>
<li>Only created when <em>is-proactive-flood-mode</em> is false</li>
<li>Maintains a list of each switch’s node-connectors</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id22">
<h5>Configuration<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>is-proactive-flood-mode<ul>
<li>&#8220;true&#8221; means that flood flows will be installed on each switch.
With this flood flow, each switch will flood a packet that doesn’t
match any other flows.<ul>
<li>Advantage: Fewer packets are sent to the controller because
those packets are flooded to the network.</li>
<li>Disadvantage: A lot of network traffic is generated.</li>
</ul>
</li>
<li>&#8220;false&#8221; means the previously mentioned flood flows will not be
installed. Instead an ARP flow will be installed on each switch
that sends all ARP packets to the controller.<ul>
<li>Advantage: Less network traffic is generated.</li>
<li>Disadvantage: The controller handles more packets (ARP requests
&amp; replies) and the ARP process takes longer than if there were
flood flows.</li>
</ul>
</li>
</ul>
</li>
<li>flood-flow-table-id<ul>
<li>The flood flow will be installed on the specified flow table of
each switch</li>
</ul>
</li>
<li>flood-flow-priority<ul>
<li>The flood flow will be installed with the specified priority</li>
</ul>
</li>
<li>flood-flow-idle-timeout<ul>
<li>The flood flow will timeout (removed from the switch) if the flow
doesn’t forward a packet for <em>x</em> seconds</li>
</ul>
</li>
<li>flood-flow-hard-timeout<ul>
<li>The flood flow will timeout (removed from the switch) after <em>x</em>
seconds, regardless of how many packets it is forwarding</li>
</ul>
</li>
<li>arp-flow-table-id<ul>
<li>The ARP flow will be installed on the specified flow table of each
switch</li>
</ul>
</li>
<li>arp-flow-priority<ul>
<li>The ARP flow will be installed with the specified priority</li>
</ul>
</li>
<li>arp-flow-idle-timeout<ul>
<li>The ARP flow will timeout (removed from the switch) if the flow
doesn’t forward a packet for <em>x</em> seconds</li>
</ul>
</li>
<li>arp-flow-hard-timeout<ul>
<li>The ARP flow will timeout (removed from the switch) after
<em>arp-flow-hard-timeout</em> seconds, regardless of how many packets it
is forwarding</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id23">
<h5>Further development<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<p>The <strong>ProactiveFloodFlowWriter</strong> needs to be improved. It does have the
advantage of having less traffic come to the controller; however, it
generates too much network traffic.</p>
</div>
</div>
<div class="section" id="address-tracker">
<h4>Address Tracker<a class="headerlink" href="#address-tracker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id24">
<h5>Classes<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>AddressTrackerModule<ul>
<li>Reads config subsystem value for <em>observe-addresses-from</em></li>
<li>If <em>observe-addresses-from</em> contains &#8220;arp&#8221;, then an
AddressObserverUsingArp is created</li>
<li>If <em>observe-addresses-from</em> contains &#8220;ipv4&#8221;, then an
AddressObserverUsingIpv4 is created</li>
<li>If <em>observe-addresses-from</em> contains &#8220;ipv6&#8221;, then an
AddressObserverUsingIpv6 is created</li>
</ul>
</li>
<li>AddressObserverUsingArp<ul>
<li>Registers for ARP packet notifications</li>
<li>Uses <strong>AddressObservationWriter</strong> to write address observations
from ARP packets</li>
</ul>
</li>
<li>AddressObserverUsingIpv4<ul>
<li>Registers for IPv4 packet notifications</li>
<li>Uses <strong>AddressObservationWriter</strong> to write address observations
from IPv4 packets</li>
</ul>
</li>
<li>AddressObserverUsingIpv6<ul>
<li>Registers for IPv6 packet notifications</li>
<li>Uses <strong>AddressObservationWriter</strong> to write address observations
from IPv6 packets</li>
</ul>
</li>
<li>AddressObservationWriter<ul>
<li>Writes new Address Observations to the Inventory data tree</li>
<li>Updates existing Address Observations with updated &#8220;last seen&#8221;
timestamps<ul>
<li>Uses the <em>timestamp-update-intervval</em> configuration variable to
determine whether or not to update</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id25">
<h5>Configuration<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>timestamp-update-interval<ul>
<li>A last-seen timestamp is associated with each address. This
last-seen timestamp will only be updated after
<em>timestamp-update-interval</em> milliseconds.</li>
<li>A higher value has the advantage of performing less writes to the
database.</li>
<li>A lower value has the advantage of knowing how fresh an address
is.</li>
</ul>
</li>
<li>observe-addresses-from<ul>
<li>IP and MAC addresses can be observed/learned from ARP, IPv4, and
IPv6 packets. Set which packets to make these observations from.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id26">
<h5>Further development<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h5>
<p>Further improvements can be made to the <strong>AddressObservationWriter</strong> so
that it (1) doesn’t make any unnecessary writes to the DB and (2) is
optimized for multi-threaded environments.</p>
</div>
<div class="section" id="validating-changes-to-address-tracker">
<h5>Validating changes to Address Tracker<a class="headerlink" href="#validating-changes-to-address-tracker" title="Permalink to this headline">¶</a></h5>
<p>Address Observations are added to the Inventory data tree.</p>
<p>The Address Observations on a Node Connector can be checked through a
browser or a REST Client.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.194</span><span class="o">.</span><span class="mf">126.91</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">operational</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">-</span><span class="n">inventory</span><span class="p">:</span><span class="n">nodes</span><span class="o">/</span><span class="n">node</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="n">connector</span><span class="o">/</span><span class="n">openflow</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
</pre></div>
</div>
<p>The Address Observations should still be there after changes.</p>
</div>
</div>
<div class="section" id="developers-guide-for-host-tracker">
<h4>Developer’s Guide for Host Tracker<a class="headerlink" href="#developers-guide-for-host-tracker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="validationg-changes-to-host-tracker">
<h5>Validationg changes to Host Tracker<a class="headerlink" href="#validationg-changes-to-host-tracker" title="Permalink to this headline">¶</a></h5>
<p>Host information is added to the Topology data tree.</p>
<ul class="simple">
<li>Host address</li>
<li>Attachment point (link) to a node/switch</li>
</ul>
<p>This host information and attachment point information can be checked
through a browser or a REST Client.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.194</span><span class="o">.</span><span class="mf">126.91</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">operational</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="p">:</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">/</span><span class="n">flow</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span>
</pre></div>
</div>
<p>Host information should still be there after changes.</p>
</div>
</div>
<div class="section" id="l2switch-main">
<h4>L2Switch Main<a class="headerlink" href="#l2switch-main" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id27">
<h5>Classes<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>L2SwitchMainModule<ul>
<li>Reads config subsystem value for <em>is-install-dropall-flow</em><ul>
<li>If <em>is-install-dropall-flow</em> is true, then an
<strong>InitialFlowWriter</strong> is created</li>
</ul>
</li>
<li>Reads config subsystem value for <em>is-learning-only-mode</em><ul>
<li>If <em>is-learning-only-mode</em> is false, then a
<strong>ReactiveFlowWriter</strong> is created</li>
</ul>
</li>
</ul>
</li>
<li>InitialFlowWriter<ul>
<li>Only created when <em>is-install-dropall-flow</em> is true</li>
<li>Installs a flow, which drops all packets, on each switch. This
flow has low priority and means that packets that don’t match any
higher-priority flows will simply be dropped.</li>
</ul>
</li>
<li>ReactiveFlowWriter<ul>
<li>Reacts to network traffic and installs MAC-to-MAC flows on
switches. These flows have matches based on MAC source and MAC
destination.</li>
<li>Uses <strong>FlowWriterServiceImpl</strong> to write these flows to the
switches</li>
</ul>
</li>
<li>FlowWriterService / FlowWriterServiceImpl<ul>
<li>Writes flows to switches</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id28">
<h5>Configuration<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>is-install-dropall-flow<ul>
<li>&#8220;true&#8221; means a drop-all flow will be installed on each switch, so
the default action will be to drop a packet instead of sending it
to the controller</li>
<li>&#8220;false&#8221; means this flow will not be installed</li>
</ul>
</li>
<li>dropall-flow-table-id<ul>
<li>The dropall flow will be installed on the specified flow table of
each switch</li>
<li>This field is only relevant when &#8220;is-install-dropall-flow&#8221; is set
to &#8220;true&#8221;</li>
</ul>
</li>
<li>dropall-flow-priority<ul>
<li>The dropall flow will be installed with the specified priority</li>
<li>This field is only relevant when &#8220;is-install-dropall-flow&#8221; is set
to &#8220;true&#8221;</li>
</ul>
</li>
<li>dropall-flow-idle-timeout<ul>
<li>The dropall flow will timeout (removed from the switch) if the
flow doesn’t forward a packet for <em>x</em> seconds</li>
<li>This field is only relevant when &#8220;is-install-dropall-flow&#8221; is set
to &#8220;true&#8221;</li>
</ul>
</li>
<li>dropall-flow-hard-timeout<ul>
<li>The dropall flow will timeout (removed from the switch) after <em>x</em>
seconds, regardless of how many packets it is forwarding</li>
<li>This field is only relevant when &#8220;is-install-dropall-flow&#8221; is set
to &#8220;true&#8221;</li>
</ul>
</li>
<li>is-learning-only-mode<ul>
<li>&#8220;true&#8221; means that the L2Switch will only be learning addresses. No
additional flows to optimize network traffic will be installed.</li>
<li>&#8220;false&#8221; means that the L2Switch will react to network traffic and
install flows on the switches to optimize traffic. Currently,
MAC-to-MAC flows are installed.</li>
</ul>
</li>
<li>reactive-flow-table-id<ul>
<li>The reactive flow will be installed on the specified flow table of
each switch</li>
<li>This field is only relevant when &#8220;is-learning-only-mode&#8221; is set to
&#8220;false&#8221;</li>
</ul>
</li>
<li>reactive-flow-priority<ul>
<li>The reactive flow will be installed with the specified priority</li>
<li>This field is only relevant when &#8220;is-learning-only-mode&#8221; is set to
&#8220;false&#8221;</li>
</ul>
</li>
<li>reactive-flow-idle-timeout<ul>
<li>The reactive flow will timeout (removed from the switch) if the
flow doesn’t forward a packet for <em>x</em> seconds</li>
<li>This field is only relevant when &#8220;is-learning-only-mode&#8221; is set to
&#8220;false&#8221;</li>
</ul>
</li>
<li>reactive-flow-hard-timeout<ul>
<li>The reactive flow will timeout (removed from the switch) after <em>x</em>
seconds, regardless of how many packets it is forwarding</li>
<li>This field is only relevant when &#8220;is-learning-only-mode&#8221; is set to
&#8220;false&#8221;</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id29">
<h5>Further development<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h5>
<p>The <strong>ReactiveFlowWriter</strong> needs to be improved to install the
MAC-to-MAC flows faster. For the first ping, the ARP request and reply
are successful. However, then the ping packets are sent out. The first
ping packet is dropped sometimes because the MAC-to-MAC flow isn’t
installed quickly enough. The second, third, and following ping packets
are successful though.</p>
</div>
</div>
</div>
<div class="section" id="id30">
<h3>API Reference Documentation<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>Further documentation can be found by checking out the L2Switch project.</p>
</div>
<div class="section" id="checking-out-the-l2switch-project">
<h3>Checking out the L2Switch project<a class="headerlink" href="#checking-out-the-l2switch-project" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">gerrit</span><span class="o">/</span><span class="n">p</span><span class="o">/</span><span class="n">l2switch</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>The above command will create a directory called &#8220;l2switch&#8221; with the
project.</p>
</div>
<div class="section" id="testing-your-changes-to-the-l2switch-project">
<h3>Testing your changes to the L2Switch project<a class="headerlink" href="#testing-your-changes-to-the-l2switch-project" title="Permalink to this headline">¶</a></h3>
<div class="section" id="running-the-l2switch-project">
<h4>Running the L2Switch project<a class="headerlink" href="#running-the-l2switch-project" title="Permalink to this headline">¶</a></h4>
<p>To run the base distribution, you can use the following command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">distribution</span><span class="o">/</span><span class="n">base</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">distributions</span><span class="o">-</span><span class="n">l2switch</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="mf">0.1</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">-</span><span class="n">osgipackage</span><span class="o">/</span><span class="n">opendaylight</span><span class="o">/</span><span class="n">run</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>If you need additional resources, you can use these command line
arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Xms1024m</span> <span class="o">-</span><span class="n">Xmx2048m</span> <span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">PermSize</span><span class="o">=</span><span class="mi">512</span><span class="n">m</span> <span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">MaxPermSize</span><span class="o">=</span><span class="mi">1024</span><span class="n">m</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>To run the karaf distribution, you can use the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">distribution</span><span class="o">/</span><span class="n">karaf</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">karaf</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-network-using-mininet">
<h4>Create a network using mininet<a class="headerlink" href="#create-a-network-using-mininet" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mn</span> <span class="o">--</span><span class="n">controller</span><span class="o">=</span><span class="n">remote</span><span class="p">,</span><span class="n">ip</span><span class="o">=&lt;</span><span class="n">Controller</span> <span class="n">IP</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">topo</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span><span class="n">switch</span> <span class="n">ovsk</span><span class="p">,</span><span class="n">protocols</span><span class="o">=</span><span class="n">OpenFlow13</span>
<span class="n">sudo</span> <span class="n">mn</span> <span class="o">--</span><span class="n">controller</span><span class="o">=</span><span class="n">remote</span><span class="p">,</span><span class="n">ip</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">--</span><span class="n">topo</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span><span class="n">switch</span> <span class="n">ovsk</span><span class="p">,</span><span class="n">protocols</span><span class="o">=</span><span class="n">OpenFlow13</span>
</pre></div>
</div>
<p>The above command will create a virtual network consisting of 3
switches. Each switch will connect to the controller located at the
specified IP, i.e. 127.0.0.1</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mn</span> <span class="o">--</span><span class="n">controller</span><span class="o">=</span><span class="n">remote</span><span class="p">,</span><span class="n">ip</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">--</span><span class="n">mac</span> <span class="o">--</span><span class="n">topo</span><span class="o">=</span><span class="n">linear</span><span class="p">,</span><span class="mi">3</span> <span class="o">--</span><span class="n">switch</span> <span class="n">ovsk</span><span class="p">,</span><span class="n">protocols</span><span class="o">=</span><span class="n">OpenFlow13</span>
</pre></div>
</div>
<p>The above command has the &#8220;mac&#8221; option, which makes it easier to
distinguish between Host MAC addresses and Switch MAC addresses.</p>
</div>
<div class="section" id="generating-network-traffic-using-mininet">
<h4>Generating network traffic using mininet<a class="headerlink" href="#generating-network-traffic-using-mininet" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">h1</span> <span class="n">ping</span> <span class="n">h2</span>
</pre></div>
</div>
<p>The above command will cause host1 (h1) to ping host2 (h2)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pingall</span>
</pre></div>
</div>
<p><em>pingall</em> will cause each host to ping every other host.</p>
</div>
<div class="section" id="miscellaneous-mininet-commands">
<h4>Miscellaneous mininet commands<a class="headerlink" href="#miscellaneous-mininet-commands" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="n">s1</span> <span class="n">s2</span> <span class="n">down</span>
</pre></div>
</div>
<p>This will bring the link between switch1 (s1) and switch2 (s2) down</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="n">s1</span> <span class="n">s2</span> <span class="n">up</span>
</pre></div>
</div>
<p>This will bring the link between switch1 (s1) and switch2 (s2) up</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="n">s1</span> <span class="n">h1</span> <span class="n">down</span>
</pre></div>
</div>
<p>This will bring the link between switch1 (s1) and host1 (h1) down</p>
</div>
</div>
</div>
<div class="section" id="lacp-developer-guide">
<h2>LACP Developer Guide<a class="headerlink" href="#lacp-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lacp-overview">
<h3>LACP Overview<a class="headerlink" href="#lacp-overview" title="Permalink to this headline">¶</a></h3>
<p>The OpenDaylight LACP (Link Aggregation Control Protocol) project can be
used to aggregate multiple links between OpenDaylight controlled network
switches and LACP enabled legacy switches or hosts operating in active
LACP mode.</p>
<p>OpenDaylight LACP passively negotiates automatic bundling of multiple
links to form a single LAG (Link Aggregation Group). LAGs are realised
in the OpenDaylight controlled switches using OpenFlow 1.3+ group table
functionality.</p>
</div>
<div class="section" id="lacp-architecture">
<h3>LACP Architecture<a class="headerlink" href="#lacp-architecture" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>inventory</strong><ul>
<li>Maintains list of OpenDaylight controlled switches and port
information</li>
<li>List of LAGs created and physical ports that are part of the LAG</li>
<li>Interacts with MD-SAL to update LACP related information</li>
</ul>
</li>
<li><strong>inventorylistener</strong><ul>
<li>This module interacts with MD-SAL for receiving
node/node-connector notifications</li>
</ul>
</li>
<li><strong>flow</strong><ul>
<li>Programs the switch to punt LACP PDU (Protocol Data Unit) to
controller</li>
</ul>
</li>
<li><strong>packethandler</strong><ul>
<li>Receives and transmits LACP PDUs to the LACP enabled endpoint</li>
<li>Provides infrastructure services for group table programming</li>
</ul>
</li>
<li><strong>core</strong><ul>
<li>Performs LACP state machine processing</li>
</ul>
</li>
</ul>
<div class="section" id="how-lag-programming-is-implemented">
<h4>How LAG programming is implemented<a class="headerlink" href="#how-lag-programming-is-implemented" title="Permalink to this headline">¶</a></h4>
<p>The LAG representing the aggregated multiple physical ports are realized
in the OpenDaylight controlled switches by creating a group table entry
(Group table supported from OpenFlow 1.3 onwards). The group table entry
has a group type <strong>Select</strong> and action referring to the aggregated
physical ports. Any data traffic to be sent out through the LAG can be
sent through the <strong>group entry</strong> available for the LAG.</p>
<p>Suppose there are ports P1-P8 in a node. When LACP project is installed,
a group table entry for handling broadcast traffic is automatically
created on all the switches that have registered to the controller.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">GroupID</th>
<th class="head">GroupType</th>
<th class="head">EgressPorts</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;B’castgID&gt;</td>
<td>ALL</td>
<td>P1,P2,…P8</td>
</tr>
</tbody>
</table>
<p>Now, assume P1 &amp; P2 are now part of LAG1. The group table would be
programmed as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">GroupID</th>
<th class="head">GroupType</th>
<th class="head">EgressPorts</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;B’castgID&gt;</td>
<td>ALL</td>
<td>P3,P4,…P8</td>
</tr>
<tr class="row-odd"><td>&lt;LAG1&gt;</td>
<td>SELECT</td>
<td>P1,P2</td>
</tr>
</tbody>
</table>
<p>When a second LAG, LAG2, is formed with ports P3 and P4,</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">GroupID</th>
<th class="head">GroupType</th>
<th class="head">EgressPorts</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;B’castgID&gt;</td>
<td>ALL</td>
<td>P5,P6,…P8</td>
</tr>
<tr class="row-odd"><td>&lt;LAG1&gt;</td>
<td>SELECT</td>
<td>P1,P2</td>
</tr>
<tr class="row-even"><td>&lt;LAG2&gt;</td>
<td>SELECT</td>
<td>P3,P4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="how-applications-can-program-openflow-flows-using-lacp-created-lag-groups">
<h4>How applications can program OpenFlow flows using LACP-created LAG groups<a class="headerlink" href="#how-applications-can-program-openflow-flows-using-lacp-created-lag-groups" title="Permalink to this headline">¶</a></h4>
<p>OpenDaylight controller modules can get the information of LAG by
listening/querying the LACP Aggregator datastore.</p>
<p>When any application receives packets, it can check, if the ingress port
is part of a LAG by verifying the LAG Aggregator reference
(lacp-agg-ref) for the source nodeConnector that OpenFlow plugin
provides.</p>
<p>When applications want to add flows to egress out of the LAG, they must
use the group entry corresponding to the LAG.</p>
<p>From the above example, for a flow to egress out of LAG1,</p>
<p><strong>add-flow eth_type=&lt;xxxx&gt;,ip_dst=&lt;x.x.x.x&gt;,actions=output:&lt;LAG1&gt;</strong></p>
<p>Similarly, when applications want traffic to be broadcasted, they should
use the group table entries <strong>&lt;B’castgID&gt;,&lt;LAG1&gt;,&lt;LAG2&gt;</strong> in output
action.</p>
<p>For all applications, the group table information is accessible from
LACP Aggregator datastore.</p>
</div>
</div>
</div>
<div class="section" id="messaging4transport-developer-guide">
<h2>Messaging4Transport Developer Guide<a class="headerlink" href="#messaging4transport-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id31">
<h3>Overview<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>Messaging4Transport can be configured such that the data tree, RPCs, and
notifications are sent to an external broker, or an integrated broker
with OpenDaylight. Messaging4Transport uses ActiveMQ as the default
external broker. It further uses AMQP as the messaging protocol for the
Beryllium Release.</p>
</div>
<div class="section" id="messaging4transport-architecture">
<h3>Messaging4Transport Architecture<a class="headerlink" href="#messaging4transport-architecture" title="Permalink to this headline">¶</a></h3>
<p>The ActiveMQ client implementation for AMQP hides the implementation
behind the Java Message Service (JMS) API. ActiveMQ further depends on
<a class="reference external" href="https://qpid.apache.org/">QPid</a> for its AMQP clients and broker.
Hence, QPid and JMS bundles are introduced as the dependencies to the
odl-messaging4transport feature.</p>
<p>ActiveMQ also has a <a class="reference external" href="http://stomp.github.io/">Simple (or Streaming) Text Oriented Message
Protocol (STOMP)</a> implementation in the same
way through StompJmsConnectionFactory, a JMS mapping and interface for
STOMP. <a class="reference external" href="http://activemq.apache.org/openwire.html">OpenWire</a> is a
cross-language wire protocol from ActiveMQ. The OpenWire implementation
of ActiveMQ follows the similar strategy and implementation. With almost
no changes to the architecture, and minimal code changes, publishing to
STOMP or OpenWire broker implementations (such as ActiveMQ) should be
possible, from OpenDaylight/MD-SAL with the odl-messaging4transport
feature.</p>
<p>There is also an <a class="reference external" href="http://mqtt.org/">MQTT</a> implementation in ActiveMQ,
which is slightly different in the implementation from AMQP, STOMP, and
OpenWire implementations, and does not seem to depend on JMS.</p>
</div>
<div class="section" id="id32">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>Messaging4Transport consists of the messaging4transport feature which
offers an AMQP message-oriented middleware northbound to MD-SAL, as an
alternative to the traditional RESTCONF northbound.</p>
</div>
<div class="section" id="use-cases">
<h3>Use Cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h3>
<p>Multiple research and industrial <a class="reference external" href="https://wiki.opendaylight.org/view/Messaging4Transport:Use_Cases">use
cases</a>
of Messaging4Transport has been proposed. Since Messaging4Transport is
still in its early stages, many of these use cases are still proof of
concepts and novel research publications.</p>
<ul>
<li><p class="first"><strong>Software-Defined Buildings</strong></p>
<p><a class="reference external" href="http://www.navigators.di.fc.ul.pt/w2/img_auth.php/9/90/Navtalk20151120_Kathiravelu.paper.pdf">Cassowary</a>
is a middleware platform for context-aware smart buildings with
software-defined sensor networks, by leveraging OpenDaylight
Messaging4Transport. Messaging4Transport architecture has been
extended by Cassowary approach to create a software-defined sensor
and actuator network for smart buildings.</p>
</li>
<li><p class="first"><strong>Software-Defined Community Networks</strong></p>
<p><a class="reference external" href="http://www.gsd.inesc-id.pt/~pradeeban/SDS2016/IEEE_SDS_16_CHIEF.pdf">CHIEF</a>
is a controller farm for clouds of software-defined community
networks. CHIEF leverages the message-oriented middleware and
OpenDaylight Messaging4Transport architecture to create a huge
deployment of SDN for community clouds.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="netconf-developer-guide">
<h2>NETCONF Developer Guide<a class="headerlink" href="#netconf-developer-guide" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Reading the NETCONF section in the User Guide is likely useful as it
contains an overview of NETCONF in OpenDaylight and a how-to for
spawning and configuring NETCONF connectors.</p>
</div></blockquote>
<p>This chapter is recommended for application developers who want to
interact with mounted NETCONF devices from their application code. It
tries to demonstrate all the use cases from user guide with RESTCONF but
now from the code level. One important difference would be the
demonstration of NETCONF notifications and notification listeners. The
notifications were not shown using RESTCONF because <strong>RESTCONF does not
support notifications from mounted NETCONF devices.</strong></p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>It may also be useful to read the generic <a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Controller:MD-SAL:MD-SAL_App_Tutorial">OpenDaylight MD-SAL app
development
tutorial</a>
before diving into this chapter. This guide assumes awareness of
basic OpenDaylight application development.</p>
</div></blockquote>
<div class="section" id="sample-app-overview">
<h3>Sample app overview<a class="headerlink" href="#sample-app-overview" title="Permalink to this headline">¶</a></h3>
<p>All the examples presented here are implemented by a sample OpenDaylight
application called <strong>ncmount</strong> in the <code class="docutils literal"><span class="pre">coretutorials</span></code> OpenDaylight
project. It can be found on the github mirror of OpenDaylight’s
repositories:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/opendaylight/coretutorials/tree/stable/lithium/ncmount">https://github.com/opendaylight/coretutorials/tree/stable/lithium/ncmount</a></li>
</ul>
<p>or checked out from the official OpenDaylight repository:</p>
<ul class="simple">
<li><a class="reference external" href="https://git.opendaylight.org/gerrit/#/admin/projects/coretutorials">https://git.opendaylight.org/gerrit/#/admin/projects/coretutorials</a></li>
</ul>
<p><strong>The application was built using the `project startup maven
archetype &lt;https://wiki.opendaylight.org/view/OpenDaylight_Controller:MD-SAL:Startup_Project_Archetype&gt;`__
and demonstrates how to:</strong></p>
<ul class="simple">
<li>preconfigure connectors to NETCONF devices</li>
<li>retrieve MountPointService (registry of available mount points)</li>
<li>listen and react to changing connection state of netconf-connector</li>
<li>add custom device YANG models to the app and work with them</li>
<li>read data from device in binding aware format (generated java APIs
from provided YANG models)</li>
<li>write data into device in binding aware format</li>
<li>trigger and listen to NETCONF notifications in binding aware format</li>
</ul>
<p>Detailed information about the structure of the application can be found
at:
<a class="reference external" href="https://wiki.opendaylight.org/view/Controller_Core_Functionality_Tutorials:Tutorials:Netconf_Mount">https://wiki.opendaylight.org/view/Controller_Core_Functionality_Tutorials:Tutorials:Netconf_Mount</a></p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The code in ncmount is fully <strong>binding aware</strong> (works with generated
java APIs from provided YANG models). However it is also possible to
perform the same operations in <strong>binding independent</strong> manner.</p>
</div></blockquote>
<div class="section" id="ncmountprovider">
<h4>NcmountProvider<a class="headerlink" href="#ncmountprovider" title="Permalink to this headline">¶</a></h4>
<p>The NcmountProvider class (found in NcmountProvider.java) is the central
point of the ncmount application and all the application logic is
contained there. The following sections will detail its most interesting
pieces.</p>
<div class="section" id="retrieve-mountpointservice">
<h5>Retrieve MountPointService<a class="headerlink" href="#retrieve-mountpointservice" title="Permalink to this headline">¶</a></h5>
<p>The MountPointService is a central registry of all available mount
points in OpenDaylight. It is just another MD-SAL service and is
available from the <code class="docutils literal"><span class="pre">session</span></code> attribute passed by
<code class="docutils literal"><span class="pre">onSessionInitiated</span></code> callback:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">onSessionInitiated</span><span class="p">(</span><span class="n">ProviderContext</span> <span class="n">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;NcmountProvider Session Initiated&quot;</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Get</span> <span class="n">references</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span> <span class="n">broker</span> <span class="ow">and</span> <span class="n">mount</span> <span class="n">service</span>
    <span class="n">this</span><span class="o">.</span><span class="n">mountService</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getSALService</span><span class="p">(</span><span class="n">MountPointService</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="o">...</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="listen-for-connection-state-changes">
<h5>Listen for connection state changes<a class="headerlink" href="#listen-for-connection-state-changes" title="Permalink to this headline">¶</a></h5>
<p>It is important to know when a mount point appears, when it is fully
connected and when it is disconnected or removed. The exact states of a
mount point are:</p>
<ul class="simple">
<li>Connected</li>
<li>Connecting</li>
<li>Unable to connect</li>
</ul>
<p>To receive this kind of information, an application has to register
itself as a notification listener for the preconfigured netconf-topology
subtree in MD-SAL’s datastore. This can be performed in the
<code class="docutils literal"><span class="pre">onSessionInitiated</span></code> callback as well:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">onSessionInitiated</span><span class="p">(</span><span class="n">ProviderContext</span> <span class="n">session</span><span class="p">)</span> <span class="p">{</span>

    <span class="o">...</span>

    <span class="n">this</span><span class="o">.</span><span class="n">dataBroker</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">getSALService</span><span class="p">(</span><span class="n">DataBroker</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Register</span> <span class="n">ourselves</span> <span class="k">as</span> <span class="n">the</span> <span class="n">REST</span> <span class="n">API</span> <span class="n">RPC</span> <span class="n">implementation</span>
    <span class="n">this</span><span class="o">.</span><span class="n">rpcReg</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">addRpcImplementation</span><span class="p">(</span><span class="n">NcmountService</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">this</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Register</span> <span class="n">ourselves</span> <span class="k">as</span> <span class="n">data</span> <span class="n">change</span> <span class="n">listener</span> <span class="k">for</span> <span class="n">changes</span> <span class="n">on</span> <span class="n">Netconf</span>
    <span class="o">//</span> <span class="n">nodes</span><span class="o">.</span> <span class="n">Netconf</span> <span class="n">nodes</span> <span class="n">are</span> <span class="n">accessed</span> <span class="n">via</span> <span class="s2">&quot;Netconf Topology&quot;</span> <span class="o">-</span> <span class="n">a</span> <span class="n">special</span>
    <span class="o">//</span> <span class="n">topology</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">created</span> <span class="n">by</span> <span class="n">the</span> <span class="n">system</span> <span class="n">infrastructure</span><span class="o">.</span> <span class="n">It</span> <span class="n">contains</span>
    <span class="o">//</span> <span class="nb">all</span> <span class="n">Netconf</span> <span class="n">nodes</span> <span class="n">the</span> <span class="n">Netconf</span> <span class="n">connector</span> <span class="n">knows</span> <span class="n">about</span><span class="o">.</span> <span class="n">NETCONF_TOPO_IID</span>
    <span class="o">//</span> <span class="ow">is</span> <span class="n">equivalent</span> <span class="n">to</span> <span class="n">the</span> <span class="n">following</span> <span class="n">URL</span><span class="p">:</span>
    <span class="o">//</span> <span class="o">.../</span><span class="n">restconf</span><span class="o">/</span><span class="n">operational</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="p">:</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">-</span><span class="n">netconf</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dataBroker</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">dclReg</span> <span class="o">=</span> <span class="n">dataBroker</span><span class="o">.</span><span class="n">registerDataChangeListener</span><span class="p">(</span><span class="n">LogicalDatastoreType</span><span class="o">.</span><span class="n">OPERATIONAL</span><span class="p">,</span>
                <span class="n">NETCONF_TOPO_IID</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">class</span><span class="p">),</span>
                <span class="n">this</span><span class="p">,</span>
                <span class="n">DataChangeScope</span><span class="o">.</span><span class="n">SUBTREE</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implementation of the callback from MD-SAL when the data change can
be found in the
<code class="docutils literal"><span class="pre">onDataChanged(AsyncDataChangeEvent&lt;InstanceIdentifier&lt;?&gt;,</span> <span class="pre">DataObject&gt;</span>
<span class="pre">change)</span></code> callback of <a class="reference external" href="https://github.com/opendaylight/coretutorials/blob/stable/lithium/ncmount/impl/src/main/java/ncmount/impl/NcmountProvider.java">NcmountProvider
class</a>.</p>
</div>
<div class="section" id="reading-data-from-the-device">
<h5>Reading data from the device<a class="headerlink" href="#reading-data-from-the-device" title="Permalink to this headline">¶</a></h5>
<p>The first step when trying to interact with the device is to get the
exact mount point instance (identified by an instance identifier) from
the MountPointService:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@Override
public Future&lt;RpcResult&lt;ShowNodeOutput&gt;&gt; showNode(ShowNodeInput input) {
    LOG.info(&quot;showNode called, input {}&quot;, input);

    // Get the mount point for the specified node
    // Equivalent to &#39;.../restconf/&lt;config | operational&gt;/opendaylight-inventory:nodes/node/&lt;node-name&gt;/yang-ext:mount/&#39;
    // Note that we can read both config and operational data from the same
    // mount point
    final Optional&lt;MountPoint&gt; xrNodeOptional = mountService.getMountPoint(NETCONF_TOPO_IID
            .child(Node.class, new NodeKey(new NodeId(input.getNodeName()))));

    Preconditions.checkArgument(xrNodeOptional.isPresent(),
            &quot;Unable to locate mountpoint: %s, not mounted yet or not configured&quot;,
            input.getNodeName());
    final MountPoint xrNode = xrNodeOptional.get();

    ....
}

**Note**

The triggering method in this case is called ``showNode``. It is a
YANG-defined RPC and NcmountProvider serves as an MD-SAL RPC
implementation among other things. This means that ``showNode`` an
be triggered using RESTCONF.
</pre></div>
</div>
<p>The next step is to retrieve an instance of the <code class="docutils literal"><span class="pre">DataBroker</span></code> API from
the mount point and start a read transaction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">RpcResult</span><span class="o">&lt;</span><span class="n">ShowNodeOutput</span><span class="o">&gt;&gt;</span> <span class="n">showNode</span><span class="p">(</span><span class="n">ShowNodeInput</span> <span class="nb">input</span><span class="p">)</span> <span class="p">{</span>

    <span class="o">...</span>

    <span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">DataBroker</span> <span class="k">for</span> <span class="n">the</span> <span class="n">mounted</span> <span class="n">node</span>
    <span class="n">final</span> <span class="n">DataBroker</span> <span class="n">xrNodeBroker</span> <span class="o">=</span> <span class="n">xrNode</span><span class="o">.</span><span class="n">getService</span><span class="p">(</span><span class="n">DataBroker</span><span class="o">.</span><span class="n">class</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
    <span class="o">//</span> <span class="n">Start</span> <span class="n">a</span> <span class="n">new</span> <span class="n">read</span> <span class="n">only</span> <span class="n">transaction</span> <span class="n">that</span> <span class="n">we</span> <span class="n">will</span> <span class="n">use</span> <span class="n">to</span> <span class="n">read</span> <span class="n">data</span>
    <span class="o">//</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">device</span>
    <span class="n">final</span> <span class="n">ReadOnlyTransaction</span> <span class="n">xrNodeReadTx</span> <span class="o">=</span> <span class="n">xrNodeBroker</span><span class="o">.</span><span class="n">newReadOnlyTransaction</span><span class="p">();</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, it is possible to perform the read operation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">RpcResult</span><span class="o">&lt;</span><span class="n">ShowNodeOutput</span><span class="o">&gt;&gt;</span> <span class="n">showNode</span><span class="p">(</span><span class="n">ShowNodeInput</span> <span class="nb">input</span><span class="p">)</span> <span class="p">{</span>

    <span class="o">...</span>

    <span class="n">InstanceIdentifier</span><span class="o">&lt;</span><span class="n">InterfaceConfigurations</span><span class="o">&gt;</span> <span class="n">iid</span> <span class="o">=</span>
            <span class="n">InstanceIdentifier</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">InterfaceConfigurations</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>

    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">InterfaceConfigurations</span><span class="o">&gt;</span> <span class="n">ifConfig</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Read</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">transaction</span> <span class="ow">is</span> <span class="n">asynchronous</span><span class="p">,</span> <span class="n">but</span> <span class="n">a</span> <span class="n">simple</span>
        <span class="o">//</span> <span class="n">get</span><span class="o">/</span><span class="n">checkedGet</span> <span class="n">makes</span> <span class="n">the</span> <span class="n">call</span> <span class="n">synchronous</span>
        <span class="n">ifConfig</span> <span class="o">=</span> <span class="n">xrNodeReadTx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">LogicalDatastoreType</span><span class="o">.</span><span class="n">CONFIGURATION</span><span class="p">,</span> <span class="n">iid</span><span class="p">)</span><span class="o">.</span><span class="n">checkedGet</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">ReadFailedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalStateException</span><span class="p">(</span><span class="s2">&quot;Unexpected error reading data from &quot;</span> <span class="o">+</span> <span class="nb">input</span><span class="o">.</span><span class="n">getNodeName</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The instance identifier is used here again to specify a subtree to read
from the device. At this point application can process the data as it
sees fit. The ncmount app transforms the data into its own format and
returns it from <code class="docutils literal"><span class="pre">showNode</span></code>.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>More information can be found in the source code of ncmount sample
app + on wiki:
<a class="reference external" href="https://wiki.opendaylight.org/view/Controller_Core_Functionality_Tutorials:Tutorials:Netconf_Mount">https://wiki.opendaylight.org/view/Controller_Core_Functionality_Tutorials:Tutorials:Netconf_Mount</a></p>
</div></blockquote>
</div>
</div>
</div>
</div>
<div class="section" id="network-intent-composition-nic-developer-guide">
<h2>Network Intent Composition (NIC) Developer Guide<a class="headerlink" href="#network-intent-composition-nic-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id33">
<h3>Overview<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>The Network Intent Composition (NIC) provides four features:</p>
<ul class="simple">
<li>odl-nic-core - the basic model and infrastructure for the NIC
capabilities</li>
<li>odl-nic-cli - support for the Karaf console CLI NIC commands</li>
<li>odl-nic-renderer-vtn - a feature that transforms an intent to a
network modification using the VTN project</li>
<li>odl-nic-renderer-gbp - a feature that transforms an intent to a
network modification using the Group Policy project</li>
</ul>
<p><em>Only a single renderer feature should be installed at a time for the
Lithium release.</em></p>
</div>
<div class="section" id="odl-nic-core">
<h3>odl-nic-core<a class="headerlink" href="#odl-nic-core" title="Permalink to this headline">¶</a></h3>
<p>This feature supplies the base models for the Network Intent Composition
(NIC) capability. This includes the definition of intent as well as the
configuration and operational data trees.</p>
<p>This feature only provides an information model. The interface for NIC
is to modify the information model via the configuraiton data tree,
which will trigger the renderer to make the appropriate changes in the
controlled network.</p>
<div class="section" id="post-put-configuration">
<h4>POST / PUT (configuration)<a class="headerlink" href="#post-put-configuration" title="Permalink to this headline">¶</a></h4>
<p>This operations create instances of an intent in the configuration data
tree and trigger the creation or modification of an intent.</p>
</div>
<div class="section" id="get-configuration-operational">
<h4>GET (configuration / operational)<a class="headerlink" href="#get-configuration-operational" title="Permalink to this headline">¶</a></h4>
<p>This operation lists all or fetches a single intent from the data tree.</p>
</div>
<div class="section" id="delete-configuration">
<h4>DELETE (configuration)<a class="headerlink" href="#delete-configuration" title="Permalink to this headline">¶</a></h4>
<p>This operation will cause an intent to be removed from the system and
trigger any configuration changes on the network rendered from this
intent to be removed.</p>
</div>
</div>
<div class="section" id="odl-nic-cli">
<h3>odl-nic-cli<a class="headerlink" href="#odl-nic-cli" title="Permalink to this headline">¶</a></h3>
<p>This feature provides karaf console CLI command to manipulate the intent
data model. The CLI essentailly invokes the equivalent data operations.</p>
<div class="section" id="intent-add">
<h4>intent:add<a class="headerlink" href="#intent-add" title="Permalink to this headline">¶</a></h4>
<p>Creates a new intent in the configuration data tree</p>
</div>
<div class="section" id="intent-update">
<h4>intent:update<a class="headerlink" href="#intent-update" title="Permalink to this headline">¶</a></h4>
<p>Updates an existing intent in the configuration data tree</p>
</div>
<div class="section" id="intent-delete">
<h4>intent:delete<a class="headerlink" href="#intent-delete" title="Permalink to this headline">¶</a></h4>
<p>Removes an existing intent from the system</p>
</div>
<div class="section" id="intent-list">
<h4>intent:list<a class="headerlink" href="#intent-list" title="Permalink to this headline">¶</a></h4>
<p>Lists all the intents in the system</p>
</div>
<div class="section" id="intent-show">
<h4>intent:show<a class="headerlink" href="#intent-show" title="Permalink to this headline">¶</a></h4>
<p>Displayes the details of a single intent</p>
</div>
</div>
</div>
<div class="section" id="network-modeling-nemo">
<h2>NEtwork MOdeling (NEMO)<a class="headerlink" href="#network-modeling-nemo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id34">
<h3>Overview<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>TBD: Overview of the NEMO feature, what logical functionality it
provides and why you might use it as a developer.</p>
</div>
<div class="section" id="nemo-architecture">
<h3>NEMO Architecture<a class="headerlink" href="#nemo-architecture" title="Permalink to this headline">¶</a></h3>
<p>TBD: NEMO components and how they work together. Also include
information about how the feature integrates with OpenDaylight and
architecture.</p>
</div>
<div class="section" id="id35">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>TBD: Document the key things a user would want to use.</p>
<div class="section" id="nemo-intent-api">
<h4>NEMO Intent API<a class="headerlink" href="#nemo-intent-api" title="Permalink to this headline">¶</a></h4>
<p>TBD: A description of NEMO Intent API.</p>
</div>
</div>
<div class="section" id="id36">
<h3>API Reference Documentation<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>TBD: Provide links to JavaDoc, REST API documentation, etc.</p>
</div>
</div>
<div class="section" id="netide-developer-guide">
<h2>NetIDE Developer Guide<a class="headerlink" href="#netide-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id37">
<h3>Overview<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>The NetIDE Network Engine enables portability and cooperation inside a
single network by using a client/server multi-controller SDN
architecture. Separate &#8220;Client SDN Controllers&#8221; host the various SDN
Applications with their access to the actual physical network abstracted
and coordinated through a single &#8220;Server SDN Controller&#8221;, in this
instance OpenDaylight. This allows applications written for
Ryu/Floodlight/Pyretic to execute on OpenDaylight managed
infrastructure.</p>
<p>The &#8220;Network Engine&#8221; is modular by design:</p>
<ul class="simple">
<li>An OpenDaylight plugin, &#8220;shim&#8221;, sends/receives messages to/from
subscribed SDN Client Controllers. This consumes the ODL OpenFlow
Plugin</li>
<li>An initial suite of SDN Client Controller &#8220;Backends&#8221;: Floodlight,
Ryu, Pyretic. Further controllers may be added over time as the
engine is extensible.</li>
</ul>
<p>The Network Engine provides a compatibility layer capable of translating
calls of the network applications running on top of the client
controllers, into calls for the server controller framework. The
communication between the client and the server layers is achieved
through the NetIDE intermediate protocol, which is an application-layer
protocol on top of TCP that transmits the network control/management
messages from the client to the server controller and vice-versa.
Between client and server controller sits the Core Layer which also
&#8220;speaks&#8221; the intermediate protocol. The core layer implements three main
functions:</p>
<ol class="lowerroman simple">
<li>interfacing with the client backends and server shim, controlling
the lifecycle of controllers as well as modules in them,</li>
<li>orchestrating the execution of individual modules (in one client
controller) or complete applications (possibly spread across
multiple client controllers),</li>
<li>interfacing with the tools.</li>
</ol>
<div class="figure" id="id115">
<img alt="NetIDE Network Engine Architecture" src="../_images/arch-engine.jpg" />
<p class="caption"><span class="caption-text">NetIDE Network Engine Architecture</span></p>
</div>
</div>
<div class="section" id="netide-intermediate-protocol">
<h3>NetIDE Intermediate Protocol<a class="headerlink" href="#netide-intermediate-protocol" title="Permalink to this headline">¶</a></h3>
<p>The Intermediate Protocol serves several needs, it has to:</p>
<ol class="lowerroman simple">
<li>carry control messages between core and shim/backend, e.g., to
start up/take down a particular module, providing unique
identifiers for modules,</li>
<li>carry event and action messages between shim, core, and backend,
properly demultiplexing such messages to the right module based on
identifiers,</li>
<li>encapsulate messages specific to a particular SBI protocol version
(e.g., OpenFlow 1.X, NETCONF, etc.) towards the client controllers
with proper information to recognize these messages as such.</li>
</ol>
<p>The NetIDE packages can be added as dependencies in Maven projects by
putting the following code in the <em>pom.xml</em> file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;dependency&gt;
    &lt;groupId&gt;org.opendaylight.netide&lt;/groupId&gt;
    &lt;artifactId&gt;api&lt;/artifactId&gt;
    &lt;version&gt;${NETIDE_VERSION}&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>
<p>The current stable version for NetIDE is <code class="docutils literal"><span class="pre">0.1.0-Beryllium</span></code>.</p>
<div class="section" id="protocol-specification">
<h4>Protocol specification<a class="headerlink" href="#protocol-specification" title="Permalink to this headline">¶</a></h4>
<p>Messages of the NetIDE protocol contain two basic elements: the NetIDE
header and the data (or payload). The NetIDE header, described below, is
placed before the payload and serves as the communication and control
link between the different components of the Network Engine. The payload
can contain management messages, used by the components of the Network
Engine to exchange relevant information, or control/configuration
messages (such as OpenFlow, NETCONF, etc.) crossing the Network Engine
generated by either network application modules or by the network
elements.</p>
<p>The NetIDE header is defined as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="mi">0</span>                   <span class="mi">1</span>                   <span class="mi">2</span>                   <span class="mi">3</span>
 <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>   <span class="n">netide_ver</span>  <span class="o">|</span>      <span class="nb">type</span>     <span class="o">|</span>             <span class="n">length</span>            <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                         <span class="n">xid</span>                                   <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                       <span class="n">module_id</span>                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+</span>                     <span class="n">datapath_id</span>                               <span class="o">+</span>
<span class="o">|</span>                                                               <span class="o">|</span>
<span class="o">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
</pre></div>
</div>
<p>where each tick mark represents one bit position. Alternatively, in a
C-style coding format, the NetIDE header can be represented with the
following structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">netide_header</span> <span class="p">{</span>
    <span class="n">uint8_t</span> <span class="n">netide_ver</span> <span class="p">;</span>
    <span class="n">uint8_t</span> <span class="nb">type</span> <span class="p">;</span>
    <span class="n">uint16_t</span> <span class="n">length</span> <span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">xid</span>
    <span class="n">uint32_t</span> <span class="n">module_id</span>
    <span class="n">uint64_t</span> <span class="n">datapath_id</span>
<span class="p">};</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">netide_ver</span></code> is the version of the NetIDE protocol (the current
version is v1.2, which is identified with value 0x03).</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">length</span></code> is the total length of the payload in bytes.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">type</span></code> contains a code that indicates the type of the message
according with the following values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">enum</span> <span class="nb">type</span> <span class="p">{</span>
    <span class="n">NETIDE_HELLO</span> <span class="o">=</span> <span class="mh">0x01</span> <span class="p">,</span>
    <span class="n">NETIDE_ERROR</span> <span class="o">=</span> <span class="mh">0x02</span> <span class="p">,</span>
    <span class="n">NETIDE_MGMT</span> <span class="o">=</span> <span class="mh">0x03</span> <span class="p">,</span>
    <span class="n">MODULE_ANNOUNCEMENT</span> <span class="o">=</span> <span class="mh">0x04</span> <span class="p">,</span>
    <span class="n">MODULE_ACKNOWLEDGE</span> <span class="o">=</span> <span class="mh">0x05</span> <span class="p">,</span>
    <span class="n">NETIDE_HEARTBEAT</span> <span class="o">=</span> <span class="mh">0x06</span> <span class="p">,</span>
    <span class="n">NETIDE_OPENFLOW</span> <span class="o">=</span> <span class="mh">0x11</span> <span class="p">,</span>
    <span class="n">NETIDE_NETCONF</span> <span class="o">=</span> <span class="mh">0x12</span> <span class="p">,</span>
    <span class="n">NETIDE_OPFLEX</span> <span class="o">=</span> <span class="mh">0x13</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">datapath_id</span></code> is a 64-bit field that uniquely identifies the
network elements.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">module_id</span></code> is a 32-bits field that uniquely identifies Backends
and application modules running on top of each client controller. The
composition mechanism in the core layer leverages on this field to
implement the correct execution flow of these modules.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">xid</span></code> is the transaction identifier associated to the each message.
Replies must use the same value to facilitate the pairing.</p>
</li>
</ul>
</div>
<div class="section" id="module-announcement">
<h4>Module announcement<a class="headerlink" href="#module-announcement" title="Permalink to this headline">¶</a></h4>
<p>The first operation performed by a Backend is registering itself and the
modules that it is running to the Core. This is done by using the
<code class="docutils literal"><span class="pre">MODULE_ANNOUNCEMENT</span></code> and <code class="docutils literal"><span class="pre">MODULE_ACKNOWLEDGE</span></code> message types. As a
result of this process, each Backend and application module can be
recognized by the Core through an identifier (the <code class="docutils literal"><span class="pre">module_id</span></code>) placed
in the NetIDE header. First, a Backend registers itself by using the
following schema: backend-&lt;platform name&gt;-&lt;pid&gt;.</p>
<p>For example,odule a Ryu Backend will register by using the following
name in the message backend-ryu-12345 where 12345 is the process ID of
the registering instance of the Ryu platform. The format of the message
is the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">NetIDE_message</span> <span class="p">{</span>
    <span class="n">netide_ver</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">MODULE_ANNOUNCEMENT</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot; backend -&lt; platform_name &gt;-&lt;pid &gt;&quot;</span><span class="p">)</span>
    <span class="n">xid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">module_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">datapath_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot; backend -&lt; platform_name &gt;-&lt;pid &gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The answer generated by the Core will include a <code class="docutils literal"><span class="pre">module_id</span></code> number and
the Backend name in the payload (the same indicated in the
<code class="docutils literal"><span class="pre">MODULE_ANNOUNCEMENT</span></code> message):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">NetIDE_message</span> <span class="p">{</span>
    <span class="n">netide_ver</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">MODULE_ACKNOWLEDGE</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot; backend -&lt; platform_name &gt;-&lt;pid &gt;&quot;</span><span class="p">)</span>
    <span class="n">xid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">module_id</span> <span class="o">=</span> <span class="n">MODULE_ID</span>
    <span class="n">datapath_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot; backend -&lt; platform_name &gt;-&lt;pid &gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once a Backend has successfully registered itself, it can start
registering its modules with the same procedure described above by
indicating the name of the module in the data (e.g. data=&#8221;Firewall&#8221;).
From this point on, the Backend will insert its own <code class="docutils literal"><span class="pre">module_id</span></code> in the
header of the messages it generates (e.g. heartbeat, hello messages,
OpenFlow echo messages from the client controllers, etc.). Otherwise, it
will encapsulate the control/configuration messages (e.g. FlowMod,
PacketOut, FeatureRequest, NETCONF request, etc.) generated by network
application modules with the specific +module_id+s.</p>
</div>
<div class="section" id="heartbeat">
<h4>Heartbeat<a class="headerlink" href="#heartbeat" title="Permalink to this headline">¶</a></h4>
<p>The heartbeat mechanism has been introduced after the adoption of the
ZeroMQ messaging queuing library to transmit the NetIDE messages.
Unfortunately, the ZeroMQ library does not offer any mechanism to find
out about disrupted connections (and also completely unresponsive
peers). This limitation of the ZeroMQ library can be an issue for the
Core’s composition mechanism and for the tools connected to the Network
Engine, as they cannot understand when an client controller disconnects
or crashes. As a consequence, Backends must periodically send (let’s say
every 5 seconds) a &#8220;heartbeat&#8221; message to the Core. If the Core does not
receive at least one &#8220;heartbeat&#8221; message from the Backend within a
certain timeframe, the Core considers it disconnected, removes all the
related data from its memory structures and informs the relevant tools.
The format of the message is the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">NetIDE_message</span> <span class="p">{</span>
    <span class="n">netide_ver</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">NETIDE_HEARTBEAT</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">xid</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">module_id</span> <span class="o">=</span> <span class="n">backend</span> <span class="o">-</span><span class="nb">id</span>
    <span class="n">datapath_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="handshake">
<h4>Handshake<a class="headerlink" href="#handshake" title="Permalink to this headline">¶</a></h4>
<p>Upon a successful connection with the Core, the client controller must
immediately send a hello message with the list of the control and/or
management protocols needed by the applications deployed on top of it.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">NetIDE_message</span> <span class="p">{</span>
    <span class="n">struct</span> <span class="n">netide_header</span> <span class="n">header</span> <span class="p">;</span>
    <span class="n">uint8</span> <span class="n">data</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The header contains the following values:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">netide</span> <span class="pre">ver=0x03</span></code></li>
<li><code class="docutils literal"><span class="pre">type=NETIDE_HELLO</span></code></li>
<li><code class="docutils literal"><span class="pre">length=2*NR_PROTOCOLS</span></code></li>
<li><code class="docutils literal"><span class="pre">data</span></code> contains one 2-byte word (in big endian order) for each
protocol, with the first byte containing the code of the protocol
according to the above enum, while the second byte in- dictates the
version of the protocol (e.g. according to the ONF specification,
0x01 for OpenFlow v1.0, 0x02 for OpenFlow v1.1, etc.). NETCONF
version is marked with 0x01 that refers to the specification in the
RFC6241, while OpFlex version is marked with 0x00 since this protocol
is still in work-in-progress stage.</li>
</ul>
<p>The Core relays hello messages to the server controller which responds
with another hello message containing the following:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">netide</span> <span class="pre">ver=0x03</span></code></li>
<li><code class="docutils literal"><span class="pre">type=NETIDE_HELLO</span></code></li>
<li><code class="docutils literal"><span class="pre">length=2*NR_PROTOCOLS</span></code></li>
</ul>
<p>If at least one of the protocols requested by the client is supported.
In particular, <code class="docutils literal"><span class="pre">data</span></code> contains the codes of the protocols that match
the client’s request (2-bytes words, big endian order). If the hand-
shake fails because none of the requested protocols is supported by the
server controller, the header of the answer is as follows:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">netide</span> <span class="pre">ver=0x03</span></code></li>
<li><code class="docutils literal"><span class="pre">type=NETIDE_ERROR</span></code></li>
<li><code class="docutils literal"><span class="pre">length=2*NR_PROTOCOLS</span></code></li>
<li><code class="docutils literal"><span class="pre">data</span></code> contains the codes of all the protocols supported by the
server controller (2-bytes words, big endian order). In this case,
the TCP session is terminated by the server controller just after the
answer is received by the client. `</li>
</ul>
</div>
</div>
</div>
<div class="section" id="neutron-northbound">
<h2>Neutron Northbound<a class="headerlink" href="#neutron-northbound" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-write-a-sb-neutron-consumer">
<h3>How to Write a SB Neutron Consumer<a class="headerlink" href="#how-to-write-a-sb-neutron-consumer" title="Permalink to this headline">¶</a></h3>
<p>In Lithium, there will be two options for SB Neutron Consumers:</p>
<ul class="simple">
<li>Using the legacy I*Aware interfaces</li>
<li>Listening for changes via the Neutron YANG model</li>
</ul>
</div>
<div class="section" id="how-to-use-the-legacy-i-aware-interfaces">
<h3>How to use the legacy I*Aware interfaces<a class="headerlink" href="#how-to-use-the-legacy-i-aware-interfaces" title="Permalink to this headline">¶</a></h3>
<p>For each neutron data object, there is an I*Aware interface defined to
allow southbound providers that don’t want to use the MD-SAL to register
with the Neutron service to be made aware of potential operations on
that type of object. For each modification operation (create, update and
delete), the I*Aware interface defines a pair of calls (The general
template is shown in the following table, please see javadoc of the
specific interface for specific details)</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Create</th>
<th class="head">Update</th>
<th class="head">Delete</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>canCreate*()</td>
<td>canUpdate*()</td>
<td>canDelete*()</td>
</tr>
<tr class="row-odd"><td>neutron*Created()</td>
<td>neutron*Updated()</td>
<td>neutron*Deleted()</td>
</tr>
</tbody>
</table>
<p>Table: I*Aware Methods</p>
<div class="section" id="the-semantics-of-the-can-methods">
<h4>The semantics of the can*() methods<a class="headerlink" href="#the-semantics-of-the-can-methods" title="Permalink to this headline">¶</a></h4>
<p>Each of the can*() methods gives a southbound provider a vote on
whether a proposed change is acceptable or not. A southbound provider
that implements a particular can*() method is expected to return an
HTTP response code as its &#8220;vote&#8221; - values between 200 and 299 are a
&#8220;yes&#8221; vote, other values are a &#8220;no&#8221; vote. The neutron white board
pattern is an all or nothing affair: if any one southbound provider
votes no on a change, that change is rejected.</p>
<p>For the canCreate*() method, the southbound provider recieves the
proposed object. In the case of canDelete*(), the southbound provider
recieves the current object that will be removed. Lastly, the
canUpdate*() method passed the current object and the proposed delta.</p>
</div>
<div class="section" id="the-semantics-of-the-neutron-methods">
<h4>The semantics of the neutron*() methods<a class="headerlink" href="#the-semantics-of-the-neutron-methods" title="Permalink to this headline">¶</a></h4>
<p>Once all southbound providers vote yes for a particular change, the
neutron service transcribes the change into its caches/MD-SAL models and
then calls the appropriate neutron*() method on each registered
southbound provider. At this point, the southbound provider is expected
to meet the request as best they can and when they can, taking
responsibility for any errors that might be incurred (there is no back
signalling of errors). For these calls, the modified object is provided
in all cases, except for the neutron*Deleted() method. This passes an
instance of the deleted object that will be garbage collected once all
the southbound providers are finished with it.</p>
</div>
<div class="section" id="how-to-register-your-consumer-with-the-neutron-service">
<h4>How to register your consumer with the Neutron Service<a class="headerlink" href="#how-to-register-your-consumer-with-the-neutron-service" title="Permalink to this headline">¶</a></h4>
<p>A southbound provider that wants to register with the neutron service
via a particular I*Aware interface must first implement that interface.
Then, in the init class of its Activator method, it should add the name
of the implemented I*Aware class as an interface that is managed, along
with the class that implements the interface as the implementation via
the setInterface method. The following example from the Neutron test
dummy provider shows it is registering for <strong>all</strong> I*Aware interfaces:</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">DependencyManager</span> <span class="n">manager</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronFirewallAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronFirewallDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronFirewallPolicyAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronFirewallPolicyDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronFirewallRuleAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronFirewallRuleDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronFloatingIPAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronFloatingIPDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronLoadBalancerAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronLoadBalancerDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronLoadBalancerHealthMonitorAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronLoadBalancerHealthMonitorDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronLoadBalancerListenerAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronLoadBalancerListenerDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronLoadBalancerPoolAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronLoadBalancerPoolDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronLoadBalancerPoolMemberAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronLoadBalancerPoolMemberDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronNetworkAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronNetworkDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronPortAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronPortDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronRouterAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronRouterDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronSecurityGroupAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronSecurityGroupDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronSecurityRuleAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronSecurityRuleDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
   <span class="n">manager</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">createComponent</span><span class="p">()</span><span class="o">.</span><span class="n">setInterface</span><span class="p">(</span><span class="n">new</span> <span class="n">String</span><span class="p">[]</span> <span class="p">{</span>
       <span class="n">INeutronSubnetAware</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">getName</span><span class="p">()},</span> <span class="n">null</span><span class="p">)</span>
       <span class="o">.</span><span class="n">setImplementation</span><span class="p">(</span><span class="n">NeutronSubnetDummyProvider</span><span class="o">.</span><span class="n">class</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="how-to-use-the-neutron-yang-model">
<h3>How to use the Neutron YANG model<a class="headerlink" href="#how-to-use-the-neutron-yang-model" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">For each neutron data object, there is an Neutron*Interface defined
within the transcriber artifact that will write that object to the
MD-SAL configurational datastore.</div>
<div class="line">All Neutron*Interface extend AbstractNeutronInterface, in which two
methods are defined:</div>
</div>
<ul>
<li><div class="first line-block">
<div class="line">one takes the neutron object as input, and will create a data
object from it.</div>
</div>
</li>
<li><p class="first">one takes an uuid as input, and will create a data object containing
the uuid.</p>
</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">abstract</span> <span class="n">T</span> <span class="n">toMd</span><span class="p">(</span><span class="n">S</span> <span class="n">neutronObject</span><span class="p">);</span>
<span class="n">protected</span> <span class="n">abstract</span> <span class="n">T</span> <span class="n">toMd</span><span class="p">(</span><span class="n">String</span> <span class="n">uuid</span><span class="p">);</span>
</pre></div>
</div>
<p>In addition the AbstractNeutronInterface class provides several other
helper methods (addMd, updateMd, removeMd), which handle the actual
writing to the configuration datastore.</p>
<div class="section" id="the-semantics-of-the-tomd-methods">
<h4>The semantics of the toMD() methods<a class="headerlink" href="#the-semantics-of-the-tomd-methods" title="Permalink to this headline">¶</a></h4>
<p>Each of the Neutron YANG models defines structures containing data.
Further each YANG-modeled structures has it own builder. A particular
toMD() method instantiates an instance of the correct builder, fills in
the properties of the builder from the corresponding values of the
Neutron object and then creates the YANG-modeled structures via the
build() method.</p>
<p>As an example, one of the toMD code for Neutron Networks is presented
below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">protected</span> <span class="n">Network</span> <span class="n">toMd</span><span class="p">(</span><span class="n">NeutronNetwork</span> <span class="n">network</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NetworkBuilder</span> <span class="n">networkBuilder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NetworkBuilder</span><span class="p">();</span>
    <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setAdminStateUp</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getAdminStateUp</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getNetworkName</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getNetworkName</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getShared</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setShared</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getShared</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setStatus</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getStatus</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getSubnets</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Uuid</span><span class="o">&gt;</span> <span class="n">subnets</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Uuid</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span> <span class="n">String</span> <span class="n">subnet</span> <span class="p">:</span> <span class="n">network</span><span class="o">.</span><span class="n">getSubnets</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">subnets</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">toUuid</span><span class="p">(</span><span class="n">subnet</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setSubnets</span><span class="p">(</span><span class="n">subnets</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getTenantID</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setTenantId</span><span class="p">(</span><span class="n">toUuid</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getTenantID</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getNetworkUUID</span><span class="p">()</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">networkBuilder</span><span class="o">.</span><span class="n">setUuid</span><span class="p">(</span><span class="n">toUuid</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">getNetworkUUID</span><span class="p">()));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Attempting to write neutron network without UUID&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">networkBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="odl-sdni-developer-guide">
<h2>ODL-SDNi Developer Guide<a class="headerlink" href="#odl-sdni-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id38">
<h3>Overview<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>This project aims at enabling inter-SDN controller communication by
developing SDNi (Software Defined Networking interface) as an
application (ODL-SDNi App).</p>
</div>
<div class="section" id="odl-sdni-architecture">
<h3>ODL-SDNi Architecture<a class="headerlink" href="#odl-sdni-architecture" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>SDNi Aggregator: Northbound SDNi plugin acts as an aggregator for
collecting network information such as topology, stats, host etc.
This plugin can be evolving as per needs of network data requested to
be shared across federated SDN controllers.</li>
<li>SDNi REST API: REST API view autogenerated and accessible through
RESTCONF to fetch the aggregated information from the northbound
plugin – SDNi aggregator.The RESTCONF protocol operates on a
conceptual datastore defined with the YANG data modeling language.</li>
<li>SDNi Wrapper: SDNi BGP Wrapper will be responsible for the sharing
and collecting information to/from federated controllers.</li>
</ul>
</div>
<div class="section" id="sdni-aggregator">
<h3>SDNi Aggregator<a class="headerlink" href="#sdni-aggregator" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>SDNiAggregator connects with the Base Network Service Functions of
the controller. Currently it is querying network topology through
md-sal for creating SDNi network capability.</li>
<li>SDNiAggregator is customized to retrieve the host controller’s
details, while running the controller in cluster mode. Rest of the
northbound APIs of controller will retrieve the entire topology
information of all the connected controllers.</li>
<li>The SDNiAggregator creates a topology structure.This structure is
populated by the various network funtions.</li>
</ul>
</div>
<div class="section" id="sdni-rest-api">
<h3>SDNi REST API<a class="headerlink" href="#sdni-rest-api" title="Permalink to this headline">¶</a></h3>
<p>ODL-SDNi REST API query SDNiAggregator to get the required information
through RESTCONF. Each request must start with URI /restconf</p>
<p><a class="reference external" href="http://${ipaddress}:8181/restconf/operations/opendaylight-sdni-topology-msg:getTopology">http://${ipaddress}:8181/restconf/operations/opendaylight-sdni-topology-msg:getTopology</a></p>
<p><strong>Topology Data:</strong> Controller IP Address, Links, Nodes, Link Bandwidths,
MAC Address of switches, Latency, Host IP address.</p>
<p><a class="reference external" href="http://${ipaddress}:8181/restconf/operations/opendaylight-sdni-qos-msg:get-all-node-connectors-statistics">http://${ipaddress}:8181/restconf/operations/opendaylight-sdni-qos-msg:get-all-node-connectors-statistics</a></p>
<p><strong>QOS Data:</strong> Node, Port, Transmit Packets, Receive Packets, Collision
Count, Receive Frame Error, Receive Over Run Error, Receive Crc Error</p>
</div>
<div class="section" id="sdni-wrapper">
<h3>SDNi Wrapper<a class="headerlink" href="#sdni-wrapper" title="Permalink to this headline">¶</a></h3>
<div class="figure" id="id116">
<img alt="SDNiWrapper" src="../_images/SDNiWrapper.png" />
<p class="caption"><span class="caption-text">SDNiWrapper</span></p>
</div>
<ul class="simple">
<li>SDNiWrapper is an extension of ODL-BGPCEP where SDNi topology data is
exchange along with the Update NLRI message. Refer
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-idr-ls-distribution-04">http://tools.ietf.org/html/draft-ietf-idr-ls-distribution-04</a> for more
information on NLRI.</li>
<li>SDNiWrapper gets the controller’s network capabilities through SDNi
REST API and serialize it in Update NLRI message. This NLRI message
will get exchange between the clustered controllers through
BGP-UPDATE message. Similarly peer controller’s UPDATE message is
received and unpacked then format to SDNi Network capability data,
which will be stored for further purpose.</li>
</ul>
</div>
<div class="section" id="id39">
<h3>API Reference Documentation<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>Go to
<a class="reference external" href="http://${ipaddress}:8181/apidoc/explorer/index.html">http://${ipaddress}:8181/apidoc/explorer/index.html</a>,
sign in, and expand the opendaylight-sdni panel. From there, users can
execute various API calls to test their sdni deployment.</p>
</div>
</div>
<div class="section" id="openflow-protocol-library-developer-guide">
<h2>OpenFlow Protocol Library Developer Guide<a class="headerlink" href="#openflow-protocol-library-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>OpenFlow Protocol Library is component in OpenDaylight, that mediates
communication between OpenDaylight controller and hardware devices
supporting OpenFlow protocol. Primary goal is to provide user (or upper
layers of OpenDaylight) communication channel, that can be used for
managing network hardware devices.</p>
</div>
<div class="section" id="features-overview">
<h3>Features Overview<a class="headerlink" href="#features-overview" title="Permalink to this headline">¶</a></h3>
<p>There are three features inside openflowjava:</p>
<ul class="simple">
<li><strong>odl-openflowjava-protocol</strong> provides all openflowjava bundles, that
are needed for communication with openflow devices. It ensures
message translation and handles network connections. It also provides
openflow protocol specific model.</li>
<li><strong>odl-openflowjava-all</strong> currently contains only
odl-openflowjava-protocol feature.</li>
<li><strong>odl-openflowjava-stats</strong> provides mechanism for message counting
and reporting. Can be used for performance analysis.</li>
</ul>
</div>
<div class="section" id="odl-openflowjava-protocol-architecture">
<h3>odl-openflowjava-protocol Architecture<a class="headerlink" href="#odl-openflowjava-protocol-architecture" title="Permalink to this headline">¶</a></h3>
<p>Basic bundles contained in this feature are openflow-protocol-api,
openflow-protocol-impl, openflow-protocol-spi and util.</p>
<ul class="simple">
<li><strong>openflow-protocol-api</strong> - contains openflow model, constants and
keys used for (de)serializer registration.</li>
<li><strong>openflow-protocol-impl</strong> - contains message factories, that
translate binary messages into DataObjects and vice versa. Bundle
also contains network connection handlers - servers, netty pipeline
handlers, …</li>
<li><strong>openflow-protocol-spi</strong> - entry point for openflowjava
configuration, startup and close. Basically starts implementation.</li>
<li><strong>util</strong> - utility classes for binary-Java conversions and to ease
experimenter key creation</li>
</ul>
</div>
<div class="section" id="odl-openflowjava-stats-feature">
<h3>odl-openflowjava-stats Feature<a class="headerlink" href="#odl-openflowjava-stats-feature" title="Permalink to this headline">¶</a></h3>
<p>Runs over odl-openflowjava-protocol. It counts various message types /
events and reports counts in specified time periods. Statistics
collection can be configured in
openflowjava-config/src/main/resources/45-openflowjava-stats.xml</p>
</div>
<div class="section" id="id40">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>Basic API / SPI classes are ConnectionAdapter (Rpc/notifications) and
SwitchConnectionProcider (configure, start, shutdown)</p>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Pull the code and import project into your IDE.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">ssh</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">username</span><span class="o">&gt;</span><span class="nd">@git</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">org</span><span class="p">:</span><span class="mi">29418</span><span class="o">/</span><span class="n">openflowjava</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="id41">
<h3>Configuration<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>Current implementation allows to configure:</p>
<ul class="simple">
<li>listening port (mandatory)</li>
<li>transfer protocol (mandatory)</li>
<li>switch idle timeout (mandatory)</li>
<li>TLS configuration (optional)</li>
<li>thread count (optional)</li>
</ul>
<p>You can find exemplary Openflow Protocol Library instance configuration
below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;data xmlns=&quot;urn:ietf:params:xml:ns:netconf:base:1.0&quot;&gt;
  &lt;modules xmlns=&quot;urn:opendaylight:params:xml:ns:yang:controller:config&quot;&gt;
    &lt;!-- default OF-switch-connection-provider (port 6633) --&gt;
    &lt;module&gt;
      &lt;type xmlns:prefix=&quot;urn:opendaylight:params:xml:ns:yang:openflow:switch:connection:provider:impl&quot;&gt;prefix:openflow-switch-connection-provider-impl&lt;/type&gt;
      &lt;name&gt;openflow-switch-connection-provider-default-impl&lt;/name&gt;
      &lt;port&gt;6633&lt;/port&gt;
&lt;!--  Possible transport-protocol options: TCP, TLS, UDP --&gt;
      &lt;transport-protocol&gt;TCP&lt;/transport-protocol&gt;
      &lt;switch-idle-timeout&gt;15000&lt;/switch-idle-timeout&gt;
&lt;!--       Exemplary TLS configuration:
            - uncomment the &lt;tls&gt; tag
            - copy exemplary-switch-privkey.pem, exemplary-switch-cert.pem and exemplary-cacert.pem
              files into your virtual machine
            - set VM encryption options to use copied keys
            - start communication
           Please visit OpenflowPlugin or Openflow Protocol Library#Documentation wiki pages
           for detailed information regarding TLS --&gt;
&lt;!--       &lt;tls&gt;
             &lt;keystore&gt;/exemplary-ctlKeystore&lt;/keystore&gt;
             &lt;keystore-type&gt;JKS&lt;/keystore-type&gt;
             &lt;keystore-path-type&gt;CLASSPATH&lt;/keystore-path-type&gt;
             &lt;keystore-password&gt;opendaylight&lt;/keystore-password&gt;
             &lt;truststore&gt;/exemplary-ctlTrustStore&lt;/truststore&gt;
             &lt;truststore-type&gt;JKS&lt;/truststore-type&gt;
             &lt;truststore-path-type&gt;CLASSPATH&lt;/truststore-path-type&gt;
             &lt;truststore-password&gt;opendaylight&lt;/truststore-password&gt;
             &lt;certificate-password&gt;opendaylight&lt;/certificate-password&gt;
           &lt;/tls&gt; --&gt;
&lt;!--       Exemplary thread model configuration. Uncomment &lt;threads&gt; tag below to adjust default thread model --&gt;
&lt;!--       &lt;threads&gt;
             &lt;boss-threads&gt;2&lt;/boss-threads&gt;
             &lt;worker-threads&gt;8&lt;/worker-threads&gt;
           &lt;/threads&gt; --&gt;
    &lt;/module&gt;
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>    &lt;!-- default OF-switch-connection-provider (port 6653) --&gt;
    &lt;module&gt;
      &lt;type xmlns:prefix=&quot;urn:opendaylight:params:xml:ns:yang:openflow:switch:connection:provider:impl&quot;&gt;prefix:openflow-switch-connection-provider-impl&lt;/type&gt;
      &lt;name&gt;openflow-switch-connection-provider-legacy-impl&lt;/name&gt;
      &lt;port&gt;6653&lt;/port&gt;
&lt;!--  Possible transport-protocol options: TCP, TLS, UDP --&gt;
      &lt;transport-protocol&gt;TCP&lt;/transport-protocol&gt;
      &lt;switch-idle-timeout&gt;15000&lt;/switch-idle-timeout&gt;
&lt;!--       Exemplary TLS configuration:
            - uncomment the &lt;tls&gt; tag
            - copy exemplary-switch-privkey.pem, exemplary-switch-cert.pem and exemplary-cacert.pem
              files into your virtual machine
            - set VM encryption options to use copied keys
            - start communication
           Please visit OpenflowPlugin or Openflow Protocol Library#Documentation wiki pages
           for detailed information regarding TLS --&gt;
&lt;!--       &lt;tls&gt;
             &lt;keystore&gt;/exemplary-ctlKeystore&lt;/keystore&gt;
             &lt;keystore-type&gt;JKS&lt;/keystore-type&gt;
             &lt;keystore-path-type&gt;CLASSPATH&lt;/keystore-path-type&gt;
             &lt;keystore-password&gt;opendaylight&lt;/keystore-password&gt;
             &lt;truststore&gt;/exemplary-ctlTrustStore&lt;/truststore&gt;
             &lt;truststore-type&gt;JKS&lt;/truststore-type&gt;
             &lt;truststore-path-type&gt;CLASSPATH&lt;/truststore-path-type&gt;
             &lt;truststore-password&gt;opendaylight&lt;/truststore-password&gt;
             &lt;certificate-password&gt;opendaylight&lt;/certificate-password&gt;
           &lt;/tls&gt; --&gt;
&lt;!--       Exemplary thread model configuration. Uncomment &lt;threads&gt; tag below to adjust default thread model --&gt;
&lt;!--       &lt;threads&gt;
             &lt;boss-threads&gt;2&lt;/boss-threads&gt;
             &lt;worker-threads&gt;8&lt;/worker-threads&gt;
           &lt;/threads&gt; --&gt;
    &lt;/module&gt;
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>  <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:openflow:common:config:impl&quot;</span><span class="o">&gt;</span><span class="n">prefix</span><span class="p">:</span><span class="n">openflow</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">openflow</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ofSwitch</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:openflow:switch:connection:provider&quot;</span><span class="o">&gt;</span><span class="n">ofSwitch</span><span class="p">:</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">default</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">ofSwitch</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:openflow:switch:connection:provider&quot;</span><span class="o">&gt;</span><span class="n">ofSwitch</span><span class="p">:</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">-</span><span class="n">legacy</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">openflow</span><span class="o">-</span><span class="n">switch</span><span class="o">-</span><span class="n">connection</span><span class="o">-</span><span class="n">provider</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">binding</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">broker</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">binding</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:md:sal:binding&quot;</span><span class="o">&gt;</span><span class="n">binding</span><span class="p">:</span><span class="n">binding</span><span class="o">-</span><span class="n">broker</span><span class="o">-</span><span class="n">osgi</span><span class="o">-</span><span class="n">registry</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">binding</span><span class="o">-</span><span class="n">osgi</span><span class="o">-</span><span class="n">broker</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">binding</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">broker</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">modules</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Possible transport-protocol options:</p>
<ul class="simple">
<li>TCP</li>
<li>TLS</li>
<li>UDP</li>
</ul>
<p>Switch-idle timeout specifies time needed to detect idle state of
switch. When no message is received from switch within this time, upper
layers are notified on switch idleness. To be able to use this exemplary
TLS configuration:</p>
<ul class="simple">
<li>uncomment the <code class="docutils literal"><span class="pre">&lt;tls&gt;</span></code> tag</li>
<li>copy <em>exemplary-switch-privkey.pem</em>, <em>exemplary-switch-cert.pem</em> and
<em>exemplary-cacert.pem</em> files into your virtual machine</li>
<li>set VM encryption options to use copied keys (please visit TLS
support wiki page for detailed information regarding TLS)</li>
<li>start communication</li>
</ul>
<p>Thread model configuration specifies how many threads are desired to
perform Netty’s I/O operations.</p>
<ul class="simple">
<li>boss-threads specifies the number of threads that register incoming
connections</li>
<li>worker-threads specifies the number of threads performing read /
write (+ serialization / deserialization) operations.</li>
</ul>
</div>
<div class="section" id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<div class="section" id="public-api-openflow-protocol-api">
<h4>Public API <code class="docutils literal"><span class="pre">(openflow-protocol-api)</span></code><a class="headerlink" href="#public-api-openflow-protocol-api" title="Permalink to this headline">¶</a></h4>
<p>Set of interfaces and builders for immutable data transfer objects
representing Openflow Protocol structures.</p>
<p>Transfer objects and service APIs are infered from several YANG models
using code generator to reduce verbosity of definition and repeatibility
of code.</p>
<p>The following YANG modules are defined:</p>
<ul class="simple">
<li>openflow-types - defines common Openflow specific types</li>
<li>openflow-instruction - defines base Openflow instructions</li>
<li>openflow-action - defines base Openflow actions</li>
<li>openflow-augments - defines object augmentations</li>
<li>openflow-extensible-match - defines Openflow OXM match</li>
<li>openflow-protocol - defines Openflow Protocol messages</li>
<li>system-notifications - defines system notification objects</li>
<li>openflow-configuration - defines structures used in ConfigSubsystem</li>
</ul>
<p>This modules also reuse types from following YANG modules:</p>
<ul class="simple">
<li>ietf-inet-types - IP adresses, IP prefixes, IP-protocol related types</li>
<li>ietf-yang-types - Mac Address, etc.</li>
</ul>
<p>The use of predefined types is to make APIs contracts more safe, better
readable and documented (e.g using MacAddress instead of byte array…)</p>
</div>
<div class="section" id="tcp-channel-pipeline-openflow-protocol-impl">
<h4>TCP Channel pipeline <code class="docutils literal"><span class="pre">(openflow-protocol-impl)</span></code><a class="headerlink" href="#tcp-channel-pipeline-openflow-protocol-impl" title="Permalink to this headline">¶</a></h4>
<p>Creates channel processing pipeline based on configuration and support.</p>
<p><strong>TCP Channel pipeline.</strong></p>
<p>imageopenflowjava/500px-TCPChannelPipeline.png[width=500]</p>
<p><strong>Switch Connection Provider.</strong></p>
<p>Implementation of connection point for other projects. Library exposes
its functionality through this class. Library can be configured, started
and shutdowned here. There are also methods for custom (de)serializer
registration.</p>
<p><strong>Tcp Connection Initializer.</strong></p>
<p>In order to initialize TCP connection to a device (switch), OF Plugin
calls method <code class="docutils literal"><span class="pre">initiateConnection()</span></code> in <code class="docutils literal"><span class="pre">SwitchConnectionProvider</span></code>.
This method in turn initializes (Bootstrap) server side channel towards
the device.</p>
<p><strong>TCP Handler.</strong></p>
<p>Represents single server that is handling incoming connections over TCP
/ TLS protocol. TCP Handler creates a single instance of TCP Channel
Initializer that will initialize channels. After that it binds to
configured InetAddress and port. When a new device connects, TCP Handler
registers its channel and passes control to TCP Channel Initializer.</p>
<p><strong>TCP Channel Initializer.</strong></p>
<p>This class is used for channel initialization / rejection and passing
arguments. After a new channel has been registered it calls Switch
Connection Handler’s (OF Plugin) accept method to decide if the library
should keep the newly registered channel or if the channel should be
closed. If the channel has been accepted, TCP Channel Initializer
creates the whole pipeline with needed handlers and also with
ConnectionAdapter instance. After the channel pipeline is ready, Switch
Connection Handler is notified with <code class="docutils literal"><span class="pre">onConnectionReady</span></code> notification.
OpenFlow Plugin can now start sending messages downstream.</p>
<p><strong>Idle Handler.</strong></p>
<p>If there are no messages received for more than time specified, this
handler triggers idle state notification. The switch idle timeout is
received as a parameter from ConnectionConfiguration settings. Idle
State Handler is inactive while there are messages received within the
switch idle timeout. If there are no messages received for more than
timeout specified, handler creates SwitchIdleEvent message and sends it
upstream.</p>
<p><strong>TLS Handler.</strong></p>
<p>It encrypts and decrypts messages over TLS protocol. Engaging TLS
Handler into pipeline is matter of configuration (<code class="docutils literal"><span class="pre">&lt;tls&gt;</span></code> tag). TLS
communication is either unsupported or required. TLS Handler is
represented as a Netty’s SslHandler.</p>
<p><strong>OF Frame Decoder.</strong></p>
<p>Parses input stream into correct length message frames for further
processing. Framing is based on Openflow header length. If received
message is shorter than minimal length of OpenFlow message (8 bytes), OF
Frame Decoder waits for more data. After receiving at least 8 bytes the
decoder checks length in OpenFlow header. If there are still some bytes
missing, the decoder waits for them. Else the OF Frame Decoder sends
correct length message to next handler in the channel pipeline.</p>
<p><strong>OF Version Detector.</strong></p>
<p>Detects version of used OpenFlow Protocol and discards unsupported
version messages. If the detected version is supported, OF Version
Detector creates <code class="docutils literal"><span class="pre">VersionMessageWrapper</span></code> object containing the
detected version and byte message and sends this object upstream.</p>
<p><strong>OF Decoder.</strong></p>
<p>Chooses correct deserilization factory (based on message type) and
deserializes messages into generated DTOs (Data Transfer Object). OF
Decoder receives <code class="docutils literal"><span class="pre">VersionMessageWrapper</span></code> object and passes it to
<code class="docutils literal"><span class="pre">DeserializationFactory</span></code> which will return translated DTO.
<code class="docutils literal"><span class="pre">DeserializationFactory</span></code> creates <code class="docutils literal"><span class="pre">MessageCodeKey</span></code> object with
version and type of received message and Class of object that will be
the received message deserialized into. This object is used as key when
searching for appropriate decoder in <code class="docutils literal"><span class="pre">DecoderTable</span></code>. <code class="docutils literal"><span class="pre">DecoderTable</span></code>
is basically a map storing decoders. Found decoder translates received
message into DTO. If there was no decoder found, null is returned. After
returning translated DTO back to OF Decoder, the decoder checks if it is
null or not. When the DTO is null, the decoder logs this state and
throws an Exception. Else it passes the DTO further upstream. Finally,
the OF Decoder releases ByteBuf containing received and decoded byte
message.</p>
<p><strong>OF Encoder.</strong></p>
<p>Chooses correct serialization factory (based on type of DTO) and
serializes DTOs into byte messages. OF Encoder does the opposite than
the OF Decoder using the same principle. OF Encoder receives DTO, passes
it for translation and if the result is not null, it sends translated
DTO downstream as a ByteBuf. Searching for appropriate encoder is done
via MessageTypeKey, based on version and class of received DTO.</p>
<p><strong>Delegating Inbound Handler.</strong></p>
<p>Delegates received DTOs to Connection Adapter. It also reacts on
channelInactive and channelUnregistered events. Upon one of these events
is triggered, DelegatingInboundHandler creates DisconnectEvent message
and sends it upstream, notifying upper layers about switch
disconnection.</p>
<p><strong>Channel Outbound Queue.</strong></p>
<p>Message flushing handler. Stores outgoing messages (DTOs) and flushes
them. Flush is performed based on time expired and on the number of
messages enqueued.</p>
<p><strong>Connection Adapter.</strong></p>
<p>Provides a facade on top of pipeline, which hides netty.io specifics.
Provides a set of methods to register for incoming messages and to send
messages to particular channel / session. ConnectionAdapterImpl
basically implements three interfaces (unified in one superinterface
ConnectionFacade):</p>
<ul class="simple">
<li>ConnectionAdapter</li>
<li>MessageConsumer</li>
<li>OpenflowProtocolService</li>
</ul>
<p><strong>ConnectionAdapter</strong> interface has methods for setting up listeners
(message, system and connection ready listener), method to check if all
listeners are set, checking if the channel is alive and disconnect
method. Disconnect method clears responseCache and disables consuming of
new messages.</p>
<p><strong>MessageConsumer</strong> interface holds only one method: <code class="docutils literal"><span class="pre">consume()</span></code>.
<code class="docutils literal"><span class="pre">Consume()</span></code> method is called from DelegatingInboundHandler. This
method processes received DTO’s based on their type. There are three
types of received objects:</p>
<ul class="simple">
<li>System notifications - invoke system notifications in OpenFlow Plugin
(systemListener set). In case of <code class="docutils literal"><span class="pre">DisconnectEvent</span></code> message, the
Connection Adapter clears response cache and disables consume()
method processing,</li>
<li>OpenFlow asynchronous messages (from switch) - invoke corresponding
notifications in OpenFlow Plugin,</li>
<li>OpenFlow symmetric messages (replies to requests) - create
<code class="docutils literal"><span class="pre">RpcResponseKey</span></code> with XID and DTO’s class set. This
<code class="docutils literal"><span class="pre">RpcResponseKey</span></code> is then used to find corresponding future object
in responseCache. Future object is set with success flag, received
message and errors (if any occurred). In case no corresponding future
was found in responseCache, Connection Adapter logs warning and
discards the message. Connection Adapter also logs warning when an
unknown DTO is received.</li>
</ul>
<p><strong>OpenflowProtocolService</strong> interface contains all rpc-methods for
sending messages from upper layers (OpenFlow Plugin) downstream and
responding. Request messages return Future filled with expected reply
message, otherwise the expected Future is of type Void.</p>
<p><strong>NOTE:</strong> MultipartRequest message is the only exception. Basically it
is request - reply Message type, but it wouldn’t be able to process more
following MultipartReply messages if this was implemented as rpc (only
one Future). This is why MultipartReply is implemented as notification.
OpenFlow Plugin takes care of correct message processing.</p>
</div>
<div class="section" id="udp-channel-pipeline-openflow-protocol-impl">
<h4>UDP Channel pipeline (openflow-protocol-impl)<a class="headerlink" href="#udp-channel-pipeline-openflow-protocol-impl" title="Permalink to this headline">¶</a></h4>
<p>Creates UDP channel processing pipeline based on configuration and
support. <strong>Switch Connection Provider</strong>, <strong>Channel Outbound Queue</strong> and
<strong>Connection Adapter</strong> fulfill the same role as in case of TCP
connection / channel pipeline (please see above).</p>
<div class="figure" id="id117">
<img alt="UDP Channel pipeline" src="../_images/500px-UdpChannelPipeline.png" />
<p class="caption"><span class="caption-text">UDP Channel pipeline</span></p>
</div>
<p><strong>UDP Handler.</strong></p>
<p>Represents single server that is handling incoming connections over UDP
(DTLS) protocol. UDP Handler creates a single instance of UDP Channel
Initializer that will initialize channels. After that it binds to
configured InetAddress and port. When a new device connects, UDP Handler
registers its channel and passes control to UDP Channel Initializer.</p>
<p><strong>UDP Channel Initializer.</strong></p>
<p>This class is used for channel initialization and passing arguments.
After a new channel has been registered (for UDP there is always only
one channel) UDP Channel Initializer creates whole pipeline with needed
handlers.</p>
<p><strong>DTLS Handler.</strong></p>
<p>Haven’t been implemented yet. Will take care of secure DTLS connections.</p>
<p><strong>OF Datagram Packet Handler.</strong></p>
<p>Combines functionality of OF Frame Decoder and OF Version Detector.
Extracts messages from received datagram packets and checks if message
version is supported. If there is a message received from yet unknown
sender, OF Datagram Packet Handler creates Connection Adapter for this
sender and stores it under sender’s address in <code class="docutils literal"><span class="pre">UdpConnectionMap</span></code>.
This map is also used for sending the messages and for correct
Connection Adapter lookup - to delegate messages from one channel to
multiple sessions.</p>
<p><strong>OF Datagram Packet Decoder.</strong></p>
<p>Chooses correct deserilization factory (based on message type) and
deserializes messages into generated DTOs. OF Decoder receives
<code class="docutils literal"><span class="pre">VersionMessageUdpWrapper</span></code> object and passes it to
<code class="docutils literal"><span class="pre">DeserializationFactory</span></code> which will return translated DTO.
<code class="docutils literal"><span class="pre">DeserializationFactory</span></code> creates <code class="docutils literal"><span class="pre">MessageCodeKey</span></code> object with
version and type of received message and Class of object that will be
the received message deserialized into. This object is used as key when
searching for appropriate decoder in <code class="docutils literal"><span class="pre">DecoderTable</span></code>. <code class="docutils literal"><span class="pre">DecoderTable</span></code>
is basically a map storing decoders. Found decoder translates received
message into DTO (DataTransferObject). If there was no decoder found,
null is returned. After returning translated DTO back to OF Datagram
Packet Decoder, the decoder checks if it is null or not. When the DTO is
null, the decoder logs this state. Else it looks up appropriate
Connection Adapter in <code class="docutils literal"><span class="pre">UdpConnectionMap</span></code> and passes the DTO to found
Connection Adapter. Finally, the OF Decoder releases <code class="docutils literal"><span class="pre">ByteBuf</span></code>
containing received and decoded byte message.</p>
<p><strong>OF Datagram Packet Encoder.</strong></p>
<p>Chooses correct serialization factory (based on type of DTO) and
serializes DTOs into byte messages. OF Datagram Packet Encoder does the
opposite than the OF Datagram Packet Decoder using the same principle.
OF Encoder receives DTO, passes it for translation and if the result is
not null, it sends translated DTO downstream as a datagram packet.
Searching for appropriate encoder is done via MessageTypeKey, based on
version and class of received DTO.</p>
</div>
<div class="section" id="spi-openflow-protocol-spi">
<h4>SPI (openflow-protocol-spi)<a class="headerlink" href="#spi-openflow-protocol-spi" title="Permalink to this headline">¶</a></h4>
<p>Defines interface for library’s connection point for other projects.
Library exposes its functionality through this interface.</p>
</div>
<div class="section" id="integration-test-openflow-protocol-it">
<h4>Integration test (openflow-protocol-it)<a class="headerlink" href="#integration-test-openflow-protocol-it" title="Permalink to this headline">¶</a></h4>
<p>Testing communication with simple client.</p>
</div>
<div class="section" id="simple-client-simple-client">
<h4>Simple client(simple-client)<a class="headerlink" href="#simple-client-simple-client" title="Permalink to this headline">¶</a></h4>
<p>Lightweight switch simulator - programmable with desired scenarios.</p>
</div>
<div class="section" id="utility-util">
<h4>Utility (util)<a class="headerlink" href="#utility-util" title="Permalink to this headline">¶</a></h4>
<p>Contains utility classes, mainly for work with ByteBuf.</p>
</div>
</div>
<div class="section" id="librarys-lifecycle">
<h3>Library’s lifecycle<a class="headerlink" href="#librarys-lifecycle" title="Permalink to this headline">¶</a></h3>
<p>Steps (after the library’s bundle is started):</p>
<ul class="simple">
<li>[1] Library is configured by ConfigSubsystem (adress, ports,
encryption, …)</li>
<li>[2] Plugin injects its SwitchConnectionHandler into the Library</li>
<li>[3] Plugin starts the Library</li>
<li>[4] Library creates configured protocol handler (e.g. TCP Handler)</li>
<li>[5] Protocol Handler creates Channel Initializer</li>
<li>[6] Channel Initializer asks plugin whether to accept incoming
connection on each new switch connection</li>
<li>[7] Plugin responds:<ul>
<li>true - continue building pipeline</li>
<li>false - reject connection / disconnect channel</li>
</ul>
</li>
<li>[8] Library notifies Plugin with onSwitchConnected(ConnectionAdapter)
notification, passing reference to ConnectionAdapter, that will
handle the connection</li>
<li>[9] Plugin registers its system and message listeners</li>
<li>[10] FireConnectionReadyNotification() is triggered, announcing that
pipeline handlers needed for communication have been created and
Plugin can start communication</li>
<li>[11] Plugin shutdowns the Library when desired</li>
</ul>
<div class="figure" id="id118">
<img alt="Library lifecycle" src="../_images/Library_lifecycle.png" />
<p class="caption"><span class="caption-text">Library lifecycle</span></p>
</div>
</div>
<div class="section" id="statistics-collection">
<h3>Statistics collection<a class="headerlink" href="#statistics-collection" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id42">
<h4>Introduction<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<p>Statistics collection collects message statistics. Current collected
statistics (<code class="docutils literal"><span class="pre">DS</span></code> - downstream, <code class="docutils literal"><span class="pre">US</span></code> - upstream):</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">DS_ENTERED_OFJAVA</span></code> - all messages that entered openflowjava
(picked up from openflowplugin)</li>
<li><code class="docutils literal"><span class="pre">DS_ENCODE_SUCCESS</span></code> - successfully encoded messages</li>
<li><code class="docutils literal"><span class="pre">DS_ENCODE_FAIL</span></code> - messages that failed during encoding
(serialization) process</li>
<li><code class="docutils literal"><span class="pre">DS_FLOW_MODS_ENTERED</span></code> - all flow-mod messages that entered
openflowjava</li>
<li><code class="docutils literal"><span class="pre">DS_FLOW_MODS_SENT</span></code> - all flow-mod messages that were successfully
sent</li>
<li><code class="docutils literal"><span class="pre">US_RECEIVED_IN_OFJAVA</span></code> - messages received from switch</li>
<li><code class="docutils literal"><span class="pre">US_DECODE_SUCCESS</span></code> - successfully decoded messages</li>
<li><code class="docutils literal"><span class="pre">US_DECODE_FAIL</span></code> - messages that failed during decoding
(deserialization) process</li>
<li><code class="docutils literal"><span class="pre">US_MESSAGE_PASS</span></code> - messages handed over to openflowplugin</li>
</ul>
</div>
<div class="section" id="karaf">
<h4>Karaf<a class="headerlink" href="#karaf" title="Permalink to this headline">¶</a></h4>
<p>In orded to start statistics, it is needed to feature:install
odl-openflowjava-stats. To see the logs one should use log:set DEBUG
org.opendaylight.openflowjava.statistics and than probably log:display
(you can log:list to see if the logging has been set). To adjust
collection settings it is enough to modify 45-openflowjava-stats.xml.</p>
</div>
<div class="section" id="jconsole">
<h4>JConsole<a class="headerlink" href="#jconsole" title="Permalink to this headline">¶</a></h4>
<p>JConsole provides two commands for the statistics collection:</p>
<ul class="simple">
<li>printing current statistics</li>
<li>resetting statistic counters</li>
</ul>
<p>After attaching JConsole to correct process, one only needs to go into
MBeans
<code class="docutils literal"><span class="pre">tab</span> <span class="pre">→</span> <span class="pre">org.opendaylight.controller</span> <span class="pre">→</span> <span class="pre">RuntimeBean</span> <span class="pre">→</span> <span class="pre">statistics-collection-service-impl</span>
<span class="pre">→</span> <span class="pre">statistics-collection-service-impl</span> <span class="pre">→</span> <span class="pre">Operations</span></code> to be able to use
this commands.</p>
</div>
</div>
<div class="section" id="tls-support">
<h3>TLS Support<a class="headerlink" href="#tls-support" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p><strong>Note</strong></p>
<p>see OpenFlow Plugin Developper Guide</p>
</div></blockquote>
</div>
<div class="section" id="extensibility">
<h3>Extensibility<a class="headerlink" href="#extensibility" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id43">
<h4>Introduction<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p>Entry point for the extensibility is <code class="docutils literal"><span class="pre">SwitchConnectionProvider</span></code>.
<code class="docutils literal"><span class="pre">SwitchConnectionProvider</span></code> contains methods for (de)serializer
registration. To register deserializer it is needed to use
.register*Deserializer(key, impl). To register serializer one must use
.register*Serializer(key, impl). Registration can occur either during
configuration or at runtime.</p>
<p><strong>NOTE</strong>: In case when experimenter message is received and no
(de)serializer was registered, the library will throw
<code class="docutils literal"><span class="pre">IllegalArgumentException</span></code>.</p>
</div>
<div class="section" id="basic-principle">
<h4>Basic Principle<a class="headerlink" href="#basic-principle" title="Permalink to this headline">¶</a></h4>
<p>In order to use extensions it is needed to augment existing model and
register new (de)serializers.</p>
<p>Augmenting the model: 1. Create new augmentation</p>
<p>Register (de)serializers: 1. Create your (de)serializer 2. Let it
implement <code class="docutils literal"><span class="pre">OFDeserializer&lt;&gt;</span></code> / <code class="docutils literal"><span class="pre">OFSerializer&lt;&gt;</span></code> - in case the
structure you are (de)serializing needs to be used in Multipart
TableFeatures messages, let it implement <code class="docutils literal"><span class="pre">HeaderDeserializer&lt;&gt;</span></code> /
<code class="docutils literal"><span class="pre">HeaderSerializer</span></code> 3. Implement prescribed methods 4. Register your
deserializer under appropriate key (in our case
<code class="docutils literal"><span class="pre">ExperimenterActionDeserializerKey</span></code>) 5. Register your serializer under
appropriate key (in our case <code class="docutils literal"><span class="pre">ExperimenterActionSerializerKey</span></code>) 6.
Done, test your implementation</p>
<p><strong>NOTE</strong>: If you don’t know what key should be used with your
(de)serializer implementation, please visit <a class="reference external" href="#registration_keys">Registration
keys</a> page.</p>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Let’s say we have vendor / experimenter action represented by this
structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">foo_action</span> <span class="p">{</span>
    <span class="n">uint16_t</span> <span class="nb">type</span><span class="p">;</span>
    <span class="n">uint16_t</span> <span class="n">length</span><span class="p">;</span>
    <span class="n">uint32_t</span> <span class="n">experimenter</span><span class="p">;</span>
    <span class="n">uint16_t</span> <span class="n">first</span><span class="p">;</span>
    <span class="n">uint16_t</span> <span class="n">second</span><span class="p">;</span>
    <span class="n">uint8_t</span>  <span class="n">pad</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First, we have to augment existing model. We create new module, which
imports &#8220;<code class="docutils literal"><span class="pre">openflow-types.yang</span></code>&#8221; (don’t forget to update your
<code class="docutils literal"><span class="pre">pom.xml</span></code> with api dependency). Now we create foo action identity:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openflow</span><span class="o">-</span><span class="n">types</span> <span class="p">{</span><span class="n">prefix</span> <span class="n">oft</span><span class="p">;}</span>
<span class="n">identity</span> <span class="n">foo</span> <span class="p">{</span>
    <span class="n">description</span> <span class="s2">&quot;Foo action description&quot;</span><span class="p">;</span>
    <span class="n">base</span> <span class="n">oft</span><span class="p">:</span><span class="n">action</span><span class="o">-</span><span class="n">base</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will be used as type in our structure. Now we must augment existing
action structure, so that we will have the desired fields first and
second. In order to create new augmentation, our module has to import
&#8220;<code class="docutils literal"><span class="pre">openflow-action.yang</span></code>&#8221;. The augment should look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openflow</span><span class="o">-</span><span class="n">action</span> <span class="p">{</span><span class="n">prefix</span> <span class="n">ofaction</span><span class="p">;}</span>
<span class="n">augment</span> <span class="s2">&quot;/ofaction:actions-container/ofaction:action&quot;</span> <span class="p">{</span>
    <span class="n">ext</span><span class="p">:</span><span class="n">augment</span><span class="o">-</span><span class="n">identifier</span> <span class="s2">&quot;foo-action&quot;</span><span class="p">;</span>
        <span class="n">leaf</span> <span class="n">first</span> <span class="p">{</span>
            <span class="nb">type</span> <span class="n">uint16</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">leaf</span> <span class="n">second</span> <span class="p">{</span>
            <span class="nb">type</span> <span class="n">uint16</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>We are finished with model changes. Run mvn clean compile to generate
sources. After generation is done, we need to implement our
(de)serializer.</p>
<p>Deserializer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">FooActionDeserializer</span> <span class="n">extends</span> <span class="n">OFDeserializer</span><span class="o">&lt;</span><span class="n">Action</span><span class="o">&gt;</span> <span class="p">{</span>
   <span class="nd">@Override</span>
   <span class="n">public</span> <span class="n">Action</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">ByteBuf</span> <span class="nb">input</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">ActionBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ActionBuilder</span><span class="p">();</span>
       <span class="nb">input</span><span class="o">.</span><span class="n">skipBytes</span><span class="p">(</span><span class="n">SIZE_OF_SHORT_IN_BYTES</span><span class="p">);</span> <span class="o">*//</span> <span class="n">we</span> <span class="n">know</span> <span class="n">the</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">action</span><span class="o">*</span>
       <span class="n">builder</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
       <span class="nb">input</span><span class="o">.</span><span class="n">skipBytes</span><span class="p">(</span><span class="n">SIZE_OF_SHORT_IN_BYTES</span><span class="p">);</span> <span class="o">*//</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t need length*</span>
       <span class="o">*//</span> <span class="n">now</span> <span class="n">create</span> <span class="n">experimenterIdAugmentation</span> <span class="o">-</span> <span class="n">so</span> <span class="n">that</span> <span class="n">openflowplugin</span> <span class="n">can</span>
       <span class="n">differentiate</span> <span class="n">correct</span> <span class="n">vendor</span> <span class="n">codec</span><span class="o">*</span>
       <span class="n">ExperimenterIdActionBuilder</span> <span class="n">expIdBuilder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ExperimenterIdActionBuilder</span><span class="p">();</span>
       <span class="n">expIdBuilder</span><span class="o">.</span><span class="n">setExperimenter</span><span class="p">(</span><span class="n">new</span> <span class="n">ExperimenterId</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">readUnsignedInt</span><span class="p">()));</span>
       <span class="n">builder</span><span class="o">.</span><span class="n">addAugmentation</span><span class="p">(</span><span class="n">ExperimenterIdAction</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">expIdBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">());</span>
       <span class="n">FooActionBuilder</span> <span class="n">fooBuilder</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FooActionBuilder</span><span class="p">();</span>
       <span class="n">fooBuilder</span><span class="o">.</span><span class="n">setFirst</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">readUnsignedShort</span><span class="p">());</span>
       <span class="n">fooBuilder</span><span class="o">.</span><span class="n">setSecond</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">readUnsignedShort</span><span class="p">());</span>
       <span class="n">builder</span><span class="o">.</span><span class="n">addAugmentation</span><span class="p">(</span><span class="n">FooAction</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">fooBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">());</span>
       <span class="nb">input</span><span class="o">.</span><span class="n">skipBytes</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="o">*//</span> <span class="n">padding</span><span class="o">*</span>
       <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Serializer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">FooActionSerializer</span> <span class="n">extends</span> <span class="n">OFSerializer</span><span class="o">&lt;</span><span class="n">Action</span><span class="o">&gt;</span> <span class="p">{</span>
   <span class="nd">@Override</span>
   <span class="n">public</span> <span class="n">void</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">,</span> <span class="n">ByteBuf</span> <span class="n">outBuffer</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeShort</span><span class="p">(</span><span class="n">FOO_CODE</span><span class="p">);</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeShort</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
       <span class="o">*//</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t have to check for ExperimenterIdAction augmentation - our</span>
       <span class="n">serializer</span><span class="o">*</span>
       <span class="o">*//</span> <span class="n">was</span> <span class="n">called</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">vendor</span> <span class="o">/</span> <span class="n">experimenter</span> <span class="n">ID</span><span class="p">,</span> <span class="n">so</span> <span class="n">we</span> <span class="n">simply</span> <span class="n">write</span>
       <span class="n">it</span> <span class="n">to</span> <span class="n">buffer</span><span class="o">*</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeInt</span><span class="p">(</span><span class="n">VENDOR</span> <span class="o">/</span> <span class="n">EXPERIMENTER</span> <span class="n">ID</span><span class="p">);</span>
       <span class="n">FooAction</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">getAugmentation</span><span class="p">(</span><span class="n">FooAction</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeShort</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">getFirst</span><span class="p">());</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeShort</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">getSecond</span><span class="p">());</span>
       <span class="n">outBuffer</span><span class="o">.</span><span class="n">writeZero</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="o">//</span><span class="n">write</span> <span class="n">padding</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Register both deserializer and serializer:
<code class="docutils literal"><span class="pre">SwitchConnectionProvider.registerDeserializer(new</span>
<span class="pre">ExperimenterActionDeserializerKey(0x04,</span> <span class="pre">VENDOR</span> <span class="pre">/</span> <span class="pre">EXPERIMENTER</span> <span class="pre">ID),</span>
<span class="pre">new</span> <span class="pre">FooActionDeserializer());</span></code>
<code class="docutils literal"><span class="pre">SwitchConnectionProvider.registerSerializer(new</span>
<span class="pre">ExperimenterActionSerializerKey(0x04,</span> <span class="pre">VENDOR</span> <span class="pre">/</span> <span class="pre">EXPERIMENTER</span> <span class="pre">ID),</span>
<span class="pre">new</span> <span class="pre">FooActionSerializer());</span></code></p>
<p>We are ready to test our implementation.</p>
<p><strong>NOTE:</strong> Vendor / Experimenter structures define only vendor /
experimenter ID as common distinguisher (besides action type). Vendor /
Experimenter ID is unique for all vendor messages - that’s why vendor is
able to register only one class under
ExperimenterAction(De)SerializerKey. And that’s why vendor has to switch
/ choose between his subclasses / subtypes on his own.</p>
</div>
<div class="section" id="detailed-walkthrough-deserialization-extensibility">
<h4>Detailed walkthrough: Deserialization extensibility<a class="headerlink" href="#detailed-walkthrough-deserialization-extensibility" title="Permalink to this headline">¶</a></h4>
<p><strong>External interface &amp; class description.</strong></p>
<p><strong>OFGeneralDeserializer:</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">OFDeserializer&lt;E</span> <span class="pre">extends</span> <span class="pre">DataObject&gt;</span></code><ul>
<li><em>deserialize(ByteBuf)</em> - deserializes given ByteBuf</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">HeaderDeserializer&lt;E</span> <span class="pre">extends</span> <span class="pre">DataObject&gt;</span></code><ul>
<li><em>deserializeHeaders(ByteBuf)</em> - deserializes only E headers (used
in Multipart TableFeatures messages)</li>
</ul>
</li>
</ul>
<p><strong>DeserializerRegistryInjector</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">injectDeserializerRegistry(DeserializerRegistry)</span></code> - injects
deserializer registry into deserializer. Useful when custom
deserializer needs access to other deserializers.</li>
</ul>
<p><strong>NOTE:</strong> DeserializerRegistryInjector is not OFGeneralDeserializer
descendand. It is a standalone interface.</p>
<p><strong>MessageCodeKey and its descendants</strong> These keys are used as for
deserializer lookup in DeserializerRegistry. MessageCodeKey should is
used in general, while its descendants are used in more special cases.
For Example ActionDeserializerKey is used for Action deserializer lookup
and (de)registration. Vendor is provided with special keys, which
contain only the most necessary fields. These keys usually start with
&#8220;Experimenter&#8221; prefix (MatchEntryDeserializerKey is an exception).</p>
<p>MessageCodeKey has these fields:</p>
<ul class="simple">
<li>short version - Openflow wire version number</li>
<li>int value - value read from byte message</li>
<li>Class&lt;?&gt; clazz - class of object being creating</li>
<li>[1] The scenario starts in a custom bundle which wants to extend
library’s functionality. The custom bundle creates deserializers
which implement exposed <code class="docutils literal"><span class="pre">OFDeserializer</span></code> / <code class="docutils literal"><span class="pre">HeaderDeserializer</span></code>
interfaces (wrapped under <code class="docutils literal"><span class="pre">OFGeneralDeserializer</span></code> unifying super
interface).</li>
<li>[2] Created deserializers are paired with corresponding
ExperimenterKeys, which are used for deserializer lookup. If you
don’t know what key should be used with your (de)serializer
implementation, please visit <a class="reference external" href="#registration_keys">Registration
keys</a> page.</li>
<li>[3] Paired deserializers are passed to the OF Library via
<strong>SwitchConnectionProvider</strong>.<em>registerCustomDeserializer(key,
impl)</em>. Library registers the deserializer.<ul>
<li>While registering, Library checks if the deserializer is an
instance of <strong>DeserializerRegistryInjector</strong> interface. If yes,
the DeserializerRegistry (which stores all deserializer
references) is injected into the deserializer.</li>
</ul>
</li>
</ul>
<p>This is particularly useful when the deserializer needs access to other
deserializers. For example <code class="docutils literal"><span class="pre">IntructionsDeserializer</span></code> needs access to
<code class="docutils literal"><span class="pre">ActionsDeserializer</span></code> in order to be able to process
OFPIT_WRITE_ACTIONS/OFPIT_APPLY_ACTIONS instructions.</p>
<div class="figure" id="id119">
<img alt="Deserialization scenario walkthrough" src="../_images/800px-Extensibility.png" />
<p class="caption"><span class="caption-text">Deserialization scenario walkthrough</span></p>
</div>
</div>
<div class="section" id="detailed-walkthrough-serialization-extensibility">
<h4>Detailed walkthrough: Serialization extensibility<a class="headerlink" href="#detailed-walkthrough-serialization-extensibility" title="Permalink to this headline">¶</a></h4>
<p><strong>External interface &amp; class description.</strong></p>
<p><strong>OFGeneralSerializer:</strong></p>
<ul class="simple">
<li>OFSerializer&lt;E extends DataObject&gt;<ul>
<li><em>serialize(E,ByteBuf)</em> - serializes E into given ByteBuf</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">HeaderSerializer&lt;E</span> <span class="pre">extends</span> <span class="pre">DataObject&gt;</span></code><ul>
<li><em>serializeHeaders(E,ByteBuf)</em> - serializes E headers (used in
Multipart TableFeatures messages)</li>
</ul>
</li>
</ul>
<p><strong>SerializerRegistryInjector</strong> *
<code class="docutils literal"><span class="pre">injectSerializerRegistry(SerializerRegistry)</span></code> - injects serializer
registry into serializer. Useful when custom serializer needs access to
other serializers.</p>
<p><strong>NOTE:</strong> SerializerRegistryInjector is not OFGeneralSerializer
descendand.</p>
<p><strong>MessageTypeKey and its descendants</strong> These keys are used as for
serializer lookup in SerializerRegistry. MessageTypeKey should is used
in general, while its descendants are used in more special cases. For
Example ActionSerializerKey is used for Action serializer lookup and
(de)registration. Vendor is provided with special keys, which contain
only the most necessary fields. These keys usually start with
&#8220;Experimenter&#8221; prefix (MatchEntrySerializerKey is an exception).</p>
<p>MessageTypeKey has these fields:</p>
<ul class="simple">
<li><em>short version</em> - Openflow wire version number</li>
<li><em>Class&lt;E&gt; msgType</em> - DTO class</li>
</ul>
<p>Scenario walkthrough</p>
<ul class="simple">
<li>[1] Serialization extensbility principles are similar to the
deserialization principles. The scenario starts in a custom bundle.
The custom bundle creates serializers which implement exposed
OFSerializer / HeaderSerializer interfaces (wrapped under
OFGeneralSerializer unifying super interface).</li>
<li>[2] Created serializers are paired with their ExperimenterKeys, which
are used for serializer lookup. If you don’t know what key should be
used with your serializer implementation, please visit <a class="reference external" href="#registration_keys">Registration
keys</a> page.</li>
<li>[3] Paired serializers are passed to the OF Library via
<strong>SwitchConnectionProvider</strong>.<em>registerCustomSerializer(key, impl)</em>.
Library registers the serializer.</li>
<li>While registering, Library checks if the serializer is an instance of
<strong>SerializerRegistryInjector</strong> interface. If yes, the
SerializerRegistry (which stores all serializer references) is
injected into the serializer.</li>
</ul>
<p>This is particularly useful when the serializer needs access to other
deserializers. For example IntructionsSerializer needs access to
ActionsSerializer in order to be able to process
OFPIT_WRITE_ACTIONS/OFPIT_APPLY_ACTIONS instructions.</p>
<div class="figure" id="id120">
<img alt="Serialization scenario walkthrough" src="../_images/800px-Extensibility2.png" />
<p class="caption"><span class="caption-text">Serialization scenario walkthrough</span></p>
</div>
</div>
<div class="section" id="internal-description">
<h4>Internal description<a class="headerlink" href="#internal-description" title="Permalink to this headline">¶</a></h4>
<p><strong>SwitchConnectionProvider</strong> <code class="docutils literal"><span class="pre">SwitchConnectionProvider</span></code> constructs and
initializes both deserializer and serializer registries with default
(de)serializers. It also injects the <code class="docutils literal"><span class="pre">DeserializerRegistry</span></code> into the
<code class="docutils literal"><span class="pre">DeserializationFactory</span></code>, the <code class="docutils literal"><span class="pre">SerializerRegistry</span></code> into the
<code class="docutils literal"><span class="pre">SerializationFactory</span></code>. When call to register custom (de)serializer is
made, <code class="docutils literal"><span class="pre">SwitchConnectionProvider</span></code> calls register method on appropriate
registry.</p>
<p><strong>DeserializerRegistry / SerializerRegistry</strong> Both registries contain
init() method to initialize default (de)serializers. Registration checks
if key or (de)serializer implementation are not <code class="docutils literal"><span class="pre">null</span></code>. If at least
one of the is <code class="docutils literal"><span class="pre">null</span></code>, <code class="docutils literal"><span class="pre">NullPointerException</span></code> is thrown. Else the
(de)serializer implementation is checked if it is
<code class="docutils literal"><span class="pre">(De)SerializerRegistryInjector</span></code> instance. If it is an instance of
this interface, the registry is injected into this (de)serializer
implementation.</p>
<p><code class="docutils literal"><span class="pre">GetSerializer(key)</span></code> or <code class="docutils literal"><span class="pre">GetDeserializer(key)</span></code> performs registry
lookup. Because there are two separate interfaces that might be put into
the registry, the registry uses their unifying super interface.
Get(De)Serializer(key) method casts the super interface to desired type.
There is also a null check for the (de)serializer received from the
registry. If the deserializer wasn’t found, <code class="docutils literal"><span class="pre">NullPointerException</span></code>
with key description is thrown.</p>
</div>
<div class="section" id="registration-keys">
<h4>Registration keys<a class="headerlink" href="#registration-keys" title="Permalink to this headline">¶</a></h4>
<p><strong>Deserialization.</strong></p>
<p><strong>Possible openflow extensions and their keys</strong></p>
<p>There are three vendor specific extensions in Openflow v1.0 and eight in
Openflow v1.3. These extensions are registered under registration keys,
that are shown in table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="12%" />
<col width="38%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Extension type</th>
<th class="head">OpenFlo
w</th>
<th class="head">Registration key</th>
<th class="head">Utility class</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Vendor message</td>
<td>1.0</td>
<td>ExperimenterIdDeserializerKe
y(1,
experimenterId,
ExperimenterMessage.class)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-odd"><td>Action</td>
<td>1.0</td>
<td>ExperimenterActionDeserializ
erKey(1,
experimenter ID)</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Stats message</td>
<td>1.0</td>
<td>ExperimenterMultipartReplyMe
ssageDeserializerKey(1,
experimenter ID)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-odd"><td>Experimenter
message</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
ExperimenterMessage.class)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-even"><td>Match entry</td>
<td>1.3</td>
<td>MatchEntryDeserializerKey(4,
(number) ${oxm_class},
(number) ${oxm_field});</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>key.setExperimenterId(experi
menter
ID);</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Action</td>
<td>1.3</td>
<td>ExperimenterActionDeserializ
erKey(4,
experimenter ID)</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>Instruction</td>
<td>1.3</td>
<td>ExperimenterInstructionDeser
ializerKey(4,
experimenter ID)</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Multipart</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
MultipartReplyMessage.class)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-odd"><td>Multipart -
Table features</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
TableFeatureProperties.class
)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-even"><td>Error</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
ErrorMessage.class)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-odd"><td>Queue property</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
QueueProperty.class)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
<tr class="row-even"><td>Meter band
type</td>
<td>1.3</td>
<td>ExperimenterIdDeserializerKe
y(4,
experimenterId,
MeterBandExperimenterCase.cl
ass)</td>
<td>ExperimenterDeseriali
zerKeyFactory</td>
</tr>
</tbody>
</table>
<p>Table: <strong>Deserialization</strong></p>
<p><strong>Serialization.</strong></p>
<p><strong>Possible openflow extensions and their keys</strong></p>
<p>There are three vendor specific extensions in Openflow v1.0 and seven
Openflow v1.3. These extensions are registered under registration keys,
that are shown in table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="12%" />
<col width="38%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Extension type</th>
<th class="head">OpenFlo
w</th>
<th class="head">Registration key</th>
<th class="head">Utility class</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Vendor message</td>
<td>1.0</td>
<td>ExperimenterIdSerializerKey&lt;
&gt;(1,
experimenterId,
ExperimenterInput.class)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
<tr class="row-odd"><td>Action</td>
<td>1.0</td>
<td>ExperimenterActionSerializer
Key(1,
experimenterId, sub-type)</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Stats message</td>
<td>1.0</td>
<td>ExperimenterMultipartRequest
SerializerKey(1,
experimenter ID)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
<tr class="row-odd"><td>Experimenter
message</td>
<td>1.3</td>
<td>ExperimenterIdSerializerKey&lt;
&gt;(4,
experimenterId,
ExperimenterInput.class)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
<tr class="row-even"><td>Match entry</td>
<td>1.3</td>
<td>MatchEntrySerializerKey&lt;&gt;(4,
(class) ${oxm_class},
(class) ${oxm_field});</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>&nbsp;</td>
<td>key.setExperimenterId(experi
menter
ID)</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Action</td>
<td>1.3</td>
<td>ExperimenterActionSerializer
Key(4,
experimenterId, sub-type)</td>
<td>.</td>
</tr>
<tr class="row-odd"><td>Instruction</td>
<td>1.3</td>
<td>ExperimenterInstructionSeria
lizerKey(4,
experimenter ID)</td>
<td>.</td>
</tr>
<tr class="row-even"><td>Multipart</td>
<td>1.3</td>
<td>ExperimenterIdSerializerKey&lt;
&gt;(4,
experimenterId,
MultipartRequestExperimenter
Case.class)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
<tr class="row-odd"><td>Multipart -
Table features</td>
<td>1.3</td>
<td>ExperimenterIdSerializerKey&lt;
&gt;(4,
experimenterId,
TableFeatureProperties.class
)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
<tr class="row-even"><td>Meter band
type</td>
<td>1.3</td>
<td>ExperimenterIdSerializerKey&lt;
&gt;(4,
experimenterId,
MeterBandExperimenterCase.cl
ass)</td>
<td>ExperimenterSerialize
rKeyFactory</td>
</tr>
</tbody>
</table>
<p>Table: <strong>Serialization</strong></p>
</div>
</div>
</div>
<div class="section" id="openflow-plugin-project-developer-guide">
<h2>OpenFlow Plugin Project Developer Guide<a class="headerlink" href="#openflow-plugin-project-developer-guide" title="Permalink to this headline">¶</a></h2>
<p>This section covers topics which are developer specific and which have
not been covered in the user guide. Please see the Lithium OpenFlow
plugin user guide first.</p>
<p>It can be found on <a class="reference external" href="https://www.opendaylight.org/downloads">the OpenDaylight software download
page</a>.</p>
<div class="section" id="event-sequences">
<h3>Event Sequences<a class="headerlink" href="#event-sequences" title="Permalink to this headline">¶</a></h3>
<div class="section" id="session-establishment">
<h4>Session Establishment<a class="headerlink" href="#session-establishment" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="#_openflow_protocol_library_developer_guide">OpenFlow Protocol
Library</a> provides
interface <strong>SwitchConnectionHandler</strong> which contains method
<em>onSwitchConnected</em> (step 1). This event is raised in the OpenFlow
Protocol Library when an OpenFlow device connects to OpenDaylight and
caught in the <strong>ConnectionManagerImpl</strong> class in the OpenFlow plugin.</p>
<p>There the plugin creates a new instance of the <strong>ConnectionContextImpl</strong>
class (step 1.1) and also instances of <strong>HandshakeManagerImpl</strong> (which
uses <strong>HandshakeListenerImpl</strong>) and <strong>ConnectionReadyListenerImpl</strong>.
<strong>ConnectionReadyListenerImpl</strong> contains method <em>onConnectionReady()</em>
which is called when connection is prepared. This method starts the
handshake with the OpenFlow device (switch) from the OpenFlow plugin
side. Then handshake can be also started from device side. In this case
method <em>shake()</em> from <strong>HandshakeManagerImpl</strong> is called (steps 1.1.1
and 2).</p>
<p>The handshake consists of an exchange of HELLO messages in addition to
an exchange of device features (steps 2.1. and 3). The handshake is
completed by <strong>HandshakeManagerImpl</strong>. After receiving device features,
the <strong>HandshakeListenerImpl</strong> is notifed via the
<em>onHanshakeSuccessfull()</em> method. After this, the device features, node
id and connection state are stored in a <strong>ConnectionContext</strong> and the
method <em>deviceConnected()</em> of <strong>DeviceManagerImpl</strong> is called.</p>
<p>When <em>deviceConnected()</em> is called, it does the following:</p>
<ol class="arabic simple">
<li>creates a new transaction chain (step 4.1)</li>
<li>creates a new instance of <strong>DeviceContext</strong> (step 4.2.2)</li>
<li>initializes the device context: the static context of device is
populated by calling <em>createDeviceFeaturesForOF&lt;version&gt;()</em> to
populate table, group, meter features and port descriptions (step
4.2.1 and 4.2.1.1)</li>
<li>creates an instance of <strong>RequestContext</strong> for each type of feature</li>
</ol>
<p>When the OpenFlow device responds to these requests (step 4.2.1.1) with
multipart replies (step 5) they are processed and stored to MD-SAL
operational datastore. The <em>createDeviceFeaturesForOF&lt;version&gt;()</em> method
returns a <strong>Future</strong> which is processed in the callback (step 5.1) (part
of <em>initializeDeviceContext()</em> in the <em>deviceConnected()</em> method) by
calling the method <em>onDeviceCtxLevelUp()</em> from <strong>StatisticsManager</strong>
(step 5.1.1).</p>
<p>The call to <em>createDeviceFeaturesForOF&lt;version&gt;()</em>: . creates a new
instance of <strong>StatisticsContextImpl</strong> (step 5.1.1.1).</p>
<ol class="arabic simple">
<li>calls <em>gatherDynamicStatistics()</em> on that instance which returns a
<strong>Future</strong> which will produce a value when done<ol class="loweralpha">
<li>this method calls methods to get dynamic data (flows, tables,
groups) from the device (step 5.1.1.2, 5.1.1.2.1, 5.1.1.2.1.1)</li>
<li>if everything works, this data is also stored in the MD-SAL
operational datastore</li>
</ol>
</li>
</ol>
<p>If the <strong>Future</strong> is successful, it is processed (step 6.1.1) in a
callback in <strong>StatisticsManagerImpl</strong> which:</p>
<ol class="arabic simple">
<li>schedules the next time to poll the device for statistics</li>
<li>sets the device state to synchronized (step 6.1.1.2)</li>
<li>calls <em>onDeviceContextLevelUp()</em> in <strong>RpcManagerImpl</strong></li>
</ol>
<p>The <em>onDeviceContextLevelUp()</em> call:</p>
<ol class="arabic simple">
<li>creates a new instance of <strong>RequestContextImpl</strong></li>
<li>registers implementation for supported services</li>
<li>calls <em>onDeviceContextLevelUp()</em> in <strong>DeviceManagerImpl</strong> (step
6.1.1.2.1.2) which causes the information about the new device be be
written to the MD-SAL operational datastore (step 6.1.1.2.2)</li>
</ol>
<div class="figure" id="id121">
<img alt="Session establishment" src="../_images/odl-ofp-session-establishment.jpg" />
<p class="caption"><span class="caption-text">Session establishment</span></p>
</div>
</div>
<div class="section" id="id44">
<h4>Handshake<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>The first thing that happens when an OpenFlow device connects to
OpenDaylight is that the OpenFlow plugin gathers basic information about
the device and establishes agreement on key facts like the version of
OpenFlow which will be used. This process is called the handshake.</p>
<p>The handshake starts with HELLO message which can be sent either by the
OpenFlow device or the OpenFlow plugin. After this, there are several
scenarios which can happen:</p>
<ol class="arabic simple">
<li>if the first HELLO message contains a <em>version bitmap</em>, it is
possible to determine if there is a common version of OpenFlow or
not:<ol class="loweralpha">
<li>if there is a single common version use it and the <strong>VERSION IS
SETTLED</strong></li>
<li>if there are more than one common versions, use the highest
(newest) protocol and the <strong>VERSION IS SETTLED</strong></li>
<li>if there are no common versions, the device is <strong>DISCONNECTED</strong></li>
</ol>
</li>
<li>if the first HELLO message does not contain a <em>version bitmap</em>, then
STEB-BY-STEP negotiation is used</li>
<li>if second (or more) HELLO message is received, then STEP-BY-STEP
negotiation is used</li>
</ol>
<div class="section" id="step-by-step-negotiation">
<h5>STEP-BY-STEP negotiation:<a class="headerlink" href="#step-by-step-negotiation" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>if last version proposed by the OpenFlow plugin is the same as the
version received from the OpenFlow device, then the <strong>VERSION IS
SETTLED</strong></li>
<li>if the version received in the current HELLO message from the device
is the same as from previous then negotiation has failed and the
device is <strong>DISCONNECTED</strong></li>
<li>if the last version from the device is greater than the last version
proposed from the plugin, wait for the next HELLO message in the hope
that it will advertise support for a lower version</li>
<li>if the last version from the device is is less than the last version
proposed from the plugin:<ul>
<li>propose the highest version the plugin supports that is less than
or equal to the version received from the device and wait for the
next HELLO message</li>
<li>if if the plugin doesn’t support a lower version, the device is
<strong>DISCONNECTED</strong></li>
</ul>
</li>
</ul>
<p>After selecting of version we can say that the <strong>VERSION IS SETTLED</strong>
and the OpenFlow plugin can ask device for its features. At this point
handshake ends.</p>
<div class="figure" id="id122">
<img alt="Handshake process" src="../_images/odl-ofp-handshake.png" />
<p class="caption"><span class="caption-text">Handshake process</span></p>
</div>
</div>
</div>
<div class="section" id="adding-a-flow">
<h4>Adding a Flow<a class="headerlink" href="#adding-a-flow" title="Permalink to this headline">¶</a></h4>
<p>There are two ways to add a flow in in the OpenFlow plugin: adding it to
the MD-SAL config datastore or calling an RPC. Both of these can either
be done using the native MD-SAL interfaces or using RESTCONF. This
discussion focuses on calling the RPC.</p>
<p>If user send flow via REST interface (step 1) it will cause that
<em>invokeRpc()</em> is called on <strong>RpcBroker</strong>. The <strong>RpcBroker</strong> then looks
for an appropriate implementation of the interface. In the case of the
OpenFlow plugin, this is the <em>addFlow()</em> method of
<strong>SalFlowServiceImpl</strong> (step 1.1). The same thing happens if the RPC is
called directly from the native MD-SAL interfaces.</p>
<p>The <em>addFlow()</em> method then</p>
<ol class="arabic simple">
<li>calls the <em>commitEntry()</em> method (step 2) from the OpenFlow Protocol
Library which is responsible for sending the flow to the device</li>
<li>creates a new <strong>RequestContext</strong> by calling <em>createRequestContext()</em>
(step 3)</li>
<li>creates a callback to handle any events that happen because of
sending the flow to the device</li>
</ol>
<p>The callback method is triggered when a barrier reply message (step 2.1)
is received from the device indicating that the flow was either
installed or an appropriate error message was sent. If the flow was
successfully sent to the device, the RPC result is set to success (step
5). // <strong>SalFlowService</strong> contains inside method <em>addFlow()</em> other
callback which caught notification from callback for barrier message.</p>
<p>At this point, no information pertaining to the flow has been added to
the MD-SAL operational datastore. That is accomplished by the periodic
gathering of statistics from OpenFlow devices.</p>
<p>The <strong>StatisticsContext</strong> for each given OpenFlow device periodically
polls it using <em>gatherStatistics()</em> of <strong>StatisticsGatheringUtil</strong> which
issues an OpenFlow OFPT_MULTIPART_REQUEST - OFPMP_FLOW. The response
to this request (step 7) is processed in <strong>StatisticsGatheringUtil</strong>
class where flow data is written to the MD-SAL operational datastore via
the <em>writeToTransaction()</em> method of <strong>DeviceContext</strong>.</p>
<div class="figure" id="id123">
<img alt="Add flow" src="../_images/odl-ofp-add-flow.png" />
<p class="caption"><span class="caption-text">Add flow</span></p>
</div>
</div>
</div>
<div class="section" id="internal-message-statistics-api">
<h3>Internal message statistics API<a class="headerlink" href="#internal-message-statistics-api" title="Permalink to this headline">¶</a></h3>
<p>To aid in testing and diagnosis, the OpenFlow plugin provides
information about the number and rate of different internal events.</p>
<p>The implementation does two things: collects event counts and exposes
counts. Event counts are grouped by message type, e.g.,
<strong>PacketInMessage</strong>, and checkpoint, e.g.,
<em>TO_SWITCH_ENQUEUED_SUCCESS</em>. Once gathered, the results are logged
as well as being exposed using OSGi command line (deprecated) and JMX.</p>
<div class="section" id="collect">
<h4>Collect<a class="headerlink" href="#collect" title="Permalink to this headline">¶</a></h4>
<p>Each message is counted as it passes through various processing
checkpoints. The following checkpoints are defined as a Java enum and
tracked:</p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="o">/**</span>
  <span class="o">*</span> <span class="n">statistic</span> <span class="n">groups</span> <span class="n">overall</span> <span class="ow">in</span> <span class="n">OFPlugin</span>
  <span class="o">*/</span>
<span class="n">enum</span> <span class="n">STATISTIC_GROUP</span> <span class="p">{</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span><span class="p">,</span> <span class="n">enqueued</span> <span class="k">for</span> <span class="n">processing</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_ENQUEUED</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">translated</span> <span class="n">successfully</span> <span class="o">-</span> <span class="n">source</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_TRANSLATE_IN_SUCCESS</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">translated</span> <span class="n">successfully</span> <span class="o">-</span> <span class="n">target</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="n">where</span> <span class="n">translation</span> <span class="n">failed</span> <span class="o">-</span> <span class="n">source</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_TRANSLATE_SRC_FAILURE</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="k">finally</span> <span class="n">published</span> <span class="n">into</span> <span class="n">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">switch</span> <span class="o">-</span> <span class="n">publishing</span> <span class="n">into</span> <span class="n">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="n">failed</span> <span class="o">*/</span>
     <span class="n">FROM_SWITCH_PUBLISHED_FAILURE</span><span class="p">,</span>

     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="n">to</span> <span class="n">switch</span> <span class="n">via</span> <span class="n">RPC</span> <span class="n">enqueued</span> <span class="o">*/</span>
     <span class="n">TO_SWITCH_ENQUEUED_SUCCESS</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="n">to</span> <span class="n">switch</span> <span class="n">via</span> <span class="n">RPC</span> <span class="n">NOT</span> <span class="n">enqueued</span> <span class="o">*/</span>
     <span class="n">TO_SWITCH_ENQUEUED_FAILED</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="n">to</span> <span class="n">switch</span> <span class="o">-</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">OFJava</span> <span class="n">successfully</span> <span class="o">*/</span>
     <span class="n">TO_SWITCH_SUBMITTED_SUCCESS</span><span class="p">,</span>
     <span class="o">/**</span> <span class="n">message</span> <span class="kn">from</span> <span class="nn">MD</span><span class="o">-</span><span class="n">SAL</span> <span class="n">to</span> <span class="n">switch</span> <span class="o">-</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">OFJava</span> <span class="n">but</span> <span class="n">failed</span><span class="o">*/</span>
     <span class="n">TO_SWITCH_SUBMITTED_FAILURE</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a message passes through any of those checkpoints then counter
assigned to corresponding checkpoint and message is incremented by 1.</p>
</div>
<div class="section" id="expose-statistics">
<h4>Expose statistics<a class="headerlink" href="#expose-statistics" title="Permalink to this headline">¶</a></h4>
<p>As described above, there are three ways to access the statistics:</p>
<ul>
<li><p class="first">OSGi command line (this is considered deprecated)</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">osgi&gt;</span> <span class="pre">dumpMsgCount</span></code></p>
</div></blockquote>
</li>
<li><p class="first">OpenDaylight logging console (statistics are logged here every 10
seconds)</p>
<blockquote>
<div><p>required logback settings :
<code class="docutils literal"><span class="pre">&lt;logger</span> <span class="pre">name=&quot;org.opendaylight.openflowplugin.openflow.md.queue.MessageSpyCounterImpl&quot;</span> <span class="pre">level=&quot;DEBUG&quot;\/&gt;</span></code></p>
</div></blockquote>
</li>
<li><p class="first">JMX (via JConsole)</p>
<blockquote>
<div><p>start OpenFlow plugin with the <code class="docutils literal"><span class="pre">-jmx</span></code> parameter</p>
<p>start JConsole by running <code class="docutils literal"><span class="pre">jconsole</span></code></p>
<p>the JConsole MBeans tab should contain
org.opendaylight.controller</p>
<p>RuntimeBean has a msg-spy-service-impl</p>
<p>Operations provides makeMsgStatistics report functionality</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="example-results">
<h5>Example results<a class="headerlink" href="#example-results" title="Permalink to this headline">¶</a></h5>
<div class="figure" id="id124">
<img alt="OFplugin Debug stats.png" src="../_images/odl-ofp-ofplugin-debug-stats.png" />
<p class="caption"><span class="caption-text">OFplugin Debug stats.png</span></p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_ENQUEUED</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PortStatusMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_ENQUEUED</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MultipartReplyMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">81</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_ENQUEUED</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PacketInMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">8</span> <span class="o">|</span> <span class="mi">111</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_IN_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PortStatusMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_IN_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MultipartReplyMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">24</span> <span class="o">|</span> <span class="mi">81</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_IN_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PacketInMessage</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">8</span> <span class="o">|</span> <span class="mi">111</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">QueueStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeConnectorStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupDescStatsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">FlowsStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">19</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PacketReceived</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">8</span> <span class="o">|</span> <span class="mi">111</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterFeaturesUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupStatisticsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupFeaturesUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterConfigStatsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterStatisticsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeConnectorUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">12</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_OUT_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">FlowTableStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">8</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_TRANSLATE_SRC_FAILURE</span><span class="p">:</span> <span class="n">no</span> <span class="n">activity</span> <span class="n">detected</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">QueueStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeConnectorStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupDescStatsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">FlowsStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">19</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">PacketReceived</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">8</span> <span class="o">|</span> <span class="mi">111</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterFeaturesUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupStatisticsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">GroupFeaturesUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterConfigStatsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">MeterStatisticsUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">NodeConnectorUpdated</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">12</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">FlowTableStatisticsUpdate</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">3</span> <span class="o">|</span> <span class="mi">8</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">FROM_SWITCH_PUBLISHED_FAILURE</span><span class="p">:</span> <span class="n">no</span> <span class="n">activity</span> <span class="n">detected</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">TO_SWITCH_ENQUEUED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">AddFlowInput</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">12</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">TO_SWITCH_ENQUEUED_FAILED</span><span class="p">:</span> <span class="n">no</span> <span class="n">activity</span> <span class="n">detected</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">TO_SWITCH_SUBMITTED_SUCCESS</span><span class="p">:</span> <span class="n">MSG</span><span class="p">[</span><span class="n">AddFlowInput</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">+</span><span class="mi">0</span> <span class="o">|</span> <span class="mi">12</span>
<span class="n">DEBUG</span> <span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">o</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">MessageSpyCounterImpl</span> <span class="o">-</span> <span class="n">TO_SWITCH_SUBMITTED_FAILURE</span><span class="p">:</span> <span class="n">no</span> <span class="n">activity</span> <span class="n">detected</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="karaf-feature-tree">
<h3>Karaf feature tree<a class="headerlink" href="#karaf-feature-tree" title="Permalink to this headline">¶</a></h3>
<div class="figure" id="id125">
<img alt="Openflow plugin karaf feature tree" src="../_images/odl-ofp-feature-tree.png" />
<p class="caption"><span class="caption-text">Openflow plugin karaf feature tree</span></p>
</div>
<p>Short
<a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_OpenFlow_Plugin:FeatureTreeHowto">HOWTO</a>
create such a tree.</p>
</div>
<div class="section" id="wiring-up-notifications">
<h3>Wiring up notifications<a class="headerlink" href="#wiring-up-notifications" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id45">
<h4>Introduction<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<p>We need to translate OpenFlow messages coming up from the <a class="reference external" href="#_openflow_protocol_library_developer_guide">OpenFlow
Protocol Library</a> into
MD-SAL Notification objects and then publish them to the MD-SAL.</p>
</div>
<div class="section" id="mechanics">
<h4>Mechanics<a class="headerlink" href="#mechanics" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Create a Translator class</li>
<li>Register the Translator</li>
<li>Register the notificationPopListener to handle your Notification
Objects</li>
</ol>
<div class="section" id="create-a-translator-class">
<h5>Create a Translator class<a class="headerlink" href="#create-a-translator-class" title="Permalink to this headline">¶</a></h5>
<p>You can see an example in
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=openflowplugin.git;a=blob;f=openflowplugin/src/main/java/org/opendaylight/openflowplugin/openflow/md/core/translator/PacketInTranslator.java;hb=refs/heads/stable/boron">PacketInTranslator.java</a>.</p>
<p>First, simply create the class</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">PacketInTranslator</span> <span class="n">implements</span> <span class="n">IMDMessageTranslator</span><span class="o">&lt;</span><span class="n">OfHeader</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
</pre></div>
</div>
<p>Then implement the translate function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">PacketInTranslator</span> <span class="n">implements</span> <span class="n">IMDMessageTranslator</span><span class="o">&lt;</span><span class="n">OfHeader</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;&gt;</span> <span class="p">{</span>

    <span class="n">protected</span> <span class="n">static</span> <span class="n">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">LoggerFactory</span>
            <span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">PacketInTranslator</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">PacketReceived</span> <span class="n">translate</span><span class="p">(</span><span class="n">SwitchConnectionDistinguisher</span> <span class="n">cookie</span><span class="p">,</span>
            <span class="n">SessionContext</span> <span class="n">sc</span><span class="p">,</span> <span class="n">OfHeader</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">...</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Make sure to check that you are dealing with the expected type and cast
it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">msg</span> <span class="n">instanceof</span> <span class="n">PacketInMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">PacketInMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="n">PacketInMessage</span><span class="p">)</span><span class="n">msg</span><span class="p">;</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>Do your transation work and return</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PacketReceived</span> <span class="n">pktInEvent</span> <span class="o">=</span> <span class="n">pktInBuilder</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
<span class="nb">list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pktInEvent</span><span class="p">);</span>
<span class="k">return</span> <span class="nb">list</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="register-your-translator-class">
<h5>Register your Translator Class<a class="headerlink" href="#register-your-translator-class" title="Permalink to this headline">¶</a></h5>
<p>Next you need to go to
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=openflowplugin.git;a=blob;f=openflowplugin/src/main/java/org/opendaylight/openflowplugin/openflow/md/core/MDController.java;hb=refs/heads/stable/boron">MDController.java</a>
and in init() add register your Translator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Initializing!&quot;</span><span class="p">);</span>
        <span class="n">messageTranslators</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">popListeners</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="o">//</span><span class="n">TODO</span><span class="p">:</span> <span class="n">move</span> <span class="n">registration</span> <span class="n">to</span> <span class="n">factory</span>
        <span class="n">addMessageTranslator</span><span class="p">(</span><span class="n">ErrorMessage</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">OF10</span><span class="p">,</span> <span class="n">new</span> <span class="n">ErrorTranslator</span><span class="p">());</span>
        <span class="n">addMessageTranslator</span><span class="p">(</span><span class="n">ErrorMessage</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">OF13</span><span class="p">,</span> <span class="n">new</span> <span class="n">ErrorTranslator</span><span class="p">());</span>
        <span class="n">addMessageTranslator</span><span class="p">(</span><span class="n">PacketInMessage</span><span class="o">.</span><span class="n">class</span><span class="p">,</span><span class="n">OF10</span><span class="p">,</span> <span class="n">new</span> <span class="n">PacketInTranslator</span><span class="p">());</span>
        <span class="n">addMessageTranslator</span><span class="p">(</span><span class="n">PacketInMessage</span><span class="o">.</span><span class="n">class</span><span class="p">,</span><span class="n">OF13</span><span class="p">,</span> <span class="n">new</span> <span class="n">PacketInTranslator</span><span class="p">());</span>
</pre></div>
</div>
<p>Notice that there is a separate registration for each of OpenFlow 1.0
and OpenFlow 1.3. Basically, you indicate the type of OpenFlow Protocol
Library message you wish to translate for, the OpenFlow version, and an
instance of your Translator.</p>
</div>
<div class="section" id="register-your-md-sal-message-for-notification-to-the-md-sal">
<h5>Register your MD-SAL Message for Notification to the MD-SAL<a class="headerlink" href="#register-your-md-sal-message-for-notification-to-the-md-sal" title="Permalink to this headline">¶</a></h5>
<p>Now, also in MDController.init() register to have the
notificationPopListener handle your MD-SAL Message:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">addMessagePopListener</span><span class="p">(</span><span class="n">PacketReceived</span><span class="o">.</span><span class="n">class</span><span class="p">,</span> <span class="n">new</span> <span class="n">NotificationPopListener</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="you-are-done">
<h5>You are done<a class="headerlink" href="#you-are-done" title="Permalink to this headline">¶</a></h5>
<p>That’s all there is to it. Now when a message comes up from the OpenFlow
Protocol Library, it will be translated and published to the MD-SAL.</p>
</div>
</div>
</div>
<div class="section" id="message-order-preservation">
<h3>Message Order Preservation<a class="headerlink" href="#message-order-preservation" title="Permalink to this headline">¶</a></h3>
<p>While the Helium release of OpenFlow Plugin relied on queues to ensure
messages were delivered in order, subsequent releases instead ensure
that all the messages from a given device are delivered using the same
thread and thus message order is guaranteed without queues. The OpenFlow
plugin allocates a number of threads equal to twice the number of
processor cores on machine it is run, e.g., 8 threads if the machine has
4 cores.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>While each device is assigned to one thread, multiple devices can be
assigned to the same thread.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="opflex-agent-ovs-developer-guide">
<h2>OpFlex agent-ovs Developer Guide<a class="headerlink" href="#opflex-agent-ovs-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id46">
<h3>Overview<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>agent-ovs is a policy agent that works with OVS to enforce a group-based
policy networking model with locally attached virtual machines or
containers. The policy agent is designed to work well with orchestration
tools like OpenStack.</p>
</div>
<div class="section" id="agent-ovs-architecture">
<h3>agent-ovs Architecture<a class="headerlink" href="#agent-ovs-architecture" title="Permalink to this headline">¶</a></h3>
<p>agent-ovs uses libopflex to communicate with an OpFlex-based policy
repository to enforce policy on network endpoints attached to OVS by an
orchestration system.</p>
<p>The key components are:</p>
<ul class="simple">
<li>Agent - coordinates startup and configuration</li>
<li>Renderers - Renderers are responsible for rendering policy. This is a
very general mechanism but the currently-implemented renderer is the
stitched-mode renderer that can work along with with hardware fabrics
such as ACI that support policy enforcement.</li>
<li>EndpointManager - Keep track of network endpoints and declare them to
the endpoint repository</li>
<li>PolicyManager - Keep track of and index policies</li>
<li>FlowManager - render policies to OVS</li>
</ul>
</div>
<div class="section" id="id47">
<h3>API Reference Documentation<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h3>
<p>Internal API documentation can be found here:
<a class="reference external" href="https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/agent-ovs/doc/html/index.html">https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/agent-ovs/doc/html/index.html</a></p>
</div>
</div>
<div class="section" id="opflex-genie-developer-guide">
<h2>OpFlex genie Developer Guide<a class="headerlink" href="#opflex-genie-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id48">
<h3>Overview<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h3>
<p>Genie is a tool for code generation from a model. It supports generating
C++ and Java code. C++ can be generated suitable for use with libopflex.
C++ and Java can be generated as a plain set of objects.</p>
</div>
<div class="section" id="group-based-policy-model">
<h3>Group-based Policy Model<a class="headerlink" href="#group-based-policy-model" title="Permalink to this headline">¶</a></h3>
<p>The group-based policy model is included with the genie tool and can be
found under the MODEL directory. By running mvn exec:java, libmodelgbp
will be generated as a library project that, when built and installed,
will work with libopflex. This model is used by the OVS agent.</p>
</div>
<div class="section" id="id49">
<h3>API Reference Documentation<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h3>
<p>Complete API documentation for the generated libmodelgbp can be found
here:
<a class="reference external" href="https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/libopflex/doc/html/index.html">https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/libopflex/doc/html/index.html</a></p>
</div>
</div>
<div class="section" id="opflex-libopflex-developer-guide">
<h2>OpFlex libopflex Developer Guide<a class="headerlink" href="#opflex-libopflex-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id50">
<h3>Overview<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<p>The OpFlex framework allows you to develop agents that can communicate
using the OpFlex protocol and act as a policy element in an OpFlex-based
distributed control system. The OpFlex architecture provides a
distributed control system based on a declarative policy information
model. The policies are defined at a logically centralized policy
repository and enforced within a set of distributed policy elements. The
policy repository communicates with the subordinate policy elements
using the OpFlex control protocol. This protocol allows for
bidirectional communication of policy, events, statistics, and faults.</p>
<p>Rather than simply providing access to the OpFlex protocol, this
framework allows you to directly manipulate a management information
tree containing a hierarchy of managed objects. This tree is kept in
sync as needed with other policy elements in the system, and you are
automatically notified when important changes to the model occur.
Additionally, we can ensure that only those managed objects that are
important to the local policy element are synchronized locally.</p>
<div class="section" id="object-model">
<h4>Object Model<a class="headerlink" href="#object-model" title="Permalink to this headline">¶</a></h4>
<p>Interactions with the OpFlex framework happen through the management
information tree. This is a tree of managed objects defined by an object
model specific to your application. There are a few important major
category of objects that can appear in the model.</p>
<ul class="simple">
<li>First, there is the policy object. A policy object represents some
data related to a policy that describes a user intent for how the
system should behave. A policy object is stored in the policy
repository which is the source of &#8220;truth&#8221; for this object.</li>
<li>Second, there is an endpoint object. A endpoint represents an entity
in the system to which we want to apply policy, which could be a
network interface, a storage array, or other relevent policy
endpoint. Endpoints are discovered and reported by policy elements
locally, and are synchronized into the endpoint repository. The
originating policy element is the source of truth for the endpoints
it discovers. Policy elements can retrieve information about
endpoints discovered by other policy elements by resolving endpoints
from the endpoint repository.</li>
<li>Third, there is the observable object. An observable object
represents some state related to the operational status or health of
the policy element. Observable objects will be reported to the
observer.</li>
<li>Finally, there is the local-only object. This is the simplest object
because it exists only local to a particular policy element. These
objects can be used to store state specific to that policy element,
or as helpers to resolve other objects. Read on to learn more.</li>
</ul>
<p>You can use the genie tool that is included with the framework to
produce your application model along with a set of generated accessor
classes that can work with this framework library. You should refer to
the documentation that accompanies the genie tool for information on how
to use to to generate your object model. Later in this guide, we’ll go
through examples of how to use the generated managed object accessor
classes.</p>
</div>
<div class="section" id="programming-by-side-effect">
<h4>Programming by Side Effect<a class="headerlink" href="#programming-by-side-effect" title="Permalink to this headline">¶</a></h4>
<p>When developing software on the OpFlex framework, you’ll need to think
in a slightly different way. Rather than calling an API function that
would perform some specific action, you’ll need to write a managed
object to the managed object database. Writing that object to the store
will trigger the side effect of performing the action that you want.</p>
<p>For example, a policy element will need to have a component responsible
for discovering policy endpoints. When it discovers a policy endpoint,
it would write an endpoint object into the managed object database. That
endpoint object will contain a reference to policy that is relevant to
the endpoint object. This will trigger a whole cascade of events. First,
the framework will notice that an endpoint object has been created and
it will write it to the endpoint repository. Second, the framework to
will attempt to resolve the unresolved reference to the relevent policy
object. There might be a whole chain of policy resolutions that will be
automatically performed to download all the relevent policy until there
are no longer any dangling references.</p>
<p>As long as there is a locally-created object in the system with a
reference to that policy, the framework will continually ensure that the
policy and any transitive policies are kept up to date. The policy
element can subscribe to updates to these policy classes that will be
invoked either the first time the policy is resolved or any time the
policy changes.</p>
<p>A consequence of this design is that the managed object database can be
temporarily in an inconsistent state with unresolved dangling
references. Eventually, however, the inconsistency will be fully
resolved. The policy element must be able to cleanly handle
partially-resolved or inconsistent state and eventually reach the
correct state as it receives these update notifications. Note that, in
the OpFlex architecture, when there is no policy that specifically
allows a particular action, that action must be prevented.</p>
<p>Let’s cover one slightly more complex example. If a policy element needs
to discover information about an endpoint that is not local to that
policy element, it will need to retrieve that information from the
endpoint repository. However, just as there is no API call to retrieve a
policy object from the policy repository, there is no API call to
retrieve an endpoint from the endpoint repository.</p>
<p>To get this information, the policy element needs to create a local-only
object that references the endpoint. Once it creates this local-only
object, if the endpoint is not already resolved, the framework will
notice the dangling reference and automatically resolve the endpoint
from the endpoint respository. When the endpoint resolution completes,
the framework deliver an update notification to the policy element. The
policy element will continue to receive any updates related to that
endpoint until the policy element remove the local-only reference to the
object. Once this occurs, the framework can garbage-collect any
unreferenced objects.</p>
</div>
<div class="section" id="threading-and-ownership">
<h4>Threading and Ownership<a class="headerlink" href="#threading-and-ownership" title="Permalink to this headline">¶</a></h4>
<p>The OpFlex framework uses a somewhat unique threading model. Each
managed object in the system belongs to a particular owner. An owner
would typically be a single thread that is reponsible for all updates to
objects with that owner. Though anything can read the state of a managed
object, only the owner of a managed object is permitted to write to it.
Though this is not strictly required for correctness, the performance of
the system wil be best if you ensure that only one thread at a time is
writing to objects with a particular owner.</p>
<p>Change notifications are delivered in a serialized fashion by a single
thread. Blocking this thread from a notification callback will stall
delivery of all notifications. It is therefore best practice to ensure
that you do not block or perform long-running operations from a
notification callback.</p>
</div>
</div>
<div class="section" id="id51">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h3>
<div class="section" id="basic-usage-and-initialization">
<h4>Basic Usage and Initialization<a class="headerlink" href="#basic-usage-and-initialization" title="Permalink to this headline">¶</a></h4>
<p>The primary interface point into the framework is
opflex::ofcore::OFFramework. You can choose to instantiate your own copy
of the framework, or you can use the static default instance.</p>
<p>Before you can use the framework, you must initialize it by installing
your model metadata. The model metadata is accessible through the
generated model library. In this case, it assumes your model is called
&#8220;mymodel&#8221;:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &lt;opflex/ofcore/OFFramework.h&gt;</span>
<span class="c1">#include &lt;mymodel/metadata/metadata.hpp&gt;</span>
<span class="o">//</span> <span class="o">...</span>
<span class="n">using</span> <span class="n">opflex</span><span class="p">::</span><span class="n">ofcore</span><span class="p">::</span><span class="n">OFFramework</span><span class="p">;</span>
<span class="n">OFFramework</span><span class="p">::</span><span class="n">defaultInstance</span><span class="p">()</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">mymodel</span><span class="p">::</span><span class="n">getMetadata</span><span class="p">());</span>
</pre></div>
</div>
<p>The other critical piece of information required for initialization is
the OpFlex identity information. The identity information is required in
order to successfully connect to OpFlex peers. In OpFlex, each component
has a unique name within its policy domain, and each policy domain is
identified by a globally unique domain name. You can set this identity
information by calling:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">OFFramework</span><span class="p">::</span><span class="n">defaultInstance</span><span class="p">()</span>
    <span class="o">.</span><span class="n">setOpflexIdentity</span><span class="p">(</span><span class="s2">&quot;[component name]&quot;</span><span class="p">,</span> <span class="s2">&quot;[unique domain]&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can then start the framework simply by calling:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">OFFramework</span><span class="p">::</span><span class="n">defaultInstance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
</pre></div>
</div>
<p>Finally, you can add peers after the framework is started by calling the
<code class="docutils literal"><span class="pre">opflex::ofcore::OFFramework::addPeer</span></code> method:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">OFFramework</span><span class="p">::</span><span class="n">defaultInstance</span><span class="p">()</span><span class="o">.</span><span class="n">addPeer</span><span class="p">(</span><span class="s2">&quot;192.168.1.5&quot;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">);</span>
</pre></div>
</div>
<p>When connecting to the peer, that peer may provide an additional list of
peers to connect to, which will be automatically added as peers. If the
peer does not include itself in the list, then the framework will
disconnect from that peer and add the peers in the list. In this way, it
is possible to automatically bootstrap the correct set of peers using a
known hostname or IP address or a known, fixed anycast IP address.</p>
<p>To cleanly shut down, you can call:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">OFFramework</span><span class="p">::</span><span class="n">defaultInstance</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-data-in-the-tree">
<h4>Working with Data in the Tree<a class="headerlink" href="#working-with-data-in-the-tree" title="Permalink to this headline">¶</a></h4>
<div class="section" id="reading-from-the-tree">
<h5>Reading from the Tree<a class="headerlink" href="#reading-from-the-tree" title="Permalink to this headline">¶</a></h5>
<p>You can access data in the managed tree using the generated accessor
classes. The details of exactly which classes you’ll use will depend on
the model you’re using, but let’s assume that we have a simple model
called &#8220;simple&#8221; with the following classes:</p>
<ul class="simple">
<li>root - The root node. The URI for the root node is &#8220;/&#8221;</li>
<li>foo - A policy object, and a child of root, with a scalar string
property called &#8220;bar&#8221;, and a unsigned 64-bit integer property called
baz. The bar property is the naming property for foo. The URI for a
foo object would be &#8220;/foo/[value of bar]/&#8221;</li>
<li>fooref - A local-only child of root, with a reference to a foo, and a
scalar string property called &#8220;bar&#8221;. The bar property is the naming
property for foo. The URI for a fooref object would be
&#8220;/fooref/[value of bar]/&#8221;</li>
</ul>
<p>In this example, we’ll have a generated class for each of the objects.
There are two main ways to get access to an object in the tree.</p>
<p>First, we can get instantiate an accessor class to any node in the tree
by calling one of its static resolve functions. The resolve functions
can take either an already-built URI that represents the object, or you
can call the version that will locate the object by its naming
properties.</p>
<p>Second, we can access the object also from its parent object using the
appropriate child resolver member functions.</p>
<p>However we read it, the object we get back is an immutable view into the
object it references. The properties set locally on that object will not
change even though the underlying object may have been updated in the
store. Note, however, that its children can change between when you
first retrieve the object and when you resolve any children.</p>
<p>Another thing that is critical to note again is that when you attempt to
resolve an object, you can get back nothing, even if the object actually
does exist on another OpFlex node. You must ensure that some object in
the managed object database references the remote managed object you
want before it will be visible to you.</p>
<p>To get access to the root node using the default framework instance, we
can simply call:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">boost</span><span class="p">::</span><span class="n">shared_ptr</span><span class="p">;</span>
<span class="n">using</span> <span class="n">boost</span><span class="p">::</span><span class="n">optional</span><span class="p">;</span>
<span class="n">optional</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">(</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="p">::</span><span class="n">resolve</span><span class="p">());</span>
</pre></div>
</div>
<p>Note that whenever we can a resolve function, we get back our data in
the form of an optional shared pointer to the object instance. If the
node does not exist, then the optional will be set to boost::none. Note
that if you dereference an optional that has not been set, you’ll
trigger an assert, so you must check the return as follows:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span>if (!r) {
   // handle missing object
}
</pre></div>
</div>
<p>Now let’s get a child node of the root in three different ways:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Get</span> <span class="n">foo1</span> <span class="n">by</span> <span class="n">constructing</span> <span class="n">its</span> <span class="n">URI</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">root</span>
<span class="n">optional</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">foo1</span><span class="p">(</span><span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">resolve</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">));</span>
<span class="o">//</span> <span class="n">get</span> <span class="n">foo1</span> <span class="n">by</span> <span class="n">constructing</span> <span class="n">its</span> <span class="n">URI</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">its</span> <span class="n">parent</span>
<span class="n">foo1</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">resolveFoo</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">);</span>
<span class="o">//</span> <span class="n">get</span> <span class="n">foo1</span> <span class="n">by</span> <span class="n">manually</span> <span class="n">building</span> <span class="n">its</span> <span class="n">URI</span>
<span class="n">foo1</span> <span class="o">=</span> <span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">resolve</span><span class="p">(</span><span class="n">opflex</span><span class="p">::</span><span class="n">modb</span><span class="p">::</span><span class="n">URIBuilder</span><span class="p">()</span>
                               <span class="o">.</span><span class="n">addElement</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
                               <span class="o">.</span><span class="n">addElement</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
                               <span class="o">.</span><span class="n">build</span><span class="p">());</span>
</pre></div>
</div>
<p>All three of these calls will give us the same object, which is the
&#8220;foo&#8221; object located at &#8220;/foo/test/&#8221;.</p>
<p>The foo class has a single string property called &#8220;bar&#8221;. We can easily
access it as follows:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">barv</span> <span class="o">=</span> <span class="n">foo1</span><span class="o">.</span><span class="n">getBar</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-to-the-tree">
<h5>Writing to the Tree<a class="headerlink" href="#writing-to-the-tree" title="Permalink to this headline">¶</a></h5>
<p>Writing to the tree is nearly as easy as reading from it. The key
concept to understand is the mutator object. If you want to make changes
to the tree, you must allocate a mutator object. The mutator will
register itself in some thread-local storage in the framework instance
you’re using. The mutator is specific to a single &#8220;owner&#8221; for the data,
so you can only make changes to data associated with that owner.</p>
<p>Whenever you modify one of the accessor classes, the change is actually
forwarded to the currently-active mutator. You won’t see any of the
changes you make until you call the commit member function on the
mutator. When you do that, all the changes you made are written into the
store.</p>
<p>Once the changes are written into the store, you will need to call the
appropriate resolve function again to see the changes.</p>
<p>Allocating a mutator is simple. To create a mutator for the default
framework instance associated with the owner &#8220;owner1&#8221;, just allocate the
mutator on the stack. Be sure to call commit() before it goes out of
scope or you’ll lose your changes.</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">opflex</span><span class="p">::</span><span class="n">modb</span><span class="p">::</span><span class="n">Mutator</span> <span class="n">mutator</span><span class="p">(</span><span class="s2">&quot;owner1&quot;</span><span class="p">);</span>
    <span class="o">//</span> <span class="n">make</span> <span class="n">changes</span> <span class="n">here</span>
    <span class="n">mutator</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that if an exception is thrown while making changes but before
committing, the mutator will go out of scope and the changes will be
discarded.</p>
<p>To create a new node, you must call the appropriate add[Child] member
function on its parent. This function takes parameters for each of the
naming properties for the object:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="o">&gt;</span> <span class="n">newfoo</span><span class="p">(</span><span class="n">root</span><span class="o">-&gt;</span><span class="n">addFoo</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>This will return a shared pointer to a new foo object that has been
registered in the active mutator but not yet committed. The &#8220;bar&#8221; naming
property will be set automatically, but if you want to set the &#8220;baz&#8221;
property now, you can do so by calling:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">newfoo</span><span class="o">-&gt;</span><span class="n">setBaz</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that creating the root node requires a call to the special static
class method createRootElement:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="o">&gt;</span> <span class="n">newroot</span><span class="p">(</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="p">::</span><span class="n">createRootElement</span><span class="p">());</span>
</pre></div>
</div>
<p>Here’s a complete example that ties this all together:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">opflex</span><span class="p">::</span><span class="n">modb</span><span class="p">::</span><span class="n">Mutator</span> <span class="n">mutator</span><span class="p">(</span><span class="s2">&quot;owner1&quot;</span><span class="p">);</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="o">&gt;</span> <span class="n">newroot</span><span class="p">(</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="p">::</span><span class="n">createRootElement</span><span class="p">());</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simple</span><span class="p">::</span><span class="n">root</span><span class="o">&gt;</span> <span class="n">newfoo</span><span class="p">(</span><span class="n">newroot</span><span class="o">-&gt;</span><span class="n">addFoo</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">));</span>
    <span class="n">newfoo</span><span class="o">-&gt;</span><span class="n">setBaz</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>

    <span class="n">mutator</span><span class="o">.</span><span class="n">commit</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-notifications">
<h4>Update Notifications<a class="headerlink" href="#update-notifications" title="Permalink to this headline">¶</a></h4>
<p>When using the OpFlex framework, you’re likely to find that most of your
time is spend responding to changes in the managed object database. To
get these notifications, you’re going to need to register some number of
listeners.</p>
<p>You can register an object listener to see all changes related to a
particular class by calling a static function for that class. You’ll
then get notifications whenever any object in that class is added,
updated, or deleted. The listener should queue a task to read the new
state and perform appropriate processing. If this function blocks or
peforms a long-running operation, then the dispatching of update
notifications will be stalled, but there will not be any other
deleterious effects.</p>
<p>If multiple changes happen to the same URI, then at least one
notification will be delivered but some events may be consolidated.</p>
<p>The update you get will tell you the URI and the Class ID of the changed
object. The class ID is a unique ID for each class. When you get the
update, you’ll need to call the appropriate resolve function to retrieve
the new value.</p>
<p>You’ll need to create your own object listener derived from
opflex::modb::ObjectListener:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyListener</span> <span class="p">:</span> <span class="n">public</span> <span class="n">ObjectListener</span> <span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">MyListener</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">virtual</span> <span class="n">void</span> <span class="n">objectUpdated</span><span class="p">(</span><span class="n">class_id_t</span> <span class="n">class_id</span><span class="p">,</span> <span class="n">const</span> <span class="n">URI</span><span class="o">&amp;</span> <span class="n">uri</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Your</span> <span class="n">handler</span> <span class="n">here</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>To register your listener with the default framework instance, just call
the appropriate class static method:</p>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="n">MyListener</span> <span class="n">listener</span><span class="p">;</span>
<span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">registerListener</span><span class="p">(</span><span class="o">&amp;</span><span class="n">listener</span><span class="p">);</span>
<span class="o">//</span> <span class="n">main</span> <span class="n">loop</span>
<span class="n">simple</span><span class="p">::</span><span class="n">foo</span><span class="p">::</span><span class="n">unregisterListener</span><span class="p">(</span><span class="o">&amp;</span><span class="n">listener</span><span class="p">);</span>
</pre></div>
</div>
<p>The listener will now recieve notifications whenever any foo or any
children of any foo object changes.</p>
<p>Note that you must ensure that you unregister your listeners before
deallocating them.</p>
</div>
</div>
<div class="section" id="id52">
<h3>API Reference Documentation<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<p>Complete API documentation can be found through doxygen here:
<a class="reference external" href="https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/libopflex/doc/html/index.html">https://jenkins.opendaylight.org/opflex/job/opflex-merge/ws/libopflex/doc/html/index.html</a></p>
</div>
</div>
<div class="section" id="ovsdb-md-sal-southbound-plugin-developer-guide">
<h2>OVSDB MD-SAL Southbound Plugin Developer Guide<a class="headerlink" href="#ovsdb-md-sal-southbound-plugin-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id53">
<h3>Overview<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h3>
<p>The Open vSwitch Database (OVSDB) Model Driven Service Abstraction Layer
(MD-SAL) Southbound plugin provides an MD-SAL based interface to Open
vSwitch systems. This is done by augmenting the MD-SAL topology node
with a YANG model which replicates some (but not all) of the Open
vSwitch schema.</p>
</div>
<div class="section" id="ovsdb-md-sal-southbound-plugin-architecture-and-operation">
<h3>OVSDB MD-SAL Southbound Plugin Architecture and Operation<a class="headerlink" href="#ovsdb-md-sal-southbound-plugin-architecture-and-operation" title="Permalink to this headline">¶</a></h3>
<p>The architecture and operation of the OVSDB MD-SAL Southbound plugin is
illustrated in the following set of diagrams.</p>
<div class="section" id="connecting-to-an-ovsdb-node">
<h4>Connecting to an OVSDB Node<a class="headerlink" href="#connecting-to-an-ovsdb-node" title="Permalink to this headline">¶</a></h4>
<p>An OVSDB node is a system which is running the OVS software and is
capable of being managed by an OVSDB Manager. The OVSDB MD-SAL
Southbound plugin in OpenDaylight is capable of operating as an OVSDB
manager. Depending on the configuration of the OVSDB node, the
connection of the OVSDB manager can be active or passive.</p>
<div class="section" id="active-ovsdb-node-manager-workflow">
<h5>Active OVSDB Node Manager Workflow<a class="headerlink" href="#active-ovsdb-node-manager-workflow" title="Permalink to this headline">¶</a></h5>
<p>An active OVSDB node manager connection is made when OpenDaylight
initiates the connection to the OVSDB node. In order for this to work,
you must configure the OVSDB node to listen on a TCP port for the
connection (i.e. OpenDaylight is active and the OVSDB node is passive).
This option can be configured on the OVSDB node using the following
command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span><span class="o">-</span><span class="n">manager</span> <span class="n">ptcp</span><span class="p">:</span><span class="mi">6640</span>
</pre></div>
</div>
<p>The following diagram illustrates the sequence of events which occur
when OpenDaylight initiates an active OVSDB manager connection to an
OVSDB node.</p>
<div class="figure" id="id126">
<img alt="Active OVSDB Manager Connection" src="../_images/ovsdb-sb-active-connection.jpg" />
<p class="caption"><span class="caption-text">Active OVSDB Manager Connection</span></p>
</div>
<dl class="docutils">
<dt>Step 1</dt>
<dd>Create an OVSDB node by using RESTCONF or an OpenDaylight plugin.
The OVSDB node is listed under the OVSDB topology node.</dd>
<dt>Step 2</dt>
<dd>Add the OVSDB node to the OVSDB MD-SAL southbound configuration
datastore. The OVSDB southbound provider is registered to listen for
data change events on the portion of the MD-SAL topology data store
which contains the OVSDB southbound topology node augmentations. The
addition of an OVSDB node causes an event which is received by the
OVSDB Southbound provider.</dd>
<dt>Step 3</dt>
<dd>The OVSDB Southbound provider initiates a connection to the OVSDB
node using the connection information provided in the configuration
OVSDB node (i.e. IP address and TCP port number).</dd>
<dt>Step 4</dt>
<dd>The OVSDB Southbound provider adds the OVSDB node to the OVSDB
MD-SAL operational data store. The operational data store contains
OVSDB node objects which represent active connections to OVSDB
nodes.</dd>
<dt>Step 5</dt>
<dd>The OVSDB Southbound provider requests the schema and databases
which are supported by the OVSDB node.</dd>
<dt>Step 6</dt>
<dd>The OVSDB Southbound provider uses the database and schema
information to construct a monitor request which causes the OVSDB
node to send the controller any updates made to the OVSDB databases
on the OVSDB node.</dd>
</dl>
</div>
<div class="section" id="passive-ovsdb-node-manager-workflow">
<h5>Passive OVSDB Node Manager Workflow<a class="headerlink" href="#passive-ovsdb-node-manager-workflow" title="Permalink to this headline">¶</a></h5>
<p>A passive OVSDB node connection to OpenDaylight is made when the OVSDB
node initiates the connection to OpenDaylight. In order for this to
work, you must configure the OVSDB node to connect to the IP address and
OVSDB port on which OpenDaylight is listening. This option can be
configured on the OVSDB node using the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ovs</span><span class="o">-</span><span class="n">vsctl</span> <span class="nb">set</span><span class="o">-</span><span class="n">manager</span> <span class="n">tcp</span><span class="p">:</span><span class="o">&lt;</span><span class="n">IP</span> <span class="n">address</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">6640</span>
</pre></div>
</div>
<p>The following diagram illustrates the sequence of events which occur
when an OVSDB node connects to OpenDaylight.</p>
<div class="figure" id="id127">
<img alt="Passive OVSDB Manager Connection" src="../_images/ovsdb-sb-passive-connection.jpg" />
<p class="caption"><span class="caption-text">Passive OVSDB Manager Connection</span></p>
</div>
<dl class="docutils">
<dt>Step 1</dt>
<dd>The OVSDB node initiates a connection to OpenDaylight.</dd>
<dt>Step 2</dt>
<dd>The OVSDB Southbound provider adds the OVSDB node to the OVSDB
MD-SAL operational data store. The operational data store contains
OVSDB node objects which represent active connections to OVSDB
nodes.</dd>
<dt>Step 3</dt>
<dd>The OVSDB Southbound provider requests the schema and databases
which are supported by the OVSDB node.</dd>
<dt>Step 4</dt>
<dd>The OVSDB Southbound provider uses the database and schema
information to construct a monitor request which causes the OVSDB
node to send back any updates which have been made to the OVSDB
databases on the OVSDB node.</dd>
</dl>
</div>
</div>
<div class="section" id="ovsdb-node-id-in-the-southbound-operational-md-sal">
<h4>OVSDB Node ID in the Southbound Operational MD-SAL<a class="headerlink" href="#ovsdb-node-id-in-the-southbound-operational-md-sal" title="Permalink to this headline">¶</a></h4>
<p>When OpenDaylight initiates an active connection to an OVSDB node, it
writes an external-id to the Open_vSwitch table on the OVSDB node. The
external-id is an OpenDaylight instance identifier which identifies the
OVSDB topology node which has just been created. Here is an example
showing the value of the <em>opendaylight-iid</em> entry in the external-ids
column of the Open_vSwitch table where the node-id of the OVSDB node is
<em>ovsdb:HOST1</em>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ovs-vsctl list open_vswitch
...
external_ids        : {opendaylight-iid=&quot;/network-topology:network-topology/network-topology:topology[network-topology:topology-id=&#39;ovsdb:1&#39;]/network-topology:node[network-topology:node-id=&#39;ovsdb:HOST1&#39;]&quot;}
...
</pre></div>
</div>
<p>The <em>opendaylight-iid</em> entry in the external-ids column of the
Open_vSwitch table causes the OVSDB node to have same node-id in the
operational MD-SAL datastore as in the configuration MD-SAL datastore.
This holds true if the OVSDB node manager settings are subsequently
changed so that a passive OVSDB manager connection is made.</p>
<p>If there is no <em>opendaylight-iid</em> entry in the external-ids column and a
passive OVSDB manager connection is made, then the node-id of the OVSDB
node in the operational MD-SAL datastore will be constructed using the
UUID of the Open_vSwitch table as follows.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;node-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ovsdb://uuid/b8dc0bfb-d22b-4938-a2e8-b0084d7bd8c1&quot;</span>
</pre></div>
</div>
<p>The <em>opendaylight-iid</em> entry can be removed from the Open_vSwitch table
using the following command.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo ovs-vsctl remove open_vswitch . external-id &quot;opendaylight-iid&quot;
</pre></div>
</div>
</div>
<div class="section" id="ovsdb-changes-by-using-ovsdb-southbound-config-md-sal">
<h4>OVSDB Changes by using OVSDB Southbound Config MD-SAL<a class="headerlink" href="#ovsdb-changes-by-using-ovsdb-southbound-config-md-sal" title="Permalink to this headline">¶</a></h4>
<p>After the connection has been made to an OVSDB node, you can make
changes to the OVSDB node by using the OVSDB Southbound Config MD-SAL.
You can make CRUD operations by using the RESTCONF interface or by a
plugin using the MD-SAL APIs. The following diagram illustrates the
highlevel flow of events.</p>
<div class="figure" id="id128">
<img alt="OVSDB Changes by using the Southbound Config MD-SAL" src="../_images/ovsdb-sb-config-crud.jpg" />
<p class="caption"><span class="caption-text">OVSDB Changes by using the Southbound Config MD-SAL</span></p>
</div>
<dl class="docutils">
<dt>Step 1</dt>
<dd>A change to the OVSDB Southbound Config MD-SAL is made. Changes
include adding or deleting bridges and ports, or setting attributes
of OVSDB nodes, bridges or ports.</dd>
<dt>Step 2</dt>
<dd>The OVSDB Southbound provider receives notification of the changes
made to the OVSDB Southbound Config MD-SAL data store.</dd>
<dt>Step 3</dt>
<dd>As appropriate, OVSDB transactions are constructed and transmitted
to the OVSDB node to update the OVSDB database on the OVSDB node.</dd>
<dt>Step 4</dt>
<dd>The OVSDB node sends update messages to the OVSDB Southbound
provider to indicate the changes made to the OVSDB nodes database.</dd>
<dt>Step 5</dt>
<dd>The OVSDB Southbound provider maps the changes received from the
OVSDB node into corresponding changes made to the OVSDB Southbound
Operational MD-SAL data store.</dd>
</dl>
</div>
<div class="section" id="detecting-changes-in-ovsdb-coming-from-outside-opendaylight">
<h4>Detecting changes in OVSDB coming from outside OpenDaylight<a class="headerlink" href="#detecting-changes-in-ovsdb-coming-from-outside-opendaylight" title="Permalink to this headline">¶</a></h4>
<p>Changes to the OVSDB nodes database may also occur independently of
OpenDaylight. OpenDaylight also receives notifications for these events
and updates the Southbound operational MD-SAL. The following diagram
illustrates the sequence of events.</p>
<div class="figure" id="id129">
<img alt="OVSDB Changes made directly on the OVSDB node" src="../_images/ovsdb-sb-oper-crud.jpg" />
<p class="caption"><span class="caption-text">OVSDB Changes made directly on the OVSDB node</span></p>
</div>
<dl class="docutils">
<dt>Step 1</dt>
<dd>Changes are made to the OVSDB node outside of OpenDaylight (e.g.
ovs-vsctl).</dd>
<dt>Step 2</dt>
<dd>The OVSDB node constructs update messages to inform OpenDaylight of
the changes made to its databases.</dd>
<dt>Step 3</dt>
<dd>The OVSDB Southbound provider maps the OVSDB database changes to
corresponding changes in the OVSDB Southbound operational MD-SAL
data store.</dd>
</dl>
</div>
<div class="section" id="ovsdb-model">
<h4>OVSDB Model<a class="headerlink" href="#ovsdb-model" title="Permalink to this headline">¶</a></h4>
<p>The OVSDB Southbound MD-SAL operates using a YANG model which is based
on the abstract topology node model found in the <a class="reference external" href="https://github.com/opendaylight/yangtools/blob/stable/lithium/model/ietf/ietf-topology/src/main/yang/network-topology%402013-10-21.yang">network topology
model</a>.</p>
<p>The augmentations for the OVSDB Southbound MD-SAL are defined in the
<a class="reference external" href="https://github.com/opendaylight/ovsdb/blob/stable/lithium/southbound/southbound-api/src/main/yang/ovsdb.yang">ovsdb.yang</a>
file.</p>
<p>There are three augmentations:</p>
<dl class="docutils">
<dt><strong>ovsdb-node-augmentation</strong></dt>
<dd><p class="first">This augments the topology node and maps primarily to the
Open_vSwitch table of the OVSDB schema. It contains the following
attributes.</p>
<ul class="last simple">
<li><strong>connection-info</strong> - holds the local and remote IP address and
TCP port numbers for the OpenDaylight to OVSDB node connections</li>
<li><strong>db-version</strong> - version of the OVSDB database</li>
<li><strong>ovs-version</strong> - version of OVS</li>
<li><strong>list managed-node-entry</strong> - a list of references to
ovsdb-bridge-augmentation nodes, which are the OVS bridges
managed by this OVSDB node</li>
<li><strong>list datapath-type-entry</strong> - a list of the datapath types
supported by the OVSDB node (e.g. <em>system</em>, <em>netdev</em>) - depends
on newer OVS versions</li>
<li><strong>list interface-type-entry</strong> - a list of the interface types
supported by the OVSDB node (e.g. <em>internal</em>, <em>vxlan</em>, <em>gre</em>,
<em>dpdk</em>, etc.) - depends on newer OVS verions</li>
<li><strong>list openvswitch-external-ids</strong> - a list of the key/value pairs
in the Open_vSwitch table external_ids column</li>
<li><strong>list openvswitch-other-config</strong> - a list of the key/value pairs
in the Open_vSwitch table other_config column</li>
</ul>
</dd>
<dt><strong>ovsdb-bridge-augmentation</strong></dt>
<dd><p class="first">This augments the topology node and maps to an specific bridge in
the OVSDB bridge table of the associated OVSDB node. It contains the
following attributes.</p>
<ul class="last simple">
<li><strong>bridge-uuid</strong> - UUID of the OVSDB bridge</li>
<li><strong>bridge-name</strong> - name of the OVSDB bridge</li>
<li><strong>bridge-openflow-node-ref</strong> - a reference (instance-identifier)
of the OpenFlow node associated with this bridge</li>
<li><strong>list protocol-entry</strong> - the version of OpenFlow protocol to use
with the OpenFlow controller</li>
<li><strong>list controller-entry</strong> - a list of controller-uuid and
is-connected status of the OpenFlow controllers associated with
this bridge</li>
<li><strong>datapath-id</strong> - the datapath ID associated with this bridge on
the OVSDB node</li>
<li><strong>datapath-type</strong> - the datapath type of this bridge</li>
<li><strong>fail-mode</strong> - the OVSDB fail mode setting of this bridge</li>
<li><strong>flow-node</strong> - a reference to the flow node corresponding to
this bridge</li>
<li><strong>managed-by</strong> - a reference to the ovsdb-node-augmentation
(OVSDB node) that is managing this bridge</li>
<li><strong>list bridge-external-ids</strong> - a list of the key/value pairs in
the bridge table external_ids column for this bridge</li>
<li><strong>list bridge-other-configs</strong> - a list of the key/value pairs in
the bridge table other_config column for this bridge</li>
</ul>
</dd>
<dt><strong>ovsdb-termination-point-augmentation</strong></dt>
<dd><p class="first">This augments the topology termination point model. The OVSDB
Southbound MD-SAL uses this model to represent both the OVSDB port
and OVSDB interface for a given port/interface in the OVSDB schema.
It contains the following attributes.</p>
<ul class="last simple">
<li><strong>port-uuid</strong> - UUID of an OVSDB port row</li>
<li><strong>interface-uuid</strong> - UUID of an OVSDB interface row</li>
<li><strong>name</strong> - name of the port</li>
<li><strong>interface-type</strong> - the interface type</li>
<li><strong>list options</strong> - a list of port options</li>
<li><strong>ofport</strong> - the OpenFlow port number of the interface</li>
<li><strong>ofport_request</strong> - the requested OpenFlow port number for the
interface</li>
<li><strong>vlan-tag</strong> - the VLAN tag value</li>
<li><strong>list trunks</strong> - list of VLAN tag values for trunk mode</li>
<li><strong>vlan-mode</strong> - the VLAN mode (e.g. access, native-tagged,
native-untagged, trunk)</li>
<li><strong>list port-external-ids</strong> - a list of the key/value pairs in the
port table external_ids column for this port</li>
<li><strong>list interface-external-ids</strong> - a list of the key/value pairs
in the interface table external_ids interface for this interface</li>
<li><strong>list port-other-configs</strong> - a list of the key/value pairs in
the port table other_config column for this port</li>
<li><strong>list interface-other-configs</strong> - a list of the key/value pairs
in the interface table other_config column for this interface</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="examples-of-ovsdb-southbound-md-sal-api">
<h3>Examples of OVSDB Southbound MD-SAL API<a class="headerlink" href="#examples-of-ovsdb-southbound-md-sal-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="connect-to-an-ovsdb-node">
<h4>Connect to an OVSDB Node<a class="headerlink" href="#connect-to-an-ovsdb-node" title="Permalink to this headline">¶</a></h4>
<p>This example RESTCONF command adds an OVSDB node object to the OVSDB
Southbound configuration data store and attempts to connect to the OVSDB
host located at the IP address 10.11.12.1 on TCP port 6640.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">8181</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="p">:</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">/</span><span class="n">ovsdb</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<span class="p">{</span>
  <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">[</span>
     <span class="p">{</span>
       <span class="s2">&quot;node-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ovsdb:HOST1&quot;</span><span class="p">,</span>
       <span class="s2">&quot;connection-info&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s2">&quot;ovsdb:remote-ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.11.12.1&quot;</span><span class="p">,</span>
         <span class="s2">&quot;ovsdb:remote-port&quot;</span><span class="p">:</span> <span class="mi">6640</span>
       <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="query-the-ovsdb-southbound-configuration-md-sal">
<h4>Query the OVSDB Southbound Configuration MD-SAL<a class="headerlink" href="#query-the-ovsdb-southbound-configuration-md-sal" title="Permalink to this headline">¶</a></h4>
<p>Following on from the previous example, if the OVSDB Southbound
configuration MD-SAL is queried, the RESTCONF command and the resulting
reply is similar to the following example.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">host</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">restconf</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="p">:</span><span class="n">network</span><span class="o">-</span><span class="n">topology</span><span class="o">/</span><span class="n">topology</span><span class="o">/</span><span class="n">ovsdb</span><span class="p">:</span><span class="mi">1</span><span class="o">/</span>
<span class="n">Application</span><span class="o">/</span><span class="n">json</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">reply</span>
<span class="p">{</span>
  <span class="s2">&quot;topology&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;topology-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ovsdb:1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;node-id&quot;</span><span class="p">:</span> <span class="s2">&quot;ovsdb:HOST1&quot;</span><span class="p">,</span>
          <span class="s2">&quot;ovsdb:connection-info&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;remote-port&quot;</span><span class="p">:</span> <span class="mi">6640</span><span class="p">,</span>
            <span class="s2">&quot;remote-ip&quot;</span><span class="p">:</span> <span class="s2">&quot;10.11.12.1&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reference-documentation">
<h3>Reference Documentation<a class="headerlink" href="#reference-documentation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf">Openvswitch
schema</a></p>
</div>
</div>
<div class="section" id="ovsdb-openstack-developer-guide">
<h2>OVSDB Openstack Developer Guide<a class="headerlink" href="#ovsdb-openstack-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id54">
<h3>Overview<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h3>
<p>The Open vSwitch database (OVSDB) Plugin component for OpenDaylight
implements the OVSDB <a class="reference external" href="https://tools.ietf.org/html/rfc7047">RFC 7047</a>
management protocol that allows the southbound configuration of switches
that support OVSDB. The component comprises a library and a plugin
usages. The OVSDB protocol uses JSON-RPC calls to manipulate a physical
or virtual switch that supports OVSDB. Many vendors support OVSDB on
various hardware platforms. The OpenDaylight controller uses the library
project to interact with an OVS instance.</p>
<p><a class="reference external" href="http://www.openstack.org">OpenStack</a> is a popular open source
infrastructure as a service project, covering compute, storage and
network management. OpenStack can use OpenDaylight as its network
management provider through the Neutron API, which acts as a northbound
for OpenStack. The providers for the Neutron API are in the OVSDB
Net-virt piece of OVSDB. OpenDaylight manages the network flows for the
OpenStack compute nodes via the OVSDB project, with the south-bound
plugin. This section describes how to set that up, and how to tell when
everything is working.</p>
</div>
<div class="section" id="ovsdb-openstack-architecture">
<h3>OVSDB Openstack Architecture<a class="headerlink" href="#ovsdb-openstack-architecture" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">The OpenStack integration architecture uses the following
technologies:</div>
</div>
<ul class="simple">
<li><a class="reference external" href="https://tools.ietf.org/html/rfc7047">RFC 7047</a> - The Open vSwitch
Database Management Protocol</li>
<li><a class="reference external" href="http://www.opennetworking.org/images/stories/downloads/sdn-resources/onf-specifications/openflow/openflow-switch-v1.3.4.pdf">OpenFlow
v1.3</a></li>
<li><a class="reference external" href="https://wiki.openstack.org/wiki/Neutron/ML2">OpenStack Neutron ML2
Plugin</a></li>
</ul>
<p><img alt="Openstack Integration" src="../_images/openstack_integration.png" /></p>
</div>
</div>
<div class="section" id="ovsdb-service-function-chaining-developer-guide">
<h2>OVSDB Service Function Chaining Developer Guide<a class="headerlink" href="#ovsdb-service-function-chaining-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id55">
<h3>Overview<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="ovsdb-hardware-vtep-architecture">
<h3>OVSDB Hardware VTEP Architecture<a class="headerlink" href="#ovsdb-hardware-vtep-architecture" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="ovsdb-hardware-vtep-developer-guide">
<h2>OVSDB Hardware VTEP Developer Guide<a class="headerlink" href="#ovsdb-hardware-vtep-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id56">
<h3>Overview<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
<div class="section" id="id57">
<h3>OVSDB Hardware VTEP Architecture<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h3>
<p>TBD</p>
</div>
</div>
<div class="section" id="pcep-developer-guide">
<h2>PCEP Developer Guide<a class="headerlink" href="#pcep-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id58">
<h3>Overview<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h3>
<p>This section provides an overview of <strong>feature odl-bgpcep-pcep-all</strong> .
This feature will install everything needed for PCEP (Path Computation
Element Protocol) including establishing the connection, storing
information about LSPs (Label Switched Paths) and displaying data in
network-topology overview.</p>
</div>
<div class="section" id="pcep-architecture">
<h3>PCEP Architecture<a class="headerlink" href="#pcep-architecture" title="Permalink to this headline">¶</a></h3>
<p>Each feature represents a module in the BGPCEP codebase. The following
diagram illustrates how the features are related.</p>
<div class="figure" id="id130">
<img alt="PCEP Dependency Tree" src="../_images/pcep-dependency-tree.png" />
<p class="caption"><span class="caption-text">PCEP Dependency Tree</span></p>
</div>
</div>
<div class="section" id="id59">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pcep">
<h4>PCEP<a class="headerlink" href="#pcep" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id60">
<h5>Session handling<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h5>
<p><em>32-pcep.xml</em> defines only pcep-dispatcher the parser should be using
(global-pcep-extensions), factory for creating session proposals (you
can create different proposals for different PCCs (Path Computation
Clients)).</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:impl&quot;</span><span class="o">&gt;</span><span class="n">prefix</span><span class="p">:</span><span class="n">pcep</span><span class="o">-</span><span class="n">dispatcher</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">pcep</span><span class="o">-</span><span class="n">dispatcher</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">pcep</span><span class="o">-</span><span class="n">extensions</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">pcepspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:spi&quot;</span><span class="o">&gt;</span><span class="n">pcepspi</span><span class="p">:</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">pcep</span><span class="o">-</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">pcep</span><span class="o">-</span><span class="n">extensions</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">pcep</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">proposal</span><span class="o">-</span><span class="n">factory</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">pcep</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep&quot;</span><span class="o">&gt;</span><span class="n">pcep</span><span class="p">:</span><span class="n">pcep</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">proposal</span><span class="o">-</span><span class="n">factory</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">stateful07</span><span class="o">-</span><span class="n">proposal</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">pcep</span><span class="o">-</span><span class="n">session</span><span class="o">-</span><span class="n">proposal</span><span class="o">-</span><span class="n">factory</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">netty</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:netty&quot;</span><span class="o">&gt;</span><span class="n">netty</span><span class="p">:</span><span class="n">netty</span><span class="o">-</span><span class="n">threadgroup</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">boss</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">netty</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:netty&quot;</span><span class="o">&gt;</span><span class="n">netty</span><span class="p">:</span><span class="n">netty</span><span class="o">-</span><span class="n">threadgroup</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">worker</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For user configuration of PCEP, check User Guide.</p>
</div>
<div class="section" id="parser">
<h5>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h5>
<p>The base PCEP parser includes messages and attributes from
<a class="reference external" href="http://tools.ietf.org/html/rfc5441">RFC5441</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc5541">RFC5541</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc5455">RFC5455</a>,
<a class="reference external" href="http://tools.ietf.org/html/rfc5557">RFC5557</a> and
<a class="reference external" href="http://tools.ietf.org/html/rfc5521">RFC5521</a>.</p>
</div>
<div class="section" id="id61">
<h5>Registration<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h5>
<p>All parsers and serializers need to be registered into <em>Extension
provider</em>. This <em>Extension provider</em> is configured in initial
configuration of the parser-spi module (<em>32-pcep.xml</em>).</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:spi&quot;</span><span class="o">&gt;</span><span class="n">prefix</span><span class="p">:</span><span class="n">pcep</span><span class="o">-</span><span class="n">extensions</span><span class="o">-</span><span class="n">impl</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="k">global</span><span class="o">-</span><span class="n">pcep</span><span class="o">-</span><span class="n">extensions</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">extension</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">pcepspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:spi&quot;</span><span class="o">&gt;</span><span class="n">pcepspi</span><span class="p">:</span><span class="n">extension</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">pcep</span><span class="o">-</span><span class="n">parser</span><span class="o">-</span><span class="n">base</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">extension</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">extension</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">pcepspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:spi&quot;</span><span class="o">&gt;</span><span class="n">pcepspi</span><span class="p">:</span><span class="n">extension</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">pcep</span><span class="o">-</span><span class="n">parser</span><span class="o">-</span><span class="n">ietf</span><span class="o">-</span><span class="n">stateful07</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">extension</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">extension</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">pcepspi</span><span class="o">=</span><span class="s2">&quot;urn:opendaylight:params:xml:ns:yang:controller:pcep:spi&quot;</span><span class="o">&gt;</span><span class="n">pcepspi</span><span class="p">:</span><span class="n">extension</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">pcep</span><span class="o">-</span><span class="n">parser</span><span class="o">-</span><span class="n">ietf</span><span class="o">-</span><span class="n">initiated00</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">extension</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><em>pcep-parser-base</em> - will register parsers and serializers
implemented in pcep-impl module</li>
<li><em>pcep-parser-ietf-stateful07</em> - will register parsers and serializers
implemented in stateful07 module</li>
</ul>
<p>Stateful07 module is a good example of a PCEP parser extension.</p>
<p>Configuration of PCEP parsers specifies one implementation of <em>Extension
provider</em> that will take care of registering mentioned parser
extensions:
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/spi/src/main/java/org/opendaylight/protocol/pcep/spi/pojo/SimplePCEPExtensionProviderContext.java;hb=refs/for/stable/lithium">SimplePCEPExtensionProviderContext</a>.
All registries are implemented in package
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=tree;f=pcep/spi/src/main/java/org/opendaylight/protocol/pcep/spi/pojo;hb=refs/for/stable/lithium">pcep-spi</a>.</p>
</div>
<div class="section" id="parsing">
<h5>Parsing<a class="headerlink" href="#parsing" title="Permalink to this headline">¶</a></h5>
<p>Parsing of PCEP elements is mostly done equally to BGP, the only
exception is message parsing, that is described here.</p>
<p>In BGP messages, parsing of first-level elements (path-attributes) can
be validated in a simple way, as the attributes should be ordered
chronologically. PCEP, on the other hand, has a strict object order
policy, that is described in RBNF (Routing Backus-Naur Form) in each
RFC. Therefore the algorithm for parsing here is to parse all objects in
order as they appear in the message. The result of parsing is a list of
<em>PCEPObjects</em>, that is put through validation. <em>validate()</em> methods are
present in each message parser. Depending on the complexity of the
message, it can contain either a simple condition (checking the presence
of a mandatory object) or a full state machine.</p>
<p>In addition to that, PCEP requires sending error message for each
documented parsing error. This is handled by creating an empty list of
messages <em>errors</em> which is then passed as argument throughout whole
parsing process. If some parser encounters <em>PCEPDocumentedException</em>, it
has the duty to create appropriate PCEP error message and add it to this
list. In the end, when the parsing is finished, this list is examined
and all messages are sent to peer.</p>
<p>Better understanding provides this sequence diagram:</p>
<div class="figure" id="id131">
<img alt="Parsing" src="../_images/pcep-parsing.png" />
<p class="caption"><span class="caption-text">Parsing</span></p>
</div>
</div>
</div>
<div class="section" id="pcep-ietf-stateful">
<h4>PCEP IETF stateful<a class="headerlink" href="#pcep-ietf-stateful" title="Permalink to this headline">¶</a></h4>
<p>This section summarizes module pcep-ietf-stateful07. The term <em>stateful</em>
refers to
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-pce-stateful-pce">draft-ietf-pce-stateful-pce</a>
and
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-pce-pce-initiated-lsp">draft-ietf-pce-pce-initiated-lsp</a>
in versions draft-ietf-pce-stateful-pce-07 with
draft-ietf-pce-pce-initiated-lsp-00.</p>
<p>We will upgrade our implementation, when the stateful draft gets
promoted to RFC.</p>
<p>The stateful module is implemented as extensions to pcep-base-parser.
The stateful draft declared new elements as well as additional fields or
TLVs (type,length,value) to known objects. All new elements are defined
in yang models, that contain augmentations to elements defined in
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/api/src/main/yang/pcep-types.yang;hb=refs/for/stable/lithium">pcep-types.yang</a>.
In the case of extending known elements, the <em>Parser</em> class merely
extends the base class and overrides necessary methods as shown in
following diagram:</p>
<div class="figure" id="id132">
<img alt="Extending existing parsers" src="../_images/validation.png" />
<p class="caption"><span class="caption-text">Extending existing parsers</span></p>
</div>
<p>All parsers (including those for newly defined PCEP elements) have to be
registered via the <em>Activator</em> class. This class is present in both
modules.</p>
<p>In addition to parsers, the stateful module also introduces additional
session proposal. This proposal includes new fields defined in stateful
drafts for Open object.</p>
</div>
<div class="section" id="pcep-segment-routing-sr">
<h4>PCEP segment routing (SR)<a class="headerlink" href="#pcep-segment-routing-sr" title="Permalink to this headline">¶</a></h4>
<p>PCEP Segment Routing is an extension of base PCEP and
pcep-ietf-stateful-07 extension. The pcep-segment-routing module
implements
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-pce-segment-routing-01">draft-ietf-pce-segment-routing-01</a>.</p>
<p>The extension brings new SR-ERO (Explicit Route Object) and SR-RRO
(Reported Route Object) subobject composed of SID (Segment Identifier)
and/or NAI (Node or Adjacency Identifier). The segment Routing path is
carried in the ERO and RRO object, as a list of SR-ERO/SR-RRO subobjects
in an order specified by the user. The draft defines new TLV -
SR-PCE-CAPABILITY TLV, carried in PCEP Open object, used to negotiate
Segment Routing ability.</p>
<div class="line-block">
<div class="line">The yang models of subobject, SR-PCE-CAPABILITY TLV and appropriate
augmentations are defined in
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/segment-routing/src/main/yang/odl-pcep-segment-routing.yang;hb=refs/for/stable/lithium">odl-pcep-segment-routing.yang</a>.</div>
<div class="line">The pcep-segment-routing module includes parsers/serializers for new
subobject
(<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/segment-routing/src/main/java/org/opendaylight/protocol/pcep/segment/routing/SrEroSubobjectParser.java;hb=refs/for/stable/lithium">SrEroSubobjectParser</a>)
and TLV
(<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/segment-routing/src/main/java/org/opendaylight/protocol/pcep/segment/routing/SrPceCapabilityTlvParser.java;hb=refs/for/stable/lithium">SrPceCapabilityTlvParser</a>).</div>
</div>
<p>The pcep-segment-routing module implements
<a class="reference external" href="http://tools.ietf.org/html/draft-ietf-pce-lsp-setup-type-01">draft-ietf-pce-lsp-setup-type-01</a>,
too. The draft defines new TLV - Path Setup Type TLV, which value
indicate path setup signaling technique. The TLV may be included in
RP(Request Parameters)/SRP(Stateful PCE Request Parameters) object. For
the default RSVP-TE (Resource Reservation Protocol), the TLV is omitted.
For Segment Routing, PST = 1 is defined.</p>
<p>The Path Setup Type TLV is modeled with yang in module
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/api/src/main/yang/pcep-types.yang;hb=refs/for/stable/lithium">pcep-types.yang</a>.
A parser/serializer is implemented in
<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=bgpcep.git;a=blob;f=pcep/impl/src/main/java/org/opendaylight/protocol/pcep/impl/tlv/PathSetupTypeTlvParser.java;hb=refs/for/stable/lithium">PathSetupTypeTlvParser</a>
and it is overriden in segment-routing module to provide the aditional
PST.</p>
</div>
<div class="section" id="pcep-topology">
<h4>PCEP Topology<a class="headerlink" href="#pcep-topology" title="Permalink to this headline">¶</a></h4>
<p>PCEP data is displayed only through one URL that is accessible from the
base network-topology URL:</p>
<p><em>http://localhost:8181/restconf/operational/network-topology:network-topology/topology/pcep-topology</em></p>
<p>Each PCC will be displayed as a node:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">computation</span><span class="o">-</span><span class="n">client</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span><span class="mf">42.42</span><span class="o">.</span><span class="mf">42.42</span><span class="o">&lt;/</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">state</span><span class="o">-</span><span class="n">sync</span><span class="o">&gt;</span><span class="n">synchronized</span><span class="o">&lt;/</span><span class="n">state</span><span class="o">-</span><span class="n">sync</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">stateful</span><span class="o">-</span><span class="n">tlv</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">stateful</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">initiation</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">initiation</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">lsp</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">capability</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">lsp</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">capability</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">stateful</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">stateful</span><span class="o">-</span><span class="n">tlv</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">path</span><span class="o">-</span><span class="n">computation</span><span class="o">-</span><span class="n">client</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">node</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="n">pcc</span><span class="p">:</span><span class="o">//</span><span class="mf">42.42</span><span class="o">.</span><span class="mf">42.42</span><span class="o">&lt;/</span><span class="n">node</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">node</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">source</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If some tunnels are configured on the network, they would be displayed
on the same page, within a node that initiated the tunnel:</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">computation</span><span class="o">-</span><span class="n">client</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">state</span><span class="o">-</span><span class="n">sync</span><span class="o">&gt;</span><span class="n">synchronized</span><span class="o">&lt;/</span><span class="n">state</span><span class="o">-</span><span class="n">sync</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">stateful</span><span class="o">-</span><span class="n">tlv</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">stateful</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">initiation</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">initiation</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">lsp</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">capability</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">lsp</span><span class="o">-</span><span class="n">update</span><span class="o">-</span><span class="n">capability</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">stateful</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">stateful</span><span class="o">-</span><span class="n">tlv</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">reported</span><span class="o">-</span><span class="n">lsp</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">foo</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">lsp</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">operational</span><span class="o">&gt;</span><span class="n">down</span><span class="o">&lt;/</span><span class="n">operational</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">sync</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">sync</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ignore</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">ignore</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">plsp</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">plsp</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">create</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">create</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">administrative</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">administrative</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">remove</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">remove</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">delegate</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">delegate</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">processing</span><span class="o">-</span><span class="n">rule</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">processing</span><span class="o">-</span><span class="n">rule</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">tlvs</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">lsp</span><span class="o">-</span><span class="n">identifiers</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">ipv4</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">ipv4</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="n">sender</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span><span class="mf">43.43</span><span class="o">.</span><span class="mf">43.43</span><span class="o">&lt;/</span><span class="n">ipv4</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="n">sender</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">ipv4</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="n">endpoint</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">&lt;/</span><span class="n">ipv4</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="n">endpoint</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span>
       <span class="o">&lt;</span><span class="n">ipv4</span><span class="o">-</span><span class="n">extended</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">&lt;/</span><span class="n">ipv4</span><span class="o">-</span><span class="n">extended</span><span class="o">-</span><span class="n">tunnel</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">ipv4</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">tunnel</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">tunnel</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">lsp</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">lsp</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">lsp</span><span class="o">-</span><span class="n">identifiers</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">symbolic</span><span class="o">-</span><span class="n">path</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Zm9v</span><span class="o">&lt;/</span><span class="n">path</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
     <span class="o">&lt;/</span><span class="n">symbolic</span><span class="o">-</span><span class="n">path</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">tlvs</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">lsp</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">reported</span><span class="o">-</span><span class="n">lsp</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span><span class="mf">43.43</span><span class="o">.</span><span class="mf">43.43</span><span class="o">&lt;/</span><span class="n">ip</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span>
 <span class="o">&lt;/</span><span class="n">path</span><span class="o">-</span><span class="n">computation</span><span class="o">-</span><span class="n">client</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">node</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span><span class="n">pcc</span><span class="p">:</span><span class="o">//</span><span class="mf">43.43</span><span class="o">.</span><span class="mf">43.43</span><span class="o">&lt;/</span><span class="n">node</span><span class="o">-</span><span class="nb">id</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">node</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that, the <em>&lt;path-name&gt;</em> tag displays tunnel name in Base64
encoding.</p>
</div>
</div>
<div class="section" id="id62">
<h3>API Reference Documentation<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h3>
<p>Javadocs are generated while creating mvn:site and they are located in
target/ directory in each module.</p>
</div>
</div>
<div class="section" id="packetcable-developer-guide">
<h2>PacketCable Developer Guide<a class="headerlink" href="#packetcable-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pcmm-specification">
<h3>PCMM Specification<a class="headerlink" href="#pcmm-specification" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.cablelabs.com/specification/packetcable-multimedia-specification">PacketCable™ Multimedia
Specification</a></p>
</div>
<div class="section" id="system-overview">
<h3>System Overview<a class="headerlink" href="#system-overview" title="Permalink to this headline">¶</a></h3>
<p>These components introduce a DOCSIS QoS Service Flow management using
the PCMM protocol. The driver component is responsible for the
PCMM/COPS/PDP functionality required to service requests from
PacketCable Provider and FlowManager. Requests are transposed into PCMM
Gate Control messages and transmitted via COPS to the CCAP/CMTS. This
plugin adheres to the PCMM/COPS/PDP functionality defined in the
CableLabs specification. PacketCable solution is an MDSAL compliant
component.</p>
</div>
<div class="section" id="packetcable-components">
<h3>PacketCable Components<a class="headerlink" href="#packetcable-components" title="Permalink to this headline">¶</a></h3>
<p>The packetcable maven project is comprised of several modules.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bundle</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>packetcable-driver</td>
<td>A common module that containts the
COPS stack and manages all
connections to CCAPS/CMTSes.</td>
</tr>
<tr class="row-odd"><td>packetcable-emulator</td>
<td>A basic CCAP emulator to facilitate
testing the the plugin when no
physical CCAP is avaible.</td>
</tr>
<tr class="row-even"><td>packetcable-policy-karaf</td>
<td>Generates a Karaf distribution with
a config that loads all the
packetcable features at runtime.</td>
</tr>
<tr class="row-odd"><td>packetcable-policy-model</td>
<td>Contains the YANG information model.</td>
</tr>
<tr class="row-even"><td>packetcable-policy-server</td>
<td>Provider hosts the model processing,
RESTCONF, and API implementation.</td>
</tr>
</tbody>
</table>
<div class="section" id="setting-logging-levels">
<h4>Setting Logging Levels<a class="headerlink" href="#setting-logging-levels" title="Permalink to this headline">¶</a></h4>
<p>From the Karaf console</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">log</span><span class="p">:</span><span class="nb">set</span> <span class="o">&lt;</span><span class="n">LEVEL</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">PACKAGE</span><span class="o">&gt;|&lt;</span><span class="n">BUNDLE</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">Example</span>
<span class="n">log</span><span class="p">:</span><span class="nb">set</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">packetcable</span><span class="o">.</span><span class="n">packetcable</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tools-for-testing">
<h3>Tools for Testing<a class="headerlink" href="#tools-for-testing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="postman-rest-client-for-chrome">
<h4>Postman REST client for Chrome<a class="headerlink" href="#postman-rest-client-for-chrome" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en">Install the Chrome
extension</a></p>
<p><a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=packetcable.git;a=tree;f=packetcable-policy-server/doc/restconf-samples">Download and import sample packetcable
collection</a></p>
</div>
<div class="section" id="view-rest-api">
<h4>View Rest API<a class="headerlink" href="#view-rest-api" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Install the <code class="docutils literal"><span class="pre">odl-mdsal-apidocs</span></code> feature from the karaf console.</li>
<li>Open <a class="reference external" href="http://localhost:8181/apidoc/explorer/index.html">http://localhost:8181/apidoc/explorer/index.html</a> default dev
build user/pass is admin/admin</li>
<li>Navigate to the PacketCable section.</li>
</ol>
</div>
<div class="section" id="yang-ide">
<h4>Yang-IDE<a class="headerlink" href="#yang-ide" title="Permalink to this headline">¶</a></h4>
<p>Editing yang can be done in any text editor but Yang-IDE will help
prevent mistakes.</p>
<p><a class="reference external" href="https://github.com/xored/yang-ide/wiki/Setup-and-build">Setup and Build Yang-IDE for
Eclipse</a></p>
</div>
</div>
<div class="section" id="using-wireshark-to-trace-pcmm">
<h3>Using Wireshark to Trace PCMM<a class="headerlink" href="#using-wireshark-to-trace-pcmm" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">To start wireshark with privileges issue the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">wireshark</span> <span class="o">&amp;</span>
</pre></div>
</div>
</li>
<li><p class="first">Select the interface to monitor.</p>
</li>
<li><p class="first">Use the Filter to only display COPS messages by applying “cops” in
the filter field.</p>
</li>
</ol>
<p><a class="reference internal" href="../_images/Screenshot8.png"><img alt="Screenshot8" src="../_images/Screenshot8.png" style="width: 500px;" /></a></p>
</div>
<div class="section" id="debugging-and-verifying-dqos-gate-flows-on-the-ccap-cmts">
<h3>Debugging and Verifying DQoS Gate (Flows) on the CCAP/CMTS<a class="headerlink" href="#debugging-and-verifying-dqos-gate-flows-on-the-ccap-cmts" title="Permalink to this headline">¶</a></h3>
<p>Below are some of the most useful CCAP/CMTS commands to verify flows
have been enabled on the CMTS.</p>
<div class="section" id="cisco">
<h4>Cisco<a class="headerlink" href="#cisco" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.cisco.com/c/en/us/td/docs/cable/cmts/cmd_ref/b_cmts_cable_cmd_ref.pdf">Cisco CMTS Cable Command
Reference</a></p>
</div>
<div class="section" id="find-the-cable-modem">
<h4>Find the Cable Modem<a class="headerlink" href="#find-the-cable-modem" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="n">k2</span><span class="o">-</span><span class="n">DSG</span><span class="c1">#show cable modem</span>
                                                                                  <span class="n">D</span>
<span class="n">MAC</span> <span class="n">Address</span>    <span class="n">IP</span> <span class="n">Address</span>      <span class="n">I</span><span class="o">/</span><span class="n">F</span>           <span class="n">MAC</span>           <span class="n">Prim</span> <span class="n">RxPwr</span>  <span class="n">Timing</span> <span class="n">Num</span> <span class="n">I</span>
                                             <span class="n">State</span>         <span class="n">Sid</span>  <span class="p">(</span><span class="n">dBmv</span><span class="p">)</span> <span class="n">Offset</span> <span class="n">CPE</span> <span class="n">P</span>
<span class="mf">0010.188</span><span class="n">a</span><span class="o">.</span><span class="n">faf6</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>         <span class="n">C8</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">U0</span>     <span class="n">offline</span>       <span class="mi">1</span>    <span class="mf">0.00</span>   <span class="mi">1482</span>   <span class="mi">0</span>   <span class="n">N</span>
<span class="mi">74</span><span class="n">ae</span><span class="o">.</span><span class="mf">7600.01</span><span class="n">f3</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">115.150</span>   <span class="n">C8</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">U0</span>    <span class="n">online</span>        <span class="mi">1</span>    <span class="o">-</span><span class="mf">0.50</span>  <span class="mi">1431</span>   <span class="mi">0</span>   <span class="n">Y</span>
<span class="mf">0010.188</span><span class="n">a</span><span class="o">.</span><span class="n">fad8</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">115.142</span>   <span class="n">C8</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">UB</span>    <span class="n">w</span><span class="o">-</span><span class="n">online</span>      <span class="mi">2</span>    <span class="o">-</span><span class="mf">0.50</span>  <span class="mi">1507</span>   <span class="mi">1</span>   <span class="n">Y</span>
<span class="mi">000</span><span class="n">e</span><span class="o">.</span><span class="mf">0900.00</span><span class="n">dd</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">115.143</span>   <span class="n">C8</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">UB</span>    <span class="n">w</span><span class="o">-</span><span class="n">online</span>      <span class="mi">3</span>    <span class="mf">1.00</span>   <span class="mi">1677</span>   <span class="mi">0</span>   <span class="n">Y</span>
<span class="n">e86d</span><span class="o">.</span><span class="mf">5271.304</span><span class="n">f</span> <span class="mf">10.32</span><span class="o">.</span><span class="mf">115.168</span>   <span class="n">C8</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="n">UB</span>    <span class="n">w</span><span class="o">-</span><span class="n">online</span>      <span class="mi">6</span>    <span class="o">-</span><span class="mf">0.50</span>  <span class="mi">1419</span>   <span class="mi">1</span>   <span class="n">Y</span>
</pre></div>
</div>
</div>
<div class="section" id="show-pcmm-plugin-connection">
<h4>Show PCMM Plugin Connection<a class="headerlink" href="#show-pcmm-plugin-connection" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="n">k2</span><span class="o">-</span><span class="n">DSG</span><span class="c1">#show packetcabl ?</span>
  <span class="n">cms</span>     <span class="n">Gate</span> <span class="n">Controllers</span> <span class="n">connected</span> <span class="n">to</span> <span class="n">this</span> <span class="n">PacketCable</span> <span class="n">client</span>
  <span class="n">event</span>   <span class="n">Event</span> <span class="n">message</span> <span class="n">server</span> <span class="n">information</span>
  <span class="n">gate</span>    <span class="n">PacketCable</span> <span class="n">gate</span> <span class="n">information</span>
  <span class="k">global</span>  <span class="n">PacketCable</span> <span class="k">global</span> <span class="n">information</span>

<span class="mi">10</span><span class="n">k2</span><span class="o">-</span><span class="n">DSG</span><span class="c1">#show packetcable cms</span>
<span class="n">GC</span><span class="o">-</span><span class="n">Addr</span>        <span class="n">GC</span><span class="o">-</span><span class="n">Port</span>  <span class="n">Client</span><span class="o">-</span><span class="n">Addr</span>    <span class="n">COPS</span><span class="o">-</span><span class="n">handle</span>  <span class="n">Version</span> <span class="n">PSID</span> <span class="n">Key</span> <span class="n">PDD</span><span class="o">-</span><span class="n">Cfg</span>


<span class="mi">10</span><span class="n">k2</span><span class="o">-</span><span class="n">DSG</span><span class="c1">#show packetcable cms</span>
<span class="n">GC</span><span class="o">-</span><span class="n">Addr</span>        <span class="n">GC</span><span class="o">-</span><span class="n">Port</span>  <span class="n">Client</span><span class="o">-</span><span class="n">Addr</span>    <span class="n">COPS</span><span class="o">-</span><span class="n">handle</span>  <span class="n">Version</span> <span class="n">PSID</span> <span class="n">Key</span> <span class="n">PDD</span><span class="o">-</span><span class="n">Cfg</span>
<span class="mf">10.32</span><span class="o">.</span><span class="mf">0.240</span>    <span class="mi">54238</span>    <span class="mf">10.32</span><span class="o">.</span><span class="mf">15.3</span>     <span class="mh">0x4B9C8150</span><span class="o">/</span><span class="mi">1</span>    <span class="mf">4.0</span>   <span class="mi">0</span>    <span class="mi">0</span>   <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="show-cops-messages">
<h4>Show COPS Messages<a class="headerlink" href="#show-cops-messages" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">debug</span> <span class="n">cops</span> <span class="n">details</span>
</pre></div>
</div>
</div>
<div class="section" id="use-cm-mac-address-to-list-service-flows">
<h4>Use CM Mac Address to List Service Flows<a class="headerlink" href="#use-cm-mac-address-to-list-service-flows" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>10k2-DSG#show cable modem
                                                                                  D
MAC Address    IP Address      I/F           MAC           Prim RxPwr  Timing Num I
                                             State         Sid  (dBmv) Offset CPE P
0010.188a.faf6 ---             C8/0/0/UB     w-online      1    0.50   1480   1   N
74ae.7600.01f3 10.32.115.150   C8/0/10/U0    online        1    -0.50  1431   0   Y
0010.188a.fad8 10.32.115.142   C8/0/10/UB    w-online      2    -0.50  1507   1   Y
000e.0900.00dd 10.32.115.143   C8/0/10/UB    w-online      3    0.00   1677   0   Y
e86d.5271.304f 10.32.115.168   C8/0/10/UB    w-online      6    -0.50  1419   1   Y


10k2-DSG#show cable modem 000e.0900.00dd service-flow


SUMMARY:
MAC Address    IP Address      Host          MAC           Prim  Num Primary    DS
                               Interface     State         Sid   CPE Downstream RfId
000e.0900.00dd 10.32.115.143   C8/0/10/UB    w-online      3     0   Mo8/0/2:1  2353


Sfid  Dir Curr  Sid   Sched  Prio MaxSusRate  MaxBrst     MinRsvRate  Throughput
          State       Type
23    US  act   3     BE     0    0           3044        0           39
30    US  act   16    BE     0    500000      3044        0           0
24    DS  act   N/A   N/A    0    0           3044        0           17



UPSTREAM SERVICE FLOW DETAIL:

SFID  SID   Requests   Polls      Grants     Delayed    Dropped    Packets
                                             Grants     Grants
23    3     784        0          784        0          0          784
30    16    0          0          0          0          0          0


DOWNSTREAM SERVICE FLOW DETAIL:

SFID  RP_SFID QID    Flg Policer               Scheduler             FrwdIF
                         Xmits      Drops      Xmits      Drops
24    33019   131550     0          0          777        0          Wi8/0/2:2

Flags Legend:
$: Low Latency Queue (aggregated)
~: CIR Queue
</pre></div>
</div>
</div>
<div class="section" id="deleting-a-pcmm-gate-message-from-the-cmts">
<h4>Deleting a PCMM Gate Message from the CMTS<a class="headerlink" href="#deleting-a-pcmm-gate-message-from-the-cmts" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="n">k2</span><span class="o">-</span><span class="n">DSG</span><span class="c1">#test cable dsd  000e.0900.00dd 30</span>
</pre></div>
</div>
</div>
<div class="section" id="find-service-flows">
<h4>Find service flows<a class="headerlink" href="#find-service-flows" title="Permalink to this headline">¶</a></h4>
<p>All gate controllers currently connected to the PacketCable client are
displayed</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>show cable modem 00:11:22:33:44:55 service flow   ????
show cable modem
</pre></div>
</div>
</div>
<div class="section" id="debug-and-display-pcmm-gate-messages">
<h4>Debug and display PCMM Gate messages<a class="headerlink" href="#debug-and-display-pcmm-gate-messages" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">debug</span> <span class="n">packetcable</span> <span class="n">gate</span> <span class="n">control</span>
<span class="n">debug</span> <span class="n">packetcable</span> <span class="n">gate</span> <span class="n">events</span>
<span class="n">show</span> <span class="n">packetcable</span> <span class="n">gate</span> <span class="n">summary</span>
<span class="n">show</span> <span class="n">packetcable</span> <span class="k">global</span>
<span class="n">show</span> <span class="n">packetcable</span> <span class="n">cms</span>
</pre></div>
</div>
</div>
<div class="section" id="debug-cops-messages">
<h4>Debug COPS messages<a class="headerlink" href="#debug-cops-messages" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">debug</span> <span class="n">cops</span> <span class="n">detail</span>
<span class="n">debug</span> <span class="n">packetcable</span> <span class="n">cops</span>
<span class="n">debug</span> <span class="n">cable</span> <span class="n">dynamic_qos</span> <span class="n">trace</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="integration-verification">
<h3>Integration Verification<a class="headerlink" href="#integration-verification" title="Permalink to this headline">¶</a></h3>
<p>Checkout the integration project and perform regression tests.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>git clone ssh://${ODL_USERNAME}@git.opendaylight.org:29418/integration.git
git clone https:/git.opendaylight.org/gerrit/integration.git
</pre></div>
</div>
<ol class="arabic simple">
<li>Check and edit the
integration/features/src/main/resources/features.xml and follow the
directions there.</li>
<li>Check and edit the integration/features/pom.xml and add a dependency
for your feature file</li>
<li>Build integration/features and debug</li>
</ol>
<p><code class="docutils literal"><span class="pre">&nbsp;&nbsp;mvn&nbsp;clean&nbsp;install</span></code></p>
<p>Test your feature in the integration/distributions/extra/karaf/
distribution</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">integration</span><span class="o">/</span><span class="n">distributions</span><span class="o">/</span><span class="n">extra</span><span class="o">/</span><span class="n">karaf</span><span class="o">/</span>
<span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
<span class="n">cd</span> <span class="n">target</span><span class="o">/</span><span class="n">assembly</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">./</span><span class="n">karaf</span>
</pre></div>
</div>
<div class="section" id="service-wrapper">
<h4>service-wrapper<a class="headerlink" href="#service-wrapper" title="Permalink to this headline">¶</a></h4>
<p>Install <a class="reference external" href="http://karaf.apache.org/manual/latest/users-guide/wrapper.html">http://karaf.apache.org/manual/latest/users-guide/wrapper.html</a></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>opendaylight-user@root&gt;feature:install service-wrapper
opendaylight-user@root&gt;wrapper:install --help
DESCRIPTION
        wrapper:install

Install the container as a system service in the OS.

SYNTAX
        wrapper:install [options]

OPTIONS
        -d, --display
                The display name of the service.
                (defaults to karaf)
        --help
                Display this help message
        -s, --start-type
                Mode in which the service is installed. AUTO_START or DEMAND_START (Default: AUTO_START)
                (defaults to AUTO_START)
        -n, --name
                The service name that will be used when installing the service. (Default: karaf)
                (defaults to karaf)
        -D, --description
                The description of the service.
                (defaults to )

opendaylight-user@root&gt; wrapper:install
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/bin/karaf-wrapper
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/bin/karaf-service
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/etc/karaf-wrapper.conf
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/lib/libwrapper.so
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/lib/karaf-wrapper.jar
Creating file: /home/user/odl/distribution-karaf-0.3.0-Lithium/lib/karaf-wrapper-main.jar

Setup complete.  You may wish to tweak the JVM properties in the wrapper configuration file:
/home/user/odl/distribution-karaf-0.3.0-Lithium/etc/karaf-wrapper.conf
before installing and starting the service.


Ubuntu/Debian Linux system detected:
  To install the service:
    $ ln -s /home/user/odl/distribution-karaf-0.3.0-Lithium/bin/karaf-service /etc/init.d/

  To start the service when the machine is rebooted:
    $ update-rc.d karaf-service defaults

  To disable starting the service when the machine is rebooted:
    $ update-rc.d -f karaf-service remove

  To start the service:
    $ /etc/init.d/karaf-service start

  To stop the service:
    $ /etc/init.d/karaf-service stop

  To uninstall the service :
    $ rm /etc/init.d/karaf-service
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="service-function-chaining">
<h2>Service Function Chaining<a class="headerlink" href="#service-function-chaining" title="Permalink to this headline">¶</a></h2>
<div class="section" id="opendaylight-service-function-chaining-sfc-overiew">
<h3>OpenDaylight Service Function Chaining (SFC) Overiew<a class="headerlink" href="#opendaylight-service-function-chaining-sfc-overiew" title="Permalink to this headline">¶</a></h3>
<p>OpenDaylight Service Function Chaining (SFC) provides the ability to
define an ordered list of a network services (e.g. firewalls, load
balancers). These service are then &#8220;stitched&#8221; together in the network to
create a service chain. This project provides the infrastructure
(chaining logic, APIs) needed for ODL to provision a service chain in
the network and an end-user application for defining such chains.</p>
<ul class="simple">
<li>ACE - Access Control Entry</li>
<li>ACL - Access Control List</li>
<li>SCF - Service Classifier Function</li>
<li>SF - Service Function</li>
<li>SFC - Service Function Chain</li>
<li>SFF - Service Function Forwarder</li>
<li>SFG - Service Function Group</li>
<li>SFP - Service Function Path</li>
<li>RSP - Rendered Service Path</li>
<li>NSH - Network Service Header</li>
</ul>
</div>
<div class="section" id="sfc-classifier-control-and-date-plane-developer-guide">
<h3>SFC Classifier Control and Date plane Developer guide<a class="headerlink" href="#sfc-classifier-control-and-date-plane-developer-guide" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id63">
<h4>Overview<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h4>
<p>Description of classifier can be found in:
<a class="reference external" href="https://datatracker.ietf.org/doc/draft-ietf-sfc-architecture/">https://datatracker.ietf.org/doc/draft-ietf-sfc-architecture/</a></p>
<p>Classifier manages everything from starting the packet listener to
creation (and removal) of appropriate ip(6)tables rules and marking
received packets accordingly. Its functionality is <strong>available only on
Linux</strong> as it leverdges <strong>NetfilterQueue</strong>, which provides access to
packets matched by an <strong>iptables</strong> rule. Classifier requires <strong>root
privileges</strong> to be able to operate.</p>
<p>So far it is capable of processing ACL for MAC addresses, ports, IPv4
and IPv6. Supported protocols are TCP and UDP.</p>
</div>
<div class="section" id="classifier-architecture">
<h4>Classifier Architecture<a class="headerlink" href="#classifier-architecture" title="Permalink to this headline">¶</a></h4>
<p>Python code located in the project repository
sfc-py/common/classifier.py.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>classifier assumes that Rendered Service Path (RSP) <strong>already
exists</strong> in ODL when an ACL referencing it is obtained</p>
</div></blockquote>
<ol class="arabic simple">
<li>sfc_agent receives an ACL and passes it for processing to the
classifier</li>
<li>the RSP (its SFF locator) referenced by ACL is requested from ODL</li>
<li>if the RSP exists in the ODL then ACL based iptables rules for it are
applied</li>
</ol>
<p>After this process is over, every packet successfully matched to an
iptables rule (i.e. successfully classified) will be NSH encapsulated
and forwarded to a related SFF, which knows how to traverse the RSP.</p>
<p>Rules are created using appropriate iptables command. If the Access
Control Entry (ACE) rule is MAC address related both iptables and
ip6tabeles rules re issued. If ACE rule is IPv4 address related, only
iptables rules are issued, same for IPv6.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>iptables <strong>raw</strong> table contains all created rules</p>
</div></blockquote>
<p>Information regarding already registered RSP(s) are stored in an
internal data-store, which is represented as a dictionary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">rsp_id</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">rsp_name</span><span class="o">&gt;</span><span class="p">,</span>
          <span class="s1">&#39;chains&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;chain_name&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">ipv</span><span class="o">&gt;</span><span class="p">,),</span>
                     <span class="o">...</span>
                     <span class="p">},</span>
          <span class="s1">&#39;sff&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span><span class="p">,</span>
                  <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span><span class="p">,</span>
                  <span class="s1">&#39;starting-index&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">starting</span><span class="o">-</span><span class="n">index</span><span class="o">&gt;</span><span class="p">,</span>
                  <span class="s1">&#39;transport-type&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">transport</span><span class="o">-</span><span class="nb">type</span><span class="o">&gt;</span>
                  <span class="p">},</span>
          <span class="p">},</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">name</span></code>: name of the RSP</li>
<li><code class="docutils literal"><span class="pre">chains</span></code>: dictionary of iptables chains related to the RSP with
information about IP version for which the chain exists</li>
<li><code class="docutils literal"><span class="pre">SFF</span></code>: SFF forwarding parameters<ul>
<li><code class="docutils literal"><span class="pre">ip</span></code>: SFF IP address</li>
<li><code class="docutils literal"><span class="pre">port</span></code>: SFF port</li>
<li><code class="docutils literal"><span class="pre">starting-index</span></code>: index given to packet at first RSP hop</li>
<li><code class="docutils literal"><span class="pre">transport-type</span></code>: encapsulation protocol</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id64">
<h4>Key APIs and Interfaces<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h4>
<p>This features exposes API to configure classifier (corresponds to
service-function-classifier.yang)</p>
</div>
<div class="section" id="id65">
<h4>API Reference Documentation<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h4>
<p>See: sfc-model/src/main/yang/service-function-classifier.yang</p>
</div>
</div>
<div class="section" id="sfc-ovs-plugin">
<h3>SFC-OVS Plugin<a class="headerlink" href="#sfc-ovs-plugin" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id66">
<h4>Overview<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h4>
<p>SFC-OVS provides integration of SFC with Open vSwitch (OVS) devices.
Integration is realized through mapping of SFC objects (like SF, SFF,
Classifier, etc.) to OVS objects (like Bridge,
TerminationPoint=Port/Interface). The mapping takes care of automatic
instantiation (setup) of corresponding object whenever its counterpart
is created. For example, when a new SFF is created, the SFC-OVS plugin
will create a new OVS bridge and when a new OVS Bridge is created, the
SFC-OVS plugin will create a new SFF.</p>
</div>
<div class="section" id="sfc-ovs-architecture">
<h4>SFC-OVS Architecture<a class="headerlink" href="#sfc-ovs-architecture" title="Permalink to this headline">¶</a></h4>
<p>SFC-OVS uses the OVSDB MD-SAL Southbound API for getting/writing
information from/to OVS devices. The core functionality consists of two
types of mapping:</p>
<ol class="loweralpha simple">
<li>mapping from OVS to SFC<ul>
<li>OVS Bridge is mapped to SFF</li>
<li>OVS TerminationPoints are mapped to SFF DataPlane locators</li>
</ul>
</li>
<li>mapping from SFC to OVS<ul>
<li>SFF is mapped to OVS Bridge</li>
<li>SFF DataPlane locators are mapped to OVS TerminationPoints</li>
</ul>
</li>
</ol>
<div class="figure" id="id133">
<img alt="SFC &lt; — &gt; OVS mapping flow diagram" src="../_images/sfc-ovs-architecture.png" />
<p class="caption"><span class="caption-text">SFC &lt; — &gt; OVS mapping flow diagram</span></p>
</div>
</div>
<div class="section" id="id67">
<h4>Key APIs and Interfaces<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>SFF to OVS mapping API (methods to convert SFF object to OVS Bridge
and OVS TerminationPoints)</li>
<li>OVS to SFF mapping API (methods to convert OVS Bridge and OVS
TerminationPoints to SFF object)</li>
</ul>
</div>
</div>
<div class="section" id="sfc-southbound-rest-plugin">
<h3>SFC Southbound REST Plugin<a class="headerlink" href="#sfc-southbound-rest-plugin" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id68">
<h4>Overview<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h4>
<p>The Southbound REST Plugin is used to send configuration from DataStore
down to network devices supporting a REST API (i.e. they have a
configured REST URI). It supports POST/PUT/DELETE operations, which are
triggered accordingly by changes in the SFC data stores.</p>
<ul class="simple">
<li>Access Control List (ACL)</li>
<li>Service Classifier Function (SCF)</li>
<li>Service Function (SF)</li>
<li>Service Function Group (SFG)</li>
<li>Service Function Schedule Type (SFST)</li>
<li>Service Function Forwader (SFF)</li>
<li>Rendered Service Path (RSP)</li>
</ul>
</div>
<div class="section" id="southbound-rest-plugin-architecture">
<h4>Southbound REST Plugin Architecture<a class="headerlink" href="#southbound-rest-plugin-architecture" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><strong>listeners</strong> - used to listen on changes in the SFC data stores</li>
<li><strong>JSON exporters</strong> - used to export JSON-encoded data from
binding-aware data store objects</li>
<li><strong>tasks</strong> - used to collect REST URIs of network devices and to send
JSON-encoded data down to these devices</li>
</ol>
<div class="figure" id="id134">
<img alt="Southbound REST Plugin Architecture diagram" src="../_images/sb-rest-architecture.png" />
<p class="caption"><span class="caption-text">Southbound REST Plugin Architecture diagram</span></p>
</div>
</div>
<div class="section" id="id69">
<h4>Key APIs and Interfaces<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h4>
<p>The plugin provides Southbound REST API designated to listening REST
devices. It supports POST/PUT/DELETE operations. The operation (with
corresponding JSON-encoded data) is sent to unique REST URL belonging to
certain datatype.</p>
<ul class="simple">
<li>Access Control List (ACL):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/config/ietf-acl:access-lists/access-list/</span></code></li>
<li>Service Function (SF):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/config/service-function:service-functions/service-function/</span></code></li>
<li>Service Function Group (SFG):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/config/service-function:service-function-groups/service-function-group/</span></code></li>
<li>Service Function Schedule Type (SFST):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/config/service-function-scheduler-type:service-function-scheduler-types/service-function-scheduler-type/</span></code></li>
<li>Service Function Forwarder (SFF):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/config/service-function-forwarder:service-function-forwarders/service-function-forwarder/</span></code></li>
<li>Rendered Service Path (RSP):
<code class="docutils literal"><span class="pre">http://&lt;host&gt;:&lt;port&gt;/operational/rendered-service-path:rendered-service-paths/rendered-service-path/</span></code></li>
</ul>
<p>Therefore, network devices willing to receive REST messages must listen
on these REST URLs.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Service Classifier Function (SCF) URL does not exist, because SCF is
considered as one of the network devices willing to receive REST
messages. However, there is a listener hooked on the SCF data store,
which is triggering POST/PUT/DELETE operations of ACL object,
because ACL is referenced in <code class="docutils literal"><span class="pre">service-function-classifier.yang</span></code></p>
</div></blockquote>
</div>
</div>
<div class="section" id="service-function-load-balancing-developer-guide">
<h3>Service Function Load Balancing Developer Guide<a class="headerlink" href="#service-function-load-balancing-developer-guide" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id70">
<h4>Overview<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>SFC Load-Balancing feature implements load balancing of Service
Functions, rather than a one-to-one mapping between Service Function
Forwarder and Service Function.</p>
</div>
<div class="section" id="load-balancing-architecture">
<h4>Load Balancing Architecture<a class="headerlink" href="#load-balancing-architecture" title="Permalink to this headline">¶</a></h4>
<p>Service Function Groups (SFG) can replace Service Functions (SF) in the
Rendered Path model. A Service Path can only be defined using SFGs or
SFs, but not a combination of both.</p>
<p>Relevant objects in the YANG model are as follows:</p>
<ol class="arabic">
<li><p class="first">Service-Function-Group-Algorithm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Service</span><span class="o">-</span><span class="n">Function</span><span class="o">-</span><span class="n">Group</span><span class="o">-</span><span class="n">Algorithms</span> <span class="p">{</span>
    <span class="n">Service</span><span class="o">-</span><span class="n">Function</span><span class="o">-</span><span class="n">Group</span><span class="o">-</span><span class="n">Algorithm</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">name</span>
        <span class="n">String</span> <span class="nb">type</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Available</span> <span class="n">types</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">SELECT</span><span class="p">,</span> <span class="n">INDIRECT</span><span class="p">,</span> <span class="n">FAST_FAILURE</span>
</pre></div>
</div>
</li>
<li><p class="first">Service-Function-Group:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Service</span><span class="o">-</span><span class="n">Function</span><span class="o">-</span><span class="n">Groups</span> <span class="p">{</span>
    <span class="n">Service</span><span class="o">-</span><span class="n">Function</span><span class="o">-</span><span class="n">Group</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">name</span>
        <span class="n">String</span> <span class="n">serviceFunctionGroupAlgorithmName</span>
        <span class="n">String</span> <span class="nb">type</span>
        <span class="n">String</span> <span class="n">groupId</span>
        <span class="n">Service</span><span class="o">-</span><span class="n">Function</span><span class="o">-</span><span class="n">Group</span><span class="o">-</span><span class="n">Element</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">service</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">name</span>
            <span class="nb">int</span> <span class="n">index</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">ServiceFunctionHop: holds a reference to a name of SFG (or SF)</p>
</li>
</ol>
</div>
<div class="section" id="id71">
<h4>Key APIs and Interfaces<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h4>
<p>This feature enhances the existing SFC API.</p>
<p>REST API commands include: * For Service Function Group (SFG): read
existing SFG, write new SFG, delete existing SFG, add Service Function
(SF) to SFG, and delete SF from SFG * For Service Function Group
Algorithm (SFG-Alg): read, write, delete</p>
<p>Bundle providing the REST API: sfc-sb-rest * Service Function Groups
and Algorithms are defined in: sfc-sfg and sfc-sfg-alg * Relevant JAVA
API: SfcProviderServiceFunctionGroupAPI,
SfcProviderServiceFunctionGroupAlgAPI</p>
</div>
</div>
<div class="section" id="service-function-scheduling-algorithms">
<h3>Service Function Scheduling Algorithms<a class="headerlink" href="#service-function-scheduling-algorithms" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id72">
<h4>Overview<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h4>
<p>When creating the Rendered Service Path (RSP), the earlier release of
SFC chose the first available service function from a list of service
function names. Now a new API is introduced to allow developers to
develop their own schedule algorithms when creating the RSP. There are
four scheduling algorithms (Random, Round Robin, Load Balance and
Shortest Path) are provided as examples for the API definition. This
guide gives a simple introduction of how to develop service function
scheduling algorithms based on the current extensible framework.</p>
</div>
<div class="section" id="id73">
<h4>Architecture<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h4>
<p>The following figure illustrates the service function selection
framework and algorithms.</p>
<div class="figure" id="id135">
<img alt="SF Scheduling Algorithm framework Architecture" src="../_images/sfc-sf-selection-arch.png" />
<p class="caption"><span class="caption-text">SF Scheduling Algorithm framework Architecture</span></p>
</div>
<p>The YANG Model defines the Service Function Scheduling Algorithm type
identities and how they are stored in the MD-SAL data store for the
scheduling algorithms.</p>
<p>The MD-SAL data store stores all informations for the scheduling
algorithms, including their types, names, and status.</p>
<p>The API provides some basic APIs to manage the informations stored in
the MD-SAL data store, like putting new items into it, getting all
scheduling algorithms, etc.</p>
<p>The RESTCONF API provides APIs to manage the informations stored in the
MD-SAL data store through RESTful calls.</p>
<p>The Service Function Chain Renderer gets the enabled scheduling
algorithm type, and schedules the service functions with scheduling
algorithm implementation.</p>
</div>
<div class="section" id="id74">
<h4>Key APIs and Interfaces<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h4>
<p>While developing a new Service Function Scheduling Algorithm, a new
class should be added and it should extend the base schedule class
SfcServiceFunctionSchedulerAPI. And the new class should implement the
abstract function:</p>
<p><code class="docutils literal"><span class="pre">public</span> <span class="pre">List&lt;String&gt;</span> <span class="pre">scheduleServiceFuntions(ServiceFunctionChain</span> <span class="pre">chain,</span> <span class="pre">int</span> <span class="pre">serviceIndex)</span></code>.</p>
<ul class="simple">
<li><strong>``ServiceFunctionChain chain``</strong>: the chain which will be rendered</li>
<li><strong>``int serviceIndex``</strong>: the initial service index for this rendered
service path</li>
<li><strong>``List&lt;String&gt;``</strong>: a list of service funtion names which scheduled
by the Service Function Scheduling Algorithm.</li>
</ul>
</div>
<div class="section" id="id75">
<h4>API Reference Documentation<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h4>
<p>Please refer the API docs generated in the mdsal-apidocs.</p>
</div>
</div>
</div>
<div class="section" id="sxp-developer-guide">
<h2>SXP Developer Guide<a class="headerlink" href="#sxp-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id76">
<h3>Overview<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h3>
<p>SXP (Source-Group Tag eXchange Protocol) project is an effort to enhance
OpenDaylight platform with IP-SGT (IP Address to Source Group Tag)
bindings that can be learned from connected SXP-aware network nodes. The
current implementation supports SXP protocol version 4 according to the
Smith, Kandula - SXP <a class="reference external" href="https://tools.ietf.org/html/draft-smith-kandula-sxp-04">IETF
draft</a> and
grouping of peers and creating filters based on ACL/Prefix-list syntax
for filtering outbound and inbound IP-SGT bindings. All protocol legacy
versions 1-3 are supported as well. Additionally, version 4 adds
bidirectional connection type as an extension of a unidirectional one.</p>
</div>
<div class="section" id="sxp-architecture">
<h3>SXP Architecture<a class="headerlink" href="#sxp-architecture" title="Permalink to this headline">¶</a></h3>
<p>The SXP Server manages all connected clients in separate threads and a
common SXP protocol agreement is used between connected peers. Each SXP
network peer is modelled with its pertaining class, e.g., SXP Server
represents the SXP Speaker, SXP Listener the Client. The server program
creates the ServerSocket object on a specified port and waits until a
client starts up and requests connect on the IP address and port of the
server. The client program opens a Socket that is connected to the
server running on the specified host IP address and port.</p>
<p>The SXP Listener maintains connection with its speaker peer. From an
opened channel pipeline, all incoming SXP messages are processed by
various handlers. Message must be decoded, parsed and validated.</p>
<p>The SXP Speaker is a counterpart to the SXP Listener. It maintains a
connection with its listener peer and sends composed messages.</p>
<p>The SXP Binding Handler extracts the IP-SGT binding from a message and
pulls it into the SXP-Database. If an error is detected during the
IP-SGT extraction, an appropriate error code and sub-code is selected
and an error message is sent back to the connected peer. All transitive
messages are routed directly to the output queue of SXP Binding
Dispatcher.</p>
<p>The IP-SGT Manager handles bindings from multiple connections. If a new
data has been added into or deleted from the SXP-Database, or binding’s
contributor change is detected, the manager performs an arbitration
process above the SXP-Database to resolve the binding duplicity and
prevent possible information loops. Finally, it updates the
IP-SGT-Master database that consists only of valid and unique bindings,
i.e., a single binding per IP address.</p>
<p>The IP-SGT Manager also contains RPCs that can be used by other
OpenDaylight plugins, or by making REST calls, to add, update or to
delete bindings in or from the SXP-database.</p>
<p>The SXP Binding Dispatcher represents a selector that will decides how
many data from the SXP-database will be sent and when. It is responsible
for message content composition based on maximum message length.</p>
<p>The SXP Binding Filters handles filtering of outcoming and incoming
IP-SGT bindings according to BGP filtering using ACL and Prefix List
syntax for specifiing filter.</p>
</div>
<div class="section" id="id77">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h3>
<p>As this project is fairly small, it provides only few features that
install and provide all APIs and implementations for this project.</p>
<ul class="simple">
<li>sxp-controller</li>
<li>sxp-api</li>
<li>spx-core</li>
</ul>
<div class="section" id="sxp-controller">
<h4>sxp-controller<a class="headerlink" href="#sxp-controller" title="Permalink to this headline">¶</a></h4>
<p>RPC request handling</p>
</div>
<div class="section" id="sxp-api">
<h4>sxp-api<a class="headerlink" href="#sxp-api" title="Permalink to this headline">¶</a></h4>
<p>Contains data holders and entiies</p>
</div>
<div class="section" id="spx-core">
<h4>spx-core<a class="headerlink" href="#spx-core" title="Permalink to this headline">¶</a></h4>
<p>Main logic and core features</p>
</div>
</div>
<div class="section" id="id78">
<h3>API Reference Documentation<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://wiki.opendaylight.org/images/9/91/SXP_Restconf_Interface_and_Dynamic_Tree.pdf">RESTCONF Interface and Dynamic
Tree</a>
<a class="reference external" href="https://wiki.opendaylight.org/images/6/6e/SXP_Specification_and_Architecture_v03.pdf">Specification and
Architecture</a></p>
</div>
</div>
<div class="section" id="tcpmd5-developer-guide">
<h2>TCPMD5 Developer Guide<a class="headerlink" href="#tcpmd5-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id79">
<h3>Overview<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h3>
<p>The TCPMD5 project delivers the support for providing access to MD5
Signature Option on operating systems which support it in their TCP
stack. The implementation is compliant with
<a class="reference external" href="http://tools.ietf.org/html/rfc2385">RFC-2385</a>.</p>
<p>The project is available from the tcpmd5 repository. It is split into:</p>
<p>tcpmd5-api</p>
<p>tcpmd5-jni</p>
<p>tcpmd5-nio</p>
<p>tcpmd5-netty</p>
<p>tcpmd5-controller-config</p>
<p>tcpmd5-feature</p>
</div>
<div class="section" id="tcpmd5-architecture">
<h3>TCPMD5 Architecture<a class="headerlink" href="#tcpmd5-architecture" title="Permalink to this headline">¶</a></h3>
<p>This project defines a new TCP option for carrying an MD5 digest in a
TCP segment. This digest acts like a signature for that segment,
incorporating information known only to the connection end points.</p>
</div>
<div class="section" id="id80">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h3>
<p>As this project is fairly small, it provides only one feature that
installs and provides all APIs and implementations for this project.</p>
<div class="section" id="tcpmd5-api">
<h4>tcpmd5-api<a class="headerlink" href="#tcpmd5-api" title="Permalink to this headline">¶</a></h4>
<p>Defines the basic API and a dummy implementation.</p>
</div>
<div class="section" id="tcpmd5-jni">
<h4>tcpmd5-jni<a class="headerlink" href="#tcpmd5-jni" title="Permalink to this headline">¶</a></h4>
<p>Contains the JNI implementation and its Java binding. The core of the
artifact is NativeKeyAccess.java, which is the Java frontend and binding
class. It defines the two native methods, setChannelKey0() and
isClassSupported0(). These are implemented in tcpmd5_jni.c. Individual
instances are then provided by NativeKeyAccessFactory, which runs basic
sanity tests before allowing itself being instantiated.</p>
</div>
<div class="section" id="tcpmd5-nio">
<h4>tcpmd5-nio<a class="headerlink" href="#tcpmd5-nio" title="Permalink to this headline">¶</a></h4>
<p>Contains the code to bridge the JNI component with java.nio package,
specifically ServerSocketChannel, SocketChannel and SocketOption
classes.</p>
</div>
<div class="section" id="tcpmd5-netty">
<h4>tcpmd5-netty<a class="headerlink" href="#tcpmd5-netty" title="Permalink to this headline">¶</a></h4>
<p>Contains the code to bridge the JNI component with netty.io, by
providing the appropriate SocketChannelFactory.</p>
</div>
</div>
</div>
<div class="section" id="topology-processing-framework-developer-guide">
<h2>Topology Processing Framework Developer Guide<a class="headerlink" href="#topology-processing-framework-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id81">
<h3>Overview<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h3>
<p>TopoProcessingProvider is entry point for Topology Processing Framework.
It requires DataBroker instance. DataBroker is needed for listener
registrations. There is TopologyRequestListener which listens on
aggregated topology requests (placed into configuration datastore) and
UnderlayTopologyListeners which listen on underlay topology data changes
(made in operational datastore). TopologyRequestHandler saves
toporequest data and provides method for translating path to the
specified leaf. When a change in topology occurs, registered
UnderlayTopologyListener processes this information for further
aggregation and/or filtration. Finally, after overlay topology is
created, it is passed to TopologyWriter, which writes this topology into
operational datastore.</p>
</div>
<div class="section" id="topology-processing-framework-architecture">
<h3>Topology Processing Framework Architecture<a class="headerlink" href="#topology-processing-framework-architecture" title="Permalink to this headline">¶</a></h3>
<p>Contains of topoprocessing-api, topoprocessing-spi and
topoprocessing-impl bundles.</p>
<ul class="simple">
<li>topoprocessing-api - contains correlation definitions</li>
<li>topoprocessing-spi - entry point for topoprocessing service (start
and close)</li>
<li>topoprocessing-impl - contains implemented handlers, listeners and
aggregators</li>
</ul>
</div>
<div class="section" id="aggregation-and-filtration">
<h3>Aggregation and Filtration<a class="headerlink" href="#aggregation-and-filtration" title="Permalink to this headline">¶</a></h3>
<div class="section" id="terminology">
<h4>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h4>
<p>We use the term Physical Node for nodes in the underlay and Logical Node
for nodes in the overlay regardless of whether either is actually a
physical network element.</p>
</div>
<div class="section" id="id82">
<h4>Introduction<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h4>
<p>The Topology Processing Framework allows for the creation of aggregated
topologies or filtered views of existing topologies. Currently
aggregation and filtration of nodes is supported only for topologies
augmenting the <a class="reference external" href="https://github.com/opendaylight/yangtools/blob/master/model/ietf/ietf-topology/src/main/yang/network-topology%402013-10-21.yang">topology YANG
model</a>.
When a request to build an aggregate or filtered topology is received,
the framework creates one listener per underlay topology. Whenever any
underlay topology changes, its listener is triggered the change is
processed. Two types of correlations (functionalities) are currently
supported:</p>
<ul class="simple">
<li>Aggregation<ul>
<li>Unification</li>
<li>Equality</li>
</ul>
</li>
<li>Filtration<ul>
<li>NodeIpFiltration</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aggregation">
<h4>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h4>
<p>Aggregation is an operation which creates an aggregated node from two or
more nodes in the underlay topology if the condition for doing so is
fulfilled. Requests for aggregated topologies must specify a list of
underlay topologies over which the overlay (aggregated) topology will be
created and a target field in the underlay nodes that the framework will
check for equality.</p>
<div class="section" id="create-overlay-node">
<h5>Create overlay node<a class="headerlink" href="#create-overlay-node" title="Permalink to this headline">¶</a></h5>
<p>First, each new underlay node is inserted into proper topology
(specifically into topology store structure). Once notified of the new
node, the framework compares it (using the target field value) with all
existing nodes in the specified underlay topologies and if the equality
condition is fulfilled, a new overlay node is created containing
pointers to all <em>equal</em> underlay nodes.</p>
<p><strong>Equality case.</strong></p>
<p>In this case, if a node doesn’t fulfill the equality condition with any
other nodes, processing finishes after adding the node into topology
store. It will stay there, for future use, ready to create aggregated
node with a new underlay node, with which it would satisfy condition to
create overlay node.</p>
<p><strong>Unification case.</strong></p>
<p>In this case, an overlay node is created for all underlay nodes, even
those which don’t fulfill the equality condition with any other nodes.
This means than an overlay node is created for every underlay node, but
for nodes which satisfy the equality condition, an aggregated node is
created.</p>
</div>
<div class="section" id="update-node">
<h5>Update node<a class="headerlink" href="#update-node" title="Permalink to this headline">¶</a></h5>
<p>Processing of updated underlay nodes depends on whether the target field
has been modified. If this it has been, then:</p>
<ul class="simple">
<li>if the underlay node belonged to some overlay node, it is withdrawn
from that node and then, if the condition of equality on target field
is satisfied, it is inserted into another (possibly the same) overlay
node.</li>
<li>if the node was a &#8220;singleton&#8221; node, it is put into overlay node, if
the condition of equality is fulfilled on the new value of target
field with some existing underlay node</li>
</ul>
<p><strong>Unification case.</strong></p>
<p>Every underlay node belongs to some overlay node. Either with some other
underlay nodes when they have the same value of target field or
otherwise there is one underlay node in an overlay node.</p>
</div>
<div class="section" id="remove-node">
<h5>Remove node<a class="headerlink" href="#remove-node" title="Permalink to this headline">¶</a></h5>
<p>The underlay node is removed from appertaining topology store and from
it’s overlay node if it belongs to one.</p>
<p><strong>Equality case.</strong></p>
<p>If there is only one underlay node left in the overlay node, the overlay
node is removed.</p>
<p><strong>Unification case.</strong></p>
<p>In this case, it is allowed to have one underlay node in overlay node.
However if this node is removed from its overlay node, the overlay node
is removed.</p>
</div>
</div>
<div class="section" id="filtration">
<h4>Filtration<a class="headerlink" href="#filtration" title="Permalink to this headline">¶</a></h4>
<p>Filtration is an operation which results in creation of overlay topology
containing only nodes fulfilling condition set in the request for
creating this topology.</p>
<div class="section" id="nodeipfiltration">
<h5>NodeIpFiltration<a class="headerlink" href="#nodeipfiltration" title="Permalink to this headline">¶</a></h5>
<p>This is filtration is based on IP addresses. If a node’s IP address
fulfills mask set in the value tag of the request, this node is put into
resulting overlay topology.</p>
<p><strong>Create node.</strong></p>
<p>For a new node fulfilling IP address mask condition, this node is put
into overlay node later written into datastore.</p>
<p><strong>Update node.</strong></p>
<p>If IP address of filtered node has changed to value still fulfilling the
mask’s condition, a new overlay node is created and this updated node is
inserted there. If the new IP address does not fit within the mask, the
overlay node is simply removed.</p>
<p><strong>Remove node.</strong></p>
<p>If underlay node is part of some overlay node, the overlay node is
simply removed.</p>
</div>
</div>
</div>
<div class="section" id="wrapper-rpc-republishing-writing-mechanism">
<h3>Wrapper, RPC republishing, writing mechanism<a class="headerlink" href="#wrapper-rpc-republishing-writing-mechanism" title="Permalink to this headline">¶</a></h3>
<p>During the process of aggregation and filtration, overlay nodes (so
called Logical Nodes) were created from underlay nodes (Physical Nodes).
In TopologyManager, overlay nodes are put into wrapper. A wrapper is
identified with unique ID and contains list of Logical Nodes. Wrappers
are used to deal with transitivity of underlay nodes - which permits
grouping of overlay nodes (into wrappers).</p>
<div class="figure" id="id136">
<img alt="Class relationship" src="../_images/wrapper.png" />
<p class="caption"><span class="caption-text">Class relationship</span></p>
</div>
<p>PN1, PN2, PN3 = Physical Node</p>
<p>LN1, LN2 = Logical Node</p>
<div class="section" id="rpc-republishing">
<h4>RPC republishing<a class="headerlink" href="#rpc-republishing" title="Permalink to this headline">¶</a></h4>
<p>All RPC underlay nodes are re-registered under their corresponding
wrapper ID. RPCs of underlay nodes (belonging to an overlay node) are
gathered, and registered under ID of their wrapper.</p>
<div class="section" id="rpc-call">
<h5>RPC Call<a class="headerlink" href="#rpc-call" title="Permalink to this headline">¶</a></h5>
<p>When RPC is called on overlay node, this call is delegated to it’s
underlay nodes, it means this RPC is called on all underlay nodes of
this overlay node.</p>
</div>
</div>
<div class="section" id="writing-mechanism">
<h4>Writing mechanism<a class="headerlink" href="#writing-mechanism" title="Permalink to this headline">¶</a></h4>
<p>When a wrapper (containing overlay node(s) with it’s underlay nodes(s))
is ready to be written into data store, it has to be converted into DOM
format. After this translation is done, result is written into
datastore. Physical nodes are stored as supporting-nodes. In order to
use resources responsibly, writing is divided into two steps. First, a
set of threads registers prepared operations (deletes and puts) and one
thread makes actual write operation in batch.</p>
</div>
</div>
<div class="section" id="classes-relationships">
<h3>Classes relationships<a class="headerlink" href="#classes-relationships" title="Permalink to this headline">¶</a></h3>
<p>[1] TopologyRequestHandler instantiates TopologyWriter, TopologyManager.
Then according to request initializes either TopologyAggregator or
Topology filtrator.</p>
<p>[2] It creates as many instances of UnderlayTopologyListener as there
are underlay topologies</p>
<p>[3] PhysicalNodes are created for relevant income nodes (those having
node ID)</p>
<p>[4a] Performs aggregation and creates Logical Nodes</p>
<p>[4b] Performs filtration and creates Logical Nodes</p>
<p>[5] Logical Nodes are put into wrapper</p>
<p>[6] Wrapper is translated into adequate format and written into
Datastore</p>
<div class="figure" id="id137">
<img alt="Class relationship" src="../_images/TopologyRequestHandler_classesRelationship.png" />
<p class="caption"><span class="caption-text">Class relationship</span></p>
</div>
</div>
<div class="section" id="id83">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h3>
<p>Basic Provider class is TopoProcessingProvider which provides startup
and shutdown methods. Otherwise the framework communicates via requests
and outputs stored in DataStores.</p>
</div>
</div>
<div class="section" id="ttp-model-developer-guide">
<h2>TTP Model Developer Guide<a class="headerlink" href="#ttp-model-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id84">
<h3>Overview<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h3>
<p>Table Type Patterns are a specification developed by the <a class="reference external" href="https://www.opennetworking.org/">Open
Networking Foundation</a> to enable the
description and negotiation of subsets of the OpenFlow protocol. This is
particularly useful for hardware switches that support OpenFlow as it
enables the to describe what features they do (and thus also what
features they do not) support. More details can be found in the full
specification listed on the <a class="reference external" href="https://www.opennetworking.org/sdn-resources/onf-specifications/openflow">OpenFlow specifications
page</a>.</p>
</div>
<div class="section" id="ttp-model-architecture">
<h3>TTP Model Architecture<a class="headerlink" href="#ttp-model-architecture" title="Permalink to this headline">¶</a></h3>
<p>The TTP Model provides a YANG-modeled type for a TTP and allows them to
be associated with a master list of known TTPs, as well as active and
supported TTPs with nodes in the MD-SAL inventory model.</p>
</div>
<div class="section" id="id85">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h3>
<p>The key API provided by the TTP Model feature is the ability to store a
set of TTPs in the MD-SAL as well as associate zero or one active TTPs
and zero or more supported TTPs along with a given node in the MD-SAL
inventory model.</p>
</div>
<div class="section" id="id86">
<h3>API Reference Documentation<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h3>
<div class="section" id="restconf">
<h4>RESTCONF<a class="headerlink" href="#restconf" title="Permalink to this headline">¶</a></h4>
<p>See the generated RESTCONF API documentation at:
<a class="reference external" href="http://localhost:8181/apidoc/explorer/index.html">http://localhost:8181/apidoc/explorer/index.html</a></p>
<p>Look for the onf-ttp module to expand and see the various RESTCONF APIs.</p>
</div>
<div class="section" id="java-bindings">
<h4>Java Bindings<a class="headerlink" href="#java-bindings" title="Permalink to this headline">¶</a></h4>
<p>As stated above there are 3 locations where a Table Type Pattern can be
placed into the MD-SAL Data Store. They correspond to 3 different REST
API URIs:</p>
<ol class="arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">restconf/config/onf-ttp:opendaylight-ttps/onf-ttp:table-type-patterns/</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">restconf/config/opendaylight-inventory:nodes/node/{id}/ttp-inventory-node:active_ttp/</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">restconf/config/opendaylight-inventory:nodes/node/{id}/ttp-inventory-node:supported_ttps/</span></code></p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>Typically, these URIs are running on the machine the controller is
on at port 8181. If you are on the same machine they can thus be
accessed at <code class="docutils literal"><span class="pre">http://localhost:8181/&lt;uri&gt;</span></code></p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="section" id="using-the-ttp-model-restconf-apis">
<h3>Using the TTP Model RESTCONF APIs<a class="headerlink" href="#using-the-ttp-model-restconf-apis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setting-rest-http-headers">
<h4>Setting REST HTTP Headers<a class="headerlink" href="#setting-rest-http-headers" title="Permalink to this headline">¶</a></h4>
<div class="section" id="authentication">
<h5>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h5>
<p>The REST API calls require authentication by default. The default method
is to use basic auth with a user name and password of ‘admin’.</p>
</div>
<div class="section" id="content-type-and-accept">
<h5>Content-Type and Accept<a class="headerlink" href="#content-type-and-accept" title="Permalink to this headline">¶</a></h5>
<p>RESTCONF supports both xml and json. This example focuses on JSON, but
xml can be used just as easily. When doing a PUT or POST be sure to
specify the appropriate <code class="docutils literal"><span class="pre">Conetnt-Type</span></code> header: either
<code class="docutils literal"><span class="pre">application/json</span></code> or <code class="docutils literal"><span class="pre">application/xml</span></code>.</p>
<p>When doing a GET be sure to specify the appropriate <code class="docutils literal"><span class="pre">Accept</span></code> header:
again, either <code class="docutils literal"><span class="pre">application/json</span></code> or <code class="docutils literal"><span class="pre">application/xml</span></code>.</p>
</div>
</div>
<div class="section" id="content">
<h4>Content<a class="headerlink" href="#content" title="Permalink to this headline">¶</a></h4>
<p>The contents of a PUT or POST should be a OpenDaylight Table Type
Pattern. An example of one is provided below. The example can also be
found at <code class="docutils literal"><span class="pre">`parser/sample-TTP-from-tests.ttp</span></code> in the TTP git
repository &lt;<a class="reference external" href="https://git.opendaylight.org/gerrit/gitweb?p=ttp.git;a=blob;f=parser/sample-TTP-from-tests.ttp;h=45130949b25c6f86b750959d27d04ec2208935fb;hb=HEAD">https://git.opendaylight.org/gerrit/gitweb?p=ttp.git;a=blob;f=parser/sample-TTP-from-tests.ttp;h=45130949b25c6f86b750959d27d04ec2208935fb;hb=HEAD</a>&gt;`__.</p>
<p><strong>Sample Table Type Pattern (json).</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;table-type-patterns&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;table-type-pattern&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;security&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;This TTP is not published for use by ONF. It is an example and for&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;illustrative purposes only.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;If this TTP were published for use it would include&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;guidance as to any security considerations in this doc member.&quot;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;NDM_metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;authority&quot;</span><span class="p">:</span> <span class="s2">&quot;org.opennetworking.fawg&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;OF_protocol_version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.3.3&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;TTPv1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;Example of a TTP supporting L2 (unicast, multicast, flooding), L3 (unicast only),&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;and an ACL table.&quot;</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2-L3-ACLs&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;identifiers&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;The VLAN ID of a locally attached L2 subnet on a Router.&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;subnet_VID&gt;&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;An OpenFlow group identifier (integer) identifying a group table entry&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;of the type indicated by the variable name&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;&lt;group_entry_types/name&gt;&gt;&quot;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Flow entry notification Extension – notification of changes in flow entries&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="s2">&quot;ext187&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Group notifications Extension – notification of changes in group or meter entries&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;feature&quot;</span><span class="p">:</span> <span class="s2">&quot;ext235&quot;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;meter_table&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;meter_types&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ControllerMeterType&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DROP&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;1000..10000&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;burst&quot;</span><span class="p">:</span> <span class="s2">&quot;50..200&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TrafficMeter&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DSCP_REMARK&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;10000..500000&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;burst&quot;</span><span class="p">:</span> <span class="s2">&quot;50..500&quot;</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DROP&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;10000..500000&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;burst&quot;</span><span class="p">:</span> <span class="s2">&quot;50..500&quot;</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;built_in_meters&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ControllerMeter&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;meter_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ControllerMeterType&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
                                    <span class="s2">&quot;burst&quot;</span><span class="p">:</span> <span class="mi">75</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;AllArpMeter&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;meter_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ControllerMeterType&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;bands&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                                    <span class="s2">&quot;burst&quot;</span><span class="p">:</span> <span class="mi">50</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;table_map&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ControlFrame&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IngressVLAN&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">10</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;MacLearning&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">20</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ACL&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">30</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">40</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ProtoFilter&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">50</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">60</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;IPv6&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="mi">80</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;documentation&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Showing-curt-how-this-works&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;type1&quot;</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;flow_tables&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Filters L2 control reserved destination addresses and&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;may forward control packets to the controller.&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Directs all other packets to the Ingress VLAN table.&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ControlFrame&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;flow_mod_types&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="s2">&quot;This match/action pair allows for flow_mods that match on either&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;ETH_TYPE or ETH_DST (or both) and send the packet to the&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;controller, subject to metering.&quot;</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Frame-To-Controller&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;match_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;ETH_TYPE&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;match_type&quot;</span><span class="p">:</span> <span class="s2">&quot;all_or_exact&quot;</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;ETH_DST&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;match_type&quot;</span><span class="p">:</span> <span class="s2">&quot;exact&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;instruction_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                                            <span class="s2">&quot;This meter may be used to limit the rate of PACKET_IN frames&quot;</span><span class="p">,</span>
                                            <span class="s2">&quot;sent to the controller&quot;</span>
                                        <span class="p">],</span>
                                        <span class="s2">&quot;instruction&quot;</span><span class="p">:</span> <span class="s2">&quot;METER&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;meter_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ControllerMeter&quot;</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;instruction&quot;</span><span class="p">:</span> <span class="s2">&quot;APPLY_ACTIONS&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="p">[</span>
                                            <span class="p">{</span>
                                                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTPUT&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;CONTROLLER&quot;</span>
                                            <span class="p">}</span>
                                        <span class="p">]</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">}</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;built_in_flow_mods&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="s2">&quot;Mandatory filtering of control frames with C-VLAN Bridge reserved DA.&quot;</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Control-Frame-Filter&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;match_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;ETH_DST&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="s2">&quot;0xfffffffffff0&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;0x0180C2000000&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="s2">&quot;Mandatory miss flow_mod, sends packets to IngressVLAN table.&quot;</span>
                                <span class="p">],</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;instruction_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;instruction&quot;</span><span class="p">:</span> <span class="s2">&quot;GOTO_TABLE&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="s2">&quot;IngressVLAN&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;group_entry_types&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Output to a port, removing VLAN tag if needed.&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Entry per port, plus entry per untagged VID per port.&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;EgressPort&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;group_type&quot;</span><span class="p">:</span> <span class="s2">&quot;INDIRECT&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;bucket_types&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;OutputTagged&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;action_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTPUT&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;port_no&gt;&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;OutputUntagged&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;action_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;POP_VLAN&quot;</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTPUT&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;port_no&gt;&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;opt_tag&quot;</span><span class="p">:</span> <span class="s2">&quot;VID-X&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;OutputVIDTranslate&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;action_set&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;SET_FIELD&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;VLAN_VID&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;local_vid&gt;&quot;</span>
                                    <span class="p">},</span>
                                    <span class="p">{</span>
                                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTPUT&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;port_no&gt;&quot;</span>
                                    <span class="p">}</span>
                                <span class="p">]</span>
                            <span class="p">}</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;flow_paths&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;This object contains just a few examples of flow paths, it is not&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;a comprehensive list of the flow paths required for this TTP.  It is&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;intended that the flow paths array could include either a list of&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;required flow paths or a list of specific flow paths that are not&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;required (whichever is more concise or more useful.&quot;</span>
                        <span class="p">],</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2-2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACLskip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2-Unicast&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;EgressPort&quot;</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2-3&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACLskip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2-Multicast&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2Mcast&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;[EgressPort]&quot;</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2-4&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACL-skip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;VID-flood&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;VIDflood&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;[EgressPort]&quot;</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;L2-5&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACLskip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2-Drop&quot;</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;v4-1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACLskip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2-Router-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;v4-Unicast&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;NextHop&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;EgressPort&quot;</span>
                        <span class="p">]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;v4-2&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Non-Control-Frame&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IV-pass&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Known-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ACLskip&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L2-Router-MAC&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;IPv4&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;v4-Unicast-ECMP&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;L3ECMP&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;NextHop&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;EgressPort&quot;</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="making-a-rest-call">
<h4>Making a REST Call<a class="headerlink" href="#making-a-rest-call" title="Permalink to this headline">¶</a></h4>
<p>In this example we’ll do a PUT to install the sample TTP from above into
OpenDaylight and then retrieve it both as json and as xml. We’ll use the
<a class="reference external" href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm">Postman - REST
Client</a>
for Chrome in the examples, but any method of accessing REST should
work.</p>
<p>First, we’ll fill in the basic information:</p>
<div class="figure" id="id138">
<img alt="Filling in URL, content, Content-Type and basic auth" src="../_images/ttp-screen1-basic-auth.png" />
<p class="caption"><span class="caption-text">Filling in URL, content, Content-Type and basic auth</span></p>
</div>
<ol class="arabic simple">
<li>Set the URL to
<code class="docutils literal"><span class="pre">http://localhost:8181/restconf/config/onf-ttp:opendaylight-ttps/onf-ttp:table-type-patterns/</span></code></li>
<li>Set the action to <code class="docutils literal"><span class="pre">PUT</span></code></li>
<li>Click Headers and</li>
<li>Set a header for <code class="docutils literal"><span class="pre">Content-Type</span></code> to <code class="docutils literal"><span class="pre">application/json</span></code></li>
<li>Make sure the content is set to raw and</li>
<li>Copy the sample TTP from above into the content</li>
<li>Click the Basic Auth tab and</li>
<li>Set the username and password to admin</li>
<li>Click Refresh headers</li>
</ol>
<div class="figure" id="id139">
<img alt="Refreshing basic auth headers" src="../_images/ttp-screen2-applied-basic-auth.png" />
<p class="caption"><span class="caption-text">Refreshing basic auth headers</span></p>
</div>
<p>After clicking Refresh headers, we can see that a new header
(<code class="docutils literal"><span class="pre">Authorization</span></code>) has been created and this will allow us to
authenticate to make the REST call.</p>
<div class="figure" id="id140">
<img alt="PUTting a TTP" src="../_images/ttp-screen3-sent-put.png" />
<p class="caption"><span class="caption-text">PUTting a TTP</span></p>
</div>
<p>At this point, clicking send should result in a Status response of <code class="docutils literal"><span class="pre">200</span>
<span class="pre">OK</span></code> indicating we’ve successfully PUT the TTP into OpenDaylight.</p>
<div class="figure" id="id141">
<img alt="Retrieving the TTP as json via a GET" src="../_images/ttp-screen4-get-json.png" />
<p class="caption"><span class="caption-text">Retrieving the TTP as json via a GET</span></p>
</div>
<p>We can now retrieve the TTP by:</p>
<ol class="arabic simple">
<li>Changing the action to <code class="docutils literal"><span class="pre">GET</span></code></li>
<li>Setting an <code class="docutils literal"><span class="pre">Accept</span></code> header to <code class="docutils literal"><span class="pre">application/json</span></code> and</li>
<li>Pressing send</li>
</ol>
<div class="figure" id="id142">
<img alt="Retrieving the TTP as xml via a GET" src="../_images/ttp-screen5-get-xml.png" />
<p class="caption"><span class="caption-text">Retrieving the TTP as xml via a GET</span></p>
</div>
<p>The same process can retrieve the content as xml by setting the
<code class="docutils literal"><span class="pre">Accept</span></code> header to <code class="docutils literal"><span class="pre">application/xml</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="ttp-cli-tools-developer-guide">
<h2>TTP CLI Tools Developer Guide<a class="headerlink" href="#ttp-cli-tools-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id87">
<h3>Overview<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h3>
<p>Table Type Patterns are a specification developed by the <a class="reference external" href="https://www.opennetworking.org/">Open
Networking Foundation</a> to enable the
description and negotiation of subsets of the OpenFlow protocol. This is
particularly useful for hardware switches that support OpenFlow as it
enables the to describe what features they do (and thus also what
features they do not) support. More details can be found in the full
specification listed on the <a class="reference external" href="https://www.opennetworking.org/sdn-resources/onf-specifications/openflow">OpenFlow specifications
page</a>.</p>
<p>The TTP CLI Tools provide a way for people interested in TTPs to read
in, validate, output, and manipulate TTPs as a self-contained,
executable jar file.</p>
</div>
<div class="section" id="ttp-cli-tools-architecture">
<h3>TTP CLI Tools Architecture<a class="headerlink" href="#ttp-cli-tools-architecture" title="Permalink to this headline">¶</a></h3>
<p>The TTP CLI Tools use the TTP Model and the YANG Tools/RESTCONF codecs
to translate between the Data Transfer Objects (DTOs) and JSON/XML.</p>
</div>
<div class="section" id="command-line-options">
<h3>Command Line Options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h3>
<p>This will cover the various options for the CLI Tools. For now, there
are no options and it merely outputs fixed data using the codecs.</p>
</div>
</div>
<div class="section" id="unified-secure-channel">
<h2>Unified Secure Channel<a class="headerlink" href="#unified-secure-channel" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id88">
<h3>Overview<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h3>
<p>The Unified Secure Channel (USC) feature provides REST API, manager, and
plugin for unified secure channels. The REST API provides a northbound
api. The manager monitors, maintains, and provides channel related
services. The plugin handles the lifecycle of channels.</p>
</div>
<div class="section" id="usc-channel-architecture">
<h3>USC Channel Architecture<a class="headerlink" href="#usc-channel-architecture" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>USC Agent<ul>
<li>The USC Agent provides proxy and agent functionality on top of all
standard protocols supported by the device. It initiates call-home
with the controller, maintains live connections with with the
controller, acts as a demuxer/muxer for packets with the USC
header, and authenticates the controller.</li>
</ul>
</li>
<li>USC Plugin<ul>
<li>The USC Plugin is responsible for communication between the
controller and the USC agent . It responds to call-home with the
controller, maintains live connections with the devices, acts as a
muxer/demuxer for packets with the USC header, and provides
support for TLS/DTLS.</li>
</ul>
</li>
<li>USC Manager<ul>
<li>The USC Manager handles configurations, high availability,
security, monitoring, and clustering support for USC.</li>
</ul>
</li>
<li>USC UI<ul>
<li>The USC UI is responsible for displaying a graphical user
interface representing the state of USC in the OpenDaylight DLUX
UI.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="usc-channel-apis-and-interfaces">
<h3>USC Channel APIs and Interfaces<a class="headerlink" href="#usc-channel-apis-and-interfaces" title="Permalink to this headline">¶</a></h3>
<p>This section describes the APIs for interacting with the unified secure
channels.</p>
<div class="section" id="usc-channel-topology-api">
<h4>USC Channel Topology API<a class="headerlink" href="#usc-channel-topology-api" title="Permalink to this headline">¶</a></h4>
<p>The USC project maintains a topology that is YANG-based in MD-SAL. These
models are available via RESTCONF.</p>
<ul class="simple">
<li>Name: view-channel</li>
<li>URL:
<a class="reference external" href="http://${ipaddress}:8181/restconf/operations/usc-channel:view-channel">http://${ipaddress}:8181/restconf/operations/usc-channel:view-channel</a></li>
<li>Description: Views the current state of the USC environment.</li>
</ul>
</div>
</div>
<div class="section" id="id89">
<h3>API Reference Documentation<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h3>
<p>Go to
<a class="reference external" href="http://${ipaddress}:8181/apidoc/explorer/index.html">http://${ipaddress}:8181/apidoc/explorer/index.html</a>,
sign in, and expand the usc-channel panel. From there, users can execute
various API calls to test their USC deployment.</p>
</div>
</div>
<div class="section" id="virtual-tenant-network-vtn">
<h2>Virtual Tenant Network (VTN)<a class="headerlink" href="#virtual-tenant-network-vtn" title="Permalink to this headline">¶</a></h2>
<div class="section" id="opendaylight-virtual-tenant-network-vtn-overview">
<h3>OpenDaylight Virtual Tenant Network (VTN) Overview<a class="headerlink" href="#opendaylight-virtual-tenant-network-vtn-overview" title="Permalink to this headline">¶</a></h3>
<p>OpenDaylight Virtual Tenant Network (VTN) is an application that
provides multi-tenant virtual network on an SDN controller.</p>
<p>Conventionally, huge investment in the network systems and operating
expenses are needed because the network is configured as a silo for each
department and system. Therefore various network appliances must be
installed for each tenant and those boxes cannot be shared with others.
It is a heavy work to design, implement and operate the entire complex
network.</p>
<p>The uniqueness of VTN is a logical abstraction plane. This enables the
complete separation of logical plane from physical plane. Users can
design and deploy any desired network without knowing the physical
network topology or bandwidth restrictions.</p>
<p>VTN allows the users to define the network with a look and feel of
conventional L2/L3 network. Once the network is designed on VTN, it will
automatically be mapped into underlying physical network, and then
configured on the individual switch leverage SDN control protocol. The
definition of logical plane makes it possible not only to hide the
complexity of the underlying network but also to better manage network
resources. It achieves reducing reconfiguration time of network services
and minimizing network configuration errors. OpenDaylight Virtual Tenant
Network (VTN) is an application that provides multi-tenant virtual
network on an SDN controller. It provides API for creating a common
virtual network irrespective of the physical network.</p>
<p>It is implemented as two major components</p>
<ul class="simple">
<li><a class="reference external" href="#_vtn_coordinator">VTN Coordinator</a></li>
<li><a class="reference external" href="#_vtn_manager">VTN Manager</a></li>
</ul>
<div class="figure" id="id143">
<img alt="VTN Architecture" src="../_images/vtn-overview.png" />
<p class="caption"><span class="caption-text">VTN Architecture</span></p>
</div>
<div class="section" id="vtn-coordinator">
<h4>VTN Coordinator<a class="headerlink" href="#vtn-coordinator" title="Permalink to this headline">¶</a></h4>
<p>The VTN Coordinator is an external application that provides a REST
interface for a user to use the VTN Virtualization. It interacts with
VTN Manager plugin to implement the user configuration. It is also
capable of multiple controller orchestration. It realizes Virtual Tenant
Network (VTN) provisioning in OpenDaylight Controllers (ODC). In the
OpenDaylight architecture VTN Coordinator is part of the network
application, orchestration and services layer. VTN Coordinator has been
implemented as an external application to the OpenDaylight controller.
This component is responsible for the VTN virtualization. VTN
Coordinator will use the REST interface exposed by the VTN Manger to
realize the virtual network using the OpenDaylight controller. It uses
OpenDaylight APIs (REST) to construct the virtual network in ODCs. It
provides REST APIs for northbound VTN applications and supports virtual
networks spanning across multiple ODCs by coordinating across ODCs.</p>
<div class="section" id="feature-overview">
<h5>Feature Overview<a class="headerlink" href="#feature-overview" title="Permalink to this headline">¶</a></h5>
<p>VTN Coordinator doesn’t have Karaf features.</p>
<p>For VTN Coordinator REST API, please refer:
<a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Virtual_Tenant_Network_%28VTN%29:VTN_Coordinator:RestApi">https://wiki.opendaylight.org/view/OpenDaylight_Virtual_Tenant_Network_%28VTN%29:VTN_Coordinator:RestApi</a></p>
</div>
</div>
<div class="section" id="vtn-manager">
<h4>VTN Manager<a class="headerlink" href="#vtn-manager" title="Permalink to this headline">¶</a></h4>
<p>An OpenDaylight Controller Plugin that interacts with other modules to
implement the components of the VTN model. It also provides a REST
interface to configure VTN components in ODL controller. VTN Manager is
implemented as one plugin to the OpenDaylight controller. This provides
a REST interface to create/update/delete VTN components. The user
command in VTN Coordinator is translated as REST API to VTN Manager by
the ODC Driver component. In addition to the above mentioned role, it
also provides an implementation to the OpenStack L2 Network Functions
API.</p>
<div class="section" id="function-outline">
<h5>Function Outline<a class="headerlink" href="#function-outline" title="Permalink to this headline">¶</a></h5>
<p>The table identifies the functions and the interface used by VTN
Components:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Component</th>
<th class="head">Interface</th>
<th class="head">Purpose</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>VTN Manager</td>
<td>RESTful API</td>
<td>Configure VTN
Virtualization model
components in
OpenDaylight</td>
</tr>
<tr class="row-odd"><td>VTN Manager</td>
<td>Neutron API
implementation</td>
<td>Handle Networks API from
OpenStack (Neutron
Interface)</td>
</tr>
<tr class="row-even"><td>VTN Coordinator</td>
<td>RESTful API</td>
<td><div class="first line-block">
<div class="line">(1) Uses the RESTful
interface of VTN
Manager and configures
VTN Virtualization
model components in
OpenDaylight.</div>
<div class="line">(2) Handles multiple
controller
orchestration.</div>
<div class="line">(3) Provides API to
read the physical
network details. See
<a href="#id90"><span class="problematic" id="id91">`</span></a>samples &lt;<a class="reference external" href="https://wiki">https://wiki</a></div>
</div>
<p>.OpenDaylight.org/view/O
penDaylight_Virtual_Tena
nt_Network_(VTN):VTN_Coo
rdinator:RestApi:L2_Netw
ork_Example_Using_VTN_Vi
rtualization&gt;`__</p>
<blockquote class="last">
<div>for usage.</div></blockquote>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id92">
<h5>Feature Overview<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h5>
<p>There are three features</p>
<ul class="simple">
<li><strong>odl-vtn-manager</strong> provides VTN Manager’s JAVA API.</li>
<li><strong>odl-vtn-manager-rest</strong> provides VTN Manager’s REST API.</li>
<li><strong>odl-vtn-manager-neutron</strong> provides the integration with Neutron
interface.</li>
</ul>
<p>REST API documentation for VTN Manager, please refer:
<a class="reference external" href="https://jenkins.opendaylight.org/releng/view/vtn/job/vtn-merge-stable-lithium/lastSuccessfulBuild/artifact/manager/northbound/target/site/wsdocs/rest.html">https://jenkins.opendaylight.org/releng/view/vtn/job/vtn-merge-stable-lithium/lastSuccessfulBuild/artifact/manager/northbound/target/site/wsdocs/rest.html</a></p>
<p>For VTN Java API documentation, please visit:
<a class="reference external" href="https://jenkins.opendaylight.org/releng/view/vtn/job/vtn-merge-master/lastSuccessfulBuild/artifact/manager/api/target/apidocs/index.html">https://jenkins.opendaylight.org/releng/view/vtn/job/vtn-merge-master/lastSuccessfulBuild/artifact/manager/api/target/apidocs/index.html</a></p>
<p>VTN Manager API:
<a class="reference external" href="https://wiki.opendaylight.org/view/OpenDaylight_Virtual_Tenant_Network_%28VTN%29:VTN_Manager:RestApi">https://wiki.opendaylight.org/view/OpenDaylight_Virtual_Tenant_Network_%28VTN%29:VTN_Manager:RestApi</a></p>
</div>
</div>
</div>
<div class="section" id="usage-examples">
<h3>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://wiki.OpenDaylight.org/view/OpenDaylight_Virtual_Tenant_Network_(VTN):VTN_Coordinator:RestApi:How_to_configure_L2_Network_with_Single_Controller">L2 Network using Single
Controller</a></li>
</ul>
</div>
</div>
<div class="section" id="yang-tools">
<h2>YANG Tools<a class="headerlink" href="#yang-tools" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id93">
<h3>Overview<a class="headerlink" href="#id93" title="Permalink to this headline">¶</a></h3>
<p>YANG Tools is set of libraries and tooling providing support for use
<a class="reference external" href="https://tools.ietf.org/html/rfc6020">YANG</a> for Java (or other
JVM-based language) projects and applications.</p>
<p>YANG Tools provides following features in OpenDaylight:</p>
<ul class="simple">
<li>parsing of YANG sources and semantic inference of relationship across
YANG models as defined in
<a class="reference external" href="https://tools.ietf.org/html/rfc6020">RFC6020</a></li>
<li>representation of YANG-modeled data in Java<ul>
<li><strong>Normalized Node</strong> representation - DOM-like tree model, which
uses conceptual meta-model more tailored to YANG and OpenDaylight
use-cases than a standard XML DOM model allows for.</li>
<li><strong>Java Binding</strong> - concrete data model and classes generated from
YANG models, designed to provide compile-time safety when working
with YANG-modeled data.</li>
</ul>
</li>
<li>serialization / deserialization of YANG-modeled data driven by YANG
models<ul>
<li>XML - as defined in
<a class="reference external" href="https://tools.ietf.org/html/rfc6020">RFC6020</a></li>
<li>JSON - as defined in
<a class="reference external" href="https://tools.ietf.org/html/rfc6020">draft-lhotka-netmod-yang-json-01</a></li>
<li>Java Binding to Normalized Node and vice-versa</li>
</ul>
</li>
<li>Integration of YANG model parsing into Maven build lifecycle and
support for third-party generators processing YANG models.</li>
</ul>
<p>YANG Tools project consists of following logical subsystems:</p>
<ul class="simple">
<li><strong>Commons</strong> - Set of general purpose code, which is not specific to
YANG, but is also useful outside YANG Tools implementation.</li>
<li><strong>YANG Model and Parser</strong> - YANG semantic model and lexical and
semantic parser of YANG models, which creates in-memory
cross-referenced represenation of YANG models, which is used by other
components to determine their behaviour based on the model.</li>
<li><strong>YANG Data</strong> - Definition of Normalized Node APIs and Data Tree
APIs, reference implementation of these APIs and implementation of
XML and JSON codecs for Normalized Nodes.</li>
<li><strong>YANG Maven Plugin</strong> - Maven plugin which integrates YANG parser
into Maven build lifecycle and provides code-generation framework for
components, which wants to generate code or other artefacts based on
YANG model.</li>
<li><strong>YANG Java Binding</strong> - Mapping of YANG model to generated Java APIs.
Java Binding also references to set of compile-time and runtime
components which implements this mapping, provides generation of
classes and APIs based on YANG models and integrate these Java
Binding objects with <strong>YANG Data</strong> APIs and components.<ul>
<li><strong>Models</strong> - Set of <strong>IETF</strong> and <strong>YANG Tools</strong> models, with
generated Java Bindings so they could be simply consumed outside
of <strong>YANG Tools</strong>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="yang-java-binding-mapping-rules">
<h3>YANG Java Binding: Mapping rules<a class="headerlink" href="#yang-java-binding-mapping-rules" title="Permalink to this headline">¶</a></h3>
<p>This chapter covers the details of mapping YANG to Java.</p>
<blockquote>
<div><p><strong>Note</strong></p>
<p>The following source code examples does not show canonical generated
code, but rather illustrative example. Generated classes and
interfaces may differ from this examples, but APIs are preserved.</p>
</div></blockquote>
<div class="section" id="general-conversion-rules">
<h4>General conversion rules<a class="headerlink" href="#general-conversion-rules" title="Permalink to this headline">¶</a></h4>
<div class="section" id="package-names-of-yang-models">
<h5>Package names of YANG models<a class="headerlink" href="#package-names-of-yang-models" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">The package name consists of the following parts:</div>
</div>
<ul class="simple">
<li><strong>Opendaylight prefix</strong> - Specifies the opendaylight prefix. Every
package name starts with the prefix <code class="docutils literal"><span class="pre">org.opendaylight.yang.gen.v</span></code>.</li>
<li><strong>Java Binding version</strong> - Specifies the YANG Java Binding version.
Curent Binding version is <code class="docutils literal"><span class="pre">1</span></code>.</li>
<li><strong>Namespace</strong> - Specified by the value of <code class="docutils literal"><span class="pre">namespace</span></code> substatement.
URI is converted to package name structure.</li>
<li><strong>Revision</strong> - Specifies the concatenation of word <code class="docutils literal"><span class="pre">rev</span></code> and value
of <code class="docutils literal"><span class="pre">module</span></code> substatements <code class="docutils literal"><span class="pre">revision</span></code> argument value without
leading zeros before month and day. For example: <code class="docutils literal"><span class="pre">rev201379</span></code></li>
</ul>
<p>After the package name is generated, we check if it contains any Java
keywords or starts with a digit. If so, then we add an underscore before
the offending token.</p>
<p>The following is a list of keywords which are prefixed with underscore:</p>
<p>abstract, assert, boolean, break, byte, case, catch, char, class, const,
continue, default, double, do, else, enum, extends, false, final,
finally, float, for, goto, if, implements, import, instanceof, int,
interface, long, native, new, null, package, private, protected, public,
return, short, static, strictfp, super, switch, synchronized, this,
throw, throws, transient, true, try, void, volatile, while</p>
<p>As an example suppose following yang model:</p>
<p>After applying rules (replacing digits and Java keywords) the resulting
package name is
<code class="docutils literal"><span class="pre">org.opendaylight.yang.gen.v1.urn._2._case.module.rev201379</span></code></p>
</div>
<div class="section" id="additional-packages">
<h5>Additional Packages<a class="headerlink" href="#additional-packages" title="Permalink to this headline">¶</a></h5>
<p>In cases when YANG statement contain some of specific YANG statements
additional packages are generated to designate this containment. Table
below provides details of parent statement and nested statements, which
yields additional package generation:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parent statement</th>
<th class="head">Substatement</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">list</span></code></td>
<td>list, container, choice</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">container</span></code></td>
<td>list, container, choice</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">choice</span></code></td>
<td>leaf, list, leaf-list, container,
case</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">case</span></code></td>
<td>list, container, choice</td>
</tr>
<tr class="row-even"><td>rpc <code class="docutils literal"><span class="pre">input</span></code> or <code class="docutils literal"><span class="pre">output</span></code></td>
<td>list, container, (choice isn’t
supported)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">notification</span></code></td>
<td>list, container, (choice isn’t
supported)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">augment</span></code></td>
<td>list, container, choice, case</td>
</tr>
</tbody>
</table>
<p>Substatements are not only mapped to Java setter methods in the
interface representing the parent statement, but they also generate
packages with names consisting of the parent statement package name with
the parent statement name appended.</p>
<p>For example, this YANG model considers the container statement <code class="docutils literal"><span class="pre">cont</span></code>
as the direct substatement of the module.</p>
<p>Container <code class="docutils literal"><span class="pre">cont</span></code> is the parent statement for the substatements
<code class="docutils literal"><span class="pre">cont-inner</span></code> and <code class="docutils literal"><span class="pre">outter-list</span></code>. <code class="docutils literal"><span class="pre">list</span> <span class="pre">outter-list</span></code> is the parent
statement for substatement <code class="docutils literal"><span class="pre">list-in-list</span></code>.</p>
<div class="line-block">
<div class="line">Java code is generated in the following structure:</div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">org.opendaylight.yang.gen.v1.urn.module.rev201379</span></code> - package
contains direct substatements of module statement<ul>
<li><code class="docutils literal"><span class="pre">Cont.java</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont</span></code> - package
contains substatements of <code class="docutils literal"><span class="pre">cont</span></code> container statement<ul>
<li><code class="docutils literal"><span class="pre">ContInner.java</span></code> - interface representing container
<code class="docutils literal"><span class="pre">cont-inner</span></code></li>
<li><code class="docutils literal"><span class="pre">OutterList.java</span></code> - interface representing list <code class="docutils literal"><span class="pre">outer-list</span></code></li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.outter.list</span></code>
- package contains substatements of outter-list list element<ul>
<li><code class="docutils literal"><span class="pre">ListInList.java</span></code></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="class-and-interface-names">
<h5>Class and interface names<a class="headerlink" href="#class-and-interface-names" title="Permalink to this headline">¶</a></h5>
<p>Some YANG statements are mapped to Java classes and interfaces. The name
of YANG element may contain various characters which aren’t permitted in
Java class names. Firstly whitespaces are trimmed from YANG name. Next
the characters space, -, ` are deleted and the subsequent letter is
capitalized. At the end, first letter is capitalized.</p>
<p>For example, <code class="docutils literal"><span class="pre">example-name_</span> <span class="pre">without_capitalization</span></code> would map to
<code class="docutils literal"><span class="pre">ExampleNameWithoutCapitalization</span></code>.</p>
</div>
<div class="section" id="getter-and-setter-names">
<h5>Getter and setter names<a class="headerlink" href="#getter-and-setter-names" title="Permalink to this headline">¶</a></h5>
<p>In some cases, YANG statements are converted to getter and/or setter
methods. The process for getter is:</p>
<ol class="arabic simple">
<li>the name of YANG statement is converted to Java class name style as
<a class="reference external" href="#_class_and_interface_names">explained above</a>.</li>
<li>the word <code class="docutils literal"><span class="pre">get</span></code> is added as prefix, if resulting type is
<code class="docutils literal"><span class="pre">Boolean</span></code>, the name is prefixed with <code class="docutils literal"><span class="pre">is</span></code> prefix instead of
<code class="docutils literal"><span class="pre">get</span></code>.</li>
<li>the return type of the getter method is set to Java type representing
substatement</li>
</ol>
<p>The process for setter is:</p>
<ol class="arabic simple">
<li>the name of YANG statement is converted to Java class name style as
<a class="reference external" href="#_class_and_interface_names">explained above</a>.</li>
<li>the word <code class="docutils literal"><span class="pre">set</span></code> is added as prefix</li>
<li>the input parameter name is set to element’s name converted to Java
parameter style</li>
<li>the return parameter is set to builder type</li>
</ol>
</div>
</div>
<div class="section" id="statement-specific-mapping">
<h4>Statement specific mapping<a class="headerlink" href="#statement-specific-mapping" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-statement">
<h5>module statement<a class="headerlink" href="#module-statement" title="Permalink to this headline">¶</a></h5>
<p>YANG <code class="docutils literal"><span class="pre">module</span></code> statement is converted to Java as two Java classes. Each
of the classes is in the separate Java file. The names of Java files are
composed as follows: <code class="docutils literal"><span class="pre">&lt;module</span> <span class="pre">name&gt;&lt;suffix&gt;.java</span></code> where <code class="docutils literal"><span class="pre">&lt;suffix&gt;</span></code>
is either data or service.</p>
<div class="section" id="data-interface">
<h6>Data Interface<a class="headerlink" href="#data-interface" title="Permalink to this headline">¶</a></h6>
<p>Data Interface has a mapping similar to container, but contains only top
level nodes defined in module.</p>
<p>Data interface serves only as marker interface for type-safe APIs of
<code class="docutils literal"><span class="pre">InstanceIdentifier</span></code>.</p>
</div>
<div class="section" id="service-interface">
<h6>Service Interface<a class="headerlink" href="#service-interface" title="Permalink to this headline">¶</a></h6>
<p>Service Interface serves to describe RPC contract defined in the module.
This RPC contract is defined by <code class="docutils literal"><span class="pre">rpc</span></code> statements.</p>
<p>RPC implementation usually implement this interface and users of the
RPCs use this interface to invoke RPCs.</p>
</div>
</div>
<div class="section" id="container-statement">
<h5>container statement<a class="headerlink" href="#container-statement" title="Permalink to this headline">¶</a></h5>
<p>YANG containers are mapped to Java interfaces which extend the Java
DataObject and Augmentable&lt;container-interface&gt;, where
container-interface is the name of the mapped interface.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">ChildOf</span><span class="o">&lt;...&gt;</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="leaf-statement">
<h5>Leaf statement<a class="headerlink" href="#leaf-statement" title="Permalink to this headline">¶</a></h5>
<p>Each leaf has to contain at least one type substatement. The leaf is
mapped to getter method of parent statement with return type equal to
type substatement value.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">getLf</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Represents <code class="docutils literal"><span class="pre">leaf</span> <span class="pre">lf</span></code></li>
</ul>
</div>
<div class="section" id="leaf-list-statement">
<h5>leaf-list statement<a class="headerlink" href="#leaf-list-statement" title="Permalink to this headline">¶</a></h5>
<p>Each leaf-list has to contain one type substatement. The leaf-list is
mapped to getter method of parent statement with return type equal to
List of type substatement value.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">getLfLst</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="list-statement">
<h5>list statement<a class="headerlink" href="#list-statement" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">list</span></code> statements are mapped to Java interfaces and a getter method is
generated in the interface associated with it’s parent statement. The
return type of getter the method is a Java List of objects implementing
the interface generated corresponding to the <code class="docutils literal"><span class="pre">list</span> <span class="pre">statement.</span>
<span class="pre">Mapping</span> <span class="pre">of</span> <span class="pre">`list</span></code> substatement to Java:</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>The list statement <code class="docutils literal"><span class="pre">example-list</span></code> is mapped to the Java interface
<code class="docutils literal"><span class="pre">ExampleList</span></code> and the <code class="docutils literal"><span class="pre">Cont</span></code> interface (parent of <code class="docutils literal"><span class="pre">ExampleList</span></code>)
contains getter method with return type <code class="docutils literal"><span class="pre">List&lt;ExampleList&gt;</span></code>. The
presence of a <code class="docutils literal"><span class="pre">key</span></code> statement, triggers generation of
<code class="docutils literal"><span class="pre">ExampleListKey</span></code>, which may be used to identify item in list.</p>
<p>The end result is this Java:</p>
<p><strong>OutterList.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="o">.</span><span class="n">cont</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">Java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.outter.list.ListInList</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">OutterList</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">OutterList</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">getLeafListInList</span><span class="p">();</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">ListInList</span><span class="o">&gt;</span> <span class="n">getListInList</span><span class="p">();</span>

    <span class="o">/*</span>
    <span class="n">Returns</span> <span class="n">Primary</span> <span class="n">Key</span> <span class="n">of</span> <span class="n">Yang</span> <span class="n">List</span> <span class="n">Type</span>
    <span class="o">*/</span>
    <span class="n">OutterListKey</span> <span class="n">getOutterListKey</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>OutterListKey.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span>package org.opendaylight.yang.gen.v1.urn.module.rev201379.cont;

import org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.OutterListKey;
import Java.math.BigInteger;

public class OutterListKey {

    private BigInteger _leafInList;

    public OutterListKey(BigInteger _leafInList) {
        super();
        this_leafInList = _leafInList;
    }

    public BigInteger getLeafInList() {
        return _leafInList;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((_leafInList == null) ? 0 : _leafInList.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        OutterListKey other = (OutterListKey) obj;
        if (_leafInList == null) {
            if (other._LeafInList != null) {
                return false;
            }
        } else if(!_leafInList.equals(other._leafInList)) {
            return false;
        }
        return true;
    }

    @Override
    public String toString() {
        StringBuilder builder = new StringBuilder();
        builder.append(&quot;OutterListKey [_leafInList=&quot;);
        builder.append(_leafInList);
        builder.append(&quot;]&quot;);
        return builder.toString();
    }
}
</pre></div>
</div>
</div>
<div class="section" id="choice-and-case-statements">
<h5>choice and case statements<a class="headerlink" href="#choice-and-case-statements" title="Permalink to this headline">¶</a></h5>
<p>A <code class="docutils literal"><span class="pre">choice</span></code> element is mapped in mostly the same way a <code class="docutils literal"><span class="pre">list</span></code> element
is. The <code class="docutils literal"><span class="pre">choice</span></code> element is mapped to and interface (marker interface)
and a new getter method with the return type of a Java <code class="docutils literal"><span class="pre">List</span></code> of this
marker interfaces is added to the interface corresponding to the parent
statement. Any <code class="docutils literal"><span class="pre">case</span></code> substatements are mapped to Java interfaces
which extend the marker interface.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.ChoiceTest</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">ExampleChoice</span> <span class="n">getExampleChoice</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>ExampleChoice.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="o">.</span><span class="n">cont</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">ExampleChoice</span> <span class="n">extends</span> <span class="n">DataContainer</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>FooCase.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="o">.</span><span class="n">cont</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">choice</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.ChoiceTest</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">FooCase</span> <span class="n">extends</span> <span class="n">ExampleChoice</span><span class="p">,</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">FooCase</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">String</span> <span class="n">getFoo</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>BarCase.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="o">.</span><span class="n">cont</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">choice</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yang.gen.v1.urn.module.rev201379.cont.ChoiceTest</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">BarCase</span> <span class="n">extends</span> <span class="n">ExampleChoice</span><span class="p">,</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">BarCase</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">String</span> <span class="n">getBar</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="grouping-and-uses-statements">
<h5>grouping and uses statements<a class="headerlink" href="#grouping-and-uses-statements" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">grouping`s</span> <span class="pre">are</span> <span class="pre">mapped</span> <span class="pre">to</span> <span class="pre">Java</span> <span class="pre">interfaces.</span> <span class="pre">`uses</span></code> statements in some
element (using of concrete grouping) are mapped as extension of
interface for this element with the interface which represents grouping.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG Model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Grp.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Grp</span> <span class="n">extends</span> <span class="n">DataObject</span> <span class="p">{</span>

    <span class="n">String</span> <span class="n">getFoo</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Grp</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="rpc-input-and-output-statements">
<h5>rpc, input and output statements<a class="headerlink" href="#rpc-input-and-output-statements" title="Permalink to this headline">¶</a></h5>
<p>An <code class="docutils literal"><span class="pre">rpc</span></code> statement is mapped to Java as method of class
<code class="docutils literal"><span class="pre">ModuleService.java</span></code>. Any substatements of an <code class="docutils literal"><span class="pre">rpc</span></code> are mapped as
follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Rpc Substatement</th>
<th class="head">Mapping</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>input</td>
<td>presence of input statement triggers
generation of interface</td>
</tr>
<tr class="row-odd"><td>output</td>
<td>presence of output statement
triggers generation of interface</td>
</tr>
</tbody>
</table>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>ModuleService.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">Java.util.concurrent.Future</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.common.RpcResult</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">ModuleService</span> <span class="p">{</span>

    <span class="n">Future</span><span class="o">&lt;</span><span class="n">RpcResult</span><span class="o">&lt;</span><span class="n">RpcTest1Output</span><span class="o">&gt;&gt;</span> <span class="n">rpcTest1</span><span class="p">(</span><span class="n">RpcTest1Input</span> <span class="nb">input</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>RpcTest1Input.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">RpcTest1Input</span> <span class="p">{</span>

    <span class="n">String</span> <span class="n">getLfInput</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>RpcTest1Output.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">RpcTest1Output</span> <span class="p">{</span>

    <span class="n">String</span> <span class="n">getLfOutput</span><span class="p">();</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="notification-statement">
<h5>notification statement<a class="headerlink" href="#notification-statement" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">notification</span></code> statements are mapped to Java interfaces which extend
the Notification interface.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Notif.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>


<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Notification</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Notif</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Notif</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">Notification</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="augment-statement">
<h4>augment statement<a class="headerlink" href="#augment-statement" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">augment</span></code> statements are mapped to Java interfaces. The interface
starts with the same name as the name of augmented interface with a
suffix corresponding to the order number of augmenting interface. The
augmenting interface also extends <code class="docutils literal"><span class="pre">Augmentation&lt;&gt;</span></code> with actual type
parameter equal to augmented interface.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG Model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>Cont.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentable</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Cont</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentable</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<p><strong>Cont1.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">org</span><span class="o">.</span><span class="n">opendaylight</span><span class="o">.</span><span class="n">yang</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">urn</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">rev201379</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.DataObject</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.opendaylight.yangtools.yang.binding.Augmentation</span><span class="p">;</span>

<span class="n">public</span> <span class="n">interface</span> <span class="n">Cont1</span> <span class="n">extends</span> <span class="n">DataObject</span><span class="p">,</span> <span class="n">Augmentation</span><span class="o">&lt;</span><span class="n">Cont</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="yang-type-mapping">
<h4>YANG Type mapping<a class="headerlink" href="#yang-type-mapping" title="Permalink to this headline">¶</a></h4>
<div class="section" id="typedef-statement">
<h5>typedef statement<a class="headerlink" href="#typedef-statement" title="Permalink to this headline">¶</a></h5>
<p>YANG <code class="docutils literal"><span class="pre">typedef</span></code> statements are mapped to Java classes. A <code class="docutils literal"><span class="pre">typedef</span></code>
may contain following substatements:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Substatement</th>
<th class="head">Behaviour</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>type</td>
<td>determines wrapped type and how
class will be generated</td>
</tr>
<tr class="row-odd"><td>descripton</td>
<td>Javadoc description</td>
</tr>
<tr class="row-even"><td>units</td>
<td>is not mapped</td>
</tr>
<tr class="row-odd"><td>default</td>
<td>is not mapped</td>
</tr>
</tbody>
</table>
<div class="section" id="valid-arguments-type">
<h6>Valid Arguments Type<a class="headerlink" href="#valid-arguments-type" title="Permalink to this headline">¶</a></h6>
<p>Simple values of type argument are mapped as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">YANG Type</th>
<th class="head">Java type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>boolean</td>
<td>Boolean</td>
</tr>
<tr class="row-odd"><td>empty</td>
<td>Boolean</td>
</tr>
<tr class="row-even"><td>int8</td>
<td>Byte</td>
</tr>
<tr class="row-odd"><td>int16</td>
<td>Short</td>
</tr>
<tr class="row-even"><td>int32</td>
<td>Integer</td>
</tr>
<tr class="row-odd"><td>int64</td>
<td>Long</td>
</tr>
<tr class="row-even"><td>string</td>
<td>String or, wrapper class (if pattern
substatement is specified)</td>
</tr>
<tr class="row-odd"><td>decimal64</td>
<td>Double</td>
</tr>
<tr class="row-even"><td>uint8</td>
<td>Short</td>
</tr>
<tr class="row-odd"><td>uint16</td>
<td>Integer</td>
</tr>
<tr class="row-even"><td>uint32</td>
<td>Long</td>
</tr>
<tr class="row-odd"><td>uint64</td>
<td>BigInteger</td>
</tr>
<tr class="row-even"><td>binary</td>
<td>byte[]</td>
</tr>
</tbody>
</table>
<p>Complex values of type argument are mapped as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument Type</th>
<th class="head">Java type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>enumeration</td>
<td>generated java enum</td>
</tr>
<tr class="row-odd"><td>bits</td>
<td>generated class for bits</td>
</tr>
<tr class="row-even"><td>leafref</td>
<td>same type as referenced leaf</td>
</tr>
<tr class="row-odd"><td>identityref</td>
<td>Class</td>
</tr>
<tr class="row-even"><td>union</td>
<td>generated java class</td>
</tr>
<tr class="row-odd"><td>instance-identifier</td>
<td><code class="docutils literal"><span class="pre">org.opendaylight.yangtools.yang.bi</span>
<span class="pre">nding.InstanceIdentifier</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="enumeration-substatement-enum">
<h5>Enumeration Substatement Enum<a class="headerlink" href="#enumeration-substatement-enum" title="Permalink to this headline">¶</a></h5>
<p>The YANG <code class="docutils literal"><span class="pre">enumeration</span></code> type has to contain some <code class="docutils literal"><span class="pre">enum</span></code>
substatements. An <code class="docutils literal"><span class="pre">enumeration</span></code> is mapped as Java enum type
(standalone class) and every YANG enum substatements is mapped to Java
enum’s predefined values.</p>
<p>An <code class="docutils literal"><span class="pre">enum</span></code> statement can have following substatements:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Enum’s Substatement</th>
<th class="head">Java mapping</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>description</td>
<td>is not mapped in API</td>
</tr>
<tr class="row-odd"><td>value</td>
<td>mapped as input parameter for every
predefined value of enum</td>
</tr>
</tbody>
</table>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>TypedefEnumeration.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">enum</span> <span class="n">TypedefEnumeration</span> <span class="p">{</span>
    <span class="n">Enum1</span><span class="p">(</span><span class="mi">18</span><span class="p">),</span>
    <span class="n">Enum2</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
    <span class="n">Enum3</span><span class="p">(</span><span class="mi">19</span><span class="p">);</span>

    <span class="nb">int</span> <span class="n">value</span><span class="p">;</span>

    <span class="n">private</span> <span class="n">TypedefEnumeration</span><span class="p">(</span><span class="nb">int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="bitss-substatement-bit">
<h5>Bits’s Substatement Bit<a class="headerlink" href="#bitss-substatement-bit" title="Permalink to this headline">¶</a></h5>
<p>The YANG <code class="docutils literal"><span class="pre">bits</span></code> type has to contain some bit substatements. YANG
<code class="docutils literal"><span class="pre">bits</span></code> is mapped to a Java class (standalone class) and every YANG
<code class="docutils literal"><span class="pre">bits</span></code> substatements is mapped to a boolean attribute of that class.
In addition, the class provides overridden versions of the Object
methods <code class="docutils literal"><span class="pre">hashCode</span></code>, <code class="docutils literal"><span class="pre">toString</span></code>, and <code class="docutils literal"><span class="pre">equals</span></code>.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG Model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>TypedefBits.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span>public class TypedefBits {

    private Boolean firstBit;
    private Boolean secondBit;

    public TypedefBits() {
        super();
    }

    public Boolean getFirstBit() {
        return firstBit;
    }

    public void setFirstBit(Boolean firstBit) {
        this.firstBit = firstBit;
    }

    public Boolean getSecondBit() {
        return secondBit;
    }

    public void setSecondBit(Boolean secondBit) {
        this.secondBit = secondBit;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result +
         ((firstBit == null) ? 0 : firstBit.hashCode());
        result = prime * result +
         ((secondBit == null) ? 0 : secondBit.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        TypedefBits other = (TypedefBits) obj;
        if (firstBit == null) {
            if (other.firstBit != null) {
                return false;
            }
        } else if(!firstBit.equals(other.firstBit)) {
            return false;
        }
        if (secondBit == null) {
            if (other.secondBit != null) {
                return false;
            }
        } else if(!secondBit.equals(other.secondBit)) {
            return false;
        }
        return true;
    }

    @Override
    public String toString() {
        StringBuilder builder = new StringBuilder();
        builder.append(&quot;TypedefBits [firstBit=&quot;);
        builder.append(firstBit);
        builder.append(&quot;, secondBit=&quot;);
        builder.append(secondBit);
        builder.append(&quot;]&quot;);
        return builder.toString();
    }
}
</pre></div>
</div>
</div>
<div class="section" id="unions-substatement-type">
<h5>Union’s Substatement Type<a class="headerlink" href="#unions-substatement-type" title="Permalink to this headline">¶</a></h5>
<p>If the type of a <code class="docutils literal"><span class="pre">typedef</span></code> is <code class="docutils literal"><span class="pre">union</span></code>, it has to contain <code class="docutils literal"><span class="pre">type</span></code>
substatements. The <code class="docutils literal"><span class="pre">union</span> <span class="pre">typedef</span></code> is mapped to class and its <code class="docutils literal"><span class="pre">type</span></code>
substatements are mapped to private class members. Every YANG union
subtype gets its own Java constructor with a parameter which represent
just that one attribute.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>TypdefUnion.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span>public class TypedefUnion {

    private Integer int32;
    private String string;

    public TypedefUnion(Integer int32) {
        super();
        this.int32 = int32;
    }

    public TypedefUnion(String string) {
        super();
        this.string = string;
    }

    public Integer getInt32() {
        return int32;
    }

    public String getString() {
        return string;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((int32 == null) ? 0 : int32.hashCode());
        result = prime * result + ((string == null) ? 0 : string.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        TypedefUnion other = (TypedefUnion) obj;
        if (int32 == null) {
            if (other.int32 != null) {
                return false;
            }
        } else if(!int32.equals(other.int32)) {
            return false;
        }
        if (string == null) {
            if (other.string != null) {
                return false;
            }
        } else if(!string.equals(other.string)) {
            return false;
        }
        return true;
    }

    @Override
    public String toString() {
        StringBuilder builder = new StringBuilder();
        builder.append(&quot;TypedefUnion [int32=&quot;);
        builder.append(int32);
        builder.append(&quot;, string=&quot;);
        builder.append(string);
        builder.append(&quot;]&quot;);
        return builder.toString();
    }
}
</pre></div>
</div>
</div>
<div class="section" id="string-mapping">
<h5>String Mapping<a class="headerlink" href="#string-mapping" title="Permalink to this headline">¶</a></h5>
<p>The YANG <code class="docutils literal"><span class="pre">string</span></code> type can contain the substatements <code class="docutils literal"><span class="pre">length</span></code> and
<code class="docutils literal"><span class="pre">pattern</span></code> which are mapped as follows:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type substatements</th>
<th class="head">Mapping to Java</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>length</td>
<td>not mapped</td>
</tr>
<tr class="row-odd"><td>pattern</td>
<td><div class="first last line-block">
<div class="line">. list of string constants = list
of patterns</div>
<div class="line">. list of Pattern objects</div>
<div class="line">. static initialization block
where list of Patterns is
initialized from list of string of
constants</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>For example, the following YANG:</p>
<p><strong>YANG model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>TypedefString.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span>public class TypedefString {

    private static final List&lt;Pattern&gt; patterns = new ArrayList&lt;Pattern&gt;();
    public static final List&lt;String&gt; PATTERN`CONSTANTS = Arrays.asList(&quot;[a][.]*&quot;);

    static {
        for (String regEx : PATTERN`CONSTANTS) {
            patterns.add(Pattern.compile(regEx));
        }
    }

    private String typedefString;

    public TypedefString(String typedefString) {
        super();
        // Pattern validation
        this.typedefString = typedefString;
    }

    public String getTypedefString() {
        return typedefString;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((typedefString == null) ? 0 : typedefString.hashCode());
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        TypedefString other = (TypedefString) obj;
        if (typedefString == null) {
            if (other.typedefString != null) {
                return false;
            }
        } else if(!typedefString.equals(other.typedefString)) {
            return false;
        }
        return true;
    }

    @Override
    public String toString() {
        StringBuilder builder = new StringBuilder();
        builder.append(&quot;TypedefString [typedefString=&quot;);
        builder.append(typedefString);
        builder.append(&quot;]&quot;);
        return builder.toString();
    }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="identity-statement">
<h4>identity statement<a class="headerlink" href="#identity-statement" title="Permalink to this headline">¶</a></h4>
<p>The purpose of the <code class="docutils literal"><span class="pre">identity</span></code> statement is to define a new globally
unique, abstract, and untyped value.</p>
<p>The <code class="docutils literal"><span class="pre">base</span></code> substatement argument is the name of existing identity from
which the new identity is derived.</p>
<p>Given that, an <code class="docutils literal"><span class="pre">identity</span></code> statement is mapped to Java abstract class
and any <code class="docutils literal"><span class="pre">base</span></code> substatements are mapped as <code class="docutils literal"><span class="pre">extends</span></code> Java keyword.
The identity name is translated to class name.</p>
<p>For example, the following YANG:</p>
<p><strong>YANG Model.</strong></p>
<p>is converted into this Java:</p>
<p><strong>ToastType.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">ToastType</span> <span class="n">extends</span> <span class="n">BaseIdentity</span> <span class="p">{</span>
    <span class="n">protected</span> <span class="n">ToastType</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>WhiteBread.java.</strong></p>
<div class="code java highlight-default"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">WhiteBread</span> <span class="n">extends</span> <span class="n">ToastType</span> <span class="p">{</span>
    <span class="n">protected</span> <span class="n">WhiteBread</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">super</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="yang-push-developer-guide">
<h2>YANG-PUSH Developer Guide<a class="headerlink" href="#yang-push-developer-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id94">
<h3>Overview<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h3>
<p>The YANG PUBSUB project allows subscriptions to be placed on targeted
subtrees of YANG datastores residing on remote devices. Changes in YANG
objects within the remote subtree can be pushed to an OpenDaylight
controller as specified without a requiring the controller to make a
continuous set of fetch requests.</p>
<div class="section" id="yang-push-capabilities-available">
<h4>YANG-PUSH capabilities available<a class="headerlink" href="#yang-push-capabilities-available" title="Permalink to this headline">¶</a></h4>
<p>This module contains the base code which embodies the intent of
YANG-PUSH requirements for subscription as defined in
{i2rs-pub-sub-requirements}
[<a class="reference external" href="https://datatracker.ietf.org/doc/draft-ietf-i2rs-pub-sub-requirements/">https://datatracker.ietf.org/doc/draft-ietf-i2rs-pub-sub-requirements/</a>].
The mechanism for delivering on these YANG-PUSH requirements over
Netconf transport is defined in {netconf-yang-push} [netconf-yang-push:
<a class="reference external" href="https://tools.ietf.org/html/draft-ietf-netconf-yang-push-00">https://tools.ietf.org/html/draft-ietf-netconf-yang-push-00</a>].</p>
<p>Note that in the current release, not all capabilities of
draft-ietf-netconf-yang-push are realized. Currently only implemented is
<strong>create-subscription</strong> RPC support from
<a class="reference external" href="mailto:ietf-datastore-push&#37;&#52;&#48;2015-10-15&#46;yang">ietf-datastore-push<span>&#64;</span>2015-10-15<span>&#46;</span>yang</a>; and this will be for periodic
subscriptions only. There of course is intent to provide much additional
functionality in future OpenDaylight releases.</p>
</div>
<div class="section" id="future-yang-push-capabilities">
<h4>Future YANG-PUSH capabilities<a class="headerlink" href="#future-yang-push-capabilities" title="Permalink to this headline">¶</a></h4>
<p>Over time, the intent is to flesh out more robust capabilities which
will allow OpenDaylight applications to subscribe to YANG-PUSH compliant
devices. Capabilities for future releases will include:</p>
<p>Support for subscription change/delete: <strong>modify-subscription</strong> rpc
support for all mountpoint devices or particular mountpoint device
<strong>delete-subscription</strong> rpc support for all mountpoint devices or
particular mountpoint device</p>
<p>Support for static subscriptions: This will enable the receipt of
subscription updates pushed from publishing devices where no signaling
from the controller has been used to establish the subscriptions.</p>
<p>Support for additional transports: NETCONF is not the only transport of
interest to OpenDaylight or the subscribed devices. Over time this code
will support Restconf and HTTP/2 transport requirements defined in
{netconf-restconf-yang-push}
[<a class="reference external" href="https://tools.ietf.org/html/draft-voit-netconf-restconf-yang-push-01">https://tools.ietf.org/html/draft-voit-netconf-restconf-yang-push-01</a>]</p>
</div>
</div>
<div class="section" id="yang-push-architecture">
<h3>YANG-PUSH Architecture<a class="headerlink" href="#yang-push-architecture" title="Permalink to this headline">¶</a></h3>
<p>The code architecture of Yang push consists of two main elements</p>
<p>YANGPUSH Provider YANGPUSH Listener</p>
<p>YANGPUSH Provider receives create-subscription requests from
applications and then establishes/registers the corresponding listener
which will receive information pushed by a publisher. In addition,
YANGPUSH Provider also invokes an augmented OpenDaylight
create-subscription RPC which enables applications to register for
notification as per rfc5277. This augmentation adds periodic time period
(duration) and subscription-id values to the existing RPC parameters.
The Java package supporting this capability is
“org.opendaylight.yangpush.impl”. Below class supports the YANGPUSH
Provider capability:</p>
<p>(1) YangpushDomProvider The Binding Independent version. It uses a
neutral data Document Object Model format for data and API calls, which
is independent of any generated Java language bindings from the YANG
model.</p>
<p>The YANGPUSH Listener accepts update notifications from a device after
they have been de-encapsulated from the NETCONF transport. The YANGPUSH
Listener then passes these updates to MD-SAL. This function is
implemented via the YangpushDOMNotificationListener class within the
“org.opendaylight.yangpush.listner” Java package.</p>
</div>
<div class="section" id="id95">
<h3>Key APIs and Interfaces<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h3>
<div class="section" id="yangpushdomprovider">
<h4>YangpushDomProvider<a class="headerlink" href="#yangpushdomprovider" title="Permalink to this headline">¶</a></h4>
<p>Central to this is onSessionInitiated which acquires the Document Object
Model format based versions of MD-SAL services, including the MountPoint
service and RPCs. Via these acquired services, invoke
registerDataChangeListener over in YangpushDOMNotificationListener.</p>
</div>
<div class="section" id="yangpushdomnotificationlistener">
<h4>YangpushDOMNotificationListener<a class="headerlink" href="#yangpushdomnotificationlistener" title="Permalink to this headline">¶</a></h4>
<p>This API handles instances of a received Push Updates which are inbound
to the listener and places these in MD-SAL. Key classes in include:</p>
<p>onPushUpdate Converts and validates the encoding of the pushed
subscription update. If the subscription exists and is active, calls
updateDataStoreForPushUpdate so that the information can be put in
MD-SAL. Finally logs the pushed subscription update as well as some
additional context information.</p>
<p>updateDataStoreForPushUpdate Used to put the published information into
MD-SAL. This pushed information will also include elements such as the
subscription-id, the identity of the publisher, the time of the update,
the incoming encoding type, and the pushed YANG subtree information.</p>
<p>YangpushDOMNotificationListener Starts the listener tracking a new
Subscription ID from a particular publisher.</p>
</div>
</div>
<div class="section" id="id96">
<h3>API Reference Documentation<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h3>
<p>Javadocs are generated while creating mvn:site and they are located in
target/ directory in each module.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, OpenDaylight Project.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>